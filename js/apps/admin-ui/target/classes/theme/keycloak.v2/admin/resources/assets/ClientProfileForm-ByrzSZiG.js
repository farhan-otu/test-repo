import{jsx as e,jsxs as o,Fragment as x}from"react/jsx-runtime";import{u as J,a as Q,b as U,l as W,c0 as X,V as Y,e as Z,j as ee,B as te,q as y,f4 as w,f2 as T,y as ie,ap as re,D as ae,P as oe,n as le,J as se,bo as ne,A as ce,f as d,L as P,aw as de,ax as L,H as F,I as V,_ as S,fk as me,ac as ue,fl as fe,a8 as pe}from"./main-hjbDDO6j.js";import{useState as h,useMemo as xe,Fragment as Pe}from"react";import{u as he}from"./ConfirmDialog-DN_NVsrg.js";import{F as Ce}from"./FormAccess-DEsYjDHG.js";import{V as be}from"./ViewHeader-Dr6ZoEJz.js";import{u as ge}from"./useParams-XtwJXIDJ.js";/* empty css                               */import{d as ve,D as ke,a as ye,b as Te,c as Ee}from"./DataListItemRow-C-0mzg8R.js";import{T as De}from"./trash-icon-fO6THQ8J.js";import"react-dom";import"./copy-icon-ePLWnxgr.js";const Ie={name:"",description:"",executors:[]};function qe(){const{adminClient:p}=J(),{t}=Q(),C=U(),E=W({defaultValues:Ie,mode:"onChange"}),{handleSubmit:A,setValue:b,getValues:H,formState:{isDirty:D},control:B}=E,{fields:g,remove:G}=X({name:"executors",control:B}),{addAlert:v,addError:k}=Y(),[m,j]=h(),[a,K]=h(!1),{realm:n,profileName:l}=ge(),q=Z(),M=xe(()=>q.componentTypes?.["org.keycloak.services.clientpolicy.executor.ClientPolicyExecutorProvider"],[]),[u,O]=h(),c=!!l,[I,R]=h(0),_=()=>R(I+1);ee(()=>p.clientPolicies.listProfiles({includeGlobalProfiles:!0}),i=>{j({globalProfiles:i.globalProfiles,profiles:i.profiles?.filter(f=>f.name!==l)});const s=i.globalProfiles?.find(f=>f.name===l),r=i.profiles?.find(f=>f.name===l);K(s!==void 0),b("name",s?.name??r?.name??""),b("description",s?.description??r?.description??""),b("executors",s?.executors??r?.executors??[])},[I]);const $=async i=>{const s=i;try{await p.clientPolicies.createProfiles({...m,profiles:[...m?.profiles||[],s]}),v(t(c?"updateClientProfileSuccess":"createClientProfileSuccess"),y.success),C(w({realm:n,profileName:i.name}))}catch(r){k(c?"updateClientProfileError":"createClientProfileError",r)}},[N,z]=he({titleKey:u?.name?t("deleteExecutorProfileConfirmTitle"):t("deleteClientProfileConfirmTitle"),messageKey:u?.name?t("deleteExecutorProfileConfirm",{executorName:u.name}):t("deleteClientProfileConfirm",{profileName:l}),continueButtonLabel:t("delete"),continueButtonVariant:te.danger,onConfirm:async()=>{if(u?.name){G(u.idx);try{await p.clientPolicies.createProfiles({...m,profiles:[...m.profiles||[],H()]}),v(t("deleteExecutorSuccess"),y.success),C(w({realm:n,profileName:l}))}catch(i){k("deleteExecutorError",i)}}else try{await p.clientPolicies.createProfiles(m),v(t("deleteClientSuccess"),y.success),C(T({realm:n,tab:"profiles"}))}catch(i){k("deleteClientError",i)}}});return m?o(x,{children:[e(z,{}),e(be,{titleKey:c?l:t("newClientProfile"),badges:[{id:"global-client-profile-badge",text:a?e(re,{color:"blue",children:t("global")}):""}],divider:!0,dropdownItems:c&&!a?[e(ae,{value:"delete",onClick:N,"data-testid":"deleteClientProfileDropdown",children:t("deleteClientProfile")},"delete")]:void 0}),e(oe,{variant:"light",children:e(le,{...E,children:o(Ce,{isHorizontal:!0,role:"view-realm",className:"pf-v5-u-mt-lg",children:[e(se,{name:"name",label:t("newClientProfileName"),helperText:t("createClientProfileNameHelperText"),readOnly:a,rules:{required:t("required")}}),e(ne,{name:"description",label:t("description"),readOnly:a}),o(ce,{children:[!a&&e(d,{variant:"primary",onClick:()=>A($)(),"data-testid":"saveCreateProfile",isDisabled:!D,children:t("save")}),c&&!a&&e(d,{id:"reloadProfile",variant:"link","data-testid":"reloadProfile",isDisabled:!D,onClick:_,children:t("reload")}),!c&&!a&&e(d,{id:"cancelCreateProfile",variant:"link",component:i=>e(P,{...i,to:T({realm:n,tab:"profiles"})}),"data-testid":"cancelCreateProfile",children:t("cancel")})]}),c&&o(x,{children:[o(de,{children:[e(L,{children:o(F,{className:"kc-executors",component:V.h1,children:[t("executors"),e(S,{helpText:t("executorsHelpText"),fieldLabelId:"executors"})]})}),!a&&e(L,{align:{default:"alignRight"},children:e(d,{id:"addExecutor",component:i=>e(P,{...i,to:me({realm:n,profileName:l})}),variant:"link",className:"kc-addExecutor","data-testid":"addExecutor",icon:e(ue,{}),children:t("addExecutor")})})]}),g.length>0&&o(x,{children:[e(ve,{"aria-label":t("executors"),isCompact:!0,children:g.map((i,s)=>e(ke,{"aria-labelledby":"executors-list-item",id:i.executor,children:e(ye,{"data-testid":"executors-list-row",children:e(Te,{dataListCells:[o(Ee,{"data-testid":"executor-type",children:[i.configuration?e(d,{component:r=>e(P,{...r,to:fe({realm:n,profileName:l,executorName:i.executor})}),variant:"link","data-testid":"editExecutor",children:i.executor}):e("span",{className:"kc-unclickable-executor",children:i.executor}),M?.filter(r=>r.id===i.executor).map(r=>o(Pe,{children:[e(S,{helpText:r.helpText,fieldLabelId:"executorTypeTextHelpText"},r.id),!a&&e(d,{variant:"link",isInline:!0,icon:e(De,{className:"kc-executor-trash-icon","data-testid":"deleteExecutor"},`executorType-trash-icon-${r.id}`),onClick:()=>{N(),O({idx:s,name:r.id})},"aria-label":t("remove")})]},r.id))]},"executor")]})})},i.executor))}),a&&e(d,{id:"backToClientPolicies",component:i=>e(P,{...i,to:T({realm:n,tab:"profiles"})}),variant:"primary",className:"kc-backToPolicies","data-testid":"backToClientPolicies",children:t("back")})]}),g.length===0&&o(x,{children:[e(pe,{}),e(F,{className:"kc-emptyExecutors",component:V.h2,children:t("emptyExecutors")})]})]})]})})})]}):e(ie,{})}export{qe as default};
//# sourceMappingURL=ClientProfileForm-ByrzSZiG.js.map
