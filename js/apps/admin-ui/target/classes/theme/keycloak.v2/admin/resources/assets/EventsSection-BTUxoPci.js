import{jsx as e,jsxs as l,Fragment as $}from"react/jsx-runtime";import{d as I,L as ee,bl as fe,bN as _e,dg as ge,bu as ve,cA as Ce,ao as Ee,cT as Re,dh as U,u as Ae,a as N,e as Oe,l as ke,bW as Ie,c1 as Ne,di as Fe,c2 as Pe,c3 as h,c4 as x,c5 as Se,c6 as d,w as De,n as Le,aw as we,ax as G,F as Ue,N as g,O as v,c7 as M,c8 as V,U as O,W as C,aj as H,J as T,A as xe,f as K,bx as Ge,h as Me,M as Ve,m as He,dj as k,dk as Ke,al as Be,P as je}from"./main-hjbDDO6j.js";import{u as B,R as We}from"./RoutableTabs-ChOqIl6o.js";import{V as Ze}from"./ViewHeader-Dr6ZoEJz.js";import{useState as u,useMemo as ze}from"react";import{D as Je}from"./DropdownPanel-D_qgc_Fl.js";import{u as Xe,F as qe}from"./useFormatDate-DtCZfuLt.js";import{U as Qe}from"./UserEvents-20oG-Z3I.js";import{p as Ye}from"./pickBy-DbcNzVCB.js";import{C as $e,L as et}from"./CodeEditor-BF8OqNGf.js";import{D as j}from"./DatePicker-ClawiStM.js";import{D as tt,a as W,b as Z,c as z}from"./DescriptionListTerm-BGpKKoC6.js";import{T as rt}from"./Trans-BCvPJnzT.js";import{a as J,b as X}from"./Tabs-TiG_cKa2.js";import"react-dom";import"./PageHandler-Dm6Ir_Zl.js";import"./DynamicComponents-2Oogxguf.js";import"./ClientSelect-Di5Ep3wz.js";import"./FileUpload-DFzHUp8z.js";import"./GroupPickerDialog-CJH5Fdnt.js";import"./DataListItemRow-C-0mzg8R.js";import"./KeySelect-CBdQO7FV.js";import"./MultiLineInput-BKovUfcB.js";import"./AddRoleMappingModal-B-7S42YC.js";import"./translationFormatter-aKDacg4X.js";import"./useLocaleSort-Bon3wgU4.js";import"./ConfirmDialog-DN_NVsrg.js";import"./filter-icon-I49U7vdU.js";import"./useParams-XtwJXIDJ.js";import"./constants-BclHbWtx.js";import"./warning-triangle-icon-CUSjnRec.js";import"./copy-icon-ePLWnxgr.js";const q=38,at=({text:a,children:t})=>{const o=a||"",i=o.length>q,E=o.substring(0,q);return i?e(fe,{content:a,children:t(E+"â€¦")}):t(o)},st=a=>a.operationType==="DELETE"?!1:a.resourceType==="USER"||a.resourceType==="GROUP_MEMBERSHIP"||a.resourceType==="GROUP"||a.resourceType==="CLIENT"||a.resourceType==="ORGANIZATION"||a.resourceType==="ORGANIZATION_MEMBERSHIP"||a.resourceType?.startsWith("AUTHORIZATION_RESOURCE")||a.resourceType==="CLIENT_SCOPE"||a.resourceType==="AUTH_FLOW"||a.resourcePath?.startsWith("roles-by-id"),nt=new RegExp(/([0-9a-fA-F]{8}-([0-9a-fA-F]{4}-){3}[0-9a-fA-F]{12})/),ot=(a,t)=>{const o=nt.exec(t.resourcePath);if(!o)return console.warn("event didn't contain a valid link",t),"";const i=o[1];return t.resourceType==="CLIENT"||t.resourceType?.startsWith("AUTHORIZATION_RESOURCE")?_e({realm:a,clientId:i,tab:t.resourceType==="CLIENT"?"settings":"authorization"}):t.resourceType==="GROUP"?ge({realm:a,id:i}):t.resourceType==="CLIENT_SCOPE"?ve({realm:a,id:i,tab:"settings"}):t.resourceType==="USER"||t.resourceType==="GROUP_MEMBERSHIP"?Ce({realm:a,id:i,tab:"settings"}):t.resourceType==="AUTH_FLOW"?Ee({realm:a,id:i,usedBy:"-"}):t.resourcePath?.startsWith("roles-by-id")?Re({realm:a,id:i,tab:"details"}):t.resourceType==="ORGANIZATION"?U({realm:a,id:i,tab:"settings"}):t.resourceType==="ORGANIZATION_MEMBERSHIP"?U({realm:a,id:i,tab:"members"}):""},it=({event:a})=>{const{realm:t}=I();return e(at,{text:a.resourcePath,children:o=>st(a)?e(ee,{to:ot(t,a),children:o}):e("span",{children:o})})},lt=a=>e(it,{event:a}),Q={resourceTypes:[],operationTypes:[],resourcePath:"",dateFrom:"",dateTo:"",authClient:"",authUser:"",authRealm:"",authIpAddress:""},Y=({titleKey:a,onClose:t,children:o})=>{const{t:i}=N();return e(Ve,{variant:He.medium,title:i(a),isOpen:!0,onClose:t,children:o})},ct=a=>l(tt,{isHorizontal:!0,className:"keycloak_eventsection_details",children:[a.details&&Object.entries(a.details).map(([t,o])=>l(W,{children:[e(Z,{children:t}),e(z,{children:o})]},t)),a.error&&l(W,{children:[e(Z,{children:"error"}),e(z,{children:a.error})]},"error")]}),dt=()=>{const{adminClient:a}=Ae(),{t}=N(),{realm:o}=I(),i=Oe(),E=Xe(),te=i.enums?.resourceType,re=i.enums?.operationType,[F,ae]=u(0),[se,P]=u(!1),[ne,oe]=u(!1),[ie,le]=u(!1),[y,ce]=u({}),[p,S]=u(),[b,D]=u(),de={resourceTypes:t("resourceTypes"),operationTypes:t("operationTypes"),resourcePath:t("resourcePath"),dateFrom:t("dateFrom"),dateTo:t("dateTo"),authClient:t("client"),authUser:t("userId"),authRealm:t("realm"),authIpAddress:t("ipAddress")},L=ke({mode:"onChange",defaultValues:Q}),{getValues:R,reset:A,formState:{isDirty:w},control:f}=L;function ue(r,s){return a.realms.findAdminEvents({...y,realm:o,first:r,max:s})}function pe(){P(!1),_()}function me(){A(),_()}function he(r){const s={...R()};delete s[r],A({...Q,...s}),_()}function Te(r,s){const n=R(),c=n[r],m=Array.isArray(c)?c.filter(be=>be!==s):c;A({...n,[r]:m}),_()}function _(){const r=Ye(R(),s=>s!==""||Array.isArray(s)&&s.length>0);ce(r),ae(F+1)}const ye=ze(()=>b?.representation?Ie(JSON.parse(b.representation)):"",[b?.representation]);return l($,{children:[p&&e(Y,{titleKey:"auth",onClose:()=>S(void 0),children:l(Ne,{"aria-label":"authData","data-testid":"auth-dialog",variant:Fe.compact,children:[e(Pe,{children:l(h,{children:[e(x,{children:t("attribute")}),e(x,{children:t("value")})]})}),l(Se,{children:[l(h,{children:[e(d,{children:t("realm")}),e(d,{children:p.authDetails?.realmId})]}),l(h,{children:[e(d,{children:t("client")}),e(d,{children:p.authDetails?.clientId})]}),l(h,{children:[e(d,{children:t("user")}),e(d,{children:p.authDetails?.userId})]}),l(h,{children:[e(d,{children:t("ipAddress")}),e(d,{children:p.authDetails?.ipAddress})]})]})]})}),b&&e(Y,{titleKey:"representation","data-testid":"representation-dialog",onClose:()=>D(void 0),children:e($e,{isLineNumbersVisible:!0,isReadOnly:!0,code:ye,language:et.json,height:"8rem"})}),e(De,{className:"keycloak__events_table",loader:ue,detailColumns:[{name:"details",enabled:r=>r.details!==void 0,cellRenderer:ct}],isPaginated:!0,ariaLabelKey:"adminEvents",toolbarItem:e(Le,{...L,children:l(we,{direction:{default:"column"},spaceItems:{default:"spaceItemsNone"},children:[e(G,{children:e(Je,{buttonText:t("searchForAdminEvent"),setSearchDropdownOpen:P,searchDropdownOpen:se,marginRight:"2.5rem",width:"15vw",children:l(Ue,{isHorizontal:!0,className:"keycloak__events_search__form","data-testid":"searchForm",children:[e(g,{label:t("resourceTypes"),fieldId:"kc-resourceTypes",className:"keycloak__events_search__form_label",children:e(v,{name:"resourceTypes",control:f,render:({field:r})=>e(M,{className:"keycloak__events_search__type_select","data-testid":"resource-types-searchField",chipGroupProps:{numChips:1,expandedText:t("hide"),collapsedText:t("showRemaining")},variant:V.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:s=>oe(s),selections:r.value,onSelect:s=>{const n=s.toString(),c=r.value.includes(n)?r.value.filter(m=>m!==n):[...r.value,n];r.onChange(c)},onClear:()=>{r.onChange([])},isOpen:ne,"aria-labelledby":"resourceTypes",chipGroupComponent:e(O,{children:r.value.map(s=>e(C,{onClick:n=>{n.stopPropagation(),r.onChange(r.value.filter(c=>c!==s))},children:s},s))}),children:te?.map(s=>e(H,{value:s,children:s},s))})})}),e(g,{label:t("operationTypes"),fieldId:"kc-operationTypes",className:"keycloak__events_search__form_label",children:e(v,{name:"operationTypes",control:f,render:({field:r})=>e(M,{className:"keycloak__events_search__type_select","data-testid":"operation-types-searchField",chipGroupProps:{numChips:1,expandedText:t("hide"),collapsedText:t("showRemaining")},variant:V.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:s=>le(s),selections:r.value,onSelect:s=>{const n=s.toString(),c=r.value.includes(n)?r.value.filter(m=>m!==n):[...r.value,n];r.onChange(c)},onClear:()=>{r.onChange([])},isOpen:ie,"aria-labelledby":"operationTypes",chipGroupComponent:e(O,{children:r.value.map(s=>e(C,{onClick:n=>{n.stopPropagation(),r.onChange(r.value.filter(c=>c!==s))},children:s},s))}),children:re?.map(s=>e(H,{value:s,children:s},s.toString()))})})}),e(T,{name:"resourcePath",label:t("resourcePath")}),e(T,{name:"authRealm",label:t("realm")}),e(T,{name:"authClient",label:t("client")}),e(T,{name:"authUser",label:t("user")}),e(T,{name:"authIpAddress",label:t("ipAddress")}),e(g,{label:t("dateFrom"),fieldId:"kc-dateFrom",className:"keycloak__events_search__form_label",children:e(v,{name:"dateFrom",control:f,render:({field:r})=>e(j,{className:"pf-v5-u-w-100",value:r.value,onChange:(s,n)=>r.onChange(n),inputProps:{id:"kc-dateFrom"}})})}),e(g,{label:t("dateTo"),fieldId:"kc-dateTo",className:"keycloak__events_search__form_label",children:e(v,{name:"dateTo",control:f,render:({field:r})=>e(j,{className:"pf-v5-u-w-100",value:r.value,onChange:(s,n)=>r.onChange(n),inputProps:{id:"kc-dateTo"}})})}),l(xe,{children:[e(K,{variant:"primary",onClick:pe,"data-testid":"search-events-btn",isDisabled:!w,children:t("searchAdminEventsBtn")}),e(K,{variant:"secondary",onClick:me,isDisabled:!w,children:t("resetBtn")})]})]})})}),e(G,{children:Object.entries(y).length>0&&e("div",{className:"keycloak__searchChips pf-v5-u-ml-md",children:Object.entries(y).map(r=>{const[s,n]=r;return e(O,{className:"pf-v5-u-mt-md pf-v5-u-mr-md",categoryName:de[s],isClosable:!0,onClick:()=>he(s),children:typeof n=="string"?e(C,{isReadOnly:!0,children:n}):n.map(c=>e(C,{onClick:()=>Te(s,c),children:c},c))},s)})})})]})}),actions:[{title:t("auth"),onRowClick:r=>S(r)},{title:t("representation"),onRowClick:r=>D(r)}],columns:[{name:"time",displayKey:"time",cellRenderer:r=>E(new Date(r.time),qe)},{name:"resourcePath",displayKey:"resourcePath",cellRenderer:lt},{name:"resourceType",displayKey:"resourceType"},{name:"operationType",displayKey:"operationType",transforms:[Ge(10)]},{name:"",displayKey:"user",cellRenderer:r=>r.authDetails?.userId||""}],emptyState:e(Me,{message:t("emptyAdminEvents"),instructions:t("emptyAdminEventsInstructions")}),isSearching:Object.keys(y).length>0},F)]})};function Bt(){const{t:a}=N(),{realm:t}=I(),o=B(k({realm:t,tab:"user-events"})),i=B(k({realm:t,tab:"admin-events"}));return l($,{children:[e(Ze,{titleKey:"titleEvents",subKey:l(rt,{i18nKey:"eventExplain",children:["If you want to configure user events, Admin events or Event listeners, please enter",e(ee,{to:Ke({realm:t,tab:"events"}),children:a("eventConfig")}),"page realm settings to configure."]}),helpUrl:Be.eventsUrl,divider:!1}),e(je,{variant:"light",className:"pf-v5-u-p-0",children:l(We,{isBox:!0,defaultLocation:k({realm:t,tab:"user-events"}),children:[e(J,{title:e(X,{children:a("userEvents")}),...o,children:e(Qe,{})}),e(J,{title:e(X,{children:a("adminEvents")}),"data-testid":"admin-events-tab",...i,children:e(dt,{})})]})})]})}export{Bt as default};
//# sourceMappingURL=EventsSection-BTUxoPci.js.map
