import{jsxs as y,jsx as e,Fragment as A}from"react/jsx-runtime";import{au as ze,bI as U,cX as ge,ar as ct,cY as dt,cZ as ut,c_ as pt,c$ as ht,d0 as mt,a1 as ft,as as Ce,ce as gt,cf as Ct,d1 as yt,d2 as St,d3 as vt,u as te,a as R,Y as z,z as ce,d4 as Tt,j as ne,N as L,_ as F,O as V,ag as It,ah as re,d5 as bt,d6 as xt,U as Ke,W as We,d7 as Ot,f as _,d8 as kt,ai as Pt,a5 as ee,aj as ie,R as de,d as Rt,b as Be,B as se,cm as $t,c7 as Ye,c8 as Me,L as Je,cb as Xe,cq as Dt,M as Ze,m as Qe,bm as ye,bn as Se,w as Mt,bJ as Ae,D as xe,h as At,c1 as pe,c2 as he,c3 as J,c4 as G,c5 as me,c6 as j,cW as ke,a4 as Pe,J as ue,bo as Et,X as wt,aw as _t,ax as Ee,Z as et,a0 as oe,a3 as Vt,l as Nt,V as Ht,y as Lt,P as Ft,n as qt,A as Ut,cE as we,q as _e,G as Gt,H as Ve,I as jt}from"./main-hjbDDO6j.js";import*as O from"react";import{useState as k,useRef as zt,useCallback as Kt,useMemo as tt}from"react";import{u as nt}from"./ConfirmDialog-DN_NVsrg.js";import{F as Wt}from"./FormAccess-DEsYjDHG.js";import{V as Bt}from"./ViewHeader-Dr6ZoEJz.js";import{u as it}from"./useParams-XtwJXIDJ.js";import{u as st,m as ot}from"./useLocaleSort-Bon3wgU4.js";import{C as Yt}from"./ClientSelect-Di5Ep3wz.js";import{h as Jt}from"./ClientScopeTypes-CQeLlnWG.js";import{g as Xt}from"./utils-C-TUnOch.js";import{F as Ne}from"./filter-icon-I49U7vdU.js";import{G as Zt}from"./GroupPickerDialog-CJH5Fdnt.js";import{C as Qt,L as en}from"./CodeEditor-BF8OqNGf.js";import{D as tn}from"./SwitchControl-C_wbgFy3.js";import{A as nn,S as sn}from"./AddRoleMappingModal-B-7S42YC.js";import{d as ve,D as on}from"./DatePicker-ClawiStM.js";const W=" AM",B=" PM",an=(t,i,l,u,c,d)=>{const a=[],p=new Date(new Date().setHours(0,0,0,0)),f=p.getDay();for(;p.getDay()===f;){let m=p.getHours(),n=W;i&&(m===0?m=12:m>=12&&(n=B),m>12&&(m%=12)),m=i?m.toString():m.toString().padStart(2,"0");const s=p.getMinutes().toString().padStart(2,"0"),r=`${m}${l}${s}${i?n:""}`;lt(u,c,r,l,d)&&a.push(r),p.setMinutes(p.getMinutes()+t)}return a},K=(t,i,l,u,c)=>{const d=new Date(t);if(!isNaN(d.getDate())&&(t instanceof Date||t.includes("T"))){const a=u?`${d.getHours()>12?d.getHours()-12:d.getHours()}`:`${d.getHours()}`.padStart(2,"0"),p=`${d.getMinutes()}`.padStart(2,"0"),f=c?`${d.getSeconds()}`.padStart(2,"0"):"",m=f?`${l}${f}`:"";let n="";return u&&d.getHours()>11?n=B:u&&(n=W),`${a}${l}${p}${m}${n}`}else if(typeof t=="string"&&(t=t.trim(),t!==""&&at(t,i,l,u))){const[,a,p,f,m=""]=i.exec(t),n=c?`${l}${f??"00"}`:"";let s="";if(u){const r=m.toUpperCase();r===W.toUpperCase().trim()?s=W:r===B.toUpperCase().trim()?s=B:s=new Date().getHours()>11?B:W}return`${a}${l}${p}${n}${s}`}return t.toString()},at=(t,i,l,u)=>{const c=new Date(t);if(!isNaN(c.getDate())&&t.includes("T"))return!0;const d=parseInt(t.split(l)[0]),a=d>=(u?1:0)&&d<=(u?12:23);return t===""||i.test(t)&&a},He=(t,i)=>{const l=t.match(i);return l&&l.length?/pm/i.test(l[4])?parseInt(l[1])===12?parseInt(l[1]):parseInt(l[1])+12:/am/i.test(l[4])&&parseInt(l[1])===12?0:parseInt(l[1]):null},Le=(t,i)=>{const l=t.match(i);return l&&l.length?parseInt(l[2]):null},Fe=(t,i)=>{var l;const u=(l=t.match(i))===null||l===void 0?void 0:l[3];return u?parseInt(u):null},lt=(t,i,l,u,c)=>{if(l.trim()==="")return!0;const d=Te(t,u,c),a=Te(l,u,c),p=Te(i,u,c);return d<=a&&a<=p},Te=(t,i,l)=>{const c=new RegExp(`^\\s*(\\d\\d?)${i}([0-5]\\d)${i}?([0-5]\\d)?\\s*([AaPp][Mm])?\\s*$`).exec(t);if(!c||!c.length)return;let d=c[1].padStart(2,"0");const a=c[2];let p=c[3]?`${i}${c[3]}`:"";!p&&l&&(p=`${i}00`);const f=c[4]||"";return f.toUpperCase()==="PM"&&d!=="12"?d=`${parseInt(d)+12}`:f.toUpperCase()==="AM"&&d==="12"&&(d="00"),`${d}${i}${a}${p}`},ln={name:"OutlinedClockIcon",height:512,width:512,svgPath:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z",yOffset:0,xOffset:0},rn=ze(ln),cn={name:"--pf-v5-c-date-picker__input--c-form-control--Width",value:"calc(10 * 1ch + calc(2rem + 0.5rem))",var:"var(--pf-v5-c-date-picker__input--c-form-control--Width)"};class Re extends O.Component{constructor(i){super(i),this.baseComponentRef=O.createRef(),this.toggleRef=O.createRef(),this.inputRef=O.createRef(),this.menuRef=O.createRef(),this.onDocClick=n=>{var s,r,o,g;const C=(r=(s=this.toggleRef)===null||s===void 0?void 0:s.current)===null||r===void 0?void 0:r.contains(n.target),v=(g=(o=this.menuRef)===null||o===void 0?void 0:o.current)===null||g===void 0?void 0:g.contains(n.target);this.state.isTimeOptionsOpen&&!(C||v)&&this.onToggle(!1)},this.handleGlobalKeys=n=>{var s,r,o,g;const{isTimeOptionsOpen:C,focusedIndex:v,scrollIndex:$}=this.state;!((r=(s=this.inputRef)===null||s===void 0?void 0:s.current)===null||r===void 0)&&r.contains(n.target)?!C&&n.key!==U.Tab&&n.key!==U.Escape?this.onToggle(!0):C&&(n.key===U.Escape||n.key===U.Tab?this.onToggle(!1):n.key===U.Enter?v!==null?(this.focusSelection(v),n.stopPropagation()):this.onToggle(!1):(n.key===U.ArrowDown||n.key===U.ArrowUp)&&(this.focusSelection($),this.updateFocusedIndex(0),n.preventDefault())):!((g=(o=this.menuRef)===null||o===void 0?void 0:o.current)===null||g===void 0)&&g.contains(n.target)&&(n.key===U.ArrowDown?(this.updateFocusedIndex(1),n.preventDefault()):n.key===U.ArrowUp?(this.updateFocusedIndex(-1),n.preventDefault()):(n.key===U.Escape||n.key===U.Tab)&&(this.inputRef.current.focus(),this.onToggle(!1)))},this.updateFocusedIndex=n=>{this.setState(s=>{const r=this.getOptions().length-1;let o=s.focusedIndex!==null?s.focusedIndex+n:s.scrollIndex+n;return o<0?o=r:o>r&&(o=0),this.scrollToIndex(o),{focusedIndex:o}})},this.getIndexToScroll=n=>this.props.menuAppendTo==="inline"?n>0?n-1:0:n,this.scrollToIndex=n=>{this.getOptions()[n].closest(`.${ge.menuContent}`).scrollTop=this.getOptions()[this.getIndexToScroll(n)].offsetTop},this.focusSelection=n=>{var s;const r=n!==-1?n:0;!((s=this.menuRef)===null||s===void 0)&&s.current&&this.getOptions()[r].querySelector(`.${ge.menuItem}`).focus()},this.scrollToSelection=n=>{const{delimiter:s,is24Hour:r}=this.props;let o=n.split(this.props.delimiter),g=null;if(o.length<2?(n=`${n}${s}00`,o=n.split(s)):o.length>2&&(n=K(n,this.state.timeRegex,s,!r,!1),o=n.split(s)),!r&&o.length>1&&o[1].length<2){const v=o[1].length===0?"00":o[1]+"0";n=`${o[0]}${s}${v}${new Date().getHours()>11?B:W}`}else!r&&o.length>1&&o[1].length===2&&!n.toUpperCase().includes(W.toUpperCase().trim())&&!n.toUpperCase().includes(B.toUpperCase().trim())&&(n=`${n}${new Date().getHours()>11?B:W}`);let C=this.getOptions().findIndex(v=>v.textContent===n);if(C!==-1)this.scrollToIndex(C),g=C;else if(o.length===2){let v="";r||(o[1].toUpperCase().includes("P")?v=B:o[1].toUpperCase().includes("A")&&(v=W)),n=`${o[0]}${s}00${v}`,C=this.getOptions().findIndex($=>$.textContent===n),C!==-1&&this.scrollToIndex(C)}this.setState({focusedIndex:g,scrollIndex:C})},this.getRegExp=(n=!0)=>{const{is24Hour:s,delimiter:r}=this.props;let o=`\\s*(\\d\\d?)${r}([0-5]\\d)`;return n&&(o+=`${r}?([0-5]\\d)?`),new RegExp(`^${o}${s?"":"\\s*([AaPp][Mm])?"}\\s*$`)},this.getOptions=()=>{var n;return!((n=this.menuRef)===null||n===void 0)&&n.current?Array.from(this.menuRef.current.querySelectorAll(`.${ge.menuListItem}`)):[]},this.isValidFormat=n=>{if(this.props.validateTime)return this.props.validateTime(n);const{delimiter:s,is24Hour:r,includeSeconds:o}=this.props;return at(n,this.getRegExp(o),s,!r)},this.isValidTime=n=>{const{delimiter:s,includeSeconds:r}=this.props,{minTimeState:o,maxTimeState:g}=this.state;return lt(o,g,n,s,r)},this.isValid=n=>this.isValidFormat(n)&&this.isValidTime(n),this.onToggle=n=>{this.setState(s=>{const{timeRegex:r,isInvalid:o,timeState:g}=s,{delimiter:C,is24Hour:v,includeSeconds:$,onChange:M}=this.props,b=K(g,r,C,!v,$);return M&&!n&&b!==g&&M(null,b,He(b,r),Le(b,r),Fe(b,r),this.isValid(b)),{isTimeOptionsOpen:n,timeState:b,isInvalid:n?o:!this.isValid(b)}}),this.props.setIsOpen(n),n||this.inputRef.current.focus()},this.onSelect=n=>{const{timeRegex:s,timeState:r}=this.state,{delimiter:o,is24Hour:g,includeSeconds:C,setIsOpen:v}=this.props,$=K(n.target.textContent,s,o,!g,C);$!==r&&this.onInputChange(n,$),this.inputRef.current.focus(),this.setState({isTimeOptionsOpen:!1,isInvalid:!1}),v(!1)},this.onInputClick=n=>{this.state.isTimeOptionsOpen||this.onToggle(!0),n.stopPropagation()},this.onInputChange=(n,s)=>{const{onChange:r}=this.props,{timeRegex:o}=this.state;r&&r(n,s,He(s,o),Le(s,o),Fe(s,o),this.isValid(s)),this.scrollToSelection(s),this.setState({timeState:s})};const{is24Hour:l,delimiter:u,time:c,includeSeconds:d,isOpen:a}=this.props;let{minTime:p,maxTime:f}=this.props;if(p===""){const n=d?`${u}00`:"";p=l?`00${u}00${n}`:`12${u}00${n} AM`}if(f===""){const n=d?`${u}59`:"";f=l?`23${u}59${n}`:`11${u}59${n} PM`}const m=this.getRegExp();this.state={isInvalid:!1,isTimeOptionsOpen:a,timeState:K(c,m,u,!l,d),focusedIndex:null,scrollIndex:0,timeRegex:m,minTimeState:K(p,m,u,!l,d),maxTimeState:K(f,m,u,!l,d)}}componentDidMount(){document.addEventListener("mousedown",this.onDocClick),document.addEventListener("touchstart",this.onDocClick),document.addEventListener("keydown",this.handleGlobalKeys),this.setState({isInvalid:!this.isValid(this.state.timeState)})}componentWillUnmount(){document.removeEventListener("mousedown",this.onDocClick),document.removeEventListener("touchstart",this.onDocClick),document.removeEventListener("keydown",this.handleGlobalKeys)}componentDidUpdate(i,l){const{timeState:u,isTimeOptionsOpen:c,isInvalid:d,timeRegex:a}=this.state,{time:p,is24Hour:f,delimiter:m,includeSeconds:n,isOpen:s,minTime:r,maxTime:o}=this.props;if(i.isOpen!==s&&this.onToggle(s),c&&!l.isTimeOptionsOpen&&u&&!d&&this.scrollToSelection(u),m!==i.delimiter&&this.setState({timeRegex:this.getRegExp()}),p!==""&&p!==i.time){const g=K(p,a,m,!f,n);this.setState({timeState:g,isInvalid:!this.isValid(g)})}r!==""&&r!==i.minTime&&this.setState({minTimeState:K(r,a,m,!f,n)}),o!==""&&o!==i.maxTime&&this.setState({maxTimeState:K(o,a,m,!f,n)})}render(){const i=this.props,{"aria-label":l,isDisabled:u,className:c,placeholder:d,id:a,menuAppendTo:p,is24Hour:f,invalidFormatErrorMessage:m,invalidMinMaxErrorMessage:n,stepMinutes:s,width:r,delimiter:o,inputProps:g,onChange:C,setIsOpen:v,isOpen:$,time:M,validateTime:b,minTime:T,maxTime:I,includeSeconds:X,zIndex:Z}=i,h=ct(i,["aria-label","isDisabled","className","placeholder","id","menuAppendTo","is24Hour","invalidFormatErrorMessage","invalidMinMaxErrorMessage","stepMinutes","width","delimiter","inputProps","onChange","setIsOpen","isOpen","time","validateTime","minTime","maxTime","includeSeconds","zIndex"]),{timeState:x,isTimeOptionsOpen:N,isInvalid:D,minTimeState:H,maxTimeState:q}=this.state,ae={[cn.name]:r},fe=an(s,!f,o,H,q,X),S=this.isValidFormat(x),E=a||dt("time-picker"),P=()=>this.baseComponentRef&&this.baseComponentRef.current?this.baseComponentRef.current.parentElement:null,Y=O.createElement(ut,{ref:this.menuRef,isScrollable:!0},O.createElement(pt,{maxMenuHeight:"200px"},O.createElement(ht,{"aria-label":l},fe.map((De,rt)=>O.createElement(mt,{onClick:this.onSelect,key:De,id:`${E}-option-${rt}`},De))))),w=O.createElement(ft,Object.assign({"aria-haspopup":"menu",id:`${E}-input`,"aria-label":l,validated:D?"error":"default",placeholder:d,value:x||"",type:"text",customIcon:O.createElement(rn,null),onClick:this.onInputClick,onChange:this.onInputChange,autoComplete:"off",isDisabled:u,isExpanded:N,ref:this.inputRef},g));let Q;switch(p){case"inline":Q=()=>this.toggleRef.current;break;case"parent":Q=P;break;default:Q=p}return O.createElement("div",{ref:this.baseComponentRef,className:Ce(ve.datePicker,c)},O.createElement("div",Object.assign({className:Ce(ve.datePickerInput),style:ae},h),O.createElement(gt,null,O.createElement(Ct,null,O.createElement("div",{id:E},O.createElement("div",{ref:this.toggleRef,style:{paddingLeft:"0"}},O.createElement(yt,{appendTo:Q,trigger:w,triggerRef:this.toggleRef,popper:Y,popperRef:this.menuRef,isVisible:N,zIndex:Z}))))),D&&O.createElement("div",{className:Ce(ve.datePickerHelperText)},O.createElement(St,null,O.createElement(vt,{variant:"error"},S?n:m)))))}}Re.displayName="TimePicker";Re.defaultProps={className:"",isDisabled:!1,time:"",is24Hour:!1,invalidFormatErrorMessage:"Invalid time format",invalidMinMaxErrorMessage:"Invalid time entered",placeholder:"hh:mm",delimiter:":","aria-label":"Time picker",width:"150px",menuAppendTo:"inline",stepMinutes:30,inputProps:{},minTime:"",maxTime:"",isOpen:!1,setIsOpen:()=>{},zIndex:9999};const dn={name:"CaretUpIcon",height:512,width:320,svgPath:"M288.662 352H31.338c-17.818 0-26.741-21.543-14.142-34.142l128.662-128.662c7.81-7.81 20.474-7.81 28.284 0l128.662 128.662c12.6 12.599 3.676 34.142-14.142 34.142z",yOffset:0,xOffset:0},un=ze(dn),pn=({name:t,label:i,helpText:l,defaultValue:u,isRequired:c,variant:d="typeaheadMulti"})=>{const{adminClient:a}=te(),{t:p}=R(),{control:f,getValues:m,formState:{errors:n}}=z(),s=m(t),[r,o,g]=ce(),[C,v]=k([]),[$,M]=k(""),[b,T]=k(""),I=zt(),X=Kt(Tt(T,1e3),[]);ne(()=>{const h={max:20};return b&&(h.username=b),s?.length&&!b?Promise.all(s.map(x=>a.users.findOne({id:x}))):a.users.find(h)},v,[b]);const Z=h=>h.filter(x=>x!==void 0).map(x=>e(ie,{value:x.id,selected:s?.includes(x.id),children:x.username},x.id));return y(L,{label:p(i),isRequired:c,labelIcon:e(F,{helpText:l,fieldLabelId:i}),fieldId:t,children:[e(V,{name:t,defaultValue:u,control:f,rules:c&&d==="typeaheadMulti"?{validate:h=>h.length>0}:{required:c},render:({field:h})=>e(It,{id:t,onOpenChange:o,toggle:x=>e(re,{"data-testid":t,ref:x,variant:"typeahead",onClick:o,isExpanded:r,isFullWidth:!0,status:n[t]?"danger":void 0,children:y(bt,{isPlain:!0,children:[e(xt,{value:$,onClick:o,onChange:(N,D)=>{g(!0),M(D),X(D)},autoComplete:"off",innerRef:I,placeholderText:p("selectAUser"),...h.value&&{"aria-activedescendant":h.value},role:"combobox",isExpanded:r,"aria-controls":"select-create-typeahead-listbox",children:d==="typeaheadMulti"&&Array.isArray(h.value)&&e(Ke,{"aria-label":"Current selections",children:h.value.map((N,D)=>e(We,{onClick:H=>{H.stopPropagation(),h.onChange(h.value.filter(q=>q!==N))},children:C.find(H=>H?.id===N)?.username},D))})}),e(Ot,{children:!!b&&e(_,{variant:"plain",onClick:()=>{M(""),T(""),h.onChange([]),I?.current?.focus()},"aria-label":"Clear input value",children:e(kt,{"aria-hidden":!0})})})]})}),isOpen:r,selected:h.value,onSelect:(x,N)=>{const D=N?.toString();if(d!=="typeaheadMulti"){const H=h.value.includes(D);H?h.onChange([]):h.onChange([D]),M(H?"":C.find(q=>q?.id===D)?.username||""),g(!1)}else{const H=h.value.find(q=>q===D)?h.value.filter(q=>q!==D):[...h.value,D];h.onChange(H)}},"aria-label":p(t),children:e(Pt,{children:Z(C)})})}),n[t]&&e(ee,{message:p("required")})]})},Ie=["UNANIMOUS","AFFIRMATIVE","CONSENSUS"],hn=({helpLabel:t,isDisabled:i=!1,isLimited:l=!1})=>{const{t:u}=R(),{control:c}=z();return e(L,{label:u("decisionStrategy"),labelIcon:e(F,{helpText:u(t||"decisionStrategyHelp"),fieldLabelId:"decisionStrategy"}),fieldId:"decisionStrategy",hasNoPaddingTop:!0,children:e(V,{name:"decisionStrategy","data-testid":"decisionStrategy",defaultValue:Ie[0],control:c,render:({field:d})=>e(A,{children:(l?Ie.slice(0,2):Ie).map(a=>e(de,{id:a,"data-testid":a,isChecked:d.value===a,isDisabled:i,name:"decisionStrategy",onChange:()=>d.onChange(a),label:u(`decisionStrategies.${a}`),className:"pf-v5-u-mb-md"},a))})})})},mn={resources:{searchFunction:"listResources",fetchFunction:"getAssociatedResources"},policies:{searchFunction:"listPolicies",fetchFunction:"getAssociatedPolicies"}},fn=({name:t,clientId:i,permissionId:l,variant:u=Me.typeaheadMulti,preSelected:c,isRequired:d=!1})=>{const{adminClient:a}=te(),{realm:p}=Rt(),{t:f}=R(),m=Be(),{control:n,formState:{errors:s,isDirty:r}}=z(),[o,g]=k([]),[C,v]=k(""),[$,M]=k(!1),[b,T]=ce(),[I,X]=k(),[Z,h]=k(),x=mn[t],N=S=>({id:"_id"in S?S._id:"id"in S?S.id:void 0,name:S.name,type:S.type});ne(async()=>{const S=Object.assign({id:i,first:0,max:10,permission:"false"},C===""?null:{name:C});return await Promise.all([a.clients.listPolicyProviders({id:i}),a.clients[x.searchFunction](S),l?a.clients[x.fetchFunction]({id:i,permissionId:l}):Promise.resolve([]),c&&t==="resources"?a.clients.getResource({id:i,resourceId:c}):Promise.resolve([])])},([S,...E])=>{X(S.filter(P=>P.type!=="resource"&&P.type!=="scope")),g(E.flat().filter(P=>typeof P!="string").map(N).filter(({id:P},Y,w)=>Y===w.findIndex(({id:Q})=>P===Q)))},[C]);const[D,H]=nt({titleKey:f("unsavedChangesTitle"),messageKey:f("unsavedChangesConfirm"),continueButtonLabel:f("continue"),continueButtonVariant:se.danger,onConfirm:()=>Z?.()}),q=S=>t==="policies"?Xe({realm:p,id:i,policyId:S.id,policyType:S.type}):Dt({realm:p,id:i,resourceId:S.id}),ae=()=>o.map(S=>e(ie,{value:S.id,children:S.name},S.id)),fe=S=>e(Ke,{children:S.value?.map(E=>{const P=o.find(w=>w.id===E);if(!P)return;const Y=q(P);return e(We,{onClick:()=>{S.onChange(S.value?.filter(w=>w!==P.id))},children:e(Je,{to:Y,onClick:w=>{r&&(w.preventDefault(),h(()=>()=>m(Y)),D())},children:P.name})},P.id)})});return y(A,{children:[e(H,{}),b&&e($n,{policyProviders:I,onSelect:S=>{m($t({id:i,realm:p,policyType:S.type}))},toggleDialog:T}),e(V,{name:t,defaultValue:c?[c]:[],control:n,rules:{validate:S=>!d||S.length>0},render:({field:S})=>e(Ye,{toggleId:t,variant:u,onToggle:E=>M(E),onFilter:E=>(v(E),ae()),onClear:()=>{S.onChange([]),v("")},selections:S.value,onSelect:E=>{const P=E.toString();if(u===Me.typeaheadMulti){const Y=S.value?.find(w=>w===P)?S.value.filter(w=>w!==P):[...S.value,P];S.onChange(Y)}else S.onChange([P]);v("")},isOpen:$,"aria-label":f(t),validated:s[t]?"error":"default",typeAheadAriaLabel:f(t),chipGroupComponent:fe(S),footer:t==="policies"?e(_,{variant:"link",isInline:!0,onClick:()=>{r?(M(!1),h(()=>T),D()):T()},children:f("createPolicy")}):void 0,children:ae()})})]})},gn=()=>{const{t}=R(),{id:i}=it();return y(A,{children:[e(L,{label:t("applyPolicy"),fieldId:"policies",labelIcon:e(F,{helpText:t("applyPolicyHelp"),fieldLabelId:"policies"}),children:e(fn,{name:"policies",clientId:i})}),e(hn,{helpLabel:"policyDecisionStagey"})]})},Cn=()=>{const{t}=R();return e(Yt,{name:"clients",label:t("clients"),helpText:t("policyClientHelp"),required:!0,defaultValue:[],variant:"typeaheadMulti"})},yn=({clientScopes:t,clientName:i,open:l,toggleDialog:u,onAdd:c,isClientScopesConditionType:d})=>{const{t:a}=R(),[p,f]=k(!1),[m,n]=k([]),[s,r]=k("Name"),[o,g]=k("All"),[C,v]=ce(),[$,M]=ce(!1),b=tt(()=>o==="OpenID Connect"?t.filter(h=>h.protocol==="openid-connect"):o==="SAML"?t.filter(h=>h.protocol==="saml"):t,[t,s,o]),T=h=>{const x=m.map(N=>({scope:N,type:h}));c(x),f(!1),u()},I=h=>{h==="Name"?r("Protocol"):h==="Protocol"&&(r("Name"),g("All")),v()},X=h=>{h==="SAML"?g("SAML"):h==="OpenID Connect"?g("OpenID Connect"):h==="All"&&g("All"),M()},Z=[e(ie,{value:"SAML",children:a("protocolTypes.saml")},1),e(ie,{value:"OpenID Connect",children:a("protocolTypes.openid-connect")},2),e(ie,{value:"All",children:a("protocolTypes.all")},3)];return e(Ze,{variant:Qe.medium,title:d?a("addClientScope"):a("addClientScopesTo",{clientName:i}),isOpen:l,onClose:u,actions:d?[e(_,{id:"modal-add","data-testid":"confirm",variant:se.primary,onClick:()=>{const h=m.map(x=>({scope:x}));c(h),u()},isDisabled:m.length===0,children:a("add")},"add"),e(_,{id:"modal-cancel","data-testid":"cancel",variant:se.link,onClick:()=>{n([]),u()},children:a("cancel")},"cancel")]:[e(ye,{popperProps:{direction:"up"},onOpenChange:h=>f(h),className:"keycloak__client-scopes-add__add-dropdown",isOpen:p,toggle:h=>e(re,{ref:h,isDisabled:m.length===0,onClick:()=>f(!p),variant:"primary",id:"add-dropdown",statusIcon:e(un,{}),children:a("add")}),children:e(Se,{children:Jt(a,T)})},"add-dropdown"),e(_,{id:"modal-cancel",variant:se.link,onClick:()=>{n([]),u()},children:a("cancel")},"cancel")],children:e(Mt,{loader:b,ariaLabelKey:"chooseAMapperType",searchPlaceholderKey:s==="Name"?"searchForClientScope":void 0,isSearching:s!=="Name",searchTypeComponent:e(ye,{onSelect:()=>{I(s)},onOpenChange:v,toggle:h=>e(re,{ref:h,"data-testid":"filter-type-dropdown",id:"toggle-id-9",onClick:v,icon:e(Ne,{}),statusIcon:e(Ae,{}),children:s}),isOpen:C,children:e(Se,{children:e(xe,{"data-testid":"filter-type-dropdown-item",children:a(s==="Name"?"protocol":"name")},"filter-type")})}),toolbarItem:s==="Protocol"&&y(A,{children:[e(ye,{onSelect:()=>{I(s)},onOpenChange:v,"data-testid":"filter-type-dropdown",toggle:h=>e(re,{ref:h,id:"toggle-id-9",onClick:v,statusIcon:e(Ae,{}),icon:e(Ne,{}),children:s}),isOpen:C,children:e(Se,{children:e(xe,{"data-testid":"filter-type-dropdown-item",children:a("name")},"filter-type")})}),e(Ye,{className:"kc-protocolType-select","aria-label":a("selectOne"),onToggle:M,onSelect:h=>X(h.toString()),selections:o,isOpen:$,children:Z})]}),canSelectAll:!0,onSelect:h=>n(h),columns:[{name:"name"},{name:"protocol",displayKey:"protocol",cellRenderer:h=>Xt(a,h.protocol??"openid-connect")},{name:"description"}],emptyState:e(At,{message:a("emptyAddClientScopes"),instructions:a("emptyAddClientScopesInstructions")})})})},Sn=()=>{const{adminClient:t}=te(),{t:i}=R(),{control:l,getValues:u,setValue:c,formState:{errors:d}}=z(),[a,p]=k(!1),[f,m]=k([]),[n,s]=k([]),r=st();return ne(()=>t.clientScopes.find(),o=>{s(u("clientScopes").map(g=>o.find(C=>C.id===g.id))),m(r(o,ot("name")))},[]),y(L,{label:i("clientScopes"),labelIcon:e(F,{helpText:i("clientsClientScopesHelp"),fieldLabelId:"clientScopes"}),fieldId:"clientScopes",isRequired:!0,children:[e(V,{name:"clientScopes",control:l,defaultValue:[],rules:{validate:o=>o.filter(g=>g.id).length>0},render:({field:o})=>y(A,{children:[a&&e(yn,{clientScopes:f.filter(g=>!o.value.map(C=>C.id).includes(g.id)),isClientScopesConditionType:!0,open:a,toggleDialog:()=>p(!a),onAdd:g=>{s([...n,...g.map(C=>C.scope)]),o.onChange([...o.value,...g.map(C=>C.scope).map(C=>({id:C.id,required:!1}))])}}),e(_,{"data-testid":"select-scope-button",variant:"secondary",onClick:()=>{p(!0)},children:i("addClientScopes")})]})}),n.length>0&&y(pe,{variant:"compact",children:[e(he,{children:y(J,{children:[e(G,{children:i("clientScopeTitle")}),e(G,{children:i("required")}),e(G,{"aria-hidden":"true"})]})}),e(me,{children:n.map((o,g)=>y(J,{children:[e(j,{children:o.name}),e(j,{children:e(V,{name:`clientScopes.${g}.required`,defaultValue:!1,control:l,render:({field:C})=>e(ke,{id:"required","data-testid":"standard",name:"required",isChecked:C.value,onChange:C.onChange})})}),e(j,{children:e(_,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e(Pe,{}),onClick:()=>{c("clientScopes",[...u("clientScopes").filter(C=>C.id!==o.id)]),s([...n.filter(C=>C.id!==o.id)])}})})]},o.id))})]}),d.clientScopes&&e(ee,{message:i("requiredClientScope")})]})},vn=()=>{const{adminClient:t}=te(),{t:i}=R(),{control:l,getValues:u,setValue:c,formState:{errors:d}}=z(),a=u("groups"),[p,f]=k(!1),[m,n]=k([]);return ne(()=>a&&a.length>0?Promise.all(a.map(s=>t.groups.findOne({id:s.id}))):Promise.resolve([]),s=>{const r=s.filter(o=>o);n(r)},[]),y(A,{children:[e(ue,{name:"groupsClaim",label:i("groupsClaim"),labelIcon:i("groupsClaimHelp")}),y(L,{label:i("groups"),labelIcon:e(F,{helpText:i("policyGroupsHelp"),fieldLabelId:"groups"}),fieldId:"groups",isRequired:!0,children:[e(V,{name:"groups",control:l,defaultValue:[],rules:{validate:s=>s&&s.filter(({id:r})=>r).length>0},render:({field:s})=>y(A,{children:[p&&e(Zt,{type:"selectMany",text:{title:"addGroupsToGroupPolicy",ok:"add"},onConfirm:r=>{s.onChange([...s.value||[],...(r||[]).map(({id:o})=>({id:o}))]),n([...m,...r||[]]),f(!1)},onClose:()=>{f(!1)},filterGroups:m}),e(_,{"data-testid":"select-group-button",variant:"secondary",onClick:()=>{f(!0)},children:i("addGroups")})]})}),m.length>0&&y(pe,{variant:"compact",children:[e(he,{children:y(J,{children:[e(G,{children:i("groups")}),e(G,{children:i("extendToChildren")}),e(G,{"aria-hidden":"true"})]})}),e(me,{children:m.map((s,r)=>y(J,{children:[e(j,{children:s.path}),e(j,{children:e(V,{name:`groups.${r}.extendChildren`,defaultValue:!1,control:l,render:({field:o})=>e(ke,{id:"extendChildren","data-testid":"standard",name:"extendChildren",isChecked:o.value,onChange:o.onChange,isDisabled:s.subGroupCount===0})})}),e(j,{children:e(_,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e(Pe,{}),onClick:()=>{c("groups",[...(a||[]).filter(({id:o})=>o!==s.id)]),n([...m.filter(({id:o})=>o!==s.id)])}})})]},s.id))})]}),d.groups&&e(ee,{message:i("requiredGroups")})]})]})},Tn=()=>{const{t}=R(),{control:i}=z();return e(L,{label:t("code"),labelIcon:e(F,{helpText:t("policyCodeHelp"),fieldLabelId:"code"}),fieldId:"code",isRequired:!0,children:e(V,{name:"code",defaultValue:"",control:i,render:({field:l})=>e(Qt,{id:"code","data-testid":"code",onChange:l.onChange,code:l.value,height:"600px",language:en.javascript,isReadOnly:!0})})})},qe=["POSITIVE","NEGATIVE"],In=({isDisabled:t})=>{const{t:i}=R(),{control:l}=z();return e(L,{label:i("logic"),labelIcon:e(F,{helpText:i("logicHelp"),fieldLabelId:"logic"}),fieldId:"logic",hasNoPaddingTop:!0,children:e(V,{name:"logic","data-testid":"logic",defaultValue:qe[0],control:l,render:({field:u})=>e(A,{children:qe.map(c=>e(de,{id:c,"data-testid":c,isChecked:u.value===c,name:"logic",onChange:()=>u.onChange(c),label:i(`logicType.${c.toLowerCase()}`),className:"pf-v5-u-mb-md",isDisabled:t},c))})})})},bn=({isDisabled:t})=>{const{t:i}=R();return y(A,{children:[e(ue,{name:"name",label:i("name"),rules:{required:i("required")},isDisabled:t}),e(Et,{name:"description",label:i("description"),rules:{maxLength:{message:i("maxLength",{length:255}),value:255}},isDisabled:t})]})},xn=()=>{const{t}=R();return y(A,{children:[e(ue,{name:"targetClaim",label:t("targetClaim"),labelIcon:t("targetClaimHelp"),rules:{required:t("required")}}),e(ue,{name:"pattern",label:t("regexPattern"),labelIcon:t("regexPatternHelp"),rules:{required:t("required")}}),e(wt,{name:"targetContextAttributes",label:t("targetContextAttributes"),labelIcon:t("targetContextAttributesHelp"),labelOn:t("yes"),labelOff:t("no")})]})},On=()=>{const{adminClient:t}=te(),{t:i}=R(),{control:l,getValues:u,setValue:c,formState:{errors:d}}=z(),a=u("roles"),[p,f]=k(!1),[m,n]=k([]);return ne(async()=>{if(a&&a.length>0){const s=await Promise.all(a.map(r=>t.roles.findOneById({id:r.id})));return Promise.all(s.map(async r=>({role:r,client:r.clientRole?await t.clients.findOne({id:r?.containerId}):void 0})))}return Promise.resolve([])},n,[]),y(A,{children:[y(L,{label:i("roles"),labelIcon:e(F,{helpText:i("policyRolesHelp"),fieldLabelId:"roles"}),fieldId:"roles",isRequired:!0,children:[e(V,{name:"roles",control:l,defaultValue:[],rules:{validate:s=>s&&s.filter(r=>r.id).length>0},render:({field:s})=>y(A,{children:[p&&e(nn,{id:"role",type:"roles",onAssign:r=>{s.onChange([...s.value||[],...r.map(o=>({id:o.role.id}))]),n([...m,...r]),f(!1)},onClose:()=>{f(!1)},isLDAPmapper:!0}),e(_,{"data-testid":"select-role-button",variant:"secondary",onClick:()=>{f(!0)},children:i("addRoles")})]})}),m.length>0&&y(pe,{variant:"compact",children:[e(he,{children:y(J,{children:[e(G,{children:i("roles")}),e(G,{children:i("required")}),e(G,{"aria-hidden":"true"})]})}),e(me,{children:m.map((s,r)=>y(J,{children:[e(j,{children:e(sn,{role:s.role,client:s.client})}),e(j,{children:e(V,{name:`roles.${r}.required`,defaultValue:!1,control:l,render:({field:o})=>e(ke,{id:"required","data-testid":"standard",name:"required",isChecked:o.value,onChange:o.onChange})})}),e(j,{children:e(_,{variant:"link",className:"keycloak__client-authorization__policy-row-remove",icon:e(Pe,{}),onClick:()=>{c("roles",[...(a||[]).filter(o=>o.id!==s.role.id)]),n([...m.filter(o=>o.role.id!==s.role.id)])}})})]},s.role.id))})]}),d.roles&&e(ee,{message:i("requiredRoles")})]}),e(tn,{name:"fetchRoles",label:i("fetchRoles"),labelIcon:i("fetchRolesHelp")})]})},be=/(\d\d\d\d-\d\d-\d\d)? (\d\d?):(\d\d?)/,Ue=t=>t.toString().padStart(2,"0"),Ge=({name:t})=>{const{control:i}=z(),l=(c,d)=>{if(!d)return c;const a=be.exec(c);return`${[d.getFullYear(),Ue(d.getMonth()+1),Ue(d.getDate())].join("-")} ${a?a[2]:"00"}:${a?a[3]:"00"}:00`},u=(c,d,a)=>{const p=be.exec(c);return a!=null?`${p?p[1]:""} ${d}:${a<10?`0${a}`:a}:00`:c};return e(V,{name:t,defaultValue:"",control:i,rules:{required:!0},render:({field:c})=>{const d=c.value.match(be)||["","","0","00"];return y(et,{hasGutter:!0,id:t,children:[e(oe,{children:e(on,{value:d[1],onChange:(a,p,f)=>{c.onChange(l(c.value,f))}})}),e(oe,{children:e(Re,{time:`${d[2]}:${d[3]}`,onChange:(a,p,f,m)=>c.onChange(u(c.value,f,m)),is24Hour:!0})})]})}})},je=({name:t,min:i,max:l})=>{const{control:u}=z(),c=d=>Math.min(d,l);return e(V,{name:t,defaultValue:"",control:u,render:({field:d})=>e(Vt,{id:t,value:d.value,min:i,max:l,onPlus:()=>d.onChange(Number(d.value)+1),onMinus:()=>d.onChange(Number(d.value)-1),onChange:a=>{const p=Number(a.currentTarget.value);d.onChange(c(isNaN(p)?0:p))}})})},le=({name:t,...i})=>{const{t:l}=R();return e(L,{label:l(t),fieldId:t,labelIcon:e(F,{helpText:l(`${t}Help`),fieldLabelId:t}),children:y(et,{hasGutter:!0,children:[e(oe,{children:e(je,{name:t,...i})}),e(oe,{children:l("to")}),e(oe,{children:e(je,{name:`${t}End`,...i})})]})})},kn=()=>{const{t}=R(),{getValues:i,formState:{errors:l}}=z(),[u,c]=k(i("month"));return y(A,{children:[e(L,{label:t("repeat"),fieldId:"repeat",labelIcon:e(F,{helpText:t("repeatHelp"),fieldLabelId:"repeat"}),children:y(_t,{children:[e(Ee,{children:e(de,{id:"notRepeat","data-testid":"notRepeat",isChecked:!u,name:"repeat",onChange:()=>c(!1),label:t("notRepeat"),className:"pf-v5-u-mb-md"})}),e(Ee,{children:e(de,{id:"repeat","data-testid":"repeat",isChecked:u,name:"repeat",onChange:()=>c(!0),label:t("repeat"),className:"pf-v5-u-mb-md"})})]})}),u&&y(A,{children:[e(le,{name:"month",min:1,max:12}),e(le,{name:"dayMonth",min:1,max:31}),e(le,{name:"hour",min:0,max:23}),e(le,{name:"minute",min:0,max:59})]}),y(L,{label:t("startTime"),fieldId:"notBefore",labelIcon:e(F,{helpText:t("startTimeHelp"),fieldLabelId:"startTime"}),isRequired:!0,children:[e(Ge,{name:"notBefore"}),l.notBefore&&e(ee,{message:t("required")})]}),y(L,{label:t("expireTime"),fieldId:"notOnOrAfter",labelIcon:e(F,{helpText:t("expireTimeHelp"),fieldLabelId:"expireTime"}),isRequired:!0,children:[e(Ge,{name:"notOnOrAfter"}),l.notOnOrAfter&&e(ee,{message:t("required")})]})]})},Pn=()=>{const{t}=R();return e(pn,{name:"users",label:"users",helpText:t("policyUsers"),defaultValue:[],variant:"typeaheadMulti",isRequired:!0})},Oe={aggregate:gn,client:Cn,user:Pn,"client-scope":Sn,group:vn,regex:xn,role:On,time:kn,js:Tn},$e=t=>t in Oe;function Rn(){const{adminClient:t}=te(),{t:i}=R(),{id:l,realm:u,policyId:c,policyType:d}=it(),a=Be(),p=Nt(),{reset:f,handleSubmit:m}=p,{addAlert:n,addError:s}=Ht(),[r,o]=k(),g=d==="js";ne(async()=>{if(c){const T=await Promise.all([t.clients.findOnePolicy({id:l,type:d,policyId:c}),t.clients.getAssociatedPolicies({id:l,permissionId:c})]);if(!T[0])throw new Error(i("notFound"));return{policy:T[0],policies:T[1].map(I=>I.id)}}return{}},({policy:T,policies:I})=>{f({...T,policies:I}),o(T)},[l,d,c]);const C=async T=>{T.groups=T.groups?.filter(I=>I.id),T.clientScopes=T.clientScopes?.filter(I=>I.id),T.roles=T.roles?.filter(I=>I.id).map(I=>({...I,required:I.required||!1}));try{if(c)await t.clients.updatePolicy({id:l,type:d,policyId:c},T);else{const I=await t.clients.createPolicy({id:l,type:d},T);a(Xe({realm:u,id:l,policyType:d,policyId:I.id}))}n(i((c?"update":"create")+"PolicySuccess"),_e.success)}catch(I){s("policySaveError",I)}},[v,$]=nt({titleKey:"deletePolicy",messageKey:"deletePolicyConfirm",continueButtonLabel:"confirm",onConfirm:async()=>{try{await t.clients.delPolicy({id:l,policyId:c}),n(i("policyDeletedSuccess"),_e.success),a(we({realm:u,clientId:l,tab:"policies"}))}catch(T){s("policyDeletedError",T)}}});if(c&&!r)return e(Lt,{});function M(){return $e(d)?Oe[d]:Oe.js}const b=M();return y(A,{children:[e($,{}),e(Bt,{titleKey:c?r?.name:i("createPolicyOfType",{policyType:d}),dropdownItems:c?[e(xe,{"data-testid":"delete-policy",onClick:()=>v(),children:i("delete")},"delete")]:void 0}),e(Ft,{variant:"light",children:y(Wt,{isHorizontal:!0,onSubmit:m(C),role:"anyone",children:[y(qt,{...p,children:[e(bn,{isDisabled:g}),e(b,{}),e(In,{isDisabled:g})]}),e(Ut,{children:y("div",{className:"pf-v5-u-mt-md",children:[e(_,{isDisabled:g,variant:se.primary,className:"pf-v5-u-mr-md",type:"submit","data-testid":"save",children:i("save")}),e(_,{variant:"link","data-testid":"cancel",component:T=>e(Je,{...T,to:we({realm:u,clientId:l,tab:"policies"})}),children:i("cancel")})]})})]})})]})}const Wn=Object.freeze(Object.defineProperty({__proto__:null,default:Rn,isValidComponentType:$e},Symbol.toStringTag,{value:"Module"})),$n=({policyProviders:t,onSelect:i,toggleDialog:l})=>{const{t:u}=R(),c=st(),d=tt(()=>t?c(t,ot("name")):[],[t]);return e(Ze,{"aria-label":u("createPolicy"),variant:Qe.medium,header:y(Gt,{children:[e(Ve,{component:jt.h1,children:u("chooseAPolicyType")}),e(Ve,{children:u("chooseAPolicyTypeInstructions")})]}),isOpen:!0,onClose:l,children:y(pe,{"aria-label":u("policies"),variant:"compact",children:[e(he,{children:y(J,{children:[e(G,{children:u("name")}),e(G,{children:u("description")})]})}),e(me,{children:d.map(a=>y(J,{"data-testid":a.type,onRowClick:()=>i(a),isClickable:!0,children:[e(j,{children:a.name}),e(j,{children:$e(a.type)&&u(`policyProvider.${a.type}`)})]},a.type))})]})})};export{yn as A,hn as D,$n as N,Wn as P,fn as R,pn as U};
//# sourceMappingURL=NewPolicyDialog-CMVGWMi2.js.map
