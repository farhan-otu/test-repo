import{jsx as t,jsxs as S,Fragment as F}from"react/jsx-runtime";import{u as K,a as L,b as N,d as U,V as q,ak as H,j as _,B as z,q as l,br as G,y as J,D as Q,P as f,bs as w,bt as W,bu as X,p as Y}from"./main-hjbDDO6j.js";import{useState as v}from"react";import{c as Z,C as M,A as $}from"./ClientScopeTypes-CQeLlnWG.js";import{u as ee}from"./ConfirmDialog-DN_NVsrg.js";import{R as te}from"./AddRoleMappingModal-B-7S42YC.js";import{R as ae,u as oe}from"./RoutableTabs-ChOqIl6o.js";import{V as ie}from"./ViewHeader-Dr6ZoEJz.js";import{u as se}from"./useParams-XtwJXIDJ.js";import{M as ne}from"./MapperList-BGDqbWYx.js";import{S as re}from"./ScopeForm-DBbRpceD.js";import{a as g,b as h}from"./Tabs-TiG_cKa2.js";import"react-dom";import"./translationFormatter-aKDacg4X.js";import"./useLocaleSort-Bon3wgU4.js";import"./filter-icon-I49U7vdU.js";import"./PageHandler-Dm6Ir_Zl.js";import"./DynamicComponents-2Oogxguf.js";import"./ClientSelect-Di5Ep3wz.js";import"./FileUpload-DFzHUp8z.js";import"./CodeEditor-BF8OqNGf.js";import"./copy-icon-ePLWnxgr.js";import"./GroupPickerDialog-CJH5Fdnt.js";import"./DataListItemRow-C-0mzg8R.js";import"./KeySelect-CBdQO7FV.js";import"./MultiLineInput-BKovUfcB.js";import"./constants-BclHbWtx.js";import"./utils-C-TUnOch.js";import"./SwitchControl-C_wbgFy3.js";import"./FormAccess-DEsYjDHG.js";function Ne(){const{adminClient:n}=K(),{t:o}=L(),y=N(),{realm:d}=U(),{id:r}=se(),{addAlert:c,addError:p}=q(),{enabled:T}=H(),[i,D]=v(),[C,R]=v(0),b=()=>R(C+1);_(async()=>{const e=await n.clientScopes.findOne({id:r});if(!e)throw new Error(o("notFound"));return{...e,type:await A(e)}},e=>{D(e)},[C,r]);async function A(e){return(await n.clientScopes.listDefaultClientScopes()).find(u=>u.name===e.name)?M.default:(await n.clientScopes.listDefaultOptionalClientScopes()).find(u=>u.name===e.name)?M.optional:$.none}const m=e=>oe(X({realm:d,id:r,tab:e})),E=m("settings"),V=m("mappers"),x=m("scope"),I=async e=>{const a=Y({...e,name:e.name?.trim().replace(/ /g,"_")});try{await n.clientScopes.update({id:r},a),await Z(n,{...a,id:r},a.type),c(o("updateSuccessClientScope"),l.success)}catch(s){p("updateErrorClientScope",s)}},[P,B]=ee({titleKey:o("deleteClientScope",{count:1,name:i?.name}),messageKey:"deleteConfirmClientScopes",continueButtonLabel:"delete",continueButtonVariant:z.danger,onConfirm:async()=>{try{await n.clientScopes.del({id:r}),c(o("deletedSuccessClientScope"),l.success),y(G({realm:d}))}catch(e){p("deleteErrorClientScope",e)}}}),O=async e=>{try{const a=e.filter(s=>s.client===void 0).map(s=>s.role).flat();await n.clientScopes.addRealmScopeMappings({id:r},a),await Promise.all(e.filter(s=>s.client!==void 0).map(s=>n.clientScopes.addClientScopeMappings({id:r,client:s.client.id},[s.role]))),c(o("roleMappingUpdatedSuccess"),l.success)}catch(a){p("roleMappingUpdatedError",a)}},j=async e=>{if(Array.isArray(e))try{await n.clientScopes.addMultipleProtocolMappers({id:i.id},e),b(),c(o("mappingCreatedSuccess"),l.success)}catch(a){p("mappingCreatedError",a)}else{const a=e;y(w({realm:d,id:i.id,mapperId:a.id,viewMode:"new"}))}},k=async e=>{try{await n.clientScopes.delProtocolMapper({id:i.id,mapperId:e.id}),c(o("mappingDeletedSuccess"),l.success),b()}catch(a){p("mappingDeletedError",a)}return!0};return i?S(F,{children:[t(B,{}),t(ie,{titleKey:i.name,dropdownItems:[t(Q,{onClick:P,children:o("delete")},"delete")],badges:[{text:i.protocol}],divider:!1}),t(f,{variant:"light",className:"pf-v5-u-p-0",children:S(ae,{isBox:!0,children:[t(g,{id:"settings","data-testid":"settings",title:t(h,{children:o("settings")}),...E,children:t(f,{variant:"light",children:t(re,{save:I,clientScope:i})})}),t(g,{id:"mappers","data-testid":"mappers",title:t(h,{children:o("mappers")}),...V,children:t(ne,{model:i,onAdd:j,onDelete:k,detailLink:e=>w({realm:d,id:i.id,mapperId:e,viewMode:"edit"})})}),S(g,{id:"scope","data-testid":"scopeTab",title:t(h,{children:o("scope")}),...x,children:[T&&t(f,{children:t(W,{variant:"info",isInline:!0,title:o("clientScopesRolesScope"),component:"h2"})}),t(te,{id:i.id,name:i.name,type:"clientScopes",save:O})]})]})})]}):t(J,{})}export{Ne as default};
//# sourceMappingURL=EditClientScope-B5_pUyzM.js.map
