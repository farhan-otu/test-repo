import{jsx as e,jsxs as o,Fragment as Z}from"react/jsx-runtime";import{u as ee,a as R,d as U,l as ae,j as se,w as te,bx as re,h as ne,ex as I,E as ie,bl as le,L as oe,cA as ce,n as de,aw as me,ax as S,F as pe,J as _,N as f,O as b,c7 as ue,c8 as he,U as w,W as g,aj as ye,A as ve,f as E}from"./main-hjbDDO6j.js";import{useState as d}from"react";import{D as _e}from"./DropdownPanel-D_qgc_Fl.js";import{u as fe,F as be}from"./useFormatDate-DtCZfuLt.js";import{W as ge}from"./warning-triangle-icon-CUSjnRec.js";import{p as ke}from"./pickBy-DbcNzVCB.js";import{D as Fe,a as N,b as O,c as x}from"./DescriptionListTerm-BGpKKoC6.js";import{D as L}from"./DatePicker-ClawiStM.js";const Te=t=>t.error?e(le,{content:t.error,children:o("span",{children:[e(I,{status:"warning",children:e(ge,{})}),t.type]})}):o("span",{children:[e(I,{status:"success",children:e(ie,{})}),t.type]}),Ce=t=>o(Fe,{isHorizontal:!0,className:"keycloak_eventsection_details",children:[t.details&&Object.entries(t.details).map(([l,c])=>o(N,{children:[e(O,{children:l}),e(x,{children:c})]},l)),t.error&&o(N,{children:[e(O,{children:"error"}),e(x,{children:t.error})]},"error")]}),De=t=>{const{t:l}=R(),{realm:c}=U();return o(Z,{children:[t.userId&&e(oe,{to:ce({realm:c,id:t.userId,tab:"settings"}),children:t.userId},`link-${t.time}-${t.type}`),!t.userId&&l("noUserDetails")]})},Ue=({user:t,client:l})=>{const{adminClient:c}=ee(),{t:r}=R(),{realm:k}=U(),j=fe(),[F,P]=d(0),[V,T]=d(!1),[G,K]=d(!1),[B,$]=d(),[m,W]=d({}),C={client:l||"",dateFrom:"",dateTo:"",user:t||"",type:[],ipAddress:""},M={client:r("client"),dateFrom:r("dateFrom"),dateTo:r("dateTo"),user:r("userId"),type:r("eventType"),ipAddress:r("ipAddress")},D=ae({mode:"onChange",defaultValues:C}),{getValues:u,reset:h,formState:{isDirty:A},control:y,handleSubmit:z}=D;se(()=>c.realms.getConfigEvents({realm:k}),a=>$(a),[]);function H(a,s){return c.realms.findEvents({...m,client:l,user:t,realm:k,first:a,max:s})}function J(){T(!1),p()}function q(){h(),p()}function Q(a){const s={...u()};delete s[a],h({...C,...s}),p()}function X(a,s){const n=u(),i=n[a],v=Array.isArray(i)?i.filter(Y=>Y!==s):i;h({...n,[a]:v}),p()}function p(){const a=ke(u(),s=>s!==""||Array.isArray(s)&&s.length>0);W(a),P(F+1)}return e("div",{className:"keycloak__events_table",children:e(te,{loader:H,detailColumns:[{name:"details",enabled:a=>a.details!==void 0,cellRenderer:Ce}],isPaginated:!0,ariaLabelKey:"titleEvents",toolbarItem:e(de,{...D,children:o(me,{direction:{default:"column"},spaceItems:{default:"spaceItemsNone"},children:[e(S,{children:e(_e,{buttonText:r("searchUserEventsBtn"),setSearchDropdownOpen:T,searchDropdownOpen:V,marginRight:"2.5rem",width:"15vw",children:o(pe,{"data-testid":"searchForm",className:"keycloak__events_search__form",onSubmit:z(J),isHorizontal:!0,children:[!t&&e(_,{name:"user",label:r("userId"),"data-testid":"userId-searchField"}),e(f,{label:r("eventType"),fieldId:"kc-eventType",className:"keycloak__events_search__form_label",children:e(b,{name:"type",control:y,render:({field:a})=>e(ue,{className:"keycloak__events_search__type_select","data-testid":"event-type-searchField",chipGroupProps:{numChips:1,expandedText:r("hide"),collapsedText:r("showRemaining")},variant:he.typeaheadMulti,typeAheadAriaLabel:"Select",onToggle:s=>K(s),selections:a.value,onSelect:s=>{const n=s.toString(),i=a.value.includes(n)?a.value.filter(v=>v!==n):[...a.value,n];a.onChange(i)},onClear:()=>{a.onChange([])},isOpen:G,"aria-labelledby":"eventType",chipGroupComponent:e(w,{children:a.value.map(s=>e(g,{onClick:n=>{n.stopPropagation(),a.onChange(a.value.filter(i=>i!==s))},children:r(`eventTypes.${s}.name`)},s))}),children:B?.enabledEventTypes?.map(s=>e(ye,{value:s,children:r(`eventTypes.${s}.name`)},s))})})}),!l&&e(_,{name:"client",label:r("client"),"data-testid":"client-searchField"}),e(f,{label:r("dateFrom"),fieldId:"kc-dateFrom",className:"keycloak__events_search__form_label",children:e(b,{name:"dateFrom",control:y,render:({field:a})=>e(L,{className:"pf-v5-u-w-100",value:a.value,onChange:(s,n)=>a.onChange(n),inputProps:{id:"kc-dateFrom"}})})}),e(f,{label:r("dateTo"),fieldId:"kc-dateTo",className:"keycloak__events_search__form_label",children:e(b,{name:"dateTo",control:y,render:({field:a})=>e(L,{className:"pf-v5-u-w-100",value:a.value,onChange:(s,n)=>a.onChange(n),inputProps:{id:"kc-dateTo"}})})}),e(_,{name:"ipAddress",label:r("ipAddress"),"data-testid":"ipAddress-searchField"}),o(ve,{children:[e(E,{"data-testid":"search-events-btn",variant:"primary",type:"submit",isDisabled:!A,children:r("searchUserEventsBtn")}),e(E,{variant:"secondary",onClick:q,isDisabled:!A,children:r("resetBtn")})]})]})})}),e(S,{children:Object.entries(m).length>0&&e("div",{className:"keycloak__searchChips pf-v5-u-ml-md",children:Object.entries(m).map(a=>{const[s,n]=a;return e(w,{className:"pf-v5-u-mt-md pf-v5-u-mr-md",categoryName:M[s],onClick:()=>Q(s),children:typeof n=="string"?e(g,{isReadOnly:!0,children:n}):n.map(i=>e(g,{onClick:()=>X(s,i),children:r(`eventTypes.${i}.name`)},i))},s)})})})]})}),columns:[{name:"time",displayKey:"time",cellRenderer:a=>j(new Date(a.time),be)},...t?[]:[{name:"userId",cellRenderer:De}],{name:"type",displayKey:"eventType",cellRenderer:Te},{name:"ipAddress",displayKey:"ipAddress",transforms:[re(10)]},...l?[]:[{name:"clientId",displayKey:"client"}]],emptyState:e(ne,{message:r("emptyUserEvents"),instructions:r("emptyUserEventsInstructions")}),isSearching:Object.keys(m).length>0},F)})};export{Ue as U};
//# sourceMappingURL=UserEvents-20oG-Z3I.js.map
