import{jsx as e,jsxs as R,Fragment as ue}from"react/jsx-runtime";import{u as W,b as $,d as j,a as z,ak as pe,P as Q,w as be,C as fe,f as b,h as he,by as v,cP as Re,bD as ye,l as ge,V as we,b$ as ve,K as M,j as x,bz as L,cQ as Ce,B as Te,q as F,y as ke,D as Ie,n as Ae,bN as U,cR as O,bE as Ne,ck as De,cS as Fe,cT as Ee,cC as Pe,cU as Ke}from"./main-hjbDDO6j.js";import{useState as C}from"react";import{u as Se}from"./ConfirmDialog-DN_NVsrg.js";import{A as Ve}from"./AttributeForm-CrNTp7VT.js";import{P as Be}from"./PermissionTab-CE0biuPZ.js";import{R as Me}from"./RoleForm-D4Wq_a6z.js";import{A as xe,R as Le}from"./AddRoleMappingModal-B-7S42YC.js";import{R as Ue,u as Oe}from"./RoutableTabs-ChOqIl6o.js";import{V as We}from"./ViewHeader-Dr6ZoEJz.js";import{u as q}from"./useParams-XtwJXIDJ.js";import{Q as $e}from"./question-circle-icon-BckMEuvu.js";import{a as f,b as h}from"./Tabs-TiG_cKa2.js";import"react-dom";import"./FormAccess-DEsYjDHG.js";import"./copy-icon-ePLWnxgr.js";import"./KeyValueInput-BjiKJH0l.js";import"./KeySelect-CBdQO7FV.js";import"./useLocaleSort-Bon3wgU4.js";import"./Trans-BCvPJnzT.js";import"./translationFormatter-aKDacg4X.js";import"./filter-icon-I49U7vdU.js";import"./PageHandler-Dm6Ir_Zl.js";import"./DynamicComponents-2Oogxguf.js";import"./ClientSelect-Di5Ep3wz.js";import"./FileUpload-DFzHUp8z.js";import"./CodeEditor-BF8OqNGf.js";import"./GroupPickerDialog-CJH5Fdnt.js";import"./DataListItemRow-C-0mzg8R.js";import"./MultiLineInput-BKovUfcB.js";import"./constants-BclHbWtx.js";const je=()=>{const{adminClient:n}=W(),m=$(),{realm:a}=j(),{t:s}=z(),{id:y,clientId:T}=q(),k=async(r,l)=>{const i=await n.roles.findOneById({id:y});if(!i)throw new Error(s("notFound"));return i.clientRole?n.clients.findUsersWithRole({roleName:i.name,id:T,briefRepresentation:!0,first:r,max:l}):n.roles.findUsersWithRole({name:i.name,briefRepresentation:!0,first:r,max:l})},{enabled:g}=pe();return e(Q,{"data-testid":"users-page",variant:"light",children:e(be,{isPaginated:!0,loader:k,ariaLabelKey:"roleList",searchPlaceholderKey:"","data-testid":"users-in-role-table",toolbarItem:g&&e(fe,{"aria-label":"Basic popover",position:"bottom",bodyContent:R("div",{children:[s("whoWillAppearPopoverTextRoles"),e(b,{className:"kc-groups-link",variant:"link",onClick:()=>m(`/${a}/groups`),children:s("groups")}),s("or"),R(b,{className:"kc-users-link",variant:"link",onClick:()=>m(`/${a}/users`),children:[s("users"),"."]})]}),footerContent:s("whoWillAppearPopoverFooterText"),children:e(b,{variant:"link",className:"kc-who-will-appear-button",icon:e($e,{}),children:s("whoWillAppearLinkTextRoles")},"who-will-appear-button")}),emptyState:e(he,{hasIcon:!0,message:s("noDirectUsers"),instructions:R("div",{children:[s("noUsersEmptyStateDescription"),e(b,{className:"kc-groups-link-empty-state",variant:"link",onClick:()=>m(`/${a}/groups`),children:s("groups")}),s("or"),e(b,{className:"kc-users-link-empty-state",variant:"link",onClick:()=>m(`/${a}/users`),children:s("users")}),s("noUsersEmptyStateDescriptionContinued")]})}),columns:[{name:"username",displayKey:"userName",cellFormatters:[v()]},{name:"email",displayKey:"email",cellFormatters:[v()]},{name:"lastName",displayKey:"lastName",cellFormatters:[v()]},{name:"firstName",displayKey:"firstName",cellFormatters:[Re(),v()]}]})})};function vt(){const{adminClient:n}=W(),m=ye(),{t:a}=z(),s=ge({mode:"onChange"}),{control:y,reset:T,setValue:k}=s,g=$(),{id:r,clientId:l}=q(),{realm:i,realmRepresentation:w}=j(),[E,G]=C(0),[H,P]=C(),J=()=>G(E+1),{addAlert:I,addError:A}=we(),{hasAccess:X}=ve(),Y=X("query-clients","manage-authorization"),[Z,_]=C(!1),[ee,te]=C(!1),ae=t=>{const{attributes:o,...D}=t;return{attributes:Ke(o),...D}},c=M({control:y,defaultValue:void 0,name:"name"}),se=M({control:y,defaultValue:!1,name:"composite"});x(async()=>n.roles.findOneById({id:r}),t=>{if(!t)throw new Error(a("notFound"));const o=ae(t);T(o),P(o.attributes)},[E]),x(async()=>n.clients.findOne({id:l}),t=>{l&&_(t?.access?.manage)},[]);const K=async t=>{try{const{attributes:o,...D}=t,p=D;p.name=p.name?.trim(),p.attributes=De(o),l?await n.clients.updateRole({id:l,roleName:t.name},p):await n.roles.updateById({id:r},p),P(o),I(a("roleSaveSuccess"),F.success)}catch(o){A("roleSaveError",o)}},S=L(Fe.path),d=L(Ce.path),oe=()=>{if(S)return O({realm:i});if(d)return U({realm:i,clientId:d.params.clientId,tab:"roles"});throw new Error("Roles overview route could not be determined.")},N=t=>{if(S)return Ee({realm:i,id:r,tab:t});if(d)return Pe({realm:i,id:r,clientId:d.params.clientId,tab:t});throw new Error("Route could not be determined.")},u=t=>Oe(N(t)),re=u("details"),ne=u("associated-roles"),ie=u("attributes"),le=u("users-in-role"),ce=u("permissions"),[me,de]=Se({titleKey:"roleDeleteConfirm",messageKey:a("roleDeleteConfirmDialog",{selectedRoleName:c||a("createRole")}),continueButtonLabel:"delete",continueButtonVariant:Te.danger,onConfirm:async()=>{try{l?await n.clients.delRole({id:l,roleName:c}):await n.roles.delById({id:r}),I(a("roleDeletedSuccess"),F.success),g(oe())}catch(t){A("roleDeleteError",t)}}}),V=async t=>{try{await n.roles.createComposite({roleId:r,realm:w.realm},t),J(),g(N("associated-roles")),I(a("addAssociatedRolesSuccess"),F.success)}catch(o){A("addAssociatedRolesError",o)}},B=t=>w?.defaultRole&&w.defaultRole.name===t;return w?R(ue,{children:[e(de,{}),ee&&e(xe,{id:r,type:"roles",name:c,onAssign:t=>V(t.map(o=>o.role)),onClose:()=>te(!1)}),e(We,{titleKey:c,badges:[{id:"composite-role-badge",text:se?a("composite"):"",readonly:!0}],actionsDropdownId:"roles-actions-dropdown",dropdownItems:[e(Ie,{component:"button",onClick:()=>{me()},children:a("deleteRole")},"delete-role")],divider:!1}),e(Q,{variant:"light",className:"pf-v5-u-p-0",children:e(Ae,{...s,children:R(Ue,{isBox:!0,mountOnEnter:!0,defaultLocation:N("details"),children:[e(f,{title:e(h,{children:a("details")}),...re,children:e(Me,{form:s,onSubmit:K,role:d?"manage-clients":"manage-realm",cancelLink:d?U({realm:i,clientId:l,tab:"roles"}):O({realm:i}),editMode:!0})}),e(f,{"data-testid":"associatedRolesTab",title:e(h,{children:a("associatedRolesText")}),...ne,children:e(Le,{name:c,id:r,type:"roles",isManager:!0,save:t=>V(t.map(o=>o.role))})}),!B(c)&&e(f,{"data-testid":"attributesTab",className:"kc-attributes-tab",title:e(h,{children:a("attributes")}),...ie,children:e(Ve,{form:s,save:K,fineGrainedAccess:Z,reset:()=>k("attributes",H,{shouldDirty:!1})})}),!B(c)&&e(f,{title:e(h,{children:a("usersInRole")}),...le,children:e(je,{"data-cy":"users-in-role-tab"})}),m(Ne.AdminFineGrainedAuthz)&&Y&&e(f,{title:e(h,{children:a("permissions")}),...ce,children:e(Be,{id:r,type:"roles"})})]})})})]}):e(ke,{})}export{vt as default};
//# sourceMappingURL=RealmRoleTabs-I4CQuVtK.js.map
