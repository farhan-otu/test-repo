import{jsx as e,jsxs as c,Fragment as O}from"react/jsx-runtime";import{a as w,N,cx as ae,cy as B,u as ge,d as ye,Y as _,z as te,K as j,j as U,y as Ie,n as ne,_ as P,a1 as ce,a5 as we,bt as De,f as L,$ as Re,a8 as Z,R as W,O as $,c7 as X,c8 as ue,aj as ee,S as xe,cW as me,e as ve,l as fe,M as Pe,m as Ee,F as Te,B as Oe,ac as Le,c1 as He,c2 as Ge,c3 as pe,c4 as J,c5 as Me,c6 as Y,H as ze,I as We,b as je,V as $e,P as Be,bZ as Ke,L as Ue,fg as ke,fa as _e,q as Fe,o as Qe,fo as Je}from"./main-hjbDDO6j.js";import{useState as T,useEffect as Ne,useMemo as Ye}from"react";import{F as le,a as Ze}from"./FormAccess-DEsYjDHG.js";import{V as Xe}from"./ViewHeader-Dr6ZoEJz.js";import{u as ea}from"./useLocale-BtoaQcMD.js";import{u as ie}from"./useParams-XtwJXIDJ.js";/* empty css                               */import{U as aa}from"./UserProfileContext-knLEppNh.js";import{K as ta}from"./KeyValueInput-BjiKJH0l.js";import{D as na}from"./SwitchControl-C_wbgFy3.js";import{u as la}from"./ConfirmDialog-DN_NVsrg.js";import{D as ia}from"./DynamicComponents-2Oogxguf.js";import{A as ra,G as sa}from"./AddTranslationsDialog-BU7BhuPq.js";import{i as oa}from"./isEqual-DwRuOUtl.js";import"react-dom";import"./copy-icon-ePLWnxgr.js";import"./KeySelect-CBdQO7FV.js";import"./ClientSelect-Di5Ep3wz.js";import"./FileUpload-DFzHUp8z.js";import"./CodeEditor-BF8OqNGf.js";import"./GroupPickerDialog-CJH5Fdnt.js";import"./DataListItemRow-C-0mzg8R.js";import"./MultiLineInput-BKovUfcB.js";import"./AddRoleMappingModal-B-7S42YC.js";import"./translationFormatter-aKDacg4X.js";import"./useLocaleSort-Bon3wgU4.js";import"./filter-icon-I49U7vdU.js";const da=()=>{const{t}=w();return e(le,{role:"manage-realm",isHorizontal:!0,children:e(N,{hasNoPaddingTop:!0,label:t("annotations"),fieldId:"kc-annotations",className:"kc-annotations-label",children:e(ae,{className:"kc-annotations",children:e(B,{children:e(ta,{name:"annotations",label:t("annotations"),defaultKeyValue:[{key:"inputType",label:t("inputType"),values:["text","textarea","select","select-radiobuttons","multiselect","multiselect-checkboxes","html5-email","html5-tel","html5-url","html5-number","html5-range","html5-datetime-local","html5-date","html5-month","html5-week","html5-time"]},{key:"inputHelperTextBefore",label:t("inputHelperTextBefore")},{key:"inputHelperTextAfter",label:t("inputHelperTextAfter")},{key:"inputOptionLabelsI18nPrefix",label:t("inputOptionLabelsI18nPrefix")},{key:"inputTypePlaceholder",label:t("inputTypePlaceholder")},{key:"inputTypeSize",label:t("inputTypeSize")},{key:"inputTypeCols",label:t("inputTypeCols")},{key:"inputTypeRows",label:t("inputTypeRows")},{key:"inputTypeStep",label:t("inputTypeStep")},{key:"kcNumberFormat",label:t("kcNumberFormat")},{key:"kcNumberUnFormat",label:t("kcNumberUnFormat")}]})})})})})},he=[{label:"requiredForLabel.both",value:["admin","user"]},{label:"requiredForLabel.users",value:["user"]},{label:"requiredForLabel.admins",value:["admin"]}],ca=({onHandlingTranslationData:t,onHandlingGeneratedDisplayName:u})=>{const{adminClient:d}=ge(),{t:a}=w(),{realmRepresentation:n}=ye(),l=_(),[h,f]=T(),[C,s]=T(),[b,H]=T(!1),[v,V]=T(!1),[E,G]=te(),{attributeName:M}=ie(),R=!!M,[z,g]=T(""),[m,i]=T(""),[A,S]=T(),[k,D]=T({key:"",translations:[]}),p=/\$\{([^}]+)\}/,y=(r,o)=>{g(o);const q=o!==""&&n?.internationalizationEnabled?`\${profile.attributes.${o}}`:"";i(q)},I=j({control:l.control,name:"hasSelector"}),F=j({control:l.control,name:"hasRequiredScopes"}),Ce=j({control:l.control,name:"isRequired",defaultValue:!1}),K=j({control:l.control,name:"displayName"}),qe=p.test(K);U(()=>d.clientScopes.find(),f,[]),U(()=>d.users.getProfile(),s,[]);const re=r=>{t(r)},se=r=>{u(r)};if(Ne(()=>{re(k),se(m)},[k,m]),!h)return e(Ie,{});function oe(r){l.setValue("hasSelector",r)}function de(r){l.setValue("hasRequiredScopes",r)}const Ve=r=>{D(r)},Se=()=>{G(),re(k),se(m)},Ae=K?.substring(2,K.length-1);return c(O,{children:[E&&e(ra,{translationKey:R?Ae:`profile.attributes.${z}`,translations:k,type:A??"displayName",onTranslationsAdded:Ve,toggleDialog:Se,onCancel:()=>{G()}}),e(le,{role:"manage-realm",isHorizontal:!0,children:c(ne,{...l,children:[c(N,{label:a("attributeName"),labelIcon:e(P,{helpText:a("upAttributeNameHelp"),fieldLabelId:"attributeName"}),fieldId:"kc-attribute-name",isRequired:!0,children:[e(ce,{isRequired:!0,id:"kc-attribute-name",defaultValue:"","data-testid":"attribute-name",isDisabled:R,validated:l.formState.errors.name?"error":"default",...l.register("name",{required:!0}),onChange:y}),l.formState.errors.name&&e(we,{message:a("validateAttributeName")})]}),e(N,{label:a("attributeDisplayName"),labelIcon:e(P,{helpText:a("attributeDisplayNameHelp"),fieldLabelId:"attributeDisplayName"}),fieldId:"kc-attribute-display-name",children:c(ae,{hasGutter:!0,children:[c(B,{span:n?.internationalizationEnabled?11:12,children:[e(ce,{id:"kc-attribute-display-name","data-testid":"attribute-display-name",isDisabled:n?.internationalizationEnabled&&z!==""||R&&qe,value:R?K:n?.internationalizationEnabled?m:void 0,...l.register("displayName")}),m&&e(De,{className:"pf-v5-u-mt-sm",variant:"info",isInline:!0,isPlain:!0,title:a("addAttributeTranslationInfo")})]}),n?.internationalizationEnabled&&e(B,{span:1,children:e(L,{variant:"link",className:"pf-m-plain kc-attribute-display-name-iconBtn","data-testid":"addAttributeTranslationBtn","aria-label":a("addAttributeTranslationBtn"),isDisabled:!z&&!R,onClick:()=>{S("displayName"),G()},icon:e(sa,{})})})]})}),e(na,{name:"multivalued",label:a("multivalued"),labelIcon:a("multivaluedHelp")}),e(Re,{name:"group",label:a("attributeGroup"),labelIcon:a("attributeGroupHelp"),controller:{defaultValue:""},options:[{key:"",value:a("none")},...C?.groups?.map(r=>({key:r.name,value:r.name}))||[]]}),!ba.includes(M)&&c(O,{children:[e(Z,{}),c(N,{label:a("enabledWhen"),labelIcon:e(P,{helpText:a("enabledWhenTooltip"),fieldLabelId:"enabled-when"}),fieldId:"enabledWhen",hasNoPaddingTop:!0,children:[e(W,{id:"always","data-testid":"always",isChecked:!I,name:"enabledWhen",label:a("always"),onChange:()=>oe(!1),className:"pf-v5-u-mb-md"}),e(W,{id:"scopesAsRequested","data-testid":"scopesAsRequested",isChecked:I,name:"enabledWhen",label:a("scopesAsRequested"),onChange:()=>oe(!0),className:"pf-v5-u-mb-md"})]}),I&&e(N,{fieldId:"kc-scope-enabled-when",children:e($,{name:"selector.scopes",control:l.control,defaultValue:[],render:({field:r})=>e(X,{"data-testid":"enabled-when-scope-field",variant:ue.typeaheadMulti,typeAheadAriaLabel:"Select",chipGroupProps:{numChips:3,expandedText:a("hide"),collapsedText:a("showRemaining")},onToggle:o=>H(o),selections:r.value,onSelect:o=>{const q=o.toString();let x=[""];r.value?x=r.value.includes(q)?r.value.filter(Q=>Q!==q):[...r.value,q]:x=[q],r.onChange(x)},onClear:()=>{r.onChange([])},isOpen:b,"aria-labelledby":"scope",children:h.map(o=>e(ee,{value:o.name,children:o.name},o.name))})})})]}),M!=="username"&&c(O,{children:[e(Z,{}),e(N,{label:a("required"),labelIcon:e(P,{helpText:a("requiredHelp"),fieldLabelId:"required"}),fieldId:"kc-required",hasNoPaddingTop:!0,children:e($,{name:"isRequired","data-testid":"required",defaultValue:!1,control:l.control,render:({field:r})=>e(xe,{id:"kc-required",onChange:r.onChange,isChecked:r.value,label:a("on"),labelOff:a("off"),"aria-label":a("required")})})}),Ce&&c(O,{children:[e(N,{label:a("requiredFor"),fieldId:"requiredFor",hasNoPaddingTop:!0,children:e($,{name:"required.roles","data-testid":"requiredFor",defaultValue:he[0].value,control:l.control,render:({field:r})=>e("div",{className:"kc-requiredFor",children:he.map(o=>e(W,{id:o.label,"data-testid":o.label,isChecked:oa(r.value,o.value),name:"roles",onChange:()=>{r.onChange(o.value)},label:a(o.label),className:"kc-requiredFor-option"},o.label))})})}),c(N,{label:a("requiredWhen"),labelIcon:e(P,{helpText:a("requiredWhenTooltip"),fieldLabelId:"required-when"}),fieldId:"requiredWhen",hasNoPaddingTop:!0,children:[e(W,{id:"requiredAlways","data-testid":"requiredAlways",isChecked:!F,name:"requiredWhen",label:a("always"),onChange:()=>de(!1),className:"pf-v5-u-mb-md"}),e(W,{id:"requiredScopesAsRequested","data-testid":"requiredScopesAsRequested",isChecked:F,name:"requiredWhen",label:a("scopesAsRequested"),onChange:()=>de(!0),className:"pf-v5-u-mb-md"})]}),F&&e(N,{fieldId:"kc-scope-required-when",children:e($,{name:"required.scopes",control:l.control,defaultValue:[],render:({field:r})=>e(X,{"data-testid":"required-when-scope-field",variant:ue.typeaheadMulti,typeAheadAriaLabel:"Select",chipGroupProps:{numChips:3,expandedText:a("hide"),collapsedText:a("showRemaining")},onToggle:o=>V(o),selections:r.value,onSelect:o=>{const q=o.toString();let x=[""];r.value?x=r.value.includes(q)?r.value.filter(Q=>Q!==q):[...r.value,q]:x=[q],r.onChange(x)},onClear:()=>{r.onChange([])},isOpen:v,"aria-labelledby":"scope",children:h.map(o=>e(ee,{value:o.name,children:o.name},o.name))})})})]})]})]})})]})},be=({name:t})=>{const{t:u}=w(),{control:d}=_();return e(ae,{children:e($,{name:`permissions.${t}`,control:d,defaultValue:[],render:({field:a})=>c(O,{children:[e(B,{lg:4,sm:6,children:e(me,{id:`user-${t}`,label:u("user"),value:"user","data-testid":`user-${t}`,isChecked:a.value.includes("user"),onChange:()=>{const n="user",l=a.value.includes(n)?a.value.filter(h=>h!==n):[...a.value,n];a.onChange(l)}})}),e(B,{lg:8,sm:6,children:e(me,{id:`admin-${t}`,label:u("admin"),value:"admin","data-testid":`admin-${t}`,isChecked:a.value.includes("admin"),onChange:()=>{const n="admin",l=a.value.includes(n)?a.value.filter(h=>h!==n):[...a.value,n];a.onChange(l)}})})]})})})},ua=()=>{const{t}=w();return c(le,{role:"manage-realm",isHorizontal:!0,children:[e(N,{hasNoPaddingTop:!0,label:t("whoCanEdit"),labelIcon:e(P,{helpText:t("whoCanEditHelp"),fieldLabelId:"whoCanEdit"}),fieldId:"kc-who-can-edit",children:e(be,{name:"edit"})}),e(N,{hasNoPaddingTop:!0,label:t("whoCanView"),labelIcon:e(P,{helpText:t("whoCanViewHelp"),fieldLabelId:"whoCanView"}),fieldId:"kc-who-can-view",children:e(be,{name:"view"})})]})},ma=({selectedValidators:t,onChange:u})=>{const{t:d}=w(),a=ve().componentTypes?.["org.keycloak.validate.Validator"]||[],n=Ye(()=>a.filter(({id:s})=>!t.includes(s)),[t]),[l,h]=te(),[f,C]=T();return e(N,{label:d("validatorType"),fieldId:"validator",children:e(X,{toggleId:"validator",onToggle:h,onSelect:s=>{const b=s;u(b),C(b),h()},selections:f?.id,variant:"single","aria-label":d("selectOne"),isOpen:l,placeholderText:d("choose"),menuAppendTo:"parent",maxHeight:300,children:n.map(s=>e(ee,{selected:f?.id===s.id,value:s,description:s.helpText,children:s.id},s.id))})})},pa=({selectedValidators:t,toggleDialog:u,onConfirm:d})=>{const{t:a}=w(),[n,l]=T(),h=ve().componentTypes?.["org.keycloak.validate.Validator"].length===t.length,f=fe(),{handleSubmit:C}=f,s=b=>{d({...b,id:n?.id}),u()};return e(Pe,{variant:Ee.small,title:a("addValidator"),isOpen:!0,onClose:u,actions:[e(L,{"data-testid":"save-validator-role-button",variant:"primary",type:"submit",form:"add-validator",children:a("save")},"save"),e(L,{"data-testid":"cancel-validator-role-button",variant:"link",onClick:u,children:a("cancel")},"cancel")],children:h?a("emptyValidators"):c(Te,{id:"add-validator",onSubmit:C(s),children:[e(ma,{selectedValidators:t.map(b=>b.key),onChange:l}),n&&e(ne,{...f,children:e(ia,{properties:n.properties})})]})})},ha=()=>{const{t}=w(),[u,d]=te(),[a,n]=T(),{setValue:l,control:h,register:f,getValues:C}=_(),s=j({name:"validations",control:h,defaultValue:[]});Ne(()=>{f("validations")},[f]);const[b,H]=la({titleKey:t("deleteValidatorConfirmTitle"),messageKey:t("deleteValidatorConfirmMsg",{validatorName:a}),continueButtonLabel:"delete",continueButtonVariant:Oe.danger,onConfirm:async()=>{const v=s.filter(V=>V.key!==a);l("validations",[...v])}});return c(O,{children:[u&&e(pa,{selectedValidators:s,onConfirm:v=>{const V=C("annotations");v.id==="options"&&!V.find(E=>E.key==="inputType")&&l("annotations",[...V,{key:"inputType",value:"select"}]),l("validations",[...s,{key:v.id,value:v.config}])},toggleDialog:d}),e(H,{}),c("div",{className:"kc-attributes-validations",children:[e(L,{id:"addValidator",onClick:()=>d(),variant:"link","data-testid":"addValidator",className:"kc--attributes-validations--add-validation-button",icon:e(Le,{}),children:t("addValidator")}),e(Z,{}),s.length!==0?c(He,{children:[e(Ge,{children:c(pe,{children:[e(J,{children:t("validatorColNames.colName")}),e(J,{children:t("validatorColNames.colConfig")}),e(J,{"aria-hidden":"true"})]})}),e(Me,{children:s.map(v=>c(pe,{children:[e(Y,{dataLabel:t("validatorColNames.colName"),children:v.key}),e(Y,{dataLabel:t("validatorColNames.colConfig"),children:JSON.stringify(v.value)}),e(Y,{className:"kc--attributes-validations--action-cell",children:e(L,{variant:"link","data-testid":"deleteValidator",onClick:()=>{b(),n(v.key)},children:t("delete")},"validator")})]},v.key))})]}):e(ze,{className:"kc-emptyValidators",component:We.p,children:t("emptyValidators")})]})]})},ba=["username","email"],ga=({onHandlingTranslationsData:t,onHandlingGeneratedDisplayName:u,save:d})=>{const{t:a}=w(),n=_(),{realm:l,attributeName:h}=ie(),f=!!h,C=b=>{t(b)},s=b=>{u(b)};return c(aa,{children:[e(Ke,{label:a("jumpToSection"),sections:[{title:a("generalSettings"),panel:e(ca,{onHandlingTranslationData:C,onHandlingGeneratedDisplayName:s})},{title:a("permission"),panel:e(ua,{})},{title:a("validations"),panel:e(ha,{})},{title:a("annotations"),panel:e(da,{})}]}),e(Te,{onSubmit:n.handleSubmit(d),children:c(Ze,{name:"attribute-settings",children:[e(L,{variant:"primary",type:"submit","data-testid":"attribute-create",children:a(f?"save":"create")}),e(Ue,{to:ke({realm:l,tab:"attributes"}),"data-testid":"attribute-cancel",className:"kc-attributeCancel",children:a("cancel")})]})})]})};function Ka(){const{adminClient:t}=ge(),{realm:u,attributeName:d}=ie(),{realmRepresentation:a}=ye(),n=fe(),{t:l}=w(),h=ea(),f=je(),{addAlert:C,addError:s}=$e(),[b,H]=T(null),v=!!d,[V,E]=T({key:"",translations:[]}),[G,M]=T("");U(async()=>{const g=[];return await Promise.all(h.map(async m=>{try{const i=await t.realms.getRealmLocalizationTexts({realm:u,selectedLocale:m}),A=n.getValues(),S=A.displayName?.substring(2,A.displayName.length-1)||"",k=Object.entries(i).filter(([D])=>D===S).map(([D,p])=>({locale:m,value:p}));k.length>0&&g.push({key:S,translations:k})}catch(i){s("errorSavingTranslations",i)}})),g},g=>{if(g&&g.length>0){const m=g.flatMap(i=>i.translations);E({key:g[0].key,translations:m}),n.setValue("translations",m)}},[h,u,n]),U(()=>t.users.getProfile(),g=>{H(g);const{annotations:m,validations:i,permissions:A,selector:S,required:k,multivalued:D,...p}=g.attributes.find(y=>y.name===d)||{permissions:{edit:["admin"]}};Qe({...p,hasSelector:typeof S<"u",hasRequiredScopes:typeof k?.scopes<"u"},n.setValue),Object.entries(Je({permissions:A,selector:S,required:k},{safe:!0})).map(([y,I])=>n.setValue(y,I)),n.setValue("annotations",Object.entries(m||{}).map(([y,I])=>({key:y,value:I}))),n.setValue("validations",Object.entries(i||{}).map(([y,I])=>({key:y,value:I}))),n.setValue("isRequired",k!==void 0),n.setValue("multivalued",D===!0)},[]);const R=async()=>{try{const g=V.translations.filter(m=>m.value.trim()!=="").map(async m=>{try{await t.realms.addLocalization({realm:u,selectedLocale:m.locale,key:V.key},m.value)}catch(i){s(l("errorSavingTranslations"),i)}});await Promise.all(g)}catch(g){console.error(`Error saving translations: ${g}`)}},z=async({hasSelector:g,hasRequiredScopes:m,...i})=>{g||delete i.selector,m||delete i.required?.scopes;const A=i.validations.reduce((p,y)=>(p[y.key]=y.value||{},p),{}),S=i.annotations.reduce((p,y)=>Object.assign(p,{[y.key]:y.value}),{}),k=()=>(b?.attributes||[]).map(p=>p.name!==d?p:(delete p.required,Object.assign({...p,name:d,displayName:i.displayName,selector:i.selector,permissions:i.permissions,multivalued:i.multivalued,annotations:S,validations:A},i.isRequired?{required:i.required}:void 0,i.group?{group:i.group}:{group:null}))),D=()=>(b?.attributes||[]).concat([Object.assign({name:i.name,displayName:i.displayName||G,required:i.isRequired?i.required:void 0,selector:i.selector,permissions:i.permissions,multivalued:i.multivalued,annotations:S,validations:A},i.isRequired?{required:i.required}:void 0,i.group?{group:i.group}:void 0)]);if(a?.internationalizationEnabled&&!V.translations.some(y=>y.value.trim()!=="")){s("createAttributeError",l("translationError"));return}try{const p=v?k():D();await t.users.updateProfile({...b,attributes:p,realm:u}),await R(),_e.reloadResources(),f(ke({realm:u,tab:"attributes"})),C(l("createAttributeSuccess"),Fe.success)}catch(p){s("createAttributeError",p)}};return c(ne,{...n,children:[e(Xe,{titleKey:v?d:l("createAttribute"),subKey:v?"":l("createAttributeSubTitle")}),e(Be,{variant:"light",children:e(ga,{save:()=>n.handleSubmit(z)(),onHandlingTranslationsData:E,onHandlingGeneratedDisplayName:M})})]})}export{ba as USERNAME_EMAIL,Ka as default};
//# sourceMappingURL=NewAttributeSettings-BEhAz053.js.map
