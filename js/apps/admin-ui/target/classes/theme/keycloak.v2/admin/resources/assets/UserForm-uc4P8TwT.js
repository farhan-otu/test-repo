import{jsx as t,jsxs as c,Fragment as v}from"react/jsx-runtime";import{u as L,b$ as S,d as se,j as R,f as M,L as oe,fr as le,f5 as de,cU as ce,ck as V,fx as ue,a as D,$ as me,c8 as pe,V as fe,e1 as be,b as he,n as Ae,N as b,ce as U,cf as y,a1 as j,_ as I,fy as ye,J as g,e_ as ge,X as ke,S as ve,O as Ie,U as Le,W as Oe,a5 as Ge,q as T,ez as we}from"./main-hjbDDO6j.js";import{useState as h,useEffect as Ce}from"react";import{D as Fe}from"./SwitchControl-C_wbgFy3.js";import{F as qe,a as xe}from"./FormAccess-DEsYjDHG.js";import{G as Ve}from"./GroupPickerDialog-CJH5Fdnt.js";import{u as Ue}from"./useFormatDate-DtCZfuLt.js";import{C as je}from"./CopyToClipboardButton-MzIOrqEi.js";const Te=({user:r})=>{const{adminClient:s}=L(),e=S(),{realm:o}=se(),[n,l]=h();return R(()=>e.hasAccess("view-realm")?s.components.findOne({id:r.federationLink}):s.userStorageProvider.name({id:r.federationLink}),l,[]),n?e.hasAccess("view-realm")?t(M,{variant:"link",component:f=>t(oe,{...f,to:le({id:n.id,providerId:n.providerId,realm:o})}),children:n.name}):t("span",{children:n.name}):null};function Se(r){const s={};Object.entries(r.attributes||{}).forEach(([o,n])=>s[de(o)]=n);const e=ce(r.unmanagedAttributes);return{...r,attributes:s,unmanagedAttributes:e}}function _e(r){const s=r.username?.trim(),e=Array.isArray(r.attributes)?V(r.attributes):Object.fromEntries(Object.entries(r.attributes||{}).map(([n,l])=>[ue(n),l])),o=Array.isArray(r.unmanagedAttributes)?V(r.unmanagedAttributes):r.unmanagedAttributes;for(const n in o)if(e&&Object.hasOwn(e,n))throw Error(`Attribute ${n} is a managed attribute and is already available from the user details.`);return{...r,username:s,attributes:{...o,...e},unmanagedAttributes:void 0}}function We(r={},s={}){return Object.fromEntries(Object.entries(r).filter(([e])=>!Object.hasOwn(s,e)))}const Re=({name:r,label:s,help:e})=>{const{adminClient:o}=L(),{t:n}=D(),[l,f]=h([]);return R(()=>o.authenticationManagement.getRequiredActions(),u=>{const m=u.filter(A=>A.enabled);f(m)},[]),t(me,{name:r,label:n(s),labelIcon:n(e),controller:{defaultValue:[]},isScrollable:!0,maxMenuHeight:"375px",variant:pe.typeaheadMulti,chipGroupProps:{numChips:3},placeholderText:n("requiredActionPlaceholder"),menuAppendTo:"parent",options:l.map(({alias:u,name:m})=>({key:u,value:m||u}))})},ze=({form:r,realm:s,user:e,bruteForce:{isBruteForceProtected:o,isLocked:n}={isBruteForceProtected:!1,isLocked:!1},userProfileMetadata:l,save:f,refresh:u,onGroupsUpdate:m})=>{const{adminClient:A}=L(),{t:a}=D(),E=Ue(),{addAlert:O,addError:G}=fe(),{hasAccess:w}=S(),H=w("manage-users"),N=w("view-realm"),{whoAmI:P}=be(),B=P.getLocale(),{handleSubmit:$,setValue:C,control:_,reset:W,formState:z}=r,{errors:J}=z,[p,F]=h([]),[q,k]=h(!1),[x,K]=h(n),X=he();Ce(()=>{C("requiredActions",e?.requiredActions||[])},[e,C]);const Q=async()=>{try{await A.users.update({id:e.id},{enabled:!0}),O(a("unlockSuccess"),T.success),u&&u()}catch(i){G("unlockError",i)}},Y=i=>{F(p.filter(d=>d.name!==i)),m?.(p)},Z=async i=>{F([...p,...i]),m?.([...p,...i])},ee=async i=>{i.forEach(async ie=>{try{await A.users.addToGroup({id:e.id,groupId:ie.id}),O(a("addedGroupMembership"),T.success)}catch(ne){G("addedGroupMembershipError",ne)}})},te=()=>{k(!q)},ae=()=>{e?.id?W(Se(e)):X(we({realm:s.realm}))},re=()=>e?.userProfileMetadata?.attributes&&!e?.userProfileMetadata?.attributes?.map(i=>i.readOnly).reduce((i,d)=>i&&d,!0);return c(qe,{isHorizontal:!0,onSubmit:$(f),role:"query-users",fineGrainedAccess:e?.access?.manage,className:"pf-v5-u-mt-lg",children:[c(Ae,{...r,children:[q&&t(Ve,{type:"selectMany",text:{title:"selectGroups",ok:"join"},canBrowse:H,onConfirm:i=>{e?.id?ee(i||[]):Z(i||[]),k(!1)},onClose:()=>k(!1),filterGroups:p}),e?.id&&c(v,{children:[t(b,{label:a("id"),fieldId:"kc-id",isRequired:!0,children:c(U,{children:[t(y,{isFill:!0,children:t(j,{id:e.id,"aria-label":a("userID"),value:e.id,readOnly:!0})}),t(y,{children:t(je,{id:`user-${e.id}`,text:e.id,label:a("userID"),variant:"control"})})]})}),t(b,{label:a("createdAt"),fieldId:"kc-created-at",isRequired:!0,children:t(j,{value:E(new Date(e.createdTimestamp)),id:"kc-created-at",readOnly:!0})})]}),t(Re,{name:"requiredActions",label:"requiredUserActions",help:"requiredUserActionsHelp"}),e?.federationLink&&N&&t(b,{label:a("federationLink"),labelIcon:t(I,{helpText:a("federationLinkHelp"),fieldLabelId:"federationLink"}),children:t(Te,{user:e})}),l?c(v,{children:[t(Fe,{name:"emailVerified",label:a("emailVerified"),labelIcon:a("emailVerifiedHelp")}),t(ye,{form:r,userProfileMetadata:l,hideReadOnly:!e,supportedLocales:s.supportedLocales||[],currentLocale:B,t:(i,d)=>a(i,d)})]}):c(v,{children:[!s.registrationEmailAsUsername&&t(g,{name:"username",label:a("username"),readOnly:!!e?.id&&!s.editUsernameAllowed&&s.editUsernameAllowed!==void 0,rules:{required:a("required")}}),t(g,{name:"email",label:a("email"),type:"email",rules:{pattern:{value:ge,message:a("emailInvalid")}}}),t(ke,{name:"emailVerified",label:a("emailVerified"),labelIcon:a("emailVerifiedHelp"),labelOn:a("yes"),labelOff:a("no")}),t(g,{name:"firstName",label:a("firstName")}),t(g,{name:"lastName",label:a("lastName")})]}),o&&t(b,{label:a("temporaryLocked"),fieldId:"temporaryLocked",labelIcon:t(I,{helpText:a("temporaryLockedHelp"),fieldLabelId:"temporaryLocked"}),children:t(ve,{"data-testid":"user-locked-switch",id:"temporaryLocked",onChange:(i,d)=>{Q(),K(d)},isChecked:x,isDisabled:!x,label:a("on"),labelOff:a("off")})}),!e?.id&&c(b,{label:a("groups"),fieldId:"kc-groups",labelIcon:t(I,{helpText:a("groupsHelp"),fieldLabelId:"groups"}),children:[t(Ie,{name:"groups",defaultValue:[],control:_,render:()=>c(U,{children:[t(y,{children:t(Le,{categoryName:" ",children:p.map(i=>t(Oe,{onClick:()=>Y(i.name),children:i.path},i.id))})}),t(y,{children:t(M,{id:"kc-join-groups-button",onClick:te,variant:"secondary","data-testid":"join-groups-button",children:a("joinGroups")})})]})}),J.requiredActions&&t(Ge,{message:a("required")})]})]}),t(xe,{name:"user-creation",saveText:e?.id?a("save"):a("create"),reset:ae,resetText:e?.id?a("revert"):a("cancel"),isDisabled:re(),isSubmit:!0})]})};export{Te as F,Re as R,ze as U,Se as a,We as f,_e as t};
//# sourceMappingURL=UserForm-uc4P8TwT.js.map
