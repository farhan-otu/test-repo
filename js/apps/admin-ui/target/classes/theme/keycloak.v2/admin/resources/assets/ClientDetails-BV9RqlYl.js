import{jsx as e,jsxs as l,Fragment as L}from"react/jsx-runtime";import{ar as mt,as as Le,bQ as va,bR as Sa,u as X,d as de,a as R,ak as Ln,e as Me,j as te,bS as Qe,m as ht,F as pe,bT as Ca,bU as on,N as z,_ as V,ag as At,ah as Be,ai as It,aj as Ie,bV as Rt,s as ka,v as Ta,x as Aa,bW as $e,Y as re,O as se,Z as Xe,a0 as Se,bD as Hn,bE as Kn,bF as I,J as j,A as Re,f as _,$ as q,bX as Ia,l as _e,V as ie,M as Ue,B as ge,n as Ee,q as $,w as Et,T as ue,h as xe,bY as Ra,S as Ae,P as le,bZ as Mn,H as fe,b_ as wt,b$ as we,bo as Fn,c0 as Ea,c1 as qe,c2 as Ge,c3 as ne,c4 as F,c5 as je,c6 as O,c7 as Yt,c8 as Ct,a4 as wa,ac as Vn,a1 as zn,z as Ce,G as Fe,I as xa,L as be,c9 as ft,ca as Ze,cb as Qt,cc as Pa,a6 as _a,cd as Da,ce as Bn,cf as kt,cg as Na,a8 as Ke,ch as Oa,ci as rn,ay as Gt,cj as ln,ck as La,y as Pe,a9 as Un,aa as qn,ab as Ha,ad as Gn,ae as Ka,bl as jn,b as et,cl as ut,ap as jt,bm as Xt,av as xt,bn as $n,D as We,bt as tt,cm as cn,cn as Wn,co as dn,cp as ct,cq as Jn,cr as un,R as pt,cs as Ma,K as Pt,bp as Tt,bq as Je,ct as pn,cu as Fa,cv as Va,aw as za,ax as mn,cw as Ba,bw as Ua,bB as qa,cx as Ga,cy as hn,cz as Yn,cA as ja,bM as $a,cB as Wa,cC as Ja,cD as fn,cE as gn,cF as Ya,bN as Qa,o as Xa,p as bn,cG as Za}from"./main-hjbDDO6j.js";import*as He from"react";import{useState as g,useMemo as gt,useEffect as nt,Fragment as Qn,useId as ei,useRef as ot}from"react";import{C as Zt,u as ke}from"./ConfirmDialog-DN_NVsrg.js";import{P as ti}from"./PermissionTab-CE0biuPZ.js";import{R as ni}from"./RolesList-CTB0TkUW.js";import{u as ae,R as Ft}from"./RoutableTabs-ChOqIl6o.js";import{V as ai}from"./ViewHeader-Dr6ZoEJz.js";import{u as en}from"./useParams-XtwJXIDJ.js";import{D as ve}from"./SwitchControl-C_wbgFy3.js";import{F as oe,a as _t,C as Xn}from"./FormAccess-DEsYjDHG.js";import{K as ii}from"./KeyValueInput-BjiKJH0l.js";import{M as Zn}from"./MultiLineInput-BKovUfcB.js";import{T as tn}from"./TimeSelector-C-6T-B4N.js";import{s as ea}from"./sortBy-D1UyZ0jY.js";import{u as ta,F as si}from"./useFormatDate-DtCZfuLt.js";import{E as na}from"./ExpandableSection-CqcMlejr.js";import{S as oi}from"./SessionsTable-BFpY614L.js";import{C as ri,a as li}from"./ClientDescription-Dn5Zssht.js";import{L as ci}from"./LoginSettings-UVeMmOVv.js";import{C as di}from"./ClientSelect-Di5Ep3wz.js";import{U as aa,N as yn,D as ui,A as pi}from"./NewPolicyDialog-CMVGWMi2.js";import{d as ia,i as vt,g as mi}from"./utils-C-TUnOch.js";import{c as hi}from"./camelCase-BMVgu5G9.js";import{D as vn}from"./policyRepresentation-LeM_FTje.js";import{D as at,a as fi,b as gi,c as bi}from"./DescriptionListTerm-BGpKKoC6.js";import{D as yi}from"./DeleteScopeDialog-1lT-fTLp.js";import{J as vi}from"./JsonFileUpload-D9OTErpO.js";import{D as Si}from"./DynamicComponents-2Oogxguf.js";import{C as sa}from"./CopyToClipboardButton-MzIOrqEi.js";import{F as oa}from"./FileUpload-DFzHUp8z.js";import{S as Ci,a as ki,C as Ti,n as Ai,t as Ii}from"./SearchFilter-DbT7G3n-.js";import{A as Sn,d as Cn,e as Ri,a as Ei,f as wi,C as kn}from"./ClientScopeTypes-CQeLlnWG.js";import{t as xi}from"./translationFormatter-aKDacg4X.js";import{u as Pi,m as _i}from"./useLocaleSort-Bon3wgU4.js";import{c as rt,T as Di,a as Y,b as Q}from"./Tabs-TiG_cKa2.js";import{Q as Ni}from"./question-circle-icon-BckMEuvu.js";import{R as Oi}from"./AddRoleMappingModal-B-7S42YC.js";import{T as Li}from"./Trans-BCvPJnzT.js";import{U as Hi}from"./UserEvents-20oG-Z3I.js";import"react-dom";import"./PageHandler-Dm6Ir_Zl.js";import"./constants-BclHbWtx.js";import"./copy-icon-ePLWnxgr.js";import"./KeySelect-CBdQO7FV.js";import"./_baseFlatten-DK0O-V_R.js";import"./filter-icon-I49U7vdU.js";import"./GroupPickerDialog-CJH5Fdnt.js";import"./DataListItemRow-C-0mzg8R.js";import"./CodeEditor-BF8OqNGf.js";import"./DatePicker-ClawiStM.js";import"./capitalize-BLSIhm4V.js";import"./_baseSlice-F8doVSIJ.js";import"./FileUploadForm-CQxs07NG.js";import"./DropdownPanel-D_qgc_Fl.js";import"./warning-triangle-icon-CUSjnRec.js";import"./pickBy-DbcNzVCB.js";const dt={codeBlock:"pf-v5-c-code-block",codeBlockActions:"pf-v5-c-code-block__actions",codeBlockCode:"pf-v5-c-code-block__code",codeBlockContent:"pf-v5-c-code-block__content",codeBlockHeader:"pf-v5-c-code-block__header",codeBlockPre:"pf-v5-c-code-block__pre"},ra=n=>{var{children:i=null,className:a,actions:t=null}=n,s=mt(n,["children","className","actions"]);return He.createElement("div",Object.assign({className:Le(dt.codeBlock,a)},s),t&&He.createElement("div",{className:Le(dt.codeBlockHeader)},He.createElement("div",{className:Le(dt.codeBlockActions)},t)),He.createElement("div",{className:Le(dt.codeBlockContent)},i))};ra.displayName="CodeBlock";const la=n=>{var{children:i=null,className:a}=n,t=mt(n,["children","className"]);return He.createElement("div",Object.assign({className:Le(`${dt.codeBlockActions}-item`,a)},t),i)};la.displayName="CodeBlockAction";const $t=n=>{var{className:i,children:a}=n,t=mt(n,["className","children"]);return He.createElement("div",Object.assign({className:Le(va.panelHeader,i)},t),a)};$t.displayName="PanelHeader";var Wt;(function(n){n.ul="ul",n.ol="ol",n.dl="dl"})(Wt||(Wt={}));const ca=n=>{var{children:i=null,className:a="",component:t=Wt.ul,isPlain:s=!1}=n,o=mt(n,["children","className","component","isPlain"]);const r=t;return He.createElement(r,Object.assign({},o,{className:Le(s&&Sa.modifiers.plain,a)}),i)};ca.displayName="TextList";var Jt;(function(n){n.li="li",n.dt="dt",n.dd="dd"})(Jt||(Jt={}));const da=n=>{var{children:i=null,className:a="",component:t=Jt.li}=n,s=mt(n,["children","className","component"]);const o=t;return He.createElement(o,Object.assign({},s,{className:Le(a)}),i)};da.displayName="TextListItem";const Ki=({id:n,open:i,toggleDialog:a,protocol:t="openid-connect"})=>{const{adminClient:s}=X(),{realm:o}=de(),{t:r}=R(),{enabled:c}=Ln(),d=Me().clientInstallations[t],[p,f]=g(d[d.length-1].id),[h,m]=g(),[C,w]=g(!1),k=gt(()=>d.find(y=>y.id===p)??null,[p]),A=y=>y.replace(/<PrivateKeyPem>.*<\/PrivateKeyPem>/gs,`<PrivateKeyPem>${r("privateKeyMask")}</PrivateKeyPem>`);return te(async()=>{if(k?.mediaType==="application/zip")return(await ka(`${Aa(s.baseUrl)}admin/realms/${o}/clients/${n}/installation/providers/${p}`,{method:"GET",headers:Ta(await s.getAccessToken())})).arrayBuffer();{const y=await s.clients.getInstallationProviders({id:n,providerId:p});return typeof y=="string"?A(y):$e(y)}},y=>m(y),[n,p]),nt(()=>m(""),[n,p]),e(Zt,{titleKey:r("downloadAdaptorTitle"),continueButtonLabel:r("download"),onConfirm:()=>{Qe.saveAs(new Blob([h],{type:k?.mediaType}),k?.filename)},open:i,toggleDialog:a,variant:ht.medium,children:e(pe,{children:l(Ca,{hasGutter:!0,children:[e(on,{children:e(z,{fieldId:"type",label:r("formatOption"),labelIcon:e(V,{helpText:r("downloadType"),fieldLabelId:"formatOption"}),children:e(At,{isOpen:C,onOpenChange:y=>w(y),toggle:y=>e(Be,{id:"type",ref:y,onClick:()=>w(!C),isExpanded:C,children:p}),selected:p,onSelect:(y,K)=>{f(K?.toString()||""),w(!1)},"aria-label":r("selectOne"),popperProps:{appendTo:document.body},children:e(It,{children:d.map(y=>e(Ie,{value:y.id,isSelected:p===y.id,description:c?y.helpText:void 0,children:y.displayType},y.id))})})})}),!k?.downloadOnly&&e(on,{isFilled:!0,children:e(z,{fieldId:"details",label:r("details"),labelIcon:e(V,{helpText:r("detailsHelp"),fieldLabelId:"details"}),children:e(Rt,{id:"details",readOnly:!0,rows:12,resizeOrientation:"vertical",value:h&&typeof h=="string"?h:"","aria-label":"text area example"})})})]})})})},Vt="tokenLifespan.inherited",zt="tokenLifespan.expires",lt=({id:n,name:i,defaultValue:a,units:t})=>{const{t:s}=R(),[o,r]=g(!1),[c,u]=g(!1),d=()=>u(!0),p=()=>u(!1),{control:f}=re(),h=m=>typeof m=="number"||typeof m=="string"&&m!==""||c;return e(z,{label:s(n),fieldId:n,labelIcon:e(V,{helpText:s(`${n}Help`),fieldLabelId:n}),"data-testid":`token-lifespan-${n}`,children:e(se,{name:i,defaultValue:"",control:f,render:({field:m})=>l(Xe,{hasGutter:!0,children:[e(Se,{children:e(At,{toggle:C=>e(Be,{ref:C,onClick:()=>r(!o),isExpanded:o,children:h(m.value)?s(zt):s(Vt)}),isOpen:o,onOpenChange:C=>r(C),onSelect:(C,w)=>{m.onChange(w),r(!1)},selected:h(m.value)?s(zt):s(Vt),children:l(It,{children:[e(Ie,{value:"",children:s(Vt)}),e(Ie,{value:60,children:s(zt)})]})})}),e(Se,{hidden:!h(m.value),children:e(tn,{validated:h(m.value)&&m.value<1?"warning":"default",units:t,value:m.value===""?a:m.value,onChange:m.onChange,onFocus:d,onBlur:p,min:1,isDisabled:!h(m.value)})})]})})})},Mi=({save:n,reset:i,protocol:a,hasConfigureAccess:t})=>{const{t:s}=R(),[o,r]=g(!1),{realmRepresentation:c}=de(),d=Hn()(Kn.DPoP),{control:p}=re();return l(oe,{role:"manage-realm",fineGrainedAccess:t,isHorizontal:!0,children:[a!=="openid-connect"&&e(z,{label:s("assertionLifespan"),fieldId:"assertionLifespan",labelIcon:e(V,{helpText:s("assertionLifespanHelp"),fieldLabelId:"assertionLifespan"}),children:e(se,{name:I("attributes.saml.assertion.lifespan"),defaultValue:"",control:p,render:({field:f})=>e(tn,{units:["minute","day","hour"],value:f.value,onChange:f.onChange})})}),a==="openid-connect"&&l(L,{children:[e(lt,{id:"accessTokenLifespan",name:I("attributes.access.token.lifespan"),defaultValue:c?.accessTokenLifespan,units:["minute","day","hour"]}),e(lt,{id:"clientSessionIdle",name:I("attributes.client.session.idle.timeout"),defaultValue:c?.clientSessionIdleTimeout,units:["minute","day","hour"]}),e(lt,{id:"clientSessionMax",name:I("attributes.client.session.max.lifespan"),defaultValue:c?.clientSessionMaxLifespan,units:["minute","day","hour"]}),e(lt,{id:"clientOfflineSessionIdle",name:I("attributes.client.offline.session.idle.timeout"),defaultValue:c?.offlineSessionIdleTimeout,units:["minute","day","hour"]}),c?.offlineSessionMaxLifespanEnabled&&e(lt,{id:"clientOfflineSessionMax",name:I("attributes.client.offline.session.max.lifespan"),defaultValue:c?.offlineSessionMaxLifespanEnabled?c.offlineSessionMaxLifespan:void 0,units:["minute","day","hour"]}),e(ve,{name:I("attributes.tls.client.certificate.bound.access.tokens"),label:s("oAuthMutual"),labelIcon:s("oAuthMutualHelp"),stringify:!0}),d&&e(ve,{name:I("attributes.dpop.bound.access.tokens"),label:s("oAuthDPoP"),labelIcon:s("oAuthDPoPHelp"),stringify:!0}),e(z,{label:s("keyForCodeExchange"),fieldId:"keyForCodeExchange",hasNoPaddingTop:!0,labelIcon:e(V,{helpText:s("keyForCodeExchangeHelp"),fieldLabelId:"keyForCodeExchange"}),children:e(se,{name:I("attributes.pkce.code.challenge.method"),defaultValue:"",control:p,render:({field:f})=>e(At,{toggle:h=>e(Be,{id:"keyForCodeExchange",ref:h,onClick:()=>r(!o),isExpanded:o,children:[f.value||s("choose")]}),isOpen:o,onOpenChange:h=>r(h),onSelect:(h,m)=>{f.onChange(m),r(!1)},selected:f.value,children:e(It,{children:["","S256","plain"].map(h=>e(Ie,{value:h,children:h||s("choose")},h))})})})}),e(ve,{name:I("attributes.require.pushed.authorization.requests"),label:s("pushedAuthorizationRequestRequired"),labelIcon:s("pushedAuthorizationRequestRequiredHelp"),stringify:!0}),e(ve,{name:I("attributes.client.use.lightweight.access.token.enabled"),label:s("lightweightAccessToken"),labelIcon:s("lightweightAccessTokenHelp"),stringify:!0}),e(ve,{name:I("attributes.client.introspection.response.allow.jwt.claim.enabled"),label:s("supportJwtClaimInIntrospectionResponse"),labelIcon:s("supportJwtClaimInIntrospectionResponseHelp"),stringify:!0}),e(z,{label:s("acrToLoAMapping"),fieldId:"acrToLoAMapping",labelIcon:e(V,{helpText:s("acrToLoAMappingHelp"),fieldLabelId:"acrToLoAMapping"}),children:e(ii,{label:s("acrToLoAMapping"),name:I("attributes.acr.loa.map")})}),e(z,{label:s("defaultACRValues"),fieldId:"defaultACRValues",labelIcon:e(V,{helpText:s("defaultACRValuesHelp"),fieldLabelId:"defaultACRValues"}),children:e(Zn,{id:"defaultACRValues","aria-label":"defaultACRValues",name:I("attributes.default.acr.values"),stringify:!0})}),e(j,{type:"text",name:I("attributes.minimum.acr.value"),label:s("minimumACRValue"),labelIcon:s("minimumACRValueHelp")})]}),l(Re,{children:[e(_,{variant:"secondary",onClick:n,"data-testid":"OIDCAdvancedSave",children:s("save")}),e(_,{variant:"link",onClick:i,"data-testid":"OIDCAdvancedRevert",children:s("revert")})]})]})},Fi=({protocol:n,save:i,reset:a,hasConfigureAccess:t})=>{const{adminClient:s}=X(),{t:o}=R(),[r,c]=g([]);return te(()=>s.authenticationManagement.getFlows(),u=>{let d=[...u.filter(p=>p.providerId!=="client-flow")];d=ea(d,[p=>p.alias]),c(d)},[]),l(oe,{role:"manage-clients",fineGrainedAccess:t,isHorizontal:!0,children:[e(q,{name:"authenticationFlowBindingOverrides.browser",label:o("browserFlow"),labelIcon:o("browserFlowHelp"),controller:{defaultValue:""},options:[{key:"",value:o("choose")},...r.map(({id:u,alias:d})=>({key:u,value:d}))]}),n==="openid-connect"&&e(q,{name:"authenticationFlowBindingOverrides.direct_grant",label:o("directGrant"),labelIcon:o("directGrantHelp"),controller:{defaultValue:""},options:[{key:"",value:o("choose")},...r.map(({id:u,alias:d})=>({key:u,value:d}))]}),l(Re,{children:[e(_,{variant:"secondary",onClick:i,"data-testid":"OIDCAuthFlowOverrideSave",children:o("save")}),e(_,{variant:"link",onClick:a,"data-testid":"OIDCAuthFlowOverrideRevert",children:o("revert")})]})]})},Vi=n=>{const{field:i}=Ia(n);return e(tn,{...n,...i})},zi=({clientId:n,isOpen:i,onAdded:a,onClose:t})=>{const{adminClient:s}=X(),{t:o}=R(),r=_e(),{handleSubmit:c,formState:{isDirty:u,isValid:d}}=r,{addAlert:p,addError:f}=ie();async function h({node:m}){try{await s.clients.addClusterNode({id:n,node:m}),a(m),p(o("addedNodeSuccess"),$.success)}catch(C){f("addedNodeFail",C)}t()}return e(Ue,{title:o("addNode"),isOpen:i,onClose:t,variant:"small",actions:[e(_,{id:"add-node-confirm",type:"submit",form:"add-host-form",isDisabled:!u||!d,children:o("save")},"confirm"),e(_,{id:"add-node-cancel",variant:ge.link,onClick:t,children:o("cancel")},"cancel")],children:e(Ee,{...r,children:e(pe,{id:"add-host-form",onSubmit:c(h),isHorizontal:!0,children:e(j,{name:"node",label:o("nodeHost"),rules:{required:o("required")}})})})})},Bi=({save:n,client:{id:i,registeredNodes:a,access:t}})=>{const{adminClient:s}=X(),{t:o}=R(),{addAlert:r,addError:c}=ie(),u=ta(),[d,p]=g(a||{}),[f,h]=g(!1),[m,C]=g(""),[w,k]=g(!1),[A,y]=g(0),K=()=>y(new Date().getTime()),D=async()=>{const E=await s.clients.testNodesAvailable({id:i});ji(E,"testCluster",r,o)},[M,H]=ke({titleKey:"deleteNode",messageKey:o("deleteNodeBody",{node:m}),continueButtonLabel:"delete",continueButtonVariant:ge.danger,onConfirm:async()=>{try{await s.clients.deleteClusterNode({id:i,node:m}),p({...Object.keys(d).reduce((E,S)=>(S!==m&&(E[S]=d[S]),E),{})}),K(),r(o("deleteNodeSuccess"),$.success)}catch(E){c("deleteNodeFail",E)}}});return l(L,{children:[e(oe,{role:"manage-clients",fineGrainedAccess:t?.configure,isHorizontal:!0,children:e(z,{label:o("nodeReRegistrationTimeout"),fieldId:"kc-node-reregistration-timeout",labelIcon:e(V,{helpText:o("nodeReRegistrationTimeoutHelp"),fieldLabelId:"nodeReRegistrationTimeout"}),children:l(Xe,{hasGutter:!0,children:[e(Se,{children:e(Vi,{name:"nodeReRegistrationTimeout"})}),e(Se,{children:e(_,{variant:ge.secondary,onClick:()=>n(),children:o("save")})})]})})}),l(L,{children:[e(H,{}),e(zi,{clientId:i,isOpen:w,onAdded:E=>{d[E]=Date.now()/1e3,K()},onClose:()=>k(!1)}),e(na,{toggleText:o("registeredClusterNodes"),onToggle:(E,S)=>h(S),isExpanded:f,children:e(Et,{ariaLabelKey:"registeredClusterNodes",loader:()=>Promise.resolve(Object.entries(d||{}).map(E=>({host:E[0],registration:E[1]}))),toolbarItem:l(L,{children:[e(ue,{children:e(_,{id:"testClusterAvailability",onClick:D,variant:ge.secondary,isDisabled:Object.keys(d).length===0,children:o("testClusterAvailability")})}),e(ue,{children:e(_,{id:"registerNodeManually",onClick:()=>k(!0),variant:ge.tertiary,children:o("registerNodeManually")})})]}),actions:[{title:o("delete"),onRowClick:E=>{C(E.host),M()}}],columns:[{name:"host",displayKey:"nodeHost"},{name:"registration",displayKey:"lastRegistration",cellFormatters:[E=>E?u(new Date(parseInt(E.toString())*1e3),si):""]}],emptyState:e(xe,{message:o("noNodes"),instructions:o("noNodesInstructions"),primaryActionText:o("registerNodeManually"),onPrimaryAction:()=>k(!0)})},A)})]})]})},ua=n=>{const{t:i}=R();return l(L,{children:[e(j,{name:"attributes.logoUri",label:i("logoUrl"),labelIcon:i("logoUrlHelp"),type:"url",...n}),e(j,{name:"attributes.policyUri",label:i("policyUrl"),labelIcon:i("policyUrlHelp"),type:"url",...n}),e(j,{name:"attributes.tosUri",label:i("termsOfServiceUrl"),labelIcon:i("termsOfServiceUrlHelp"),type:"url",...n})]})},Ui=({save:n,reset:i,hasConfigureAccess:a})=>{const{t}=R(),s=Me().providers,o=s?.clientSignature.providers,r=s?.contentencryption.providers,c=s?.cekmanagement.providers,u=s?.signature.providers,d=m=>Ra(m).map(C=>({key:C,value:C})),p=m=>[{key:"",value:t("choose")},...d(m)],f=m=>[{key:"any",value:t("any")},...d(m)],h=m=>[{key:"none",value:t("none")},...d(m)];return l(oe,{role:"manage-clients",fineGrainedAccess:a,isHorizontal:!0,children:[e(ua,{}),e(q,{name:I("attributes.access.token.signed.response.alg"),label:t("accessTokenSignatureAlgorithm"),labelIcon:t("accessTokenSignatureAlgorithmHelp"),controller:{defaultValue:""},options:p(o)}),e(q,{name:I("attributes.id.token.signed.response.alg"),label:t("idTokenSignatureAlgorithm"),labelIcon:t("idTokenSignatureAlgorithmHelp"),controller:{defaultValue:""},options:p(o)}),e(q,{name:I("attributes.id.token.encrypted.response.alg"),label:t("idTokenEncryptionKeyManagementAlgorithm"),labelIcon:t("idTokenEncryptionKeyManagementAlgorithmHelp"),controller:{defaultValue:""},options:p(c)}),e(q,{name:I("attributes.id.token.encrypted.response.enc"),label:t("idTokenEncryptionContentEncryptionAlgorithm"),labelIcon:t("idTokenEncryptionContentEncryptionAlgorithmHelp"),controller:{defaultValue:""},options:p(r)}),e(q,{name:I("attributes.user.info.response.signature.alg"),label:t("userInfoSignedResponseAlgorithm"),labelIcon:t("userInfoSignedResponseAlgorithmHelp"),controller:{defaultValue:""},options:p(u)}),e(q,{name:I("attributes.user.info.encrypted.response.alg"),label:t("userInfoResponseEncryptionKeyManagementAlgorithm"),labelIcon:t("userInfoResponseEncryptionKeyManagementAlgorithmHelp"),controller:{defaultValue:""},options:p(c)}),e(q,{name:I("attributes.user.info.encrypted.response.enc"),label:t("userInfoResponseEncryptionContentEncryptionAlgorithm"),labelIcon:t("userInfoResponseEncryptionContentEncryptionAlgorithmHelp"),controller:{defaultValue:""},options:p(r)}),e(q,{name:I("attributes.request.object.signature.alg"),label:t("requestObjectSignatureAlgorithm"),labelIcon:t("requestObjectSignatureAlgorithmHelp"),controller:{defaultValue:""},options:[{key:"any",value:t("any")},...h(o)]}),e(q,{name:I("attributes.request.object.encryption.alg"),label:t("requestObjectEncryption"),labelIcon:t("requestObjectEncryptionHelp"),controller:{defaultValue:""},options:f(c)}),e(q,{name:I("attributes.request.object.encryption.enc"),label:t("requestObjectEncoding"),labelIcon:t("requestObjectEncodingHelp"),controller:{defaultValue:""},options:f(r)}),e(q,{name:I("attributes.request.object.required"),label:t("requestObjectRequired"),labelIcon:t("requestObjectRequiredHelp"),controller:{defaultValue:""},options:["not required","request or request_uri","request only","request_uri only"].map(m=>({key:m,value:t(`requestObject.${m}`)}))}),e(z,{label:t("validRequestURIs"),fieldId:"validRequestURIs",labelIcon:e(V,{helpText:t("validRequestURIsHelp"),fieldLabelId:"validRequestURIs"}),children:e(Zn,{name:I("attributes.request.uris"),"aria-label":t("validRequestURIs"),addButtonLabel:"addRequestUri",stringify:!0})}),e(q,{name:I("attributes.authorization.signed.response.alg"),label:t("authorizationSignedResponseAlg"),labelIcon:t("authorizationSignedResponseAlgHelp"),controller:{defaultValue:""},options:p(u)}),e(q,{name:I("attributes.authorization.encrypted.response.alg"),label:t("authorizationEncryptedResponseAlg"),labelIcon:t("authorizationEncryptedResponseAlgHelp"),controller:{defaultValue:""},options:p(c)}),e(q,{name:I("attributes.authorization.encrypted.response.enc"),label:t("authorizationEncryptedResponseEnc"),labelIcon:t("authorizationEncryptedResponseEncHelp"),controller:{defaultValue:""},options:p(r)}),l(Re,{children:[e(_,{variant:"secondary",id:"fineGrainSave",onClick:n,children:t("save")}),e(_,{id:"fineGrainRevert",variant:"link",onClick:i,children:t("revert")})]})]})},qi=({save:n,reset:i})=>{const{t:a}=R();return l(oe,{role:"manage-realm",isHorizontal:!0,children:[e(ua,{}),e(j,{name:"attributes.saml_assertion_consumer_url_post",label:a("assertionConsumerServicePostBindingURL"),labelIcon:a("assertionConsumerServicePostBindingURLHelp"),type:"url"}),e(j,{name:"attributes.saml_assertion_consumer_url_redirect",label:a("assertionConsumerServiceRedirectBindingURL"),labelIcon:a("assertionConsumerServiceRedirectBindingURLHelp"),type:"url"}),e(j,{name:"attributes.saml_single_logout_service_url_post",label:a("logoutServicePostBindingURL"),labelIcon:a("logoutServicePostBindingURLHelp"),type:"url"}),e(j,{name:"attributes.saml_single_logout_service_url_redirect",label:a("logoutServiceRedirectBindingURL"),labelIcon:a("logoutServiceRedirectBindingURLHelp"),type:"url"}),e(j,{name:"attributes.saml_single_logout_service_url_soap",label:a("logoutServiceSoapBindingUrl"),labelIcon:a("logoutServiceSoapBindingUrlHelp"),type:"url"}),e(j,{name:"attributes.saml_single_logout_service_url_artifact",label:a("logoutServiceArtifactBindingUrl"),labelIcon:a("logoutServiceArtifactBindingUrlHelp"),type:"url"}),e(j,{name:"attributes.saml_artifact_binding_url",label:a("artifactBindingUrl"),labelIcon:a("artifactBindingUrlHelp"),type:"url"}),e(j,{name:"attributes.saml_artifact_resolution_service_url",label:a("artifactResolutionService"),labelIcon:a("artifactResolutionServiceHelp"),type:"url"}),l(Re,{children:[e(_,{variant:"tertiary",onClick:n,"data-testid":"fineGrainSave",children:a("save")}),e(_,{variant:"link",onClick:i,"data-testid":"fineGrainRevert",children:a("revert")})]})]})},Gi=({save:n,reset:i,hasConfigureAccess:a})=>{const{t}=R(),{control:s}=re();return l(oe,{role:"manage-clients",fineGrainedAccess:a,isHorizontal:!0,children:[e(z,{label:t("excludeSessionStateFromAuthenticationResponse"),fieldId:"excludeSessionStateFromAuthenticationResponse",hasNoPaddingTop:!0,labelIcon:e(V,{helpText:t("excludeSessionStateFromAuthenticationResponseHelp"),fieldLabelId:"excludeSessionStateFromAuthenticationResponse"}),children:e(se,{name:I("attributes.exclude.session.state.from.auth.response"),defaultValue:"",control:s,render:({field:o})=>e(Ae,{id:"excludeSessionStateFromAuthenticationResponse-switch",label:t("on"),labelOff:t("off"),isChecked:o.value==="true",onChange:(r,c)=>o.onChange(c.toString()),"aria-label":t("excludeSessionStateFromAuthenticationResponse")})})}),e(z,{label:t("excludeIssuerFromAuthenticationResponse"),fieldId:"excludeIssuerFromAuthenticationResponse",hasNoPaddingTop:!0,labelIcon:e(V,{helpText:t("excludeIssuerFromAuthenticationResponseHelp"),fieldLabelId:"excludeIssuerFromAuthenticationResponse"}),children:e(se,{name:I("attributes.exclude.issuer.from.auth.response"),defaultValue:"",control:s,render:({field:o})=>e(Ae,{id:"excludeIssuerFromAuthenticationResponse-switch",label:t("on"),labelOff:t("off"),isChecked:o.value==="true",onChange:(r,c)=>o.onChange(c.toString()),"aria-label":t("excludeIssuerFromAuthenticationResponse")})})}),e(z,{label:t("useRefreshTokens"),fieldId:"useRefreshTokens",hasNoPaddingTop:!0,labelIcon:e(V,{helpText:t("useRefreshTokensHelp"),fieldLabelId:"useRefreshTokens"}),children:e(se,{name:I("attributes.use.refresh.tokens"),defaultValue:"true",control:s,render:({field:o})=>e(Ae,{id:"useRefreshTokens",label:t("on"),labelOff:t("off"),isChecked:o.value==="true",onChange:(r,c)=>o.onChange(c.toString()),"aria-label":t("useRefreshTokens")})})}),e(z,{label:t("useRefreshTokenForClientCredentialsGrant"),fieldId:"useRefreshTokenForClientCredentialsGrant",hasNoPaddingTop:!0,labelIcon:e(V,{helpText:t("useRefreshTokenForClientCredentialsGrantHelp"),fieldLabelId:"useRefreshTokenForClientCredentialsGrant"}),children:e(se,{name:I("attributes.client_credentials.use_refresh_token"),defaultValue:"false",control:s,render:({field:o})=>e(Ae,{id:"useRefreshTokenForClientCredentialsGrant",label:t("on"),labelOff:t("off"),isChecked:o.value==="true",onChange:(r,c)=>o.onChange(c.toString()),"aria-label":t("useRefreshTokenForClientCredentialsGrant")})})}),e(z,{label:t("useLowerCaseBearerType"),fieldId:"useLowerCaseBearerType",hasNoPaddingTop:!0,labelIcon:e(V,{helpText:t("useLowerCaseBearerTypeHelp"),fieldLabelId:"useLowerCaseBearerType"}),children:e(se,{name:I("attributes.token.response.type.bearer.lower-case"),defaultValue:"false",control:s,render:({field:o})=>e(Ae,{id:"useLowerCaseBearerType",label:t("on"),labelOff:t("off"),isChecked:o.value==="true",onChange:(r,c)=>o.onChange(c.toString()),"aria-label":t("useLowerCaseBearerType")})})}),l(Re,{children:[e(_,{variant:"secondary",onClick:n,"data-testid":"OIDCCompatabilitySave",children:t("save")}),e(_,{variant:"link",onClick:i,"data-testid":"OIDCCompatabilityRevert",children:t("revert")})]})]})},ji=(n,i,a,t)=>{const s=n.successRequests?.length||0,o=n.failedRequests?.length||0;s===0&&o===0?a(t("noAdminUrlSet"),$.warning):o>0?(a(t(i+"Success",{successNodes:n.successRequests}),$.success),a(t(i+"Fail",{failedNodes:n.failedRequests}),$.danger)):a(t(i+"Success",{successNodes:n.successRequests}),$.success)},$i=({save:n,client:i})=>{const{t:a}=R(),t="openid-connect",{setValue:s}=re(),{publicClient:o,attributes:r,protocol:c,authenticationFlowBindingOverrides:u}=i,d=p=>{for(const f of p)s(I(`attributes.${f}`),r?.[f]||"")};return e(le,{variant:"light",className:"pf-v5-u-py-0",children:e(Mn,{label:a("jumpToSection"),sections:[{title:a("clustering"),isHidden:!o,panel:e(Bi,{client:i,save:n})},{title:a("fineGrainOpenIdConnectConfiguration"),isHidden:c!==t,panel:l(L,{children:[e(fe,{className:"pf-v5-u-pb-lg",children:a("fineGrainOpenIdConnectConfigurationHelp")}),e(Ui,{save:n,reset:()=>{d(["logoUri","policyUri","tosUri","access.token.signed.response.alg","id.token.signed.response.alg","id.token.encrypted.response.alg","id.token.encrypted.response.enc","user.info.response.signature.alg","user.info.encrypted.response.alg","user.info.encrypted.response.enc","request.object.signature.alg","request.object.encryption.alg","request.object.encryption.enc","request.object.required","request.uris","authorization.signed.response.alg","authorization.encrypted.response.alg","authorization.encrypted.response.enc"])}})]})},{title:a("openIdConnectCompatibilityModes"),isHidden:c!==t,panel:l(L,{children:[e(fe,{className:"pf-v5-u-pb-lg",children:a("openIdConnectCompatibilityModesHelp")}),e(Gi,{save:()=>n(),reset:()=>d(["exclude.session.state.from.auth.response","use.refresh.tokens","client_credentials.use_refresh_token","token.response.type.bearer.lower-case"])})]})},{title:a("fineGrainSamlEndpointConfig"),isHidden:c===t,panel:l(L,{children:[e(fe,{className:"pf-v5-u-pb-lg",children:a("fineGrainSamlEndpointConfigHelp")}),e(qi,{save:()=>n(),reset:()=>d(["logoUri","policyUri","tosUri","saml_assertion_consumer_url_post","saml_assertion_consumer_url_redirect","saml_single_logout_service_url_post","saml_single_logout_service_url_redirect","saml_single_logout_service_url_artifact","saml_artifact_binding_url","saml_artifact_resolution_service_url"])})]})},{title:a("advancedSettings"),panel:l(L,{children:[e(fe,{className:"pf-v5-u-pb-lg",children:a("advancedSettings"+wt(c||""))}),e(Mi,{protocol:c,save:()=>n(),reset:()=>{d(["saml.assertion.lifespan","access.token.lifespan","tls.client.certificate.bound.access.tokens","pkce.code.challenge.method"])}})]})},{title:a("authenticationOverrides"),panel:l(L,{children:[e(fe,{className:"pf-v5-u-pb-lg",children:a("authenticationOverridesHelp")}),e(Fi,{protocol:c,save:()=>n(),reset:()=>{s("authenticationFlowBindingOverrides.browser",u?.browser),s("authenticationFlowBindingOverrides.direct_grant",u?.direct_grant)}})]})}],borders:!0})})},Wi=({client:n})=>{const{adminClient:i}=X(),{t:a}=R();return e(le,{variant:"light",className:"pf-v5-u-p-0",children:e(oi,{loader:async(s,o)=>{const r=u=>d=>d.map(p=>({type:u,...p}));return(await Promise.all([i.clients.listSessions({id:n.id,first:s,max:o}).then(r(a("sessionsType.regularSSO"))),i.clients.listOfflineSessions({id:n.id,first:s,max:o}).then(r(a("sessionsType.offline")))])).flat()},hiddenColumns:["clients"],emptyInstructions:a("noSessionsForClient")})})},Ji=({client:n,save:i,reset:a})=>{const{t}=R(),{watch:s}=re(),{hasAccess:o}=we(),r=o("manage-clients")||n.access?.configure,c=s("protocol");return l(oe,{isHorizontal:!0,fineGrainedAccess:n.access?.configure,role:"manage-clients",children:[!n.bearerOnly&&e(ci,{protocol:c}),c!=="saml"&&e(j,{type:"url",name:"adminUrl",label:t("adminURL"),labelIcon:t("adminURLHelp")}),n.bearerOnly&&e(_t,{name:"settings",save:i,reset:a,isDisabled:r})]})},Yi=({access:n})=>{const{t:i}=R(),{watch:a}=re(),t=Me().themes.login,s=a("consentRequired"),o=a(I("attributes.display.on.consent.screen"));return l(oe,{isHorizontal:!0,fineGrainedAccess:n,role:"manage-clients",children:[e(q,{name:"attributes.login_theme",label:i("loginTheme"),labelIcon:i("loginThemeHelp"),controller:{defaultValue:""},options:[{key:"",value:i("choose")},...t.map(({name:r})=>({key:r,value:r}))]}),e(ve,{name:"consentRequired",label:i("consentRequired"),labelIcon:i("consentRequiredHelp")}),e(ve,{name:I("attributes.display.on.consent.screen"),label:i("displayOnClient"),labelIcon:i("displayOnClientHelp"),isDisabled:!s,stringify:!0}),e(Fn,{name:I("attributes.consent.screen.text"),label:i("consentScreenText"),labelIcon:i("consentScreenTextHelp"),isDisabled:!(s&&o==="true")})]})},Tn=(n,i)=>(n?.startsWith("https://")||n?.startsWith("http://"))&&!n.includes("*")||n===""||i,Qi=({save:n,reset:i,client:{access:a}})=>{const{t}=R(),{control:s,watch:o}=re(),{hasAccess:r}=we(),c=r("manage-clients")||a?.configure,u=o("protocol"),d=o("frontchannelLogout"),p=u==="openid-connect"?"frontchannelLogoutOIDCHelp":"frontchannelLogoutHelp";return l(oe,{isHorizontal:!0,fineGrainedAccess:a?.configure,role:"manage-clients",children:[e(z,{label:t("frontchannelLogout"),labelIcon:e(V,{helpText:t(p),fieldLabelId:"frontchannelLogout"}),fieldId:"kc-frontchannelLogout",hasNoPaddingTop:!0,children:e(se,{name:"frontchannelLogout",defaultValue:!0,control:s,render:({field:f})=>e(Ae,{id:"kc-frontchannelLogout-switch",label:t("on"),labelOff:t("off"),isChecked:f.value,onChange:f.onChange,"aria-label":t("frontchannelLogout")})})}),u==="openid-connect"&&d&&e(j,{"data-testid":"frontchannelLogoutUrl",type:"url",name:I("attributes.frontchannel.logout.url"),label:t("frontchannelLogoutUrl"),labelIcon:t("frontchannelLogoutUrlHelp"),rules:{validate:f=>Tn(f,t("frontchannelUrlInvalid").toString())}}),u==="openid-connect"&&d&&e(ve,{name:I("attributes.frontchannel.logout.session.required"),defaultValue:"true",label:t("frontchannelLogoutSessionRequired"),labelIcon:t("frontchannelLogoutSessionRequiredHelp"),stringify:!0}),u==="openid-connect"&&!d&&l(L,{children:[e(j,{"data-testid":"backchannelLogoutUrl",type:"url",name:I("attributes.backchannel.logout.url"),label:t("backchannelLogoutUrl"),labelIcon:t("backchannelLogoutUrlHelp"),rules:{validate:f=>Tn(f,t("backchannelUrlInvalid").toString())}}),e(z,{label:t("backchannelLogoutSessionRequired"),labelIcon:e(V,{helpText:t("backchannelLogoutSessionRequiredHelp"),fieldLabelId:"backchannelLogoutSessionRequired"}),fieldId:"backchannelLogoutSessionRequired",hasNoPaddingTop:!0,children:e(se,{name:I("attributes.backchannel.logout.session.required"),defaultValue:"true",control:s,render:({field:f})=>e(Ae,{id:"backchannelLogoutSessionRequired",label:t("on"),labelOff:t("off"),isChecked:f.value==="true",onChange:(h,m)=>f.onChange(m.toString()),"aria-label":t("backchannelLogoutSessionRequired")})})}),e(z,{label:t("backchannelLogoutRevokeOfflineSessions"),labelIcon:e(V,{helpText:t("backchannelLogoutRevokeOfflineSessionsHelp"),fieldLabelId:"backchannelLogoutRevokeOfflineSessions"}),fieldId:"backchannelLogoutRevokeOfflineSessions",hasNoPaddingTop:!0,children:e(se,{name:I("attributes.backchannel.logout.revoke.offline.tokens"),defaultValue:"false",control:s,render:({field:f})=>e(Ae,{id:"backchannelLogoutRevokeOfflineSessions",label:t("on"),labelOff:t("off"),isChecked:f.value==="true",onChange:(h,m)=>f.onChange(m.toString()),"aria-label":t("backchannelLogoutRevokeOfflineSessions")})})})]}),e(_t,{name:"settings",save:n,reset:i,isDisabled:!c})]})},Ne=({name:n,label:i})=>{const{t:a}=R();return e(ve,{name:n,label:a(i),labelIcon:a(`${i}Help`),stringify:!0})},Xi=()=>{const{t:n}=R();return l(oe,{isHorizontal:!0,role:"manage-clients",className:"keycloak__capability-config__form",children:[e(q,{name:"attributes.saml_name_id_format",label:n("nameIdFormat"),labelIcon:n("nameIdFormatHelp"),controller:{defaultValue:"username"},options:["username","email","transient","persistent"]}),e(Ne,{name:"attributes.saml_force_name_id_format",label:"forceNameIdFormat"}),e(Ne,{name:I("attributes.saml.force.post.binding"),label:"forcePostBinding"}),e(Ne,{name:I("attributes.saml.artifact.binding"),label:"forceArtifactBinding"}),e(Ne,{name:I("attributes.saml.authnstatement"),label:"includeAuthnStatement"}),e(Ne,{name:I("attributes.saml.onetimeuse.condition"),label:"includeOneTimeUseCondition"}),e(Ne,{name:I("attributes.saml.server.signature.keyinfo.ext"),label:"optimizeLookup"}),e(Ne,{name:I("attributes.saml.allow.ecp.flow"),label:"allowEcpFlow"})]})},An=["RSA_SHA1","RSA_SHA256","RSA_SHA256_MGF1","RSA_SHA512","RSA_SHA512_MGF1","DSA_SHA1"],In=["NONE","KEY_ID","CERT_SUBJECT"],Rn=[{name:"EXCLUSIVE",value:"http://www.w3.org/2001/10/xml-exc-c14n#"},{name:"EXCLUSIVE_WITH_COMMENTS",value:"http://www.w3.org/2001/10/xml-exc-c14n#WithComments"},{name:"INCLUSIVE",value:"http://www.w3.org/TR/2001/REC-xml-c14n-20010315"},{name:"INCLUSIVE_WITH_COMMENTS",value:"http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments"}],Zi=()=>{const{t:n}=R(),{watch:i}=re(),a=i(I("attributes.saml.server.signature")),t=i(I("attributes.saml.assertion.signature"));return l(oe,{isHorizontal:!0,role:"manage-clients",className:"keycloak__capability-config__form",children:[e(Ne,{name:I("attributes.saml.server.signature"),label:"signDocuments"}),e(Ne,{name:I("attributes.saml.assertion.signature"),label:"signAssertions"}),(a==="true"||t==="true")&&l(L,{children:[e(q,{name:I("attributes.saml.signature.algorithm"),label:n("signatureAlgorithm"),labelIcon:n("signatureAlgorithmHelp"),controller:{defaultValue:An[0]},options:[...An]}),e(q,{name:I("attributes.saml.server.signature.keyinfo.xmlSigKeyInfoKeyNameTransformer"),label:n("signatureKeyName"),labelIcon:n("signatureKeyNameHelp"),controller:{defaultValue:In[0]},options:[...In]}),e(q,{name:"attributes.saml_signature_canonicalization_method",label:n("canonicalization"),labelIcon:n("canonicalizationHelp"),controller:{defaultValue:Rn[0].value},options:Rn.map(({name:s,value:o})=>({key:o,value:s}))})]})]})},es=n=>{const{t:i}=R(),{watch:a}=re(),t=a("protocol"),{client:s}=n;return e(Mn,{label:i("jumpToSection"),className:"pf-v5-u-px-lg pf-v5-u-pb-lg",sections:[{title:i("generalSettings"),panel:e(pe,{isHorizontal:!0,children:e(ri,{protocol:s.protocol,hasConfigureAccess:s.access?.configure})})},{title:i("accessSettings"),panel:e(Ji,{...n})},{title:i("samlCapabilityConfig"),isHidden:t!=="saml"||s.bearerOnly,panel:e(Xi,{})},{title:i("signatureAndEncryption"),isHidden:t!=="saml"||s.bearerOnly,panel:e(Zi,{})},{title:i("capabilityConfig"),isHidden:t!=="openid-connect"||s.bearerOnly,panel:e(li,{})},{title:i("loginSettings"),isHidden:s.bearerOnly,panel:e(Yi,{access:s.access?.configure})},{title:i("logoutSettings"),isHidden:s.bearerOnly,panel:e(Qi,{...n})}]})},ts=({name:n,rowIndex:i,attribute:a,selectableValues:t,resources:s})=>{const{t:o}=R(),{control:r,register:c,getValues:u}=re(),[d,p]=g([!1]),f=(w,k)=>{const A=[...d];A[w]=k,p(A)},h=gt(()=>{let w=[];return t&&(w=ia.find(k=>k.key===u().context?.[i]?.key)?.values),w},[u]),m=()=>{const w=s?.find(k=>k.name===u().resources?.[i]?.key)?.scopes;if(h?.length&&!s)return h.map(k=>e(Ie,{value:k.key,children:k.name},k.key));if(w?.length)return w.map(k=>e(Ie,{value:k.name,children:k.name},k.name))},C=w=>hi(w).replace(/\W/g,"");return e(O,{children:s||h?.length?e(se,{name:`${n}.${i}.value`,defaultValue:[],control:r,render:({field:w})=>e(Yt,{toggleId:`${a.id}-value`,className:"kc-attribute-value-selectable",chipGroupProps:{numChips:1,expandedText:o("hide"),collapsedText:o("showRemaining")},onToggle:k=>f(i,k),isOpen:d[i],variant:Ct.typeahead,typeAheadAriaLabel:o("selectOrTypeAKey"),placeholderText:o("selectOrTypeAKey"),selections:w.value,onSelect:k=>{w.onChange(k),f(i,!1)},children:m()})}):e(zn,{id:`${C(a.key)}-value`,className:"value-input",defaultValue:a.value,"data-testid":"attribute-value-input","aria-label":o("value"),...c(`${n}.${i}.value`)})})},En=({name:n,selectableValues:i,resources:a})=>{const{t}=R(),{control:s,watch:o}=re(),{fields:r,append:c,remove:u}=Ea({control:s,name:n}),[d,p]=g([!1]),f=(m,C)=>{const w=[...d];w[m]=C,p(w)};nt(()=>{r.length||c({key:"",value:""},{shouldFocus:!1})},[r]);const h=o(`${n}.${r.length-1}.value`,"");return l(qe,{className:"kc-attributes__table","aria-label":"Role attribute keys and values",variant:"compact",children:[e(Ge,{children:l(ne,{children:[e(F,{width:40,children:t("key")}),e(F,{width:40,children:t("value")})]})}),l(je,{children:[r.map((m,C)=>l(ne,{"data-testid":"attribute-row",children:[e(O,{children:e(se,{name:`${n}.${C}.key`,defaultValue:"",control:s,render:({field:w})=>e(Yt,{toggleId:`${n}.${C}.key`,className:"kc-attribute-key-selectable",onToggle:k=>f(C,k),isOpen:d[C],variant:Ct.typeahead,typeAheadAriaLabel:t("selectOrTypeAKey"),placeholderText:t("selectOrTypeAKey"),selections:w.value,onSelect:k=>{w.onChange(k.toString()),f(C,!1)},children:i?.map(k=>e(Ie,{selected:k.name===w.value,value:a?k.name:k.key,children:k.name},k.key))})})}),e(ts,{name:n,attribute:m,rowIndex:C,selectableValues:i,resources:a}),e(O,{children:e(_,{id:`${n}-minus-button-${C}`,variant:"link",className:"kc-attributes__minus-icon",onClick:()=>u(C),"aria-label":t("remove"),children:e(wa,{})})})]},m.id)),e(ne,{children:e(O,{children:e(_,{"aria-label":t("addAttribute",{label:t("attribute")}),id:`${n}-plus-icon`,variant:"link",className:"kc-attributes__plus-icon",onClick:()=>{c({key:"",value:""}),p([...d,!1])},icon:e(Vn,{}),isDisabled:!h,"data-testid":"attribute-add-row",children:t("addAttribute",{label:t("attribute")})})})})]})]})},ns=({data:n})=>{const{t:i}=R(),[a,t]=Ce();return l(L,{children:[e(_,{"data-testid":"authorization-revert",onClick:t,variant:"secondary",children:i("showAuthData")}),e(Ue,{variant:ht.medium,isOpen:a,"aria-label":i("authData"),header:l(Fe,{children:[e(fe,{component:xa.h1,children:i("authData")}),e(fe,{children:i("authDataDescription")})]}),onClose:t,actions:[e(_,{"data-testid":"cancel",id:"modal-cancel",onClick:t,children:i("cancel")},"cancel")],children:e(Rt,{readOnly:!0,rows:20,value:$e(n)})})]})},as=({idx:n,rowIndex:i,outerPolicy:a,resource:t})=>{const[s,o]=g(!1),{t:r}=R(),{realm:c}=de(),{clientId:u}=en();return l(je,{isExpanded:s,children:[l(ne,{children:[e(O,{expand:{rowIndex:i,isExpanded:s,onToggle:()=>o(d=>!d)}}),e(O,{"data-testid":`name-column-${t.resource}`,children:e(be,{to:ft({realm:c,id:u,permissionType:a.policy?.type,permissionId:a.policy?.id}),children:a.policy?.name})}),e(O,{id:a.status?.toLowerCase(),children:r(a.status?.toLowerCase())}),e(O,{children:r(`${a.policy?.decisionStrategy?.toLowerCase()}`)}),e(O,{children:a.status===vn.Permit?t.policies?.[i]?.scopes?.join(", "):"-"}),e(O,{children:a.status===vn.Deny&&t.policies?.[i]?.scopes?.length?t.policies[i].scopes?.join(", "):"-"})]}),l(ne,{isExpanded:s,children:[e(O,{}),e(O,{colSpan:5,children:s&&e(Ze,{children:e(at,{isHorizontal:!0,className:"keycloak_resource_details",children:e(Fe,{children:e(ca,{children:a.associatedPolicies?.map(d=>l(da,{children:[e(be,{to:Qt({realm:c,id:u,policyType:d.policy?.type,policyId:d.policy?.id}),children:d.policy?.name}),r("votedToStatus",{status:Pa(d.status)})]},"policyDetails"))})})})})})]},`child-${t.resource}`)]},n)},is=({rowIndex:n,resource:i,evaluateResults:a})=>{const[t,s]=g(!1),{t:o}=R();return l(je,{isExpanded:t,children:[l(ne,{children:[e(O,{expand:{rowIndex:n,isExpanded:t,onToggle:()=>s(r=>!r)}}),e(O,{"data-testid":`name-column-${i.resource}`,children:i.resource?.name}),e(O,{id:i.status?.toLowerCase(),children:o(`${i.status?.toLowerCase()}`)}),e(O,{children:i.allowedScopes?.length?i.allowedScopes.map(r=>r.name):"-"})]}),l(ne,{isExpanded:t,children:[e(O,{}),e(O,{colSpan:5,children:e(Ze,{children:t&&e(at,{isHorizontal:!0,className:"keycloak_resource_details",children:l(qe,{"aria-label":o("evaluationResults"),children:[e(Ge,{children:l(ne,{children:[e(F,{"aria-hidden":"true"}),e(F,{children:o("permission")}),e(F,{children:o("results")}),e(F,{children:o("decisionStrategy")}),e(F,{children:o("grantedScopes")}),e(F,{children:o("deniedScopes")}),e(F,{"aria-hidden":"true"})]})}),Object.values(a[n].policies).map((r,c)=>e(as,{idx:c,rowIndex:n,outerPolicy:r,resource:i},c))]})})})})]},`child-${i.resource}`)]})};function ss(n,i){switch(i){case"STATUS_PERMITTED":return n.filter(({status:a})=>a==="PERMIT");case"STATUS_DENIED":return n.filter(({status:a})=>a==="DENY");default:return n}}const os=({evaluateResult:n,refresh:i,back:a})=>{const{t}=R(),[s,o]=Ce(),[r,c]=g("ALL"),[u,d]=g(""),[p,f]=g(""),h=()=>{d(p)},m=A=>{A.key==="Enter"&&h()},C=gt(()=>ss(n.results,r).filter(({resource:A})=>A?.name?.includes(u)??!1),[n.results,r,u]),w=n.results.length===0,k=C.length===0;return l(le,{children:[e(_a,{children:l(Da,{className:"providers-toolbar",children:[e(ue,{children:l(Bn,{children:[e(kt,{isFill:!0,children:e(zn,{name:"inputGroupName",id:"inputGroupName",type:"search","aria-label":t("search"),placeholder:t("search"),onChange:(A,y)=>f(y),onKeyDown:m})}),e(kt,{children:e(_,{variant:ge.control,"aria-label":t("search"),onClick:()=>h(),children:e(Na,{})})})]})}),e(ue,{children:e(At,{"data-testid":"filter-type-select",isOpen:s,className:"kc-filter-type-select",toggle:A=>e(Be,{ref:A,onClick:o,isExpanded:s,style:{width:"300px"},children:r}),onSelect:(A,y)=>{c(y),o(),i()},selected:r,children:l(It,{children:[e(Ie,{"data-testid":"all-results-option",value:"ALL",children:t("allResults")}),e(Ie,{"data-testid":"result-permit-option",value:"STATUS_PERMITTED",children:t("resultPermit")}),e(Ie,{"data-testid":"result-deny-option",value:"STATUS_DENIED",children:t("resultDeny")})]})})})]})}),!k&&l(qe,{"aria-label":t("evaluationResults"),children:[e(Ge,{children:l(ne,{children:[e(F,{"aria-hidden":"true"}),e(F,{children:t("resource")}),e(F,{children:t("overallResults")}),e(F,{children:t("scopes")}),e(F,{"aria-hidden":"true"})]})}),C.map((A,y)=>e(is,{rowIndex:y,resource:A,evaluateResults:n.results},y))]}),(k||w)&&l(L,{children:[e(Ke,{}),e(xe,{isSearchVariant:!0,message:t("noSearchResults"),instructions:t("noSearchResultsInstructions")})]}),e(pe,{children:l(_t,{name:"authorization",children:[e(_,{"data-testid":"authorization-eval",id:"back-btn",onClick:a,children:t("back")})," ",e(_,{"data-testid":"authorization-reevaluate",id:"reevaluate-btn",variant:"secondary",onClick:i,children:t("reevaluate")})," ",e(ns,{data:n.rpt})]})})]})},rs=n=>{const{hasAccess:i}=we();return i("view-users")?e(ls,{...n}):e(Oa,{permissionNeeded:"view-users"})},ls=({client:n})=>{const{adminClient:i}=X(),a=_e({mode:"onChange"}),{reset:t,trigger:s,formState:{isValid:o}}=a,{t:r}=R(),{addError:c}=ie(),u=de(),[d,p]=g(!1),[f,h]=g(!1),[m,C]=g([]),[w,k]=g([]),[A,y]=g(),[K,D]=g([]);te(()=>i.roles.find(),H=>{D(H)},[]),te(()=>Promise.all([i.clients.listResources({id:n.id}),i.clients.listAllScopes({id:n.id})]),([H,E])=>{C(H),k(E)},[]);const M=async()=>{if(!await s())return;const H=a.getValues(),E=La(H.resources),S={roleIds:H.roleIds??[],clientId:H.client.id,userId:H.user[0],resources:m.filter(P=>Object.keys(E).includes(P.name)).map(P=>({...P,scopes:P.scopes?.filter(U=>Object.values(E).flatMap(T=>T).includes(U.name))})),entitlements:!1,context:{attributes:Object.fromEntries(H.context.attributes.filter(P=>P.key||P.value!=="").map(({key:P,value:U})=>[P,U]))}};try{const P=await i.clients.evaluateResource({id:n.id,realm:u.realm},S);y(P)}catch(P){c("evaluateError",P)}};return A?e(os,{evaluateResult:A,refresh:M,back:()=>y(void 0)}):e(le,{children:l(Ee,{...a,children:[l(rn,{children:[e($t,{children:e(Gt,{headingLevel:"h2",children:r("identityInformation")})}),e(ln,{children:l(oe,{isHorizontal:!0,role:"view-clients",children:[e(di,{name:"client",label:"client",helpText:"clientHelp",defaultValue:n.clientId}),e(aa,{name:"user",label:"users",helpText:r("selectUser"),defaultValue:[],variant:"typeahead",isRequired:!0}),e(q,{name:"roleIds",label:r("roles"),labelIcon:r("rolesHelp"),variant:"typeaheadMulti",placeholderText:r("selectARole"),controller:{defaultValue:[],rules:{required:!0}},options:K.map(H=>H.name)})]})})]}),l(rn,{children:[e($t,{children:e(Gt,{headingLevel:"h2",children:r("permissions")})}),e(ln,{children:l(oe,{isHorizontal:!0,role:"view-clients",children:[e(z,{label:r("applyToResourceType"),fieldId:"applyToResourceType",labelIcon:e(V,{helpText:r("applyToResourceTypeHelp"),fieldLabelId:"applyToResourceType"}),children:e(Ae,{id:"applyToResource-switch",label:r("on"),labelOff:r("off"),isChecked:f,onChange:(H,E)=>h(E),"aria-label":r("applyToResourceType")})}),f?l(L,{children:[e(j,{name:"alias",label:r("resourceType"),labelIcon:r("resourceTypeHelp"),rules:{required:r("required")}}),e(q,{name:"authScopes",label:r("authScopes"),labelIcon:r("scopesSelect"),controller:{defaultValue:[]},variant:"typeaheadMulti",options:w.map(H=>H.name)})]}):e(z,{label:r("resourcesAndScopes"),id:"resourcesAndScopes",labelIcon:e(V,{helpText:r("contextualAttributesHelp"),fieldLabelId:"resourcesAndScopes"}),fieldId:"resourcesAndScopes",children:e(En,{selectableValues:m.map(H=>({name:H.name,key:H._id})),resources:m,name:"resources"})}),e(na,{toggleText:r("contextualInfo"),onToggle:()=>p(!d),isExpanded:d,children:e(z,{label:r("contextualAttributes"),id:"contextualAttributes",labelIcon:e(V,{helpText:r("contextualAttributesHelp"),fieldLabelId:"contextualAttributes"}),fieldId:"contextualAttributes",children:e(En,{selectableValues:ia,name:"context.attributes"})})})]})})]}),l(Re,{children:[e(_,{"data-testid":"authorization-eval",id:"authorization-eval",className:"pf-v5-u-mr-md",isDisabled:!o,onClick:()=>M(),children:r("evaluate")}),e(_,{"data-testid":"authorization-revert",id:"authorization-revert",className:"pf-v5-u-mr-md",variant:"link",onClick:()=>t(),children:r("revert")})]})]})})},cs=()=>{const{adminClient:n}=X(),{t:i}=R(),{clientId:a}=en(),{addAlert:t,addError:s}=ie(),[o,r]=g(),[c,u]=g();te(()=>n.clients.exportResource({id:a}),p=>{r(JSON.stringify(p,null,2)),u(p)},[]);const d=()=>{try{Qe.saveAs(new Blob([$e(c)],{type:"application/json"}),"test-authz-config.json"),t(i("exportAuthDetailsSuccess"),$.success)}catch(p){s("exportAuthDetailsError",p)}};return o?e(le,{children:l(oe,{isHorizontal:!0,role:"manage-authorization",className:"pf-v5-u-mt-lg",children:[e(Fn,{name:"authDetails",label:i("authDetails"),labelIcon:i("authDetailsHelp"),resizeOrientation:"vertical",defaultValue:o,readOnly:!0,rows:10}),l(Re,{children:[e(_,{"data-testid":"authorization-export-download",onClick:()=>d(),children:i("download")}),e(_,{"data-testid":"authorization-export-copy",variant:"secondary",onClick:async()=>{try{await navigator.clipboard.writeText(o),t(i("copied"),$.success)}catch(p){s("copyError",p)}},children:i("copy")})]})]})}):e(Pe,{})};function ds(n){return e(ze,{...n})}function ze({name:n,array:i,convert:a,link:t}){const{t:s}=R();return l(fi,{children:[e(gi,{children:s(n)}),l(bi,{children:[i?.map(o=>{const r=typeof o=="string"?o:a(o);return t?e(be,{to:t(o),className:"pf-v5-u-pr-sm",children:r},r):e("span",{className:"pf-v5-u-pr-sm",children:r},r)}),i?.length===0&&e("i",{children:s("none")})]})]})}const wn=({permissionType:n,disabled:i=!1,clientId:a})=>{const{t}=R(),{realm:s}=de(),o=et();return e(_,{"data-testid":`create-${n}`,className:i?"keycloak__permissions__empty_state ":"pf-v5-u-m-sm",variant:"secondary",onClick:()=>!i&&o(ut({realm:s,id:a,permissionType:n})),children:t(`create${wt(n)}BasedPermission`)})},xn=({permissionType:n,disabled:i,...a})=>{const{t}=R();return i?e(jn,{content:t(`no${wt(n)}CreateHint`),children:e(wn,{...a,disabled:i,permissionType:n})}):e(wn,{...a,disabled:i,permissionType:n})},us=({clientId:n,isResourceEnabled:i,isScopeEnabled:a})=>{const{t}=R();return l(Un,{"data-testid":"empty-state",variant:"lg",children:[e(qn,{titleText:e(L,{children:t("emptyPermissions")}),icon:e(Ha,{icon:Vn}),headingLevel:"h1"}),e(Gn,{children:t("emptyPermissionInstructions")}),l(Ka,{children:[e(xn,{permissionType:"resource",disabled:i,clientId:n}),e("br",{}),e(xn,{permissionType:"scope",disabled:a,clientId:n})]})]})},nn=({array:n})=>{const{t:i}=R();return!n||n.length<=1?null:e(jt,{color:"blue",children:i("more",{count:n.length-1})})},an=({types:n,search:i,onSearch:a,type:t})=>{const{t:s}=R(),o=_e({mode:"onChange"}),{reset:r,formState:{isDirty:c},handleSubmit:u}=o,[d,p]=Ce(),f=h=>{p(),a(h)};return nt(()=>r(i),[i]),e(Xt,{onOpenChange:p,toggle:h=>l(Be,{"data-testid":"searchdropdown_dorpdown",ref:h,onClick:p,className:"keycloak__client_authentication__searchdropdown",children:[t==="resource"&&s("searchClientAuthorizationResource"),t==="policy"&&s("searchClientAuthorizationPolicy"),t==="permission"&&s("searchClientAuthorizationPermission")]}),isOpen:d,children:e(Ee,{...o,children:l(pe,{isHorizontal:!0,className:"keycloak__client_authentication__searchdropdown_form",onSubmit:u(f),children:[e(j,{name:"name",label:s("name")}),t==="resource"&&l(L,{children:[e(j,{name:"type",label:s("type")}),e(j,{name:"uris",label:s("uris")}),e(j,{name:"owner",label:s("owner")})]}),t!=="resource"&&t!=="policy"&&e(j,{name:"resource",label:s("resource")}),t!=="policy"&&e(j,{name:"scope",label:s("scope")}),t!=="resource"&&e(q,{name:"type",label:s("type"),controller:{defaultValue:""},options:[{key:"",value:s("allTypes")},...(n||[]).map(({type:h,name:m})=>({key:h,value:m}))]}),l(Re,{children:[e(_,{variant:"primary",type:"submit","data-testid":"search-btn",isDisabled:!c,children:s("search")}),e(_,{variant:"link","data-testid":"revert-btn",onClick:()=>a({}),children:s("clear")})]})]})})})},ps=({row:n})=>l(L,{children:[n.associatedPolicies?.[0]?.name||"—"," ",e(nn,{array:n.associatedPolicies})]}),ms=({clientId:n,isDisabled:i=!1})=>{const{adminClient:a}=X(),{t}=R(),s=et(),{addAlert:o,addError:r}=ie(),{realm:c}=de(),[u,d]=g(),[p,f]=g(),[h,m]=g(),[C,w]=g(),[k,A]=Ce(),[y,K]=g({}),[D,M]=g(0),H=()=>M(D+1),[E,S]=g(10),[P,U]=g(0);te(async()=>{const N=await a.clients.findPermissions({first:P,max:E+1,id:n,...y});return await Promise.all(N.map(async ee=>{const x=await a.clients.getAssociatedPolicies({id:n,permissionId:ee.id});return{...ee,associatedPolicies:x,isExpanded:!1}}))},d,[D,y,P,E]),te(async()=>{const N={first:0,max:1},[ee,x,G]=await Promise.all([a.clients.listPolicyProviders({id:n}),a.clients.listResources({...N,id:n}),a.clients.listAllScopes({...N,id:n})]);return{policies:ee.filter(ye=>ye.type==="resource"||ye.type==="scope"),resources:x.length!==1,scopes:G.length!==1}},({policies:N,resources:ee,scopes:x})=>{m(N),w({resources:ee,scopes:x})},[]);const[T,b]=ke({titleKey:"deletePermission",messageKey:t("deletePermissionConfirm",{permission:p?.name}),continueButtonVariant:ge.danger,continueButtonLabel:"confirm",onConfirm:async()=>{try{await a.clients.delPermission({id:n,type:p?.type,permissionId:p?.id}),o(t("permissionDeletedSuccess"),$.success),H()}catch(N){r("permissionDeletedError",N)}}});if(!u)return e(Pe,{});const v=u.length===0,B=Object.keys(y).length!==0;return l(le,{variant:"light",className:"pf-v5-u-p-0",children:[e(b,{}),(!v||B)&&e(xt,{count:u.length,first:P,max:E,onNextClick:U,onPreviousClick:U,onPerPageSelect:(N,ee)=>{U(N),S(ee)},toolbarItem:l(L,{children:[e(ue,{children:e(an,{types:h,search:y,onSearch:K,type:"permission"})}),e(ue,{children:e(Xt,{onOpenChange:A,toggle:N=>e(Be,{ref:N,onClick:A,isDisabled:i,variant:"primary","data-testid":"permissionCreateDropdown",children:t("createPermission")}),isOpen:k,children:l($n,{children:[e(We,{"data-testid":"create-resource",isDisabled:i||C?.resources,component:"button",onClick:()=>s(ut({realm:c,id:n,permissionType:"resource"})),children:t("createResourceBasedPermission")}),e(Ke,{}),l(We,{"data-testid":"create-scope",isDisabled:i||C?.scopes,component:"button",onClick:()=>s(ut({realm:c,id:n,permissionType:"scope"})),children:[t("createScopeBasedPermission"),C?.scopes&&e(tt,{className:"pf-v5-u-mt-sm",variant:"warning",isInline:!0,isPlain:!0,title:t("noScopeCreateHint")})]})]})})})]}),children:!v&&l(qe,{"aria-label":t("resources"),variant:"compact",children:[e(Ge,{children:l(ne,{children:[e(F,{"aria-hidden":"true"}),e(F,{children:t("name")}),e(F,{children:t("type")}),e(F,{children:t("associatedPolicy")}),e(F,{children:t("description")}),e(F,{"aria-hidden":"true"})]})}),u.map((N,ee)=>l(je,{isExpanded:N.isExpanded,children:[l(ne,{children:[e(O,{expand:{rowIndex:ee,isExpanded:N.isExpanded,onToggle:(x,G)=>{const ye=u.map((De,W)=>W===G?{...De,isExpanded:!De.isExpanded}:De);d(ye)}}}),e(O,{"data-testid":`name-column-${N.name}`,children:e(be,{to:ft({realm:c,id:n,permissionType:N.type,permissionId:N.id}),children:N.name})}),e(O,{children:h?.find(x=>x.type===N.type)?.name}),e(O,{children:e(ps,{row:N})}),e(O,{children:N.description||"—"}),e(O,{actions:{items:[{title:t("delete"),onClick:async()=>{f(N),T()}}]}})]}),l(ne,{isExpanded:N.isExpanded,children:[e(O,{}),e(O,{colSpan:5,children:e(Ze,{children:N.isExpanded&&e(at,{isHorizontal:!0,className:"keycloak_resource_details",children:e(ze,{name:"associatedPolicy",array:N.associatedPolicies,convert:x=>x.name,link:x=>Qt({id:n,realm:c,policyId:x.id,policyType:x.type})})})})})]},`child-${N.id}`)]},N.id))]})}),v&&!B&&e(us,{clientId:n,isResourceEnabled:!i&&C?.resources,isScopeEnabled:!i&&C?.scopes}),v&&B&&e(xe,{isSearchVariant:!0,message:t("noSearchResults"),instructions:t("noSearchResultsInstructions")})]})},hs=({row:n})=>l(L,{children:[n.dependentPolicies?.[0]?.name," ",e(nn,{array:n.dependentPolicies})]}),fs=({clientId:n,isDisabled:i=!1})=>{const{adminClient:a}=X(),{t}=R(),{addAlert:s,addError:o}=ie(),{realm:r}=de(),c=et(),[u,d]=g(),[p,f]=g(),[h,m]=g(),[C,w]=g(0),k=()=>w(C+1),[A,y]=g(10),[K,D]=g(0),[M,H]=g({}),[E,S]=Ce();te(async()=>{const v=await a.clients.listPolicies({first:K,max:A+1,id:n,permission:"false",...M});return await Promise.all([a.clients.listPolicyProviders({id:n}),...(v||[]).map(async B=>{const N=await a.clients.listDependentPolicies({id:n,policyId:B.id});return{...B,dependentPolicies:N,isExpanded:!1}})])},([v,...B])=>{m(v.filter(N=>N.type!=="resource"&&N.type!=="scope")),d(B)},[C,M,K,A]);const[P,U]=ke({titleKey:"deletePolicy",children:l(L,{children:[t("deletePolicyConfirm"),p?.dependentPolicies&&p.dependentPolicies.length>0&&e(tt,{variant:"warning",isInline:!0,isPlain:!0,component:"p",title:t("deletePolicyWarning"),className:"pf-v5-u-pt-lg",children:e("p",{className:"pf-v5-u-pt-xs",children:p.dependentPolicies.map(v=>e("strong",{className:"pf-v5-u-pr-md",children:v.name},v.id))})})]}),continueButtonLabel:"confirm",onConfirm:async()=>{try{await a.clients.delPolicy({id:n,policyId:p?.id}),s(t("policyDeletedSuccess"),$.success),k()}catch(v){o("policyDeletedError",v)}}});if(!u)return e(Pe,{});const T=u.length===0,b=Object.keys(M).length!==0;return l(le,{variant:"light",className:"pf-v5-u-p-0",children:[e(U,{}),(!T||b)&&l(L,{children:[E&&e(yn,{policyProviders:h,onSelect:v=>c(cn({id:n,realm:r,policyType:v.type})),toggleDialog:S}),e(xt,{count:u.length,first:K,max:A,onNextClick:D,onPreviousClick:D,onPerPageSelect:(v,B)=>{D(v),y(B)},toolbarItem:l(L,{children:[e(ue,{children:e(an,{types:h,search:M,onSearch:H,type:"policy"})}),e(ue,{children:e(_,{"data-testid":"createPolicy",onClick:S,isDisabled:i,children:t("createPolicy")})})]}),children:!T&&l(qe,{"aria-label":t("resources"),variant:"compact",children:[e(Ge,{children:l(ne,{children:[e(F,{"aria-hidden":"true"}),e(F,{children:t("name")}),e(F,{children:t("type")}),e(F,{children:t("dependentPermission")}),e(F,{children:t("description")}),e(F,{"aria-hidden":"true"})]})}),u.map((v,B)=>l(je,{isExpanded:v.isExpanded,children:[l(ne,{children:[e(O,{expand:{rowIndex:B,isExpanded:v.isExpanded,onToggle:(N,ee)=>{const x=u.map((G,ye)=>ye===ee?{...G,isExpanded:!G.isExpanded}:G);d(x)}}}),e(O,{"data-testid":`name-column-${v.name}`,children:e(be,{to:Qt({realm:r,id:n,policyType:v.type,policyId:v.id}),children:v.name})}),e(O,{children:wt(v.type)}),e(O,{children:e(hs,{row:v})}),e(O,{children:v.description}),!i&&e(O,{actions:{items:[{title:t("delete"),onClick:()=>{f(v),P()}}]}})]}),l(ne,{isExpanded:v.isExpanded,children:[e(O,{}),e(O,{colSpan:3+(i?0:1),children:e(Ze,{children:v.isExpanded&&e(at,{isHorizontal:!0,className:"keycloak_resource_details",children:e(ze,{name:"dependentPermission",array:v.dependentPolicies,convert:N=>N.name,link:N=>ft({realm:r,id:n,permissionId:N.id,permissionType:N.type})})})})})]},`child-${v.id}`)]},v.id))]})})]}),T&&b&&e(xe,{isSearchVariant:!0,isDisabled:i,message:t("noSearchResults"),instructions:t("noSearchResultsInstructions")}),T&&!b&&l(L,{children:[E&&e(yn,{policyProviders:h?.filter(v=>v.type!=="aggregate"),onSelect:v=>c(cn({id:n,realm:r,policyType:v.type})),toggleDialog:S}),e(xe,{message:t("emptyPolicies"),instructions:t("emptyPoliciesInstructions"),isDisabled:i,primaryActionText:t("createPolicy"),onPrimaryAction:S})]})]})},gs=({id:n,clientId:i,uris:a})=>{const{adminClient:t}=X(),{realm:s}=de(),[o,r]=g(),[c,u]=g();return te(()=>Promise.all([t.clients.listScopesByResource({id:i,resourceName:n}),t.clients.listPermissionsByResource({id:i,resourceId:n})]),([d,p])=>{r(d),u(p)},[]),!c||!o?e(Pe,{}):l(at,{isHorizontal:!0,className:"keycloak_resource_details",children:[e(ds,{name:"uris",array:a}),e(ze,{name:"scopes",array:o,convert:d=>d.name,link:d=>Wn({id:i,realm:s,scopeId:d.id})}),e(ze,{name:"associatedPermissions",array:c,convert:d=>d.name,link:d=>ft({id:i,realm:s,permissionId:d.id,permissionType:"resource"})})]})},bs=({row:n})=>l(ct,{wrapModifier:"truncate",children:[n.uris?.[0]," ",e(nn,{array:n.uris})]}),ys=({clientId:n,isDisabled:i=!1})=>{const{adminClient:a}=X(),{t}=R(),s=et(),{addAlert:o,addError:r}=ie(),{realm:c}=de(),[u,d]=g(),[p,f]=g(),[h,m]=g(),[C,w]=g(0),k=()=>w(C+1),[A,y]=g(10),[K,D]=g(0),[M,H]=g({});te(()=>{const b={first:K,max:A+1,deep:!1,...M};return a.clients.listResources({...b,id:n})},b=>d(b.map(v=>({...v,isExpanded:!1}))),[C,M,K,A]);const E=async b=>a.clients.listPermissionsByResource({id:n,resourceId:b}),[S,P]=ke({titleKey:"deleteResource",children:l(L,{children:[t("deleteResourceConfirm"),h?.length&&e(tt,{variant:"warning",isInline:!0,isPlain:!0,title:t("deleteResourceWarning"),className:"pf-v5-u-pt-lg",children:e("p",{className:"pf-v5-u-pt-xs",children:h.map(b=>e("strong",{className:"pf-v5-u-pr-md",children:b.name},b.id))})})]}),continueButtonLabel:"confirm",onConfirm:async()=>{try{await a.clients.delResource({id:n,resourceId:p?._id}),o(t("resourceDeletedSuccess"),$.success),k()}catch(b){r("resourceDeletedError",b)}}});if(!u)return e(Pe,{});const U=u.length===0,T=Object.keys(M).length!==0;return l(le,{variant:"light",className:"pf-v5-u-p-0",children:[e(P,{}),(!U||T)&&e(xt,{count:u.length,first:K,max:A,onNextClick:D,onPreviousClick:D,onPerPageSelect:(b,v)=>{D(b),y(v)},toolbarItem:l(L,{children:[e(ue,{children:e(an,{search:M,onSearch:H,type:"resource"})}),e(ue,{children:e(_,{"data-testid":"createResource",isDisabled:i,component:b=>e(be,{...b,to:dn({realm:c,id:n})}),children:t("createResource")})})]}),children:!U&&l(qe,{"aria-label":t("resources"),variant:"compact",children:[e(Ge,{children:l(ne,{children:[e(F,{"aria-hidden":"true"}),e(F,{children:t("name")}),e(F,{children:t("displayName")}),e(F,{children:t("type")}),e(F,{children:t("owner")}),e(F,{children:t("uris")}),!i&&l(L,{children:[e(F,{"aria-hidden":"true"}),e(F,{"aria-hidden":"true"})]})]})}),u.map((b,v)=>l(je,{isExpanded:b.isExpanded,children:[l(ne,{children:[e(O,{expand:{rowIndex:v,isExpanded:b.isExpanded,onToggle:(B,N)=>{const ee=u.map((x,G)=>G===N?{...x,isExpanded:!x.isExpanded}:x);d(ee)}}}),e(O,{"data-testid":`name-column-${b.name}`,children:e(ct,{wrapModifier:"truncate",children:e(be,{to:Jn({realm:c,id:n,resourceId:b._id}),children:b.name})})}),e(O,{children:e(ct,{wrapModifier:"truncate",children:b.displayName})}),e(O,{children:e(ct,{wrapModifier:"truncate",children:b.type})}),e(O,{children:e(ct,{wrapModifier:"truncate",children:b.owner?.name})}),e(O,{children:e(bs,{row:b})}),!i&&l(L,{children:[e(O,{width:10,children:e(_,{variant:"link",component:B=>e(be,{...B,to:ut({realm:c,id:n,permissionType:"resource",selectedId:b._id})}),children:t("createPermission")})}),e(O,{actions:{items:[{title:t("delete"),onClick:async()=>{f(b),m(await E(b._id)),S()}}]}})]})]}),l(ne,{isExpanded:b.isExpanded,children:[e(O,{}),e(O,{colSpan:4,children:e(Ze,{children:b.isExpanded&&e(gs,{clientId:n,id:b._id,uris:b.uris})})})]},`child-${b._id}`)]},b._id))]})}),U&&T&&e(xe,{isSearchVariant:!0,message:t("noSearchResults"),instructions:t("noSearchResultsInstructions")}),U&&!T&&e(xe,{message:t("emptyResources"),instructions:t("emptyResourcesInstructions"),isDisabled:i,primaryActionText:t("createResource"),onPrimaryAction:()=>s(dn({realm:c,id:n}))})]})},vs=({clientId:n,isDisabled:i=!1})=>{const{adminClient:a}=X(),{t}=R(),s=et(),{realm:o}=de(),[r,c]=Ce(),[u,d]=g(),[p,f]=g(),[h,m]=g([]),[C,w]=g(0),k=()=>w(C+1),[A,y]=g(10),[K,D]=g(0),[M,H]=g("");te(()=>{const T={first:K,max:A+1,deep:!1,name:M};return a.clients.listAllScopes({...T,id:n})},T=>{d(T.map(b=>({...b,isLoaded:!1}))),m(T.map(b=>({id:b.id,isExpanded:!1})))},[C,M,K,A]);const E=T=>u?.find(b=>b.id===T),S=T=>h.find(b=>b.id===T)?.isExpanded||!1;if(te(()=>{const T=h.filter(b=>b.isExpanded).map(({id:b})=>E(b)).filter(b=>!b.isLoaded);return Promise.all(T.map(async b=>{const[v,B]=await Promise.all([a.clients.listAllResourcesByScope({id:n,scopeId:b.id}),a.clients.listAllPermissionsByScope({id:n,scopeId:b.id})]);return{...b,resources:v,permissions:B,isLoaded:!0}}))},T=>{let b=[...u||[]];T.forEach(v=>{const B=u?.findIndex(N=>v.id===N.id);b=[...b.slice(0,B),v,...b.slice(B+1)]}),d(b)},[h]),!u)return e(Pe,{});const P=u.length===0,U=M!=="";return l(le,{variant:"light",className:"pf-v5-u-p-0",children:[e(yi,{clientId:n,open:r,toggleDialog:c,selectedScope:p,refresh:k}),(!P||U)&&e(xt,{count:u.length,first:K,max:A,onNextClick:D,onPreviousClick:D,onPerPageSelect:(T,b)=>{D(T),y(b)},inputGroupName:"search",inputGroupPlaceholder:t("searchByName"),inputGroupOnEnter:H,toolbarItem:e(ue,{children:e(_,{"data-testid":"createAuthorizationScope",component:T=>e(be,{...T,to:un({realm:o,id:n})}),children:t("createAuthorizationScope")})}),children:!P&&l(qe,{"aria-label":t("scopes"),variant:"compact",children:[e(Ge,{children:l(ne,{children:[e(F,{"aria-hidden":"true"}),e(F,{children:t("name")}),e(F,{children:t("displayName")}),e(F,{"aria-hidden":"true"}),e(F,{"aria-hidden":"true"})]})}),u.map((T,b)=>l(je,{isExpanded:S(T.id),children:[l(ne,{children:[e(O,{expand:{rowIndex:b,isExpanded:S(T.id),onToggle:(v,B,N)=>{m([...h.slice(0,B),{id:T.id,isExpanded:N},...h.slice(B+1)])}}}),e(O,{"data-testid":`name-column-${T.name}`,children:e(be,{to:Wn({realm:o,id:n,scopeId:T.id}),children:T.name})}),e(O,{children:T.displayName}),e(O,{width:10,children:e(_,{variant:"link",component:v=>e(be,{...v,to:ut({realm:o,id:n,permissionType:"scope",selectedId:T.id})}),children:t("createPermission")})}),e(O,{isActionCell:!0,actions:{items:[{title:t("delete"),onClick:()=>{f(T),c()}}]}})]}),l(ne,{isExpanded:S(T.id),children:[e(O,{}),e(O,{colSpan:4,children:e(Ze,{children:S(T.id)&&T.isLoaded?l(at,{isHorizontal:!0,className:"keycloak_resource_details",children:[e(ze,{name:"resources",array:T.resources,convert:v=>v.name,link:v=>Jn({id:n,realm:o,resourceId:v._id})}),e(ze,{name:"associatedPermissions",array:T.permissions,convert:v=>v.name,link:v=>ft({id:n,realm:o,permissionId:v.id,permissionType:v.type})})]}):e(Pe,{})})})]},`child-${T.id}`)]},T.id))]})}),P&&!U&&e(xe,{message:t("emptyAuthorizationScopes"),instructions:t("emptyAuthorizationInstructions"),isDisabled:i,onPrimaryAction:()=>s(un({id:n,realm:o})),primaryActionText:t("createAuthorizationScope")}),P&&U&&e(xe,{isSearchVariant:!0,isDisabled:i,message:t("noSearchResults"),instructions:t("noSearchResultsInstructions")})]})},Ss=({onConfirm:n,closeDialog:i})=>{const{t:a}=R(),[t,s]=g({});return l(Ue,{title:a("import"),isOpen:!0,variant:"small",onClose:i,actions:[e(_,{id:"modal-confirm",onClick:()=>{n(t),i()},"data-testid":"confirm",children:a("confirm")},"confirm"),e(_,{"data-testid":"cancel",id:"modal-cancel",variant:ge.link,onClick:()=>{i()},children:a("cancel")},"cancel")],children:[e(pe,{children:e(vi,{id:"import-resource",onChange:s})}),Object.keys(t).length!==0&&l(L,{children:[e(Ke,{}),e("p",{className:"pf-v5-u-my-lg",children:a("importResources")}),l(pe,{isHorizontal:!0,children:[e(z,{label:a("policyEnforcementMode"),labelIcon:e(V,{helpText:a("policyEnforcementModeHelp"),fieldLabelId:"policyEnforcementMode"}),fieldId:"policyEnforcementMode",hasNoPaddingTop:!0,children:e(pt,{id:"policyEnforcementMode",name:"policyEnforcementMode",label:a(`policyEnforcementModes.${t.policyEnforcementMode}`),isChecked:!0,isDisabled:!0,className:"pf-v5-u-mb-md"})}),e(z,{label:a("decisionStrategy"),labelIcon:e(V,{helpText:a("decisionStrategyHelp"),fieldLabelId:"decisionStrategy"}),fieldId:"decisionStrategy",hasNoPaddingTop:!0,children:e(pt,{id:"decisionStrategy",name:"decisionStrategy",isChecked:!0,isDisabled:!0,label:a(`decisionStrategies.${t.decisionStrategy}`),className:"pf-v5-u-mb-md"})}),e(z,{hasNoPaddingTop:!0,label:a("allowRemoteResourceManagement"),fieldId:"allowRemoteResourceManagement",labelIcon:e(V,{helpText:a("allowRemoteResourceManagement"),fieldLabelId:"allowRemoteResourceManagement"}),children:e(Ae,{id:"allowRemoteResourceManagement",label:a("on"),labelOff:a("off"),isChecked:t.allowRemoteResourceManagement,isDisabled:!0,"aria-label":a("allowRemoteResourceManagement")})})]}),e("div",{className:"pf-v5-u-mt-md",children:Object.entries(t).filter(([,o])=>Array.isArray(o)).map(([o,r])=>l(Qn,{children:[e(Ke,{}),e("p",{className:"pf-v5-u-my-sm",children:l("strong",{children:[r.length," ",a(o)]})})]},o))}),e(Ke,{}),e(tt,{variant:"warning",className:"pf-v5-u-mt-lg",isInline:!0,title:a("importWarning")})]})]})},Pn=["ENFORCING","PERMISSIVE","DISABLED"],Cs=({clientId:n})=>{const{adminClient:i}=X(),{t:a}=R(),[t,s]=g(),[o,r]=Ce(),c=_e({}),{control:u,reset:d,handleSubmit:p}=c,{addAlert:f,addError:h}=ie(),{hasAccess:m}=we(),C=!m("manage-authorization");te(()=>i.clients.getResourceServer({id:n}),A=>{s(A),d(A)},[]);const w=async A=>{try{await i.clients.importResource({id:n},A),f(a("importResourceSuccess"),$.success),d({...A})}catch(y){h("importResourceError",y)}},k=async A=>{try{await i.clients.updateResourceServer({id:n},A),f(a("updateResourceSuccess"),$.success)}catch(y){h("resourceSaveError",y)}};return t?l(le,{variant:"light",children:[o&&e(Ss,{onConfirm:w,closeDialog:r}),l(oe,{role:"manage-authorization",isHorizontal:!0,onSubmit:p(k),children:[e(z,{label:a("import"),fieldId:"import",labelIcon:e(V,{helpText:a("importHelp"),fieldLabelId:"import"}),children:e(_,{variant:"secondary",onClick:r,children:a("import")})}),e(Ke,{}),e(z,{label:a("policyEnforcementMode"),labelIcon:e(V,{helpText:a("policyEnforcementModeHelp"),fieldLabelId:"policyEnforcementMode"}),fieldId:"policyEnforcementMode",hasNoPaddingTop:!0,children:e(se,{name:"policyEnforcementMode","data-testid":"policyEnforcementMode",defaultValue:Pn[0],control:u,render:({field:A})=>e(L,{children:Pn.map(y=>e(pt,{id:y,"data-testid":y,isChecked:A.value===y,isDisabled:C,name:"policyEnforcementMode",onChange:()=>A.onChange(y),label:a(`policyEnforcementModes.${y}`),className:"pf-v5-u-mb-md"},y))})})}),l(Ee,{...c,children:[e(ui,{isLimited:!0}),e(ve,{name:"allowRemoteResourceManagement",label:a("allowRemoteResourceManagement"),labelIcon:a("allowRemoteResourceManagementHelp")})]}),e(_t,{name:"authenticationSettings",reset:()=>d(t),isSubmit:!0})]})]}):e(Pe,{})},_n=({id:n,buttonLabel:i,client:a,secret:t,toggle:s})=>{const{t:o}=R(),r=re(),{hasAccess:c}=we(),u=c("manage-clients")||a.access?.configure;return l(Xe,{hasGutter:!0,children:[e(Se,{isFilled:!0,children:l(Bn,{children:[e(kt,{isFill:!0,children:e(Ma,{id:n,value:t,readOnly:!0})}),e(kt,{children:e(sa,{id:n,text:t,label:"clientSecret",variant:"control"})})]})}),e(Se,{children:e(_,{variant:"secondary",isDisabled:r.formState.isDirty||!u,onClick:s,children:o(i)})})]})},Dn=({time:n})=>{const{t:i}=R(),a=ta();return e("div",{className:"pf-v5-u-my-md",children:(s=>s?i("secretExpiresOn",{time:a(new Date(s*1e3),{dateStyle:"full",timeStyle:"long"})}):void 0)(n)})},ks=({client:n,secret:i,toggle:a})=>{const{adminClient:t}=X(),{t:s}=R(),{addAlert:o,addError:r}=ie(),[c,u]=g(n.attributes?.["client.secret.rotated"]),d=n.attributes?.["client.secret.expiration.time"],p=n.attributes?.["client.secret.rotated.expiration.time"],f=C=>new Date().getTime()>=C*1e3,[h,m]=ke({titleKey:"invalidateRotatedSecret",messageKey:"invalidateRotatedSecretExplain",continueButtonLabel:"confirm",onConfirm:async()=>{try{await t.clients.invalidateSecret({id:n.id}),u(void 0),o(s("invalidateRotatedSuccess"))}catch(C){r("invalidateRotatedError",C)}}});return nt(()=>{c!==n.attributes?.["client.secret.rotated"]&&u(n.attributes?.["client.secret.rotated"])},[n,c]),l(L,{children:[e(m,{}),l(z,{label:s("clientSecret"),fieldId:"kc-client-secret",className:"pf-v5-u-my-md",children:[e(_n,{id:"kc-client-secret",client:n,secret:i,toggle:a,buttonLabel:"regenerate"}),e(Dn,{time:d}),f(d)&&e(tt,{variant:"warning",isInline:!0,title:s("secretHasExpired")})]}),c&&l(z,{label:s("secretRotated"),fieldId:"secretRotated",children:[e(_n,{id:"secretRotated",client:n,secret:c,toggle:h,buttonLabel:"invalidateSecret"}),e(Dn,{time:p})]})]})},Ts=({clientAuthenticatorType:n})=>{const{cryptoInfo:i}=Me(),a=n==="client-jwt"?i?.clientSignatureAsymmetricAlgorithms??[]:i?.clientSignatureSymmetricAlgorithms??[],{t}=R();return e(q,{name:I("attributes.token.endpoint.auth.signing.alg"),label:t("signatureAlgorithm"),labelIcon:t("signatureAlgorithmHelp"),controller:{defaultValue:""},isScrollable:!0,maxMenuHeight:"200px",options:[{key:"",value:t("anyAlgorithm")},...a.map(s=>({key:s,value:s}))]})},As=()=>{const{t:n}=R();return l(L,{children:[e(ve,{name:I("attributes.x509.allow.regex.pattern.comparison"),label:n("allowRegexComparison"),labelIcon:n("allowRegexComparisonHelp")}),e(j,{name:I("attributes.x509.subjectdn"),label:n("subject"),labelIcon:n("subjectHelp"),rules:{required:n("required")}})]})},Is=({client:n,save:i,refresh:a})=>{const{adminClient:t}=X(),{t:s}=R(),{addAlert:o,addError:r}=ie(),c=n.id,[u,d]=g([]),{control:p,formState:{isDirty:f},handleSubmit:h}=re(),m=Pt({control:p,name:"clientAuthenticatorType",defaultValue:""}),[C,w]=g(""),[k,A]=g(""),y=u.find(b=>b.id===m),{componentTypes:K}=Me(),D=gt(()=>K?.["org.keycloak.authentication.ClientAuthenticator"]?.find(b=>b.id===m)?.properties,[m,K]);te(()=>Promise.all([t.authenticationManagement.getClientAuthenticatorProviders(),t.clients.getClientSecret({id:c})]),([b,v])=>{d(b),w(v.value)},[]);async function M(b,v){try{const B=await b(c);return o(s(`${v}Success`),$.success),B}catch(B){r(`${v}Error`,B)}}const H=async()=>{const b=await M(v=>t.clients.generateNewClientSecret({id:v}),"clientSecret");w(b?.value||""),a()},[E,S]=ke({titleKey:"confirmClientSecretTitle",messageKey:"confirmClientSecretBody",continueButtonLabel:"yes",cancelButtonLabel:"no",onConfirm:H}),P=async()=>{const b=await M(v=>t.clients.generateRegistrationAccessToken({id:v}),"accessToken");A(b?.registrationAccessToken||"")},[U,T]=ke({titleKey:"confirmAccessTokenTitle",messageKey:"confirmAccessTokenBody",continueButtonLabel:"yes",cancelButtonLabel:"no",onConfirm:P});return e(le,{children:l(oe,{onSubmit:h(i),isHorizontal:!0,className:"pf-v5-u-mt-md",role:"manage-clients",fineGrainedAccess:n.access?.configure,children:[e(S,{}),e(T,{}),l(Tt,{isFlat:!0,children:[l(Je,{children:[e(q,{name:"clientAuthenticatorType",label:s("clientAuthenticator"),labelIcon:s("clientAuthenticatorTypeHelp"),controller:{defaultValue:""},options:u.map(({id:b,displayName:v})=>({key:b,value:v||b}))}),(m==="client-jwt"||m==="client-secret-jwt")&&e(Ts,{clientAuthenticatorType:m}),m==="client-jwt"&&e(z,{children:e(tt,{variant:"info",isInline:!0,title:s("signedJWTConfirm")})}),m==="client-x509"&&e(As,{}),D&&e(pe,{children:e(Si,{properties:D})}),e(Re,{children:e(_,{variant:"primary",type:"submit",isDisabled:!f,children:s("save")})})]}),y?.supportsSecret&&l(L,{children:[e(Ke,{}),e(Je,{children:e(ks,{client:n,secret:C,toggle:E})})]})]}),e(Tt,{isFlat:!0,children:e(Je,{children:e(z,{label:s("registrationAccessToken"),fieldId:"kc-access-token",labelIcon:e(V,{helpText:s("registrationAccessTokenHelp"),fieldLabelId:"registrationAccessToken"}),children:l(Xe,{hasGutter:!0,children:[e(Se,{isFilled:!0,children:e(Xn,{id:"kc-access-token",isReadOnly:!0,children:k})}),e(Se,{children:e(_,{variant:"secondary",onClick:U,children:s("regenerate")})})]})})})})]})})},Nn=({id:n,keyInfo:i})=>{const{t:a}=R();return e(Rt,{readOnly:!0,rows:5,id:n,"data-testid":"certificate",value:i?.certificate,"aria-label":a("certificate")})},sn=({keyInfo:n,plain:i=!1})=>{const{t:a}=R(),t=ei();return i?e(Nn,{id:t,keyInfo:n}):e(z,{label:a("certificate"),fieldId:t,labelIcon:e(V,{helpText:a("certificateHelp"),fieldLabelId:t}),children:e(Nn,{id:t,keyInfo:n})})},pa=({hidePassword:n=!1,isSaml:i=!1})=>{const{t:a}=R();return l(L,{children:[e(j,{name:"keyAlias",label:a("keyAlias"),labelIcon:a("keyAliasHelp"),rules:{required:a("required")}}),!n&&e(pn,{name:"keyPassword",label:a("keyPassword"),labelIcon:a("keyPasswordHelp"),rules:{required:a("required")}}),i&&e(j,{name:"realmAlias",label:a("realmCertificateAlias"),labelIcon:a("realmCertificateAliasHelp")}),e(pn,{name:"storePassword",label:a("storePassword"),labelIcon:a("storePasswordHelp"),rules:{required:a("required")}})]})},On="Certificate PEM",Rs=new Map([["PKCS12","p12"],["JKS","jks"],["BCFKS","bcfks"]]),ma=n=>Rs.get(n),Dt=({isSaml:n=!1,hasPem:i=!1,useFile:a=!1})=>{const{t}=R(),[s,o]=g(),{control:r,watch:c}=re(),u=c("format"),{cryptoInfo:d}=Me(),p=[...d?.supportedKeystoreTypes??[],...i?[On]:[]];return l(pe,{className:"pf-v5-u-pt-lg",children:[e(q,{name:"format",label:t("archiveFormat"),labelIcon:t("archiveFormatHelp"),controller:{defaultValue:p[0]},menuAppendTo:"parent",options:p}),a&&e(z,{label:t("importFile"),labelIcon:e(V,{helpText:t("importFileHelp"),fieldLabelId:"importFile"}),fieldId:"importFile",children:e(se,{name:"file",defaultValue:"",control:r,render:({field:f})=>e(oa,{id:"importFile",value:f.value,filename:s,browseButtonText:t("browse"),onTextChange:h=>{f.onChange(h)},onFileInputChange:(h,m)=>o(m.name)})})}),u!==On&&e(pa,{hidePassword:a,isSaml:n})]})},Es=({clientId:n,save:i,toggleDialog:a})=>{const{t}=R(),s=_e({defaultValues:{keyAlias:n},mode:"onChange"}),{handleSubmit:o,formState:{isValid:r}}=s;return l(Ue,{variant:ht.medium,title:t("generateKeys"),isOpen:!0,onClose:a,actions:[e(_,{id:"modal-confirm","data-testid":"confirm",isDisabled:!r,onClick:()=>{o(c=>{i(c),a()})()},children:t("generate")},"confirm"),e(_,{id:"modal-cancel","data-testid":"cancel",variant:ge.link,onClick:()=>{a()},children:t("cancel")},"cancel")],children:[e(Fe,{children:e(fe,{children:t("generateKeysDescription")})}),e(Ee,{...s,children:e(Dt,{})})]})},ws=({save:n,toggleDialog:i})=>{const{t:a}=R(),t=_e(),{control:s,handleSubmit:o}=t,r=Me().cryptoInfo?.supportedKeystoreTypes??[],c=r.concat(["Certificate PEM","Public Key PEM","JSON Web Key Set"]),u=Pt({control:s,name:"keystoreFormat",defaultValue:c[0]});return l(Ue,{variant:ht.medium,title:a("generateKeys"),isOpen:!0,onClose:i,actions:[e(_,{id:"modal-confirm","data-testid":"confirm",onClick:()=>{o(d=>{n(d),i()})()},children:a("import")},"confirm"),e(_,{id:"modal-cancel","data-testid":"cancel",variant:ge.link,onClick:()=>{i()},children:a("cancel")},"cancel")],children:[e(Fe,{children:e(fe,{children:a("generateKeysDescription")})}),e(pe,{className:"pf-v5-u-pt-lg",children:l(Ee,{...t,children:[e(q,{name:"keystoreFormat",label:a("archiveFormat"),labelIcon:a("archiveFormatHelp"),controller:{defaultValue:c[0]},options:c}),r.includes(u)&&e(pa,{hidePassword:!0}),e(z,{label:a("importFile"),fieldId:"importFile",children:e(se,{name:"file",control:s,defaultValue:{filename:""},render:({field:d})=>e(oa,{id:"importFile",value:d.value.value,filename:d.value.filename,onTextChange:p=>d.onChange({...d.value,value:p}),onFileInputChange:(p,f)=>d.onChange({...d.value,filename:f.name})})})})]})})]})},Bt="jwt.credential",xs=({clientId:n,save:i,hasConfigureAccess:a})=>{const{adminClient:t}=X(),{t:s}=R(),{control:o,getValues:r,formState:{isDirty:c}}=re(),{addAlert:u,addError:d}=ie(),[p,f]=g(),[h,m,C]=Ce(),[w,k,A]=Ce(),[y,K]=g(0),D=()=>K(y+1),M=Pt({control:o,name:I("attributes.use.jwks.url"),defaultValue:"false"});te(()=>t.clients.getKeyInfo({id:n,attr:Bt}),S=>f(S),[y]);const H=async S=>{try{const P=await t.clients.generateAndDownloadKey({id:n,attr:Bt},S);Qe.saveAs(new Blob([P],{type:"application/octet-stream"}),`keystore.${ma(S.format??"")}`),u(s("generateSuccess"),$.success),D()}catch(P){d("generateError",P)}},E=async S=>{try{const P=new FormData,{file:U,...T}=S;for(const[b,v]of Object.entries(T))P.append(b,v);P.append("file",U.value),await t.clients.uploadCertificate({id:n,attr:Bt},P),u(s("importSuccess"),$.success),D()}catch(P){d("importError",P)}};return l(le,{variant:"light",className:"keycloak__form",children:[h&&e(Es,{clientId:r("clientId"),toggleDialog:m,save:H}),w&&e(ws,{toggleDialog:k,save:E}),l(Tt,{isFlat:!0,children:[e(Fa,{children:e(Va,{children:s("jwksUrlConfig")})}),e(Je,{children:e(Fe,{children:e(fe,{children:s("keysIntro")})})}),e(Je,{children:l(oe,{role:"manage-clients",fineGrainedAccess:a,isHorizontal:!0,children:[e(ve,{name:I("attributes.use.jwks.url"),label:s("useJwksUrl"),labelIcon:s("useJwksUrlHelp"),stringify:!0}),M!=="true"&&(p?e(sn,{plain:!0,keyInfo:p}):"No client certificate configured"),M==="true"&&e(j,{name:I("attributes.jwks.url"),label:s("jwksUrl"),labelIcon:s("jwksUrlHelp"),type:"url"}),l(Re,{children:[e(_,{"data-testid":"saveKeys",onClick:i,isDisabled:!c,children:s("save")}),e(_,{"data-testid":"generate",variant:"secondary",onClick:()=>C(!0),children:s("generateNewKeys")}),e(_,{"data-testid":"import",variant:"secondary",onClick:()=>A(!0),isDisabled:M==="true",children:s("import")})]})]})})]})]})},Ps=({clientId:n,close:i,keyType:a})=>{const{adminClient:t}=X(),{t:s}=R(),{realm:o}=de(),{addAlert:r,addError:c}=ie(),u=_e({defaultValues:{realmAlias:o}}),d=async p=>{try{const f=await t.clients.downloadKey({id:n,attr:a},p);Qe.saveAs(new Blob([f],{type:"application/octet-stream"}),`keystore.${ma(p.format??"")}`),r(s("samlKeysExportSuccess")),i()}catch(f){c("samlKeysExportError",f)}};return e(Ue,{variant:"medium",title:s("exportSamlKeyTitle"),isOpen:!0,onClose:i,actions:[e(_,{id:"modal-confirm","data-testid":"confirm",type:"submit",form:"export-saml-key-form",children:s("export")},"confirm"),e(_,{id:"modal-cancel","data-testid":"cancel",variant:"link",onClick:()=>{i()},children:s("cancel")},"cancel")],children:e(pe,{id:"export-saml-key-form",className:"pf-v5-u-pt-lg",onSubmit:u.handleSubmit(d),children:e(Ee,{...u,children:e(Dt,{isSaml:!0})})})})},ha=async(n,i,a,t,s)=>{try{const o=new FormData,{file:r,...c}=i;Object.entries(c).map(([u,d])=>o.append(u==="format"?"keystoreFormat":u,d.toString())),o.append("file",r),await n.clients.uploadKey({id:a,attr:t},o),s()}catch(o){s(o)}},_s=({id:n,attr:i,onClose:a,onCancel:t})=>{const{adminClient:s}=X(),{t:o}=R(),[r,c]=g(!1),[u,d]=g(),p=_e({mode:"onChange"}),{handleSubmit:f,formState:{isValid:h}}=p,{addAlert:m,addError:C}=ie(),w=A=>{ha(s,A,n,i,y=>{y?C("importError",y):m(o("importSuccess"),$.success)})},k=async()=>{try{const A=await s.clients.generateKey({id:n,attr:i});d(A),Qe.saveAs(new Blob([A.privateKey],{type:"application/octet-stream"}),"private.key"),m(o("generateSuccess"),$.success)}catch(A){C("generateError",A)}};return e(Ue,{variant:ht.medium,"aria-label":o("enableClientSignatureRequiredModal"),header:l(Fe,{children:[e(Gt,{headingLevel:"h1",children:o("enableClientSignatureRequired")}),e(fe,{children:o("enableClientSignatureRequiredExplain")})]}),isOpen:!0,onClose:a,actions:[e(_,{id:"modal-confirm","data-testid":"confirm",variant:"primary",isDisabled:!h&&!u,onClick:()=>{r&&f(w)(),a()},children:o("confirm")},"confirm"),e(_,{id:"modal-cancel","data-testid":"cancel",variant:ge.link,onClick:t,children:o("cancel")},"cancel")],children:l(Ee,{...p,children:[l(pe,{isHorizontal:!0,children:[e(z,{label:o("selectMethod"),fieldId:"selectMethod",hasNoPaddingTop:!0,children:l(za,{children:[e(mn,{children:e(pt,{isChecked:!r,name:"selectMethodType",onChange:()=>c(!1),label:o("selectMethodType.generate"),id:"selectMethodType-generate"})}),e(mn,{children:e(pt,{isChecked:r,name:"selectMethodType",onChange:()=>c(!0),label:o("selectMethodType.import"),id:"selectMethodType-import"})})]})}),!r&&e(z,{label:o("certificate"),fieldId:"certificate",labelIcon:e(V,{helpText:o("certificateHelp"),fieldLabelId:"certificate"}),children:l(Xe,{hasGutter:!0,children:[e(Se,{isFilled:!0,children:e(sn,{plain:!0,keyInfo:u})}),e(Se,{children:e(_,{variant:"secondary","data-testid":"generate",onClick:k,children:o("generate")})})]})})]}),r&&e(Dt,{useFile:!0})]})})},Ds=({id:n,attr:i,onClose:a})=>{const{adminClient:t}=X(),{t:s}=R(),o=re(),{handleSubmit:r}=o,{addAlert:c,addError:u}=ie(),d=p=>{ha(t,p,n,i,f=>{f?u("importError",f):c(s("importSuccess"),$.success)})};return e(Zt,{open:!0,toggleDialog:a,continueButtonLabel:"import",titleKey:"importKey",onConfirm:()=>{r(d)(),a()},children:e(Ee,{...o,children:e(Dt,{useFile:!0,hasPem:!0})})})},Ut=["saml.signing","saml.encryption"],Ye={"saml.signing":{name:I("attributes.saml.client.signature"),title:"signingKeysConfig",key:"clientSignature"},"saml.encryption":{name:I("attributes.saml.encrypt"),title:"encryptionKeysConfig",key:"encryptAssertions"}},Ns=({clientId:n,keyInfo:i,attr:a,onChanged:t,onGenerate:s,onImport:o})=>{const{t:r}=R(),{control:c,watch:u}=re(),d=Ye[a].title,p=Ye[a].key,f=Ye[a].name,[h,m]=Ce(),C=u(f);return l(L,{children:[h&&e(Ps,{keyType:a,clientId:n,close:m}),l(Ba,{title:r(d),className:"kc-form-panel__panel",children:[e(Fe,{className:"pf-v5-u-pb-lg",children:e(fe,{children:r(`${d}Explain`)})}),e(oe,{role:"manage-clients",isHorizontal:!0,children:e(z,{labelIcon:e(V,{helpText:r(`${p}Help`),fieldLabelId:p}),label:r(p),fieldId:p,hasNoPaddingTop:!0,children:e(se,{name:f,control:c,defaultValue:"false",render:({field:w})=>e(Ae,{"data-testid":p,id:p,label:r("on"),labelOff:r("off"),isChecked:w.value==="true",onChange:(k,A)=>{const y=A.toString();y==="true"?(t(a),w.onChange(y)):s(a,!1)},"aria-label":r(p)})})})})]}),i?.certificate&&C==="true"&&e(Tt,{isFlat:!0,children:e(Je,{className:"kc-form-panel__body",children:l(pe,{isHorizontal:!0,children:[e(sn,{keyInfo:i}),l(Re,{children:[e(_,{variant:"secondary",onClick:()=>s(a,!0),children:r("regenerate")}),e(_,{variant:"secondary",onClick:()=>o(a),children:r("importKey")}),e(_,{variant:"tertiary",onClick:m,children:r("export")})]})]})})})]})},Os=({clientId:n,save:i})=>{const{adminClient:a}=X(),{t}=R(),[s,o]=g(),[r,c]=g(),[u,d]=g(),[p,f]=g(),[h,m]=g(0),{setValue:C}=re(),{addAlert:w,addError:k}=ie();te(()=>Promise.all(Ut.map(E=>a.clients.getKeyInfo({id:n,attr:E}))),E=>c(E),[h]);const A=async E=>{const S=Ut.indexOf(E);try{const P=[...r||[]];P[S]=await a.clients.generateKey({id:n,attr:E}),c(P),Qe.saveAs(new Blob([P[S].privateKey],{type:"application/octet-stream"}),"private.key"),w(t("generateSuccess"),$.success)}catch(P){k("generateError",P)}},y=u?Ye[u].key:"",[K,D]=ke({titleKey:t("disableSigning",{key:t(y)}),messageKey:t("disableSigningExplain",{key:t(y)}),continueButtonLabel:"yes",cancelButtonLabel:"no",onConfirm:()=>{C(Ye[u].name,"false"),i()}}),[M,H]=ke({titleKey:"reGenerateSigning",messageKey:"reGenerateSigningExplain",continueButtonLabel:"yes",cancelButtonLabel:"no",onConfirm:()=>{A(u)}});return l(le,{variant:"light",className:"keycloak__form",children:[s&&e(_s,{id:n,attr:s,onClose:()=>{o(void 0),i(),m(h+1)},onCancel:()=>{C(Ye[u].name,"false"),o(void 0)}}),e(D,{}),e(H,{}),Ut.map((E,S)=>l(Qn,{children:[p===E&&e(Ds,{id:n,attr:E,onClose:()=>f(void 0)}),e(Ns,{clientId:n,keyInfo:r?.[S],attr:E,onChanged:o,onGenerate:(P,U)=>{d(P),U?M():K()},onImport:()=>f(E)})]},E))]})},St="dedicated",Ls=({clientId:n,refresh:i,fineGrainedAccess:a,...t})=>{const{adminClient:s}=X(),{t:o}=R(),{addAlert:r,addError:c}=ie(),{hasAccess:u}=we(),d=f=>f.id===St,p=u("manage-clients")||a;return e(Ei,{isDisabled:d(t)||!p,clientScope:t,type:t.type,onSelect:async f=>{try{await wi(s,n,t,t.type,f),r(o("clientScopeSuccess"),$.success),i()}catch(h){c("clientScopeError",h)}}})},Hs=({clientId:n,protocol:i,clientName:a,fineGrainedAccess:t})=>{const{adminClient:s}=X(),{t:o}=R(),{addAlert:r,addError:c}=ie(),{realm:u}=de(),d=Pi(),[p,f]=g("name"),[h,m]=g(Sn.none),[C,w]=g(!1),[k,A]=g(),[y,K]=g([]),D=x=>K(x.filter(({id:G})=>G!==St)),[M,H]=g(!1),[E,S]=g(0),P=()=>S(E+1),U=x=>x.id===St,{hasAccess:T}=we(),b=T("manage-clients")||t,v=T("view-clients")||t,B=async(x,G,ye)=>{const De=await s.clients.listDefaultClientScopes({id:n}),W=await s.clients.listOptionalClientScopes({id:n}),Z=await s.clientScopes.find(),me=ce=>Z.find(Ve=>ce===Ve.id),it=W.map(ce=>{const Ve=me(ce.id);return{...ce,type:kn.optional,description:Ve?.description}}),Nt=De.map(ce=>{const Ve=me(ce.id);return{...ce,type:kn.default,description:Ve?.description}});let he=[...it,...Nt];const Ot=he.map(ce=>ce.name);A(Z.filter(ce=>!Ot.includes(ce.name)).filter(ce=>ce.protocol===i)),he=d(he,_i("name")),v&&he.unshift({id:St,name:o("dedicatedScopeName",{clientName:a}),type:Sn.none,description:o("dedicatedScopeDescription")});const Lt=p==="name"?Ai(ye):Ii(h),bt=Number(x);return he.filter(Lt).slice(bt,bt+Number(G))},[N,ee]=ke({titleKey:o("deleteClientScope",{count:y.length,name:y[0]?.name}),messageKey:"deleteConfirmClientScopes",continueButtonLabel:"delete",continueButtonVariant:ge.danger,onConfirm:async()=>{try{await Cn(s,n,y[0],y[0].type),r(o("clientScopeRemoveSuccess"),$.success),P()}catch(x){c("clientScopeRemoveError",x)}}});return l(L,{children:[k&&e(pi,{clientScopes:k,clientName:a,open:C,toggleDialog:()=>w(!C),onAdd:async x=>{try{await Promise.all(x.map(async G=>await Ri(s,n,G.scope,G.type))),r(o("clientScopeSuccess"),$.success),P()}catch(G){c("clientScopeError",G)}}}),e(Et,{loader:B,ariaLabelKey:`clientScopeList-${E}`,searchPlaceholderKey:p==="name"?"searchByName":void 0,canSelectAll:!0,isPaginated:!0,isSearching:p==="type",onSelect:x=>D([...x]),searchTypeComponent:e(Ci,{searchType:p,onSelect:x=>f(x)}),toolbarItem:l(L,{children:[e(ki,{searchType:p,type:h,onSelect:x=>f(x),onType:x=>{m(x),P()}}),b&&l(L,{children:[e(ee,{}),e(ue,{children:e(_,{onClick:()=>w(!0),children:o("addClientScope")})}),e(ue,{children:e(Ti,{clientId:n,selectedRows:y,refresh:P})}),e(ue,{children:e(Xt,{onOpenChange:x=>H(x),toggle:x=>e(Be,{"data-testid":"kebab","aria-label":"Kebab toggle",ref:x,variant:"plain",onClick:()=>H(!M),isExpanded:M,children:e(Ua,{})}),isOpen:M,children:e($n,{children:e(We,{isDisabled:y.length===0,onClick:async()=>{try{await Promise.all(y.map(x=>Cn(s,n,{...x},x.type))),H(!1),D([]),r(o("clientScopeRemoveSuccess")),P()}catch(x){c("clientScopeRemoveError",x)}},children:o("remove")},"deleteAll")})})})]})]}),columns:[{name:"name",displayKey:"assignedClientScope",cellRenderer:x=>U(x)?e(be,{to:qa({realm:u,clientId:n}),children:x.name}):x.name},{name:"type",displayKey:"assignedType",cellRenderer:x=>e(Ls,{clientId:n,refresh:P,...x})},{name:"description",cellFormatters:[xi(o)]}],actions:b?[{title:o("remove"),onRowClick:async x=>(D([x]),N(),!0)}]:[],emptyState:e(xe,{message:o("emptyClientScopes"),instructions:o("emptyClientScopesInstructions"),primaryActionText:o("emptyClientScopesPrimaryAction"),onPrimaryAction:()=>w(!0)})},E)]})},qt=({text:n,user:i,label:a})=>{const{t}=R();return i?e(ra,{id:a,actions:e(la,{children:e(sa,{id:"code",text:n,label:a})}),children:e(Rt,{id:`text-area-${a}`,rows:20,value:n,"aria-label":a})}):l(Un,{variant:"lg",id:a,children:[e(qn,{titleText:e(L,{children:t(`${a}No`)}),headingLevel:"h2"}),e(Gn,{children:t(`${a}IsDisabled`)})]})},Ks=({protocolMappers:n})=>{const[i,a]=g(0);return nt(()=>{a(i+1)},[n]),e(Et,{loader:()=>Promise.resolve(n),ariaLabelKey:"effectiveProtocolMappers",searchPlaceholderKey:"searchForProtocol","data-testid":"effective-protocol-mappers",columns:[{name:"mapperName",displayKey:"name"},{name:"containerName",displayKey:"parentClientScope"},{name:"type.category",displayKey:"category"},{name:"type.priority",displayKey:"priority"}]},i)},Ms=({effectiveRoles:n})=>{const[i,a]=g(0);return nt(()=>{a(i+1)},[n]),e(Et,{loader:()=>Promise.resolve(n),ariaLabelKey:"effectiveRoleScopeMappings",searchPlaceholderKey:"searchForRole","data-testid":"effective-role-scope-mappings",columns:[{name:"name",displayKey:"role"},{name:"containerId",displayKey:"origin"}]},i)},Fs=({clientId:n,protocol:i})=>{const{adminClient:a}=X(),t="openid",{t:s}=R(),{enabled:o}=Ln(),{realm:r}=de(),c=Me().protocolMapperTypes[i],[u,d]=g([]),[p,f]=g(!1),[h,m]=g([t]),[C,w]=g(0),[k,A]=g(""),y=()=>A(`${new Date().getTime()}`),[K,D]=g([]),[M,H]=g([]),[E,S]=g(""),[P,U]=g(""),[T,b]=g(""),v=ot(null),B=ot(null),N=ot(null),ee=ot(null),x=ot(null),G=_e(),{hasAccess:ye}=we(),De=ye("view-users");return te(()=>a.clients.listOptionalClientScopes({id:n}),W=>d(W),[]),te(async()=>{const W=h.join(" "),Z=await a.clients.evaluatePermission({id:n,roleContainer:r,scope:W,type:"granted"});return{mapperList:await a.clients.evaluateListProtocolMapper({id:n,scope:W}),effectiveRoles:Z}},({mapperList:W,effectiveRoles:Z})=>{D(Z),W.map(me=>{me.type=c.find(it=>it.id===me.protocolMapper)}),H(W),y()},[h]),te(async()=>{const W=h.join(" "),Z=G.getValues("user");return Z?await Promise.all([a.clients.evaluateGenerateAccessToken({id:n,userId:Z[0],scope:W}),a.clients.evaluateGenerateUserInfo({id:n,userId:Z[0],scope:W}),a.clients.evaluateGenerateIdToken({id:n,userId:Z[0],scope:W})]):[]},([W,Z,me])=>{S($e(W)),U($e(Z)),b($e(me))},[G.getValues("user"),h]),l(L,{children:[l(le,{variant:"light",children:[o&&e(Fe,{className:"keycloak__section_intro__help",children:l(fe,{children:[e(Ni,{})," ",s("evaluateExplain")]})}),l(pe,{isHorizontal:!0,children:[e(z,{label:s("scopeParameter"),fieldId:"scopeParameter",labelIcon:e(V,{helpText:s("scopeParameterHelp"),fieldLabelId:"scopeParameter"}),children:l(Xe,{hasGutter:!0,children:[e(Se,{isFilled:!0,children:e(Yt,{toggleId:"scopeParameter",variant:Ct.typeaheadMulti,typeAheadAriaLabel:s("scopeParameter"),onToggle:()=>f(!p),isOpen:p,selections:h,onSelect:W=>{const Z=W;h.includes(Z)?Z!==t&&m(h.filter(me=>me!==Z)):m([...h,Z])},"aria-labelledby":s("scopeParameter"),placeholderText:s("scopeParameterPlaceholder"),children:u.map((W,Z)=>e(Ie,{value:W.name,children:W.name},Z))})}),e(Se,{children:e(Xn,{className:"keycloak__scopes_evaluate__clipboard-copy",children:h.join(" ")})})]})}),De&&e(Ee,{...G,children:e(aa,{name:"user",label:"users",helpText:s("userHelp"),defaultValue:"",variant:Ct.typeahead,isRequired:!0})})]})]}),l(Ga,{hasGutter:!0,className:"keycloak__scopes_evaluate__tabs",children:[l(hn,{span:8,children:[e(rt,{"aria-labelledby":"pf-tab-0-effectiveProtocolMappers",eventKey:0,id:"effectiveProtocolMappers",ref:v,children:e(Ks,{protocolMappers:M})}),e(rt,{"aria-labelledby":"pf-tab-0-effectiveRoleScopeMappings",eventKey:1,id:"effectiveRoleScopeMappings",ref:B,hidden:!0,children:e(Ms,{effectiveRoles:K})}),e(rt,{"aria-labelledby":s("generatedAccessToken"),eventKey:2,id:"tab-generated-access-token",ref:N,hidden:!0,children:e(qt,{text:E,user:G.getValues("user"),label:"generatedAccessToken"})}),e(rt,{"aria-labelledby":s("generatedIdToken"),eventKey:3,id:"tab-generated-id-token",ref:ee,hidden:!0,children:e(qt,{text:T,user:G.getValues("user"),label:"generatedIdToken"})}),e(rt,{"aria-labelledby":s("generatedUserInfo"),eventKey:4,id:"tab-generated-user-info",ref:x,hidden:!0,children:e(qt,{text:P,user:G.getValues("user"),label:"generatedUserInfo"})})]}),e(hn,{span:4,children:l(Di,{id:"tabs",isVertical:!0,activeKey:C,onSelect:(W,Z)=>w(Z),children:[e(Y,{id:"effectiveProtocolMappers","aria-controls":"effectiveProtocolMappers","data-testid":"effective-protocol-mappers-tab",eventKey:0,title:l(Q,{children:[s("effectiveProtocolMappers")," ",e(V,{fieldLabelId:"effectiveProtocolMappers",helpText:s("effectiveProtocolMappersHelp"),noVerticalAlign:!1,unWrap:!0})]}),tabContentRef:v}),e(Y,{id:"effectiveRoleScopeMappings","aria-controls":"effectiveRoleScopeMappings","data-testid":"effective-role-scope-mappings-tab",eventKey:1,title:l(Q,{children:[s("effectiveRoleScopeMappings")," ",e(V,{fieldLabelId:"effectiveRoleScopeMappings",helpText:s("effectiveRoleScopeMappingsHelp"),noVerticalAlign:!1,unWrap:!0})]}),tabContentRef:B}),e(Y,{id:"generatedAccessToken","aria-controls":"generatedAccessToken","data-testid":"generated-access-token-tab",eventKey:2,title:l(Q,{children:[s("generatedAccessToken")," ",e(V,{fieldLabelId:"generatedAccessToken",helpText:s("generatedAccessTokenHelp"),noVerticalAlign:!1,unWrap:!0})]}),tabContentRef:N}),e(Y,{id:"generatedIdToken","aria-controls":"generatedIdToken","data-testid":"generated-id-token-tab",eventKey:3,title:l(Q,{children:[s("generatedIdToken")," ",e(V,{fieldLabelId:"generatedIdToken",helpText:s("generatedIdTokenHelp"),noVerticalAlign:!1,unWrap:!0})]}),tabContentRef:ee}),e(Y,{id:"generatedUserInfo","aria-controls":"generatedUserInfo","data-testid":"generated-user-info-tab",eventKey:4,title:l(Q,{children:[s("generatedUserInfo")," ",e(V,{fieldLabelId:"generatedUserInfo",helpText:s("generatedUserInfoHelp"),noVerticalAlign:!1,unWrap:!0})]}),tabContentRef:x})]},k)})]})]})},Vs=({client:n})=>{const{adminClient:i}=X(),{t:a}=R(),{addAlert:t,addError:s}=ie(),{realm:o}=de(),[r,c]=g(),{hasAccess:u}=we(),d=u("manage-clients");te(()=>i.clients.getServiceAccountUser({id:n.id}),f=>c(f),[]);const p=async f=>{try{const h=f.filter(m=>m.client===void 0).map(m=>m.role).flat();await i.users.addRealmRoleMappings({id:r?.id,roles:h}),await Promise.all(f.filter(m=>m.client!==void 0).map(m=>i.users.addClientRoleMappings({id:r?.id,clientUniqueId:m.client.id,roles:[m.role]}))),t(a("roleMappingUpdatedSuccess"),$.success)}catch(h){s("roleMappingUpdatedError",h)}};return r?l(L,{children:[l(le,{className:"pf-v5-u-pb-0",children:[e(Yn,{className:"pf-v5-c-alert__icon keycloak--service-account--info-text"}),e("span",{className:"pf-v5-u-pl-sm",children:l(Li,{i18nKey:"manageServiceAccountUser",children:["",e(be,{to:ja({realm:o,id:r.id,tab:"settings"}),children:{link:r.username}})]})})]}),e(Oi,{name:n.clientId,id:r.id,type:"users",isManager:d||n.access?.configure,save:p})]}):e(Pe,{})},zs=({onChange:n,value:i,save:a,client:t,toggleDownloadDialog:s,toggleDeleteDialog:o})=>{const{t:r}=R(),[c,u]=ke({titleKey:"disableConfirmClientTitle",messageKey:"disableConfirmClient",continueButtonLabel:"disable",onConfirm:()=>{n(!i),a()}}),d=gt(()=>{const m=mi(r,t.protocol??"openid-connect");return[{text:t.bearerOnly?e(jn,{"data-testid":"bearer-only-explainer-tooltip",content:r("explainBearerOnly"),children:e(jt,{"data-testid":"bearer-only-explainer-label",icon:e(Yn,{}),children:m})}):e(jt,{children:m})}]},[t,r]),{hasAccess:p}=we(),f=p("manage-clients")||t.access?.configure,h=[e(We,{onClick:s,children:r("downloadAdapterConfig")},"download"),e(We,{onClick:()=>Ya(t),children:r("export")},"export"),...!vt(t)&&f?[e(Ke,{},"divider"),e(We,{"data-testid":"delete-client",onClick:o,children:r("delete")},"delete")]:[]];return l(L,{children:[e(u,{}),e(ai,{titleKey:t.clientId,subKey:"clientsExplain",badges:d,divider:!1,isReadOnly:!f,helpTextKey:"enableDisable",dropdownItems:h,isEnabled:i,onToggle:m=>{m?(n(m),a()):c()}})]})};function jo(){const{adminClient:n}=X(),{t:i}=R(),{addAlert:a,addError:t}=ie(),{realm:s,realmRepresentation:o}=de(),{hasAccess:r}=we(),c=Hn(),u=r("manage-authorization"),d=r("view-authorization"),p=r("manage-clients"),f=r("view-clients"),h=r("view-users"),m=c(Kn.AdminFineGrainedAuthz)&&(u||d),C=et(),[w,k]=Ce(),[A,y]=Ce(),K=_e(),{clientId:D}=en(),[M,H]=g(0),E=Pt({control:K.control,name:"clientAuthenticatorType",defaultValue:"client-secret"}),[S,P]=g(),U=async()=>{const J=await n.clients.listRoles({id:D});return ea(J,st=>st.name?.toUpperCase())},T=J=>Qa({realm:s,clientId:D,tab:J}),b=ae(T("settings")),v=ae(T("keys")),B=ae(T("credentials")),N=ae(T("roles")),ee=ae(T("clientScopes")),x=ae(T("authorization")),G=ae(T("serviceAccount")),ye=ae(T("sessions")),De=ae(T("permissions")),W=ae(T("advanced")),Z=ae(T("user-events")),me=J=>fn({realm:s,clientId:D,tab:J}),it=ae(me("setup")),Nt=ae(me("evaluate")),he=J=>gn({realm:s,clientId:D,tab:J}),Ot=ae(he("settings")),Lt=ae(he("resources")),bt=ae(he("scopes")),ce=ae(he("policies")),Ve=ae(he("permissions")),Ht=ae(he("evaluate")),fa=ae(he("export")),[ga,ba]=ke({titleKey:"clientDeleteConfirmTitle",messageKey:"clientDeleteConfirm",continueButtonLabel:"delete",continueButtonVariant:ge.danger,onConfirm:async()=>{try{await n.clients.del({id:D}),a(i("clientDeletedSuccess"),$.success),C($a({realm:s}))}catch(J){t("clientDeleteError",J)}}}),Kt=J=>{K.reset({...J}),Xa(J,K.setValue),J.attributes?.["acr.loa.map"]&&K.setValue(I("attributes.acr.loa.map"),Object.entries(JSON.parse(J.attributes["acr.loa.map"])).flatMap(([st,Mt])=>({key:st,value:Mt})))};te(()=>n.clients.findOne({id:D}),J=>{if(!J)throw new Error(i("notFound"));P(Za(J)),Kt(J)},[D,M]);const Oe=async({confirmed:J=!1,messageKey:st="clientSaveSuccess"}={confirmed:!1,messageKey:"clientSaveSuccess"})=>{if(!await K.trigger())return;if(!S?.publicClient&&S?.clientAuthenticatorType!==E&&!J){y();return}const Mt=bn(K.getValues()),yt=bn(Mt);yt.attributes?.["acr.loa.map"]&&(yt.attributes["acr.loa.map"]=JSON.stringify(Object.fromEntries(yt.attributes["acr.loa.map"].filter(({key:Te})=>Te!=="").map(({key:Te,value:ya})=>[Te,ya]))));try{const Te={...S,...yt};Te.clientId=Te.clientId?.trim(),await n.clients.update({id:D},Te),Kt(Te),P(Te),a(i(st),$.success)}catch(Te){t("clientSaveError",Te)}};return S?l(L,{children:[e(Zt,{continueButtonLabel:"yes",cancelButtonLabel:"no",titleKey:i("changeAuthenticatorConfirmTitle",{clientAuthenticatorType:E}),open:A,toggleDialog:y,onConfirm:()=>Oe({confirmed:!0}),children:e(L,{children:i("changeAuthenticatorConfirm",{clientAuthenticatorType:E})})}),e(ba,{}),w&&e(Ki,{id:S.id,protocol:S.protocol,open:!0,toggleDialog:k}),e(se,{name:"enabled",control:K.control,defaultValue:!0,render:({field:J})=>e(zs,{value:J.value,onChange:J.onChange,client:S,save:Oe,toggleDeleteDialog:ga,toggleDownloadDialog:k})}),e(le,{variant:"light",className:"pf-v5-u-p-0",children:e(Ee,{...K,children:l(Ft,{"data-testid":"client-tabs","aria-label":"client-tabs",isBox:!0,mountOnEnter:!0,children:[e(Y,{id:"settings","data-testid":"clientSettingsTab",title:e(Q,{children:i("settings")}),...b,children:e(es,{client:S,save:()=>Oe(),reset:()=>Kt(S)})}),(!S.publicClient&&!vt(S)||S.protocol==="saml")&&l(Y,{id:"keys","data-testid":"keysTab",title:e(Q,{children:i("keys")}),...v,children:[S.protocol==="openid-connect"&&e(xs,{clientId:D,save:Oe,hasConfigureAccess:S.access?.configure}),S.protocol==="saml"&&e(Os,{clientId:D,save:Oe})]}),!S.publicClient&&!vt(S)&&(f||S.access?.configure||S.access?.view)&&e(Y,{id:"credentials",title:e(Q,{children:i("credentials")}),...B,children:e(Is,{client:S,save:Oe,refresh:()=>H(M+1)},M)}),e(Y,{id:"roles","data-testid":"rolesTab",title:e(Q,{children:i("roles")}),...N,children:e(ni,{loader:U,paginated:!1,messageBundle:"client",toCreate:Wa({realm:s,clientId:S.id}),toDetail:J=>Ja({realm:s,clientId:S.id,id:J,tab:"details"}),isReadOnly:!(p||S.access?.configure)})}),!vt(S)&&!S.bearerOnly&&e(Y,{id:"clientScopes","data-testid":"clientScopesTab",title:e(Q,{children:i("clientScopes")}),...ee,children:l(Ft,{defaultLocation:fn({realm:s,clientId:D,tab:"setup"}),children:[e(Y,{id:"setup","data-testid":"clientScopesSetupTab",title:e(Q,{children:i("setup")}),...it,children:e(Hs,{clientName:S.clientId,clientId:D,protocol:S.protocol,fineGrainedAccess:S.access?.manage})}),e(Y,{id:"evaluate","data-testid":"clientScopesEvaluateTab",title:e(Q,{children:i("evaluate")}),...Nt,children:e(Fs,{clientId:D,protocol:S.protocol})})]})}),S.authorizationServicesEnabled&&(u||d)&&e(Y,{id:"authorization","data-testid":"authorizationTab",title:e(Q,{children:i("authorization")}),...x,children:l(Ft,{mountOnEnter:!0,unmountOnExit:!0,defaultLocation:gn({realm:s,clientId:D,tab:"settings"}),children:[e(Y,{id:"settings","data-testid":"authorizationSettings",title:e(Q,{children:i("settings")}),...Ot,children:e(Cs,{clientId:D})}),e(Y,{id:"resources","data-testid":"authorizationResources",title:e(Q,{children:i("resources")}),...Lt,children:e(ys,{clientId:D,isDisabled:!u})}),e(Y,{id:"scopes","data-testid":"authorizationScopes",title:e(Q,{children:i("scopes")}),...bt,children:e(vs,{clientId:D,isDisabled:!u})}),e(Y,{id:"policies","data-testid":"authorizationPolicies",title:e(Q,{children:i("policies")}),...ce,children:e(fs,{clientId:D,isDisabled:!u})}),e(Y,{id:"permissions","data-testid":"authorizationPermissions",title:e(Q,{children:i("permissions")}),...Ve,children:e(ms,{clientId:D,isDisabled:!u})}),h&&e(Y,{id:"evaluate","data-testid":"authorizationEvaluate",title:e(Q,{children:i("evaluate")}),...Ht,children:e(rs,{client:S,save:Oe})}),r("manage-authorization")&&e(Y,{id:"export","data-testid":"authorizationExport",title:e(Q,{children:i("export")}),...fa,children:e(cs,{})})]})}),S.serviceAccountsEnabled&&h&&e(Y,{id:"serviceAccount","data-testid":"serviceAccountTab",title:e(Q,{children:i("serviceAccount")}),...G,children:e(Vs,{client:S})}),e(Y,{id:"sessions","data-testid":"sessionsTab",title:e(Q,{children:i("sessions")}),...ye,children:e(Wi,{client:S})}),m&&(p||S.access?.manage)&&e(Y,{id:"permissions","data-testid":"permissionsTab",title:e(Q,{children:i("permissions")}),...De,children:e(ti,{id:S.id,type:"clients"})}),e(Y,{id:"advanced","data-testid":"advancedTab",title:e(Q,{children:i("advanced")}),...W,children:e($i,{save:Oe,client:S})}),r("view-events")&&o?.eventsEnabled&&e(Y,{"data-testid":"user-events-tab",title:e(Q,{children:i("events")}),...Z,children:e(Hi,{client:S.clientId})})]})})})]}):e(Pe,{})}export{jo as default};
//# sourceMappingURL=ClientDetails-BV9RqlYl.js.map
