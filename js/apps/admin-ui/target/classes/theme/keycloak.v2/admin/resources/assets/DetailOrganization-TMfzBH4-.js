import{jsx as e,jsxs as f,Fragment as H}from"react/jsx-runtime";import{u as D,d as Z,b as be,a as z,V as x,K as ie,Y as ee,B as W,eK as ye,O as de,D as Q,z as G,d4 as fe,j as te,y as ve,N as Ce,_ as ke,ag as Ie,ah as ce,d5 as Se,d6 as Oe,U as Te,W as Me,d7 as Pe,f as F,d8 as we,ai as Le,a5 as De,aj as oe,l as ae,o as ze,M as me,m as ue,aq as ne,n as re,F as he,$ as Ae,bF as se,p as Ee,c as Fe,P as q,h as Y,eL as xe,w as ge,T as K,S as Ve,J,bm as Ue,bn as Ke,L as Re,cA as Be,A as Ne,dh as Ge,cU as He}from"./main-hjbDDO6j.js";import{F as _e}from"./FormAccess-DEsYjDHG.js";import{A as je}from"./AttributeForm-CrNTp7VT.js";import{R as qe,u as We}from"./RoutableTabs-ChOqIl6o.js";import{u as pe}from"./useParams-XtwJXIDJ.js";import{V as $e}from"./ViewHeader-Dr6ZoEJz.js";import{u as X}from"./ConfirmDialog-DN_NVsrg.js";import{useState as I,useRef as Je,useCallback as Qe,useEffect as Ye}from"react";import{M as Xe}from"./ManageOrderDialog-Dm20IJc0.js";import{D as le}from"./SwitchControl-C_wbgFy3.js";import{s as Ze}from"./sortBy-D1UyZ0jY.js";import{M as et}from"./MembersModal-C-yaYxu4.js";import{S as tt,C as at}from"./SearchInputComponent-Dywqn1xE.js";import{t as nt}from"./translationFormatter-aKDacg4X.js";import{O as rt,c as it}from"./OrganizationForm-C_Ad-USh.js";import{a as _,b as j}from"./Tabs-TiG_cKa2.js";import"react-dom";import"./copy-icon-ePLWnxgr.js";import"./KeyValueInput-BjiKJH0l.js";import"./KeySelect-CBdQO7FV.js";import"./PageHandler-Dm6Ir_Zl.js";import"./DynamicComponents-2Oogxguf.js";import"./ClientSelect-Di5Ep3wz.js";import"./FileUpload-DFzHUp8z.js";import"./CodeEditor-BF8OqNGf.js";import"./GroupPickerDialog-CJH5Fdnt.js";import"./DataListItemRow-C-0mzg8R.js";import"./MultiLineInput-BKovUfcB.js";import"./AddRoleMappingModal-B-7S42YC.js";import"./useLocaleSort-Bon3wgU4.js";import"./filter-icon-I49U7vdU.js";import"./constants-BclHbWtx.js";import"./Droppable-BpTayVV3.js";import"./_baseFlatten-DK0O-V_R.js";import"./differenceBy-BM_QxZMj.js";const ot=({save:t})=>{const{adminClient:a}=D(),{realm:d}=Z(),h=be(),{t:r}=z(),{addAlert:n,addError:m}=x(),s=ie({name:"id"}),o=ie({name:"name"}),{setValue:p}=ee(),[v,u]=X({titleKey:"disableConfirmOrganizationTitle",messageKey:"disableConfirmOrganization",continueButtonLabel:"disable",onConfirm:()=>{p("enabled",!1),t()}}),[y,i]=X({titleKey:"organizationDelete",messageKey:"organizationDeleteConfirm",continueButtonLabel:"delete",continueButtonVariant:W.danger,onConfirm:async()=>{try{await a.organizations.delById({id:s}),n(r("organizationDeletedSuccess")),h(ye({realm:d}))}catch(l){m("organizationDeleteError",l)}}});return e(de,{name:"enabled",render:({field:{value:l,onChange:C}})=>f(H,{children:[e(i,{}),e(u,{}),e($e,{titleKey:o||"",divider:!1,dropdownItems:[e(Q,{"data-testid":"delete-client",onClick:y,children:r("delete")},"delete")],isEnabled:l,onToggle:T=>{T?(C(T),t()):v()}})]})})},st=({name:t,label:a,helpText:d,defaultValue:h,isRequired:r,variant:n="typeahead",isDisabled:m})=>{const{adminClient:s}=D(),{t:o}=z(),{control:p,getValues:v,formState:{errors:u}}=ee(),y=v(t),[i,l,C]=G(),[T,w]=I(""),V=Je(),[b,M]=I([]),[A,R]=I(""),B=Qe(fe(R,1e3),[]);te(async()=>{const c={max:20,realmOnly:!0};return A&&(c.search=A),await s.identityProviders.find(c)},M,[A]);const $=c=>{const P=c.map(S=>e(oe,{value:S,selected:y?.includes(S.alias),children:S.alias},S.alias));return P.length===0?e(oe,{value:"",children:o("noResultsFound")}):P};return b?f(Ce,{label:o(a),isRequired:r,labelIcon:d?e(ke,{helpText:d,fieldLabelId:a}):void 0,fieldId:t,children:[e(de,{name:t,defaultValue:h,control:p,rules:{validate:c=>r&&c.filter(P=>P!==void 0).length===0?o("required"):void 0},render:({field:c})=>e(Ie,{id:t,onOpenChange:l,toggle:P=>e(ce,{"data-testid":t,ref:P,variant:"typeahead",onClick:l,isExpanded:i,isFullWidth:!0,isDisabled:m,status:u[t]?"danger":void 0,children:f(Se,{isPlain:!0,children:[e(Oe,{value:T||c.value,onClick:l,onChange:(S,E)=>{C(!0),w(E),B(E)},autoComplete:"off",innerRef:V,placeholderText:o("selectAUser"),...c.value&&{"aria-activedescendant":c.value},role:"combobox",isExpanded:i,"aria-controls":"select-create-typeahead-listbox",children:n==="typeaheadMulti"&&Array.isArray(c.value)&&e(Te,{"aria-label":"Current selections",children:c.value.map((S,E)=>e(Me,{onClick:O=>{O.stopPropagation(),c.onChange(c.value.filter(L=>L!==S))},children:S},E))})}),e(Pe,{children:!!A&&e(F,{variant:"plain",onClick:()=>{w(""),R(""),c.onChange([]),V?.current?.focus()},"aria-label":o("clear"),children:e(we,{"aria-hidden":!0})})})]})}),isOpen:i,selected:c.value,onSelect:(P,S)=>{const O=S.alias;if(n!=="typeaheadMulti"){const L=c.value.includes(O);L?c.onChange([]):c.onChange([O]),w(L?"":O||""),C(!1)}else{const L=c.value.find(U=>U===O)?c.value.filter(U=>U!==O):[...c.value,O];c.onChange(L)}},"aria-label":o(t),children:e(Le,{children:$(b)})})}),u[t]&&e(De,{message:o("required")})]}):e(ve,{})},lt=({orgId:t,identityProvider:a,onClose:d})=>{const{adminClient:h}=D(),{t:r}=z(),{addAlert:n,addError:m}=x(),s=ae({mode:"onChange"}),{handleSubmit:o,formState:p,setValue:v}=s,{getValues:u}=ee();Ye(()=>ze({...a,alias:[a?.alias],hideOnLogin:a?.hideOnLogin},v),[]);const y=async i=>{try{const l=await h.identityProviders.findOne({alias:i.alias[0]});if(!l)throw new Error(r("notFound"));const{config:C}=Ee(i);l.config={...l.config,...C},l.hideOnLogin=i.hideOnLogin,await h.identityProviders.update({alias:i.alias[0]},l),a||await h.organizations.linkIdp({orgId:t,alias:i.alias[0]}),n(r(a?"linkUpdatedSuccessful":"linkSuccessful")),d()}catch(l){m(a?"linkUpdatedError":"linkError",l)}};return e(me,{variant:ue.small,title:r("linkIdentityProvider"),isOpen:!0,onClose:d,actions:[e(ne,{formState:p,"data-testid":"confirm",form:"form",allowInvalid:!0,allowNonDirty:!0,children:r("save")},"confirm"),e(F,{id:"modal-cancel","data-testid":"cancel",variant:W.link,onClick:d,children:r("cancel")},"cancel")],children:e(re,{...s,children:f(he,{id:"form",onSubmit:o(y),children:[e(st,{name:"alias",label:r("identityProvider"),defaultValue:[],isRequired:!0,isDisabled:!!a}),e(Ae,{name:se("config.kc.org.domain"),label:r("domain"),controller:{defaultValue:""},options:[{key:"",value:r("none")},...u("domains").map(i=>({key:i,value:i}))],menuAppendTo:"parent"}),e(le,{name:"hideOnLogin",label:r("hideOnLoginPage"),labelIcon:r("hideOnLoginPageHelp"),defaultValue:!0}),e(le,{name:se("config.kc.org.broker.redirect.mode.email-matches"),label:r("redirectWhenEmailMatches"),labelIcon:r("redirectWhenEmailMatchesHelp"),stringify:!0})]})})})},dt=({row:t,refresh:a})=>{const{adminClient:d}=D(),{addAlert:h,addError:r}=x(),{t:n}=z(),m=async s=>{try{await d.identityProviders.update({alias:t.alias},{...t,hideOnLogin:s}),h(n("linkUpdatedSuccessful")),a()}catch(o){r("linkUpdatedError",o)}};return e(Ve,{label:n("on"),labelOff:n("off"),isChecked:t.hideOnLogin,onChange:(s,o)=>m(o)})},ct=()=>{const{adminClient:t}=D(),{t:a}=z(),{id:d}=Fe(),{addAlert:h,addError:r}=x(),[n,m]=I(0),s=()=>m(n+1),[o,p]=I(!1),[v,u]=I(!1),[y,i]=I(),[l,C]=G();te(async()=>t.identityProviders.find({max:1}),b=>{u(b.length===1)},[]);const T=async()=>{const b=await t.organizations.listIdentityProviders({orgId:d});return Ze(b,"alias")},[w,V]=X({titleKey:"identityProviderUnlink",messageKey:"identityProviderUnlinkConfirm",continueButtonLabel:"unLinkIdentityProvider",continueButtonVariant:W.danger,onConfirm:async()=>{try{await t.organizations.unLinkIdp({orgId:d,alias:y.alias}),i(void 0),h(a("unLinkSuccessful")),s()}catch(b){r("unLinkError",b)}}});return f(H,{children:[o&&e(Xe,{orgId:d,onClose:()=>{p(!1),s()}}),f(q,{variant:"light",children:[e(V,{}),l&&e(lt,{orgId:d,identityProvider:y,onClose:()=>{C(),s()}}),v?e(ge,{loader:T,ariaLabelKey:"identityProviders",searchPlaceholderKey:"searchProvider",toolbarItem:f(H,{children:[e(K,{children:e(F,{onClick:()=>{i(void 0),C()},children:a("linkIdentityProvider")})}),e(K,{children:e(F,{"data-testid":"manageDisplayOrder",variant:"link",onClick:()=>p(!0),children:a("manageDisplayOrder")})})]}),actions:[{title:a("edit"),onRowClick:b=>{i(b),C()}},{title:a("unLinkIdentityProvider"),onRowClick:b=>{i(b),w()}}],columns:[{name:"alias"},{name:"config['kc.org.domain']",displayKey:"domain"},{name:"providerId",displayKey:"providerDetails"},{name:"hideOnLogin",displayKey:"hideOnLoginPage",cellRenderer:b=>e(dt,{row:b,refresh:s})}],emptyState:e(Y,{message:a("emptyIdentityProviderLink"),instructions:a("emptyIdentityProviderLinkInstructions"),primaryActionText:a("linkIdentityProvider"),onPrimaryAction:C})},n):e(Y,{icon:xe,message:a("noIdentityProvider"),instructions:a("noIdentityProviderInstructions")})]})]})},mt=({orgId:t,onClose:a})=>{const{adminClient:d}=D(),{addAlert:h,addError:r}=x(),{t:n}=z(),m=ae(),{handleSubmit:s,formState:o}=m,p=async v=>{try{const u=new FormData;for(const y in v)u.append(y,v[y]);await d.organizations.invite({orgId:t},u),h(n("inviteSent")),a()}catch(u){r("inviteSentError",u)}};return e(me,{variant:ue.small,title:n("inviteMember"),isOpen:!0,onClose:a,actions:[e(ne,{formState:o,"data-testid":"save",form:"form",allowInvalid:!0,allowNonDirty:!0,children:n("send")},"confirm"),e(F,{id:"modal-cancel","data-testid":"cancel",variant:W.link,onClick:a,children:n("cancel")},"cancel")],children:e(re,{...m,children:f(he,{id:"form",onSubmit:s(p),children:[e(J,{name:"email",label:n("email"),rules:{required:n("required")},autoFocus:!0}),e(J,{name:"firstName",label:n("firstName")}),e(J,{name:"lastName",label:n("lastName")})]})})})},ut=t=>{const{realm:a}=Z();return e(Re,{to:Be({realm:a,id:t.id,tab:"settings"}),children:t.username})},ht=()=>{const{t}=z(),{adminClient:a}=D(),{id:d}=pe(),{addAlert:h,addError:r}=x(),[n,m]=I(0),s=()=>m(n+1),[o,p]=G(),[v,u]=G(),[y,i]=G(),[l,C]=I([]),[T,w]=I(""),[V,b]=I(""),[M,A]=I([]),[R,B]=I(!1),$=[{value:"Managed",label:"Managed"},{value:"Unmanaged",label:"Unmanaged"}],c=()=>{B(!R)},P=(g,k)=>{M.includes(k)?A(M.filter(N=>N!==k)):A([...M,k]),B(!1),s()},S=async(g,k)=>{try{const N=M.length===1?M[0]:void 0;return await a.organizations.listMembers({orgId:d,first:g,max:k,search:V,membershipType:N})}catch(N){return r("organizationsMembersListError",N),[]}},E=g=>{w(g)},O=()=>{b(T),s()},L=()=>{w(""),b(""),s()},U=async g=>{try{await Promise.all(g.map(k=>a.organizations.delMember({orgId:d,userId:k.id}))),h(t("organizationUsersLeft",{count:g.length}))}catch(k){r("organizationUsersLeftError",k)}s()};return f(H,{children:[v&&e(et,{membersQuery:()=>a.organizations.listMembers({orgId:d}),onAdd:async g=>{try{await Promise.all(g.map(k=>a.organizations.addMember({orgId:d,userId:k.id}))),h(t("organizationUsersAdded",{count:g.length}))}catch(k){r("organizationUsersAddedError",k)}},onClose:()=>{u(),s()}}),y&&e(mt,{orgId:d,onClose:i}),e(ge,{loader:S,isPaginated:!0,ariaLabelKey:"membersList",onSelect:g=>C([...g]),canSelectAll:!0,toolbarItem:f(H,{children:[e(K,{children:e(tt,{value:T,onChange:E,onSearch:O,onClear:L,placeholder:t("searchMembers"),"aria-label":t("searchMembers")})}),e(K,{children:e(Ue,{onOpenChange:p,toggle:g=>e(ce,{ref:g,onClick:p,isExpanded:o,variant:"primary",children:t("addMember")}),isOpen:o,children:f(Ke,{children:[e(Q,{onClick:()=>{u(),p()},children:t("addRealmUser")}),e(Q,{onClick:()=>{i(),p()},children:t("inviteMember")})]})})}),e(K,{children:e(F,{variant:"plain",isDisabled:l.length===0,onClick:()=>U(l),children:t("removeMember")})}),e(K,{children:e(at,{filterPlaceholderText:t("filterByMembershipType"),isOpen:R,options:$,onOpenChange:g=>B(g),onToggleClick:c,onSelect:P,selectedItems:M,width:"260px"})})]}),actions:[{title:t("remove"),onRowClick:async g=>{await U([g])}}],columns:[{name:"username",cellRenderer:ut},{name:"email"},{name:"firstName"},{name:"lastName"},{name:"membershipType",cellFormatters:[nt(t)]}],emptyState:e(Y,{message:t("emptyMembers"),instructions:t("emptyMembersInstructions"),secondaryActions:[{text:t("addRealmUser"),onClick:u},{text:t("inviteMember"),onClick:i}]}),isSearching:M.length>0},n)]})};function Yt(){const{adminClient:t}=D(),{addAlert:a,addError:d}=x(),{realm:h}=Z(),{id:r}=pe(),{t:n}=z(),m=ae(),s=async i=>{try{const l=it(i);await t.organizations.updateById({id:r},l),a(n("organizationSaveSuccess"))}catch(l){d("organizationSaveError",l)}};te(()=>t.organizations.findOne({id:r}),i=>{if(!i)throw new Error(n("notFound"));m.reset({...i,domains:i.domains?.map(l=>l.name),attributes:He(i.attributes)})},[r]);const o=i=>We(Ge({realm:h,id:r,tab:i})),p=o("settings"),v=o("attributes"),u=o("members"),y=o("identityProviders");return e(q,{variant:"light",className:"pf-v5-u-p-0",children:f(re,{...m,children:[e(ot,{save:()=>s(m.getValues())}),f(qe,{"data-testid":"organization-tabs","aria-label":n("organization"),isBox:!0,mountOnEnter:!0,children:[e(_,{id:"settings","data-testid":"settingsTab",title:e(j,{children:n("settings")}),...p,children:e(q,{children:f(_e,{role:"anyone",onSubmit:m.handleSubmit(s),isHorizontal:!0,children:[e(rt,{readOnly:!0}),f(Ne,{children:[e(ne,{formState:m.formState,"data-testid":"save",children:n("save")}),e(F,{onClick:()=>m.reset(),"data-testid":"reset",variant:"link",children:n("reset")})]})]})})}),e(_,{id:"attributes","data-testid":"attributeTab",title:e(j,{children:n("attributes")}),...v,children:e(q,{variant:"light",children:e(je,{form:m,save:s,reset:()=>m.reset({...m.getValues()}),name:"attributes"})})}),e(_,{id:"members","data-testid":"membersTab",title:e(j,{children:n("members")}),...u,children:e(ht,{})}),e(_,{id:"identityProviders","data-testid":"identityProvidersTab",title:e(j,{children:n("identityProviders")}),...y,children:e(ct,{})})]})]})})}export{Yt as default};
//# sourceMappingURL=DetailOrganization-TMfzBH4-.js.map
