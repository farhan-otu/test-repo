import{jsxs as q,jsx as t,Fragment as Q}from"react/jsx-runtime";import{ar as ie,as as U,dl as ge,a8 as Fe,cK as Se,dm as st,at as Ue,bI as xe,dn as Me,dp as Te,au as it,dq as rt,dr as ot,ds as Ae,dt as lt,du as ct,a as j,dv as te,d as re,dw as oe,dx as dt,dy as Re,L as ue,u as P,V as Y,l as $e,j as le,P as qe,dz as je,cU as Ve,p as ut,q as me,M as ze,m as He,aq as mt,f as X,B as fe,n as pt,F as ht,bt as gt,J as ft,b$ as ce,z as H,T as Z,bm as be,ah as ve,bw as we,bn as ye,D as J,w as Ce,dA as bt,h as Ne,ak as vt,cW as Ge,C as wt,bx as De,dB as Pe,y as We,by as he,cA as yt,ap as Ct,cz as Nt,b as Ee,av as Gt,ce as Et,cf as Oe,dC as _e,dg as se,bl as Qe,dD as kt,bD as It,bE as St,dE as xt,dF as Mt,dG as Tt,dH as At,dI as Rt,al as Vt}from"./main-hjbDDO6j.js";import*as $ from"react";import D,{useState as x,useEffect as Je,useRef as Le}from"react";import{P as Dt}from"./PermissionTab-CE0biuPZ.js";import{V as Ot}from"./ViewHeader-Dr6ZoEJz.js";import{A as _t}from"./AttributeForm-CrNTp7VT.js";import{R as Lt}from"./AddRoleMappingModal-B-7S42YC.js";import{C as Bt}from"./ConfirmDialog-DN_NVsrg.js";import{G as Kt,a as Ft}from"./GroupPickerDialog-CJH5Fdnt.js";import{M as Ut}from"./MembersModal-C-yaYxu4.js";import{s as $t}from"./sortBy-D1UyZ0jY.js";import{Q as qt}from"./question-circle-icon-BckMEuvu.js";import{b as jt}from"./_baseFlatten-DK0O-V_R.js";import{T as zt,a as ae,b as ne}from"./Tabs-TiG_cKa2.js";import"react-dom";import"./useLocaleSort-Bon3wgU4.js";import"./Trans-BCvPJnzT.js";import"./FormAccess-DEsYjDHG.js";import"./copy-icon-ePLWnxgr.js";import"./KeyValueInput-BjiKJH0l.js";import"./KeySelect-CBdQO7FV.js";import"./translationFormatter-aKDacg4X.js";import"./filter-icon-I49U7vdU.js";import"./DataListItemRow-C-0mzg8R.js";import"./differenceBy-BM_QxZMj.js";const Xe=a=>{var{className:e="",children:n,hasNoPadding:o=!1}=a,c=ie(a,["className","children","hasNoPadding"]);return $.createElement("div",Object.assign({className:U(ge.drawerBody,o&&ge.modifiers.noPadding,e)},c),n)};Xe.displayName="DrawerPanelBody";const Ye=a=>{var{className:e="",children:n,hasNoPadding:o=!1}=a,c=ie(a,["className","children","hasNoPadding"]);return $.createElement(Xe,{hasNoPadding:o},$.createElement("div",Object.assign({className:U(ge.drawerHead,e)},c),n))};Ye.displayName="DrawerHead";const E={badge:"pf-v5-c-badge",dirRtl:"pf-v5-m-dir-rtl",modifiers:{compact:"pf-m-compact",guides:"pf-m-guides",expanded:"pf-m-expanded",noBackground:"pf-m-no-background",current:"pf-m-current",read:"pf-m-read",selectable:"pf-m-selectable",truncate:"pf-m-truncate"},themeDark:"pf-v5-theme-dark",treeView:"pf-v5-c-tree-view",treeViewAction:"pf-v5-c-tree-view__action",treeViewContent:"pf-v5-c-tree-view__content",treeViewListItem:"pf-v5-c-tree-view__list-item",treeViewNode:"pf-v5-c-tree-view__node",treeViewNodeCheck:"pf-v5-c-tree-view__node-check",treeViewNodeContainer:"pf-v5-c-tree-view__node-container",treeViewNodeContent:"pf-v5-c-tree-view__node-content",treeViewNodeCount:"pf-v5-c-tree-view__node-count",treeViewNodeIcon:"pf-v5-c-tree-view__node-icon",treeViewNodeText:"pf-v5-c-tree-view__node-text",treeViewNodeTitle:"pf-v5-c-tree-view__node-title",treeViewNodeToggle:"pf-v5-c-tree-view__node-toggle",treeViewNodeToggleIcon:"pf-v5-c-tree-view__node-toggle-icon",treeViewSearch:"pf-v5-c-tree-view__search"},Ze=a=>{var{isNested:e=!1,isMultiSelectable:n=!1,toolbar:o,children:c,"aria-label":s,"aria-labelledby":r}=a,i=ie(a,["isNested","isMultiSelectable","toolbar","children","aria-label","aria-labelledby"]);return $.createElement($.Fragment,null,o&&$.createElement($.Fragment,null,o,$.createElement(Fe,null)),$.createElement("ul",Object.assign({className:U(`${E.treeView}__list`),role:e?"group":"tree","aria-multiselectable":e?void 0:n,"aria-label":s,"aria-labelledby":r},i),c))};Ze.displayName="TreeViewList";const Ht=({name:a,title:e,id:n,isExpanded:o,defaultExpanded:c=!1,children:s=null,onSelect:r,onExpand:i,onCollapse:d,onCheck:l,hasCheckbox:h=!1,checkProps:k={checked:!1},hasBadge:v=!1,customBadgeContent:N,badgeProps:p={isRead:!0},isSelectable:y=!1,isCompact:_,activeItems:L=[],itemData:u,parentItem:g,icon:I,expandedIcon:T,action:f,compareItems:K,useMemo:V})=>{const[B,w]=x(c);Je(()=>{o!=null?w(o):c!=null&&w(B||c)},[o,c]);let m="button";h?m="label":y&&(m="div");const b=h||y?"button":"span",M=C=>D.createElement(b,Object.assign({className:U(E.treeViewNodeToggle),onClick:S=>{(y||h)&&(B?d&&d(S,u,g):i&&i(S,u,g),w(!B)),y&&S.stopPropagation()}},(h||y)&&{"aria-labelledby":`label-${C}`},b==="button"&&{type:"button"},{tabIndex:-1}),D.createElement("span",{className:U(E.treeViewNodeToggleIcon)},D.createElement(Ue,{"aria-hidden":"true"}))),O=k.checked===null?!1:k.checked,A=C=>D.createElement("span",{className:U(E.treeViewNodeCheck)},D.createElement("input",Object.assign({type:"checkbox",onChange:S=>l&&l(S,u,g),onClick:S=>S.stopPropagation(),ref:S=>S&&(S.indeterminate=k.checked===null)},k,{checked:O,id:C,tabIndex:-1}))),F=D.createElement("span",{className:U(E.treeViewNodeIcon)},!B&&I,B&&(T||I)),z=()=>{const C=D.createElement(D.Fragment,null,_&&e&&D.createElement("span",{className:U(E.treeViewNodeTitle)},e),y?D.createElement("button",{tabIndex:-1,className:U(E.treeViewNodeText),type:"button"},a):D.createElement("span",{className:U(E.treeViewNodeText)},a));return _?D.createElement("span",{className:U(E.treeViewNodeContent)},C):C},G=D.createElement(D.Fragment,null,v&&s&&D.createElement("span",{className:U(E.treeViewNodeCount)},D.createElement(Se,Object.assign({},p),N||s.props.data.length)),v&&!s&&N!==void 0&&D.createElement("span",{className:U(E.treeViewNodeCount)},D.createElement(Se,Object.assign({},p),N))),R=(!s||y)&&L&&L.length>0&&L.some(C=>K&&C&&K(C,u));return D.createElement("li",Object.assign({id:n,className:U(E.treeViewListItem,B&&E.modifiers.expanded),"aria-expanded":B,role:"treeitem",tabIndex:-1},h&&{"aria-checked":O},!h&&{"aria-selected":R}),D.createElement("div",{className:U(E.treeViewContent)},D.createElement(st,{prefix:y?"selectable-id":"checkbox-id"},C=>D.createElement(m,Object.assign({className:U(E.treeViewNode,s&&(y||h)&&E.modifiers.selectable,R&&E.modifiers.current),onClick:S=>{h||(r&&r(S,u,g),!y&&s&&S.isDefaultPrevented()!==!0&&(B?d&&d(S,u,g):i&&i(S,u,g),w(!B)))}},h&&{htmlFor:C},(h||y&&s)&&{id:`label-${C}`},m==="button"&&{type:"button"}),D.createElement("span",{className:U(E.treeViewNodeContainer)},s&&M(C),h&&A(C),I&&F,z(),G))),f&&D.createElement("div",{className:U(E.treeViewAction)},f)),B&&s)},et=D.memo(Ht,(a,e)=>{if(!e.useMemo)return!1;const n=a.activeItems&&a.activeItems.length>0&&a.activeItems.some(c=>a.compareItems&&c&&a.compareItems(c,a.itemData)),o=e.activeItems&&e.activeItems.length>0&&e.activeItems.some(c=>e.compareItems&&c&&e.compareItems(c,e.itemData));return!(n||o||a.name!==e.name||a.title!==e.title||a.id!==e.id||a.isExpanded!==e.isExpanded||a.defaultExpanded!==e.defaultExpanded||a.onSelect!==e.onSelect||a.onCheck!==e.onCheck||a.onExpand!==e.onExpand||a.onCollapse!==e.onCollapse||a.hasCheckbox!==e.hasCheckbox||a.checkProps!==e.checkProps||a.hasBadge!==e.hasBadge||a.customBadgeContent!==e.customBadgeContent||a.badgeProps!==e.badgeProps||a.isCompact!==e.isCompact||a.icon!==e.icon||a.expandedIcon!==e.expandedIcon||a.action!==e.action||a.parentItem!==e.parentItem||a.itemData!==e.itemData)});et.displayName="TreeViewListItem";class Pt extends $.Component{constructor(){super(...arguments),this.displayName="TreeViewRoot",this.treeRef=$.createRef(),this.handleKeys=e=>{var n,o,c,s,r,i,d;if(!this.treeRef.current.contains(e.target)||!e.target.classList.contains(E.treeViewNode))return;const l=document.activeElement,h=e.key,k=Array.from((n=this.treeRef.current)===null||n===void 0?void 0:n.getElementsByClassName(E.treeViewNode)).filter(v=>!v.classList.contains("pf-m-disabled"));if(h===xe.Space&&(l.click(),e.preventDefault()),Me(e,k,v=>l===v,void 0,[],void 0,!0,!0),["ArrowLeft","ArrowRight"].includes(h)){const v=(c=(o=l?.firstElementChild)===null||o===void 0?void 0:o.firstElementChild)===null||c===void 0?void 0:c.classList.contains(E.treeViewNodeToggle),N=(s=l?.closest("li"))===null||s===void 0?void 0:s.classList.contains("pf-m-expanded");if(h==="ArrowLeft")if(v&&N)l.click();else{const p=(r=l?.closest("ul"))===null||r===void 0?void 0:r.parentElement;if(p?.tagName!=="DIV"){const y=p?.querySelector("button");l.tabIndex=-1,y&&(y.tabIndex=0,y.focus())}}else if(v&&!N){l.tabIndex=-1,l.click();const p=(d=(i=l?.closest("li"))===null||i===void 0?void 0:i.querySelector("ul > li"))===null||d===void 0?void 0:d.querySelector("button");p&&(p.tabIndex=0,p.focus())}e.preventDefault()}},this.handleKeysCheckbox=e=>{var n,o,c,s,r;if(!this.treeRef.current.contains(e.target))return;const i=document.activeElement,d=e.key;d===xe.Space&&(i.click(),e.preventDefault());const l=Array.from((n=this.treeRef.current)===null||n===void 0?void 0:n.getElementsByClassName(E.treeViewNode));Me(e,l,h=>h.contains(i),h=>h.querySelector("button,input"),[],void 0,!0,!0),["ArrowLeft","ArrowRight"].includes(d)&&(d==="ArrowLeft"?i?.tagName==="INPUT"?!((o=i?.parentElement)===null||o===void 0)&&o.previousSibling&&i.parentElement.previousSibling.focus():i?.previousSibling&&(((c=i.previousElementSibling)===null||c===void 0?void 0:c.tagName)==="SPAN"?i.previousSibling.firstChild.focus():i.previousSibling.focus()):i?.tagName==="INPUT"?!((s=i.parentElement)===null||s===void 0)&&s.nextSibling&&i.parentElement.nextSibling.focus():i?.nextSibling&&(((r=i.nextElementSibling)===null||r===void 0?void 0:r.tagName)==="SPAN"?i.nextSibling.firstChild.focus():i.nextSibling.focus()),e.preventDefault())},this.variantStyleModifiers={default:"",compact:E.modifiers.compact,compactNoBackground:[E.modifiers.compact,E.modifiers.noBackground]}}componentDidMount(){var e;if(Te&&window.addEventListener("keydown",this.props.hasCheckboxes||this.props.hasSelectableNodes?this.handleKeysCheckbox:this.handleKeys),this.props.hasCheckboxes||this.props.hasSelectableNodes){const n=this.treeRef.current.getElementsByClassName(E.treeViewNodeToggle)[0];if(n&&(n.tabIndex=0),this.props.hasCheckboxes){const o=this.treeRef.current.getElementsByTagName("INPUT")[0];o&&(o.tabIndex=0)}if(this.props.hasSelectableNodes){const o=this.treeRef.current.getElementsByClassName(E.treeViewNodeText)[0];o&&(o.tabIndex=0)}}else((e=this.treeRef.current)===null||e===void 0?void 0:e.getElementsByClassName(E.treeViewNode)[0]).tabIndex=0}componentWillUnmount(){Te&&window.removeEventListener("keydown",this.props.hasCheckboxes||this.props.hasSelectableNodes?this.handleKeysCheckbox:this.handleKeys)}render(){const e=this.props,{children:n,hasCheckboxes:o,hasGuides:c,variant:s,className:r,hasSelectableNodes:i}=e,d=ie(e,["children","hasCheckboxes","hasGuides","variant","className","hasSelectableNodes"]);return $.createElement("div",Object.assign({className:U(E.treeView,c&&E.modifiers.guides,this.variantStyleModifiers[s],r),ref:this.treeRef},d),n)}}const ke=a=>{var{data:e,isNested:n=!1,hasCheckboxes:o=!1,hasBadges:c=!1,hasGuides:s=!1,hasSelectableNodes:r=!1,variant:i="default",defaultAllExpanded:d=!1,allExpanded:l,icon:h,isMultiSelectable:k=!1,expandedIcon:v,parentItem:N,onSelect:p,onCheck:y,onExpand:_,onCollapse:L,toolbar:u,activeItems:g,compareItems:I=(m,b)=>m.id===b.id,className:T,useMemo:f,"aria-label":K,"aria-labelledby":V}=a,B=ie(a,["data","isNested","hasCheckboxes","hasBadges","hasGuides","hasSelectableNodes","variant","defaultAllExpanded","allExpanded","icon","isMultiSelectable","expandedIcon","parentItem","onSelect","onCheck","onExpand","onCollapse","toolbar","activeItems","compareItems","className","useMemo","aria-label","aria-labelledby"]);const w=$.createElement(Ze,{isNested:n,toolbar:u,isMultiSelectable:k,"aria-label":K,"aria-labelledby":V},e.map(m=>{var b,M;return $.createElement(et,Object.assign({key:((b=m.id)===null||b===void 0?void 0:b.toString())||((M=m.name)===null||M===void 0?void 0:M.toString()),name:m.name,title:m.title,id:m.id,isExpanded:l,isSelectable:r,defaultExpanded:m.defaultExpanded!==void 0?m.defaultExpanded:d,onSelect:p,onCheck:y,onExpand:_,onCollapse:L,hasCheckbox:m.hasCheckbox!==void 0?m.hasCheckbox:o,checkProps:m.checkProps,hasBadge:m.hasBadge!==void 0?m.hasBadge:c,customBadgeContent:m.customBadgeContent,badgeProps:m.badgeProps,activeItems:g,parentItem:N,itemData:m,icon:m.icon!==void 0?m.icon:h,expandedIcon:m.expandedIcon!==void 0?m.expandedIcon:v,action:m.action,compareItems:I,isCompact:i==="compact"||i==="compactNoBackground",useMemo:f},m.children&&{children:$.createElement(ke,{data:m.children,isNested:!0,parentItem:m,hasCheckboxes:o,hasBadges:c,hasGuides:s,hasSelectableNodes:r,variant:i,allExpanded:l,defaultAllExpanded:d,onSelect:p,onCheck:y,onExpand:_,onCollapse:L,activeItems:g,icon:h,expandedIcon:v})}))}));return $.createElement($.Fragment,null,N?w:$.createElement(Pt,Object.assign({hasSelectableNodes:r,hasCheckboxes:o,hasGuides:s,variant:i,className:T},B),w))};ke.displayName="TreeView";const Wt={name:"TreeIcon",height:512,width:384,svgPath:"M378.31 378.49L298.42 288h30.63c9.01 0 16.98-5 20.78-13.06 3.8-8.04 2.55-17.26-3.28-24.05L268.42 160h28.89c9.1 0 17.3-5.35 20.86-13.61 3.52-8.13 1.86-17.59-4.24-24.08L203.66 4.83c-6.03-6.45-17.28-6.45-23.32 0L70.06 122.31c-6.1 6.49-7.75 15.95-4.24 24.08C69.38 154.65 77.59 160 86.69 160h28.89l-78.14 90.91c-5.81 6.78-7.06 15.99-3.27 24.04C37.97 283 45.93 288 54.95 288h30.63L5.69 378.49c-6 6.79-7.36 16.09-3.56 24.26 3.75 8.05 12 13.25 21.01 13.25H160v24.45l-30.29 48.4c-5.32 10.64 2.42 23.16 14.31 23.16h95.96c11.89 0 19.63-12.52 14.31-23.16L224 440.45V416h136.86c9.01 0 17.26-5.2 21.01-13.25 3.8-8.17 2.44-17.47-3.56-24.26z",yOffset:0,xOffset:0},Qt=it(Wt);var Be=rt(function(a){var e=ot(a);return Ae(e)&&(e=void 0),lt(jt(a,1,Ae,!0),ct(e))});const Jt=()=>{const{t:a}=j(),{clear:e,remove:n,subGroups:o}=te(),{realm:c}=re(),s=oe();return Je(()=>{const{pathname:r}=s;(!r.includes("/groups")||r.endsWith("/groups"))&&e()},[s]),o.length!==0?q(dt,{children:[t(Re,{children:t(ue,{to:`/${c}/groups`,children:a("groups")})},"home"),o.map((r,i)=>{const d=i===o.length-1;return q(Re,{isActive:d,children:[!d&&t(ue,{to:s.pathname.substring(0,s.pathname.indexOf(r.id)+r.id.length),onClick:()=>n(r),children:r.name}),d&&(r.id==="search"?r.name:a("groupDetails"))]},r.id)})]}):null},tt=a=>{const e=a.substring(1).split("/");return e.length>1?e.splice(2):void 0},pe=a=>{const e=tt(a);return e?e[e.length-1]:void 0},Xt=()=>{const{adminClient:a}=P(),{t:e}=j(),{addAlert:n,addError:o}=Y(),c=$e({mode:"onChange"}),s=oe(),r=pe(s.pathname),[i,d]=x();le(()=>a.groups.findOne({id:r}),h=>{c.reset({attributes:Ve(h?.attributes)}),d(h)},[r]);const l=async h=>{try{const k=ut(h).attributes;await a.groups.update({id:r},{...i,attributes:k}),d({...i,attributes:k}),n(e("groupUpdated"),me.success)}catch(k){o("groupUpdateError",k)}};return t(qe,{variant:je.light,children:t(_t,{form:c,save:l,fineGrainedAccess:i?.access?.manage,reset:()=>c.reset({attributes:Ve(i?.attributes)})})})},Yt=({id:a,name:e})=>{const{adminClient:n}=P(),{t:o}=j(),{addAlert:c,addError:s}=Y();return t(Lt,{name:e,id:a,type:"groups",save:async i=>{try{const d=i.filter(l=>l.client===void 0).map(l=>l.role).flat();await n.groups.addRealmRoleMappings({id:a,roles:d}),await Promise.all(i.filter(l=>l.client!==void 0).map(l=>n.groups.addClientRoleMappings({id:a,clientUniqueId:l.client.id,roles:[l.role]}))),c(o("roleMappingUpdatedSuccess"),me.success)}catch(d){s("roleMappingUpdatedError",d)}}})},ee=({id:a,rename:e,duplicateId:n,handleModalToggle:o,refresh:c})=>{const{adminClient:s}=P(),{t:r}=j(),{addAlert:i,addError:d}=Y(),[l,h]=x(null),k=$e({defaultValues:{name:""}}),{handleSubmit:v,formState:N}=k;le(async()=>{if(n)return s.groups.findOne({id:n})},u=>{u&&(h(u),k.reset({name:r("copyOf",{name:u.name})}))},[n]);const p=async u=>{try{const g=[],I=await s.clients.find();for(const T of I){const K=(await s.groups.listClientRoleMappings({id:u,clientUniqueId:T.id})).filter(V=>V.id&&V.name).map(V=>({id:V.id,name:V.name}));K.length>0&&g.push({clientId:T.id,roles:K})}return g}catch(g){throw d("couldNotFetchClientRoleMappings",g),g}},y=async(u,g,I=!1)=>{try{const T={...u,name:I?u.name:r("copyOf",{name:u.name}),...g?{}:{attributes:l?.attributes}};delete T.id;const f=g?await s.groups.createChildGroup({id:g},T):await s.groups.create(T),K=await s.groups.listMembers({id:u.id});for(const A of K)await s.users.addToGroup({id:A.id,groupId:f.id});const V=await s.groups.listPermissions({id:u.id});V&&await s.groups.updatePermission({id:f.id},V);const w=(await s.groups.listRealmRoleMappings({id:u.id})).map(A=>({id:A.id,name:A.name})),b=(await p(u.id))?.flatMap(A=>A.roles.map(F=>({id:F.id,name:F.name,clientUniqueId:A.clientId}))),M=[...w,...b];await _(M,f.id);const O=await s.groups.listSubGroups({parentId:u.id});for(const A of O){const F=A.attributes;await y({...A,attributes:F},f.id,!0)}return f}catch(T){throw d("couldNotDuplicateGroup",T),T}},_=async(u,g)=>{try{const I=u.filter(f=>!f.clientUniqueId&&f.name),T=u.filter(f=>f.clientUniqueId&&f.name);await s.groups.addRealmRoleMappings({id:g,roles:I.map(({id:f,name:K})=>({id:f,name:K}))}),await Promise.all(T.map(f=>f.clientUniqueId&&f.name?s.groups.addClientRoleMappings({id:g,clientUniqueId:f.clientUniqueId,roles:[{id:f.id,name:f.name}]}):Promise.resolve()))}catch(I){d("roleMappingUpdatedError",I)}},L=async u=>{u.name=u.name?.trim();try{n&&l?await y(l):a?e?await s.groups.update({id:a},{...e,name:u.name}):await s.groups.updateChildGroup({id:a},u):await s.groups.create(u),c(e?{...e,name:u.name}:void 0),o(),i(r(e?"groupUpdated":n?"groupDuplicated":"groupCreated"),me.success)}catch(g){d("couldNotCreateGroup",g)}};return t(ze,{variant:He.small,title:r(e?"renameAGroup":n?"duplicateAGroup":"createAGroup"),isOpen:!0,onClose:o,actions:[t(mt,{formState:N,"data-testid":`${e?"rename":n?"duplicate":"create"}Group`,form:"group-form",allowInvalid:!0,allowNonDirty:!0,children:r(e?"rename":n?"duplicate":"create")},"confirm"),t(X,{id:"modal-cancel","data-testid":"cancel",variant:fe.link,onClick:o,children:r("cancel")},"cancel")],children:t(pt,{...k,children:q(ht,{id:"group-form",isHorizontal:!0,onSubmit:v(L),children:[n&&t(gt,{variant:"warning",component:"h2",isInline:!0,title:r("duplicateGroupWarning")}),t(ft,{name:"name",label:r("name"),rules:{required:r("required")},autoFocus:!0})]})})})},Ie=({selectedRows:a,show:e,toggleDialog:n,refresh:o})=>{const{adminClient:c}=P(),{t:s}=j(),{addAlert:r,addError:i}=Y(),d=async()=>{try{for(const l of a)await c.groups.del({id:l.id});o(),r(s("groupDeleted",{count:a.length}))}catch(l){i("groupDeleteError",l)}};return t(Bt,{titleKey:s("deleteConfirmTitle",{count:a.length}),messageKey:s("deleteConfirmGroup",{count:a.length,groupName:a[0]?.name}),continueButtonLabel:"delete",continueButtonVariant:fe.danger,onConfirm:d,open:e,toggleDialog:n})},Zt=({toggleCreate:a,toggleDelete:e,kebabDisabled:n})=>{const{t:o}=j(),{currentGroup:c}=te(),{hasAccess:s}=ce(),r=s("manage-users")||c()?.access?.manage,[i,d]=H();return r?q(Q,{children:[t(Z,{children:t(X,{"data-testid":"openCreateGroupModal",variant:"primary",onClick:a,children:o("createGroup")})}),t(Z,{children:t(be,{onOpenChange:d,toggle:l=>t(ve,{ref:l,isExpanded:i,onClick:d,isDisabled:n,variant:"plain","aria-label":"Actions",children:t(we,{})}),isOpen:i,children:t(ye,{children:t(J,{component:"button",onClick:()=>{e(),d()},children:o("delete")},"action")})})})]}):t("div",{})},ea=(a,e)=>e.id?a.groups.updateRoot(e):a.groups.create(e),ta=async(a,e,n)=>a.groups.updateChildGroup({id:n.id},e),at=({source:a,onClose:e,refresh:n})=>{const{adminClient:o}=P(),{t:c}=j(),{addAlert:s,addError:r}=Y();return t(Kt,{type:"selectOne",filterGroups:[a],text:{title:"moveToGroup",ok:"moveHere"},onClose:e,onConfirm:async d=>{try{await(d?ta(o,a,d[0]):ea(o,a)),n(),s(c("moveGroupSuccess"))}catch(l){r("moveGroupError",l)}},isMove:!0})},Ke=({refresh:a})=>{const{adminClient:e}=P(),{t:n}=j(),[o,c]=x([]),[s,r]=x(),[i,d]=H(),[l,h]=x(),[k,v]=H(),[N,p]=x(),{currentGroup:y}=te(),[_,L]=x(0),u=()=>L(_+1),[g,I]=x(),T=oe(),f=pe(T.pathname),{hasAccess:K}=ce(),V=K("manage-users")||y()?.access?.manage,B=async(w,m)=>{let b;if(f){const M={search:g||"",first:w,max:m,parentId:f};b=await e.groups.listSubGroups(M)}else{const M={search:g||"",first:w||void 0,max:m||void 0};b=await e.groups.find(M)}return b};return q(Q,{children:[t(Ie,{show:k,toggleDialog:v,selectedRows:o,refresh:()=>{u(),a(),c([])}}),s&&t(ee,{id:s.id,rename:s,refresh:()=>{u(),a()},handleModalToggle:()=>r(void 0)}),i&&t(ee,{id:o[0]?.id||f,handleModalToggle:d,refresh:()=>{c([]),u(),a()}}),l&&t(ee,{id:l,duplicateId:l,refresh:()=>{u(),a()},handleModalToggle:()=>h(void 0)}),N&&t(at,{source:N,refresh:()=>{p(void 0),u(),a()},onClose:()=>p(void 0)}),t(Ce,{onSelect:w=>c([...w]),canSelectAll:!0,loader:B,ariaLabelKey:"groups",isPaginated:!0,isSearching:!!g,toolbarItem:q(Q,{children:[t(Z,{children:t(bt,{"data-testid":"group-search",placeholder:n("filterGroups"),value:g,onChange:(w,m)=>{I(m)},onSearch:u,onClear:()=>{I(""),u()}})}),t(Zt,{toggleCreate:d,toggleDelete:v,kebabDisabled:o.length===0})]}),actions:V?[{title:n("rename"),onRowClick:async w=>(r(w),!1)},{title:n("moveTo"),onRowClick:async w=>(p(w),!1)},{title:n("createChildGroup"),onRowClick:async w=>(c([w]),d(),!1)},...f?[]:[{title:n("duplicate"),onRowClick:async w=>(h(w.id),!1)}],{isSeparator:!0},{title:n("delete"),onRowClick:async w=>(c([w]),v(),!0)}]:[],columns:[{name:"name",displayKey:"groupName",cellRenderer:w=>w.access?.view?t(ue,{to:`${T.pathname}/${w.id}`,children:w.name},w.id):t("span",{children:w.name})}],emptyState:t(Ne,{hasIcon:!0,message:n(`noGroupsInThis${f?"SubGroup":"Realm"}`),instructions:n(`noGroupsInThis${f?"SubGroup":"Realm"}Instructions`),primaryActionText:n("createGroup"),onPrimaryAction:d})},`${f}${_}`)]})},aa=({user:a,onClose:e})=>{const{t:n}=j(),{adminClient:o}=P(),[c,s]=x(0),r=()=>s(c+1),[i,d]=x(!0),{enabled:l}=vt(),h=v=>$t(v,N=>N.path?.toUpperCase()),k=async(v,N,p)=>{const y={first:v,max:N},_=p||"";_&&(y.search=_);const L=await o.users.listGroups({...y,id:a.id}),u=[];return i||L.forEach(g=>{const I=(g.path?.substring(1).match(/((~\/)|[^/])+/g)||[]).slice(0,-1);u.push(...I.map(T=>({name:T,path:g.path?.substring(0,g.path.indexOf(T)+T.length)})))}),h(Pe([...L,...u],"path"))};return t(ze,{variant:He.large,title:n("showMembershipsTitle",{username:a.username}),"data-testid":"showMembershipsDialog",isOpen:!0,onClose:e,actions:[t(X,{id:"modal-cancel","data-testid":"cancel",variant:fe.primary,onClick:e,children:n("cancel")},"cancel")],children:t(Ce,{loader:k,className:"keycloak_user-section_groups-table",isPaginated:!0,ariaLabelKey:"roleList",searchPlaceholderKey:"searchGroup",toolbarItem:q(Q,{children:[t(Ge,{label:n("directMembership"),id:"kc-direct-membership-checkbox",onChange:()=>{d(!i),r()},isChecked:i,className:"pf-v5-u-mt-sm"},"direct-membership-check"),l&&t(wt,{"aria-label":"Basic popover",position:"bottom",bodyContent:t("div",{children:n("whoWillAppearPopoverTextUsers")}),children:t(X,{variant:"link",className:"kc-who-will-appear-button",icon:t(qt,{}),children:n("whoWillAppearLinkTextUsers")},"who-will-appear-button")})]}),columns:[{name:"groupMembership",displayKey:"groupMembership",cellRenderer:v=>v.name||"-",transforms:[De(40)]},{name:"path",displayKey:"path",cellRenderer:v=>t(Ft,{group:v}),transforms:[De(45)]}],emptyState:t(Ne,{hasIcon:!0,message:n("noGroupMemberships"),instructions:n("noGroupMembershipsText")})},c)})},na=a=>{const{realm:e}=re(),{t:n}=j();return q(ue,{to:yt({realm:e,id:a.id,tab:"settings"}),children:[a.username," ",!a.enabled&&t(Ct,{color:"red",icon:t(Nt,{}),children:n("disabled")})]},a.id)},sa=()=>{const{adminClient:a}=P(),{t:e}=j(),{addAlert:n,addError:o}=Y(),c=oe(),s=pe(c.pathname),[r,i]=x(!1),{currentGroup:d}=te(),[l,h]=x(),[k,v]=x(!1),[N,p]=x(!1),[y,_]=x([]),[L,u]=x(),[g,I]=H(),{hasAccess:T}=ce();le(()=>a.groups.findOne({id:d().id}),h,[]);const f=T("manage-users")||l?.access.manageMembership,[K,V]=x(0),B=()=>V(new Date().getTime()),w=async(b,M=0)=>{let O=[];if(!M||!b)return O;const A={parentId:b,first:0,max:M},F=await a.groups.listSubGroups(A);return O=O.concat(F),await Promise.all(F.map(z=>w(z.id,z.subGroupCount))).then(z=>{z.forEach(G=>O=O.concat(G))}),O},m=async(b,M)=>{if(!s)return[];let O=await a.groups.listMembers({id:s,briefRepresentation:!0,first:b,max:M});if(r&&l?.subGroupCount&&l.id){const A=await w(l.id,l.subGroupCount);await Promise.all(A.map(F=>a.groups.listMembers({id:F.id,briefRepresentation:!0}))).then(F=>{F.forEach(z=>O=O.concat(z))}),O=Pe(O,F=>F.username)}return O};return l?q(Q,{children:[k&&t(Ut,{membersQuery:(b,M)=>a.groups.listMembers({id:s,first:b,max:M}),onAdd:async b=>{try{await Promise.all(b.map(M=>a.users.addToGroup({id:M.id,groupId:s}))),n(e("usersAdded",{count:b.length}))}catch(M){o("usersAddedError",M)}},onClose:()=>{v(!1),B()}}),g&&t(aa,{onClose:()=>{I()},user:L}),t(Ce,{"data-testid":"members-table",loader:m,ariaLabelKey:"members",isPaginated:!0,canSelectAll:!0,onSelect:b=>_([...b]),toolbarItem:f&&q(Q,{children:[t(Z,{children:t(X,{"data-testid":"addMember",variant:"primary",onClick:()=>v(!0),children:e("addMember")})}),t(Z,{children:t(Ge,{"data-testid":"includeSubGroupsCheck",label:e("includeSubGroups"),id:"kc-include-sub-groups",isChecked:r,onChange:()=>i(!r)})}),t(Z,{children:t(be,{onOpenChange:b=>p(b),toggle:b=>t(ve,{ref:b,variant:"plain",onClick:()=>p(!N),isExpanded:N,isDisabled:y.length===0,"aria-label":"Actions",children:t(we,{})}),shouldFocusToggleOnSelect:!0,isOpen:N,children:t(ye,{children:t(J,{component:"button",onClick:async()=>{try{await Promise.all(y.map(b=>a.users.delFromGroup({id:b.id,groupId:s}))),p(!1),n(e("usersLeft",{count:y.length}))}catch(b){o("usersLeftError",b)}B()},children:e("leave")},"action")})})})]}),actions:[...f?[{title:e("leave"),onRowClick:async b=>{try{await a.users.delFromGroup({id:b.id,groupId:s}),n(e("usersLeft",{count:1}))}catch(M){o("usersLeftError",M)}return!0}}]:[],{title:e("showMemberships"),onRowClick:b=>{u(b),I()}}],columns:[{name:"username",displayKey:"name",cellRenderer:na},{name:"email",displayKey:"email",cellFormatters:[he()]},{name:"firstName",displayKey:"firstName",cellFormatters:[he()]},{name:"lastName",displayKey:"lastName",cellFormatters:[he()]}],emptyState:t(Ne,{message:e("noUsersFound"),instructions:f?e("emptyInstructions"):void 0,primaryActionText:f?e("addMember"):void 0,onPrimaryAction:()=>v(!0),secondaryActions:[{text:e("includeSubGroups"),onClick:()=>i(!0)}]})},`${s}${K}${r}`)]}):t(We,{})};function nt(a){let e=a.length;for(const n of a)n.subGroups&&(e+=nt(n.subGroups));return e}const ia=({group:a,refresh:e})=>{const{t:n}=j(),[o,c]=H(),[s,r]=H(),[i,d]=H(),[l,h]=H(),[k,v]=H(),N=Ee(),{realm:p}=re();return q(Q,{children:[s&&t(ee,{id:a.id,rename:a,refresh:()=>{N(se({realm:p})),e()},handleModalToggle:r}),i&&t(ee,{id:a.id,handleModalToggle:d,refresh:e}),l&&t(at,{source:a,refresh:e,onClose:h}),t(Ie,{show:k,toggleDialog:v,selectedRows:[a],refresh:()=>{N(se({realm:p})),e()}}),t(be,{popperProps:{position:"right"},onOpenChange:c,toggle:y=>t(ve,{ref:y,onClick:c,isExpanded:o,variant:"plain","aria-label":"Actions",children:t(we,{})}),isOpen:o,children:q(ye,{children:[t(J,{onClick:r,children:n("rename")},"rename"),t(J,{onClick:h,children:n("moveTo")},"move"),t(J,{onClick:d,children:n("createChildGroup")},"create"),t(Fe,{},"separator"),t(J,{onClick:v,children:n("delete")},"delete")]})})]})},de=50,ra=()=>{const{t:a}=j();return q(Q,{children:[t(kt,{size:"sm"})," ",a("spinnerLoading")]})},oa=[{name:t(ra,{})}],la=({refresh:a,canViewDetails:e})=>{const{adminClient:n}=P(),{t:o}=j(),{realm:c}=re(),s=Ee(),{addAlert:r}=Y(),{hasAccess:i}=ce(),[d,l]=x(),{subGroups:h,clear:k}=te(),[v,N]=x(""),[p,y]=x(20),[_,L]=x(0),u=Le(0),g=Le(20),[I,T]=x(0),[f,K]=x(!1),[V,B]=x(),[w,m]=x(0),[b,M]=x(0),O=()=>{M(b+1),a()},A=(G,R)=>{const C=G.subGroupCount;return{id:G.id,name:t(Qe,{content:G.name,children:t("span",{children:G.name})}),access:G.access||{},children:C?v.length===0?oa:G.subGroups?.map(S=>A(S,R)):void 0,action:(i("manage-users")||G.access?.manage)&&t(ia,{group:G,refresh:R}),defaultExpanded:h.map(S=>S.id).includes(G.id)}};le(async()=>{const G=await _e(n,"groups",Object.assign({first:`${_}`,max:`${p+1}`,exact:`${f}`,global:`${v!==""}`},v===""?null:{search:v}));let R=[];return V&&(R=await _e(n,`groups/${V.id}/children`,{first:`${w}`,max:`${de}`})),{groups:G,subGroups:R}},({groups:G,subGroups:R})=>{if(V){const C=F(d||[],V.id,[]);if(C.length&&R.length){const S=C.pop();S.children=[...(Be(S.children||[]).splice(0,de),R.map(W=>A(W,O),"id")),...R.length===de?[{id:"next",name:t(X,{variant:"plain",onClick:()=>m(w+de),children:t(Ue,{})})}]:[]]}}v||u.current!==_||g.current!==p?l(G.map(C=>A(C,O))):l(Be(d,G.map(C=>A(C,O)),"id")),T(nt(G)),u.current=_,g.current=p},[b,_,w,p,v,f,V]);const F=(G,R,C)=>{for(let S=0;S<G.length;S++){const W=G[S];if(W.id===R)return C.push(W),C;W.children&&(C.push(W),F(W.children,R,C),C[C.length-1].id!==R&&C.pop())}return C},z=(G,R)=>{if(G.id==="next")return;B(G);const C=F(R,G.id,[]);h.every(({id:S})=>C.find(W=>W.id===S))||k(),e||C.at(-1)?.access?.view||h.at(-1)?.access?.view?s(se({realm:c,id:C.map(S=>S.id).join("/")})):(r(o("noViewRights"),me.warning),s(se({realm:c})))};return d?t(Gt,{count:I,first:_,max:p,onNextClick:L,onPreviousClick:L,onPerPageSelect:(G,R)=>{L(G),y(R)},inputGroupName:"searchForGroups",inputGroupPlaceholder:o("searchForGroups"),inputGroupOnEnter:N,toolbarItem:q(Et,{className:"pf-v5-u-pt-sm",children:[t(Oe,{children:t(Ge,{id:"exact","data-testid":"exact-search",name:"exact",isChecked:f,onChange:(G,R)=>K(R),className:"pf-v5-u-mr-xs"})}),t(Oe,{children:t("label",{htmlFor:"exact",className:"pf-v5-u-pl-sm",children:o("exactSearch")})})]}),children:d.length>0&&t(ke,{data:d.slice(0,p),allExpanded:v.length>0,activeItems:V?[V]:void 0,hasGuides:!0,hasSelectableNodes:!0,className:"keycloak_groups_treeview",onExpand:(G,R)=>{z(R,d)},onSelect:(G,R)=>{z(R,d)}})}):t(We,{})};function Da(){const{adminClient:a}=P(),{t:e}=j(),[n,o]=x(0),{subGroups:c,setSubGroups:s,currentGroup:r}=te(),{realm:i}=re(),[d,l]=x(),[h,k]=H(),v=Ee(),N=oe(),p=pe(N.pathname),[y,_]=H(!0),[L,u]=x(0),g=()=>u(L+1),{hasAccess:I}=ce(),f=It()(St.AdminFineGrainedAuthz)&&I("manage-authorization","manage-users","manage-clients"),K=I("manage-users")||r()?.access?.manage,V=I("manage-users"),B=I("query-groups","view-users")||I("manage-users","query-groups"),w=I("view-users")||r()?.access?.viewMembers||r()?.access?.manageMembers;return le(async()=>{const m=tt(N.pathname);if(m&&m.length>c.length){const M=[];for(const O of m){let A;if(O!=="search"?A=await a.groups.findOne({id:O}):A={name:e("searchGroups"),id:"search"},A)M.push(A);else throw new Error(e("notFound"))}return M}return[]},m=>{m.length&&s(m)},[p]),q(Q,{children:[t(Ie,{show:h,toggleDialog:k,selectedRows:[r()],refresh:()=>{v(se({realm:i})),g()}}),d&&t(ee,{id:p,rename:d,refresh:m=>{g(),s([...c.slice(0,c.length-1),m])},handleModalToggle:()=>l(void 0)}),t(qe,{variant:je.light,className:"pf-v5-u-p-0",children:t(xt,{isInline:!0,isExpanded:y,position:"left",children:t(Mt,{panelContent:t(Tt,{isResizable:!0,children:t(Ye,{children:t(la,{refresh:g,canViewDetails:B})})}),children:q(At,{children:[t(Qe,{content:e(y?"hide":"show"),children:t(X,{"aria-label":e(y?"hide":"show"),variant:"plain",icon:y?t(Rt,{}):t(Qt,{}),onClick:_})}),t(Jt,{}),t(Ot,{titleKey:p?r()?.name:"groups",subKey:p?"":"groupsDescription",helpUrl:p?"":Vt.groupsUrl,divider:!p,dropdownItems:p&&K?[t(J,{"data-testid":"renameGroupAction",onClick:()=>l(r()),children:e("renameGroup")},"renameGroup"),t(J,{"data-testid":"deleteGroup",onClick:k,children:e("deleteGroup")},"deleteGroup")]:void 0}),c.length>0&&q(zt,{inset:{default:"insetNone",md:"insetSm",xl:"insetLg","2xl":"inset2xl"},activeKey:n,onSelect:(m,b)=>o(b),isBox:!0,mountOnEnter:!0,unmountOnExit:!0,children:[t(ae,{"data-testid":"groups",eventKey:0,title:t(ne,{children:e("childGroups")}),children:t(Ke,{refresh:g})}),w&&t(ae,{"data-testid":"members",eventKey:1,title:t(ne,{children:e("members")}),children:t(sa,{})}),t(ae,{"data-testid":"attributes",eventKey:2,title:t(ne,{children:e("attributes")}),children:t(Xt,{})}),V&&t(ae,{eventKey:3,"data-testid":"role-mapping-tab",title:t(ne,{children:e("roleMapping")}),children:t(Yt,{id:p,name:r()?.name})}),f&&t(ae,{eventKey:4,"data-testid":"permissionsTab",title:t(ne,{children:e("permissions")}),children:t(Dt,{id:p,type:"groups"})})]}),c.length===0&&t(Ke,{refresh:g})]})})},L)})]})}export{Da as default};
//# sourceMappingURL=GroupsSection-aPYRqiCg.js.map
