import{jsx as a,jsxs as I,Fragment as B}from"react/jsx-runtime";import{u as G,l as H,b as U,d as R,a as _,V as $,j as z,B as J,q as V,ft as L,K as W,y as Q,D as v,P as X,n as Y,J as D,N as Z,_ as ee,O as ae,c7 as te,c8 as re,aj as oe,A as ne,f as M,o as pe,p as se}from"./main-hjbDDO6j.js";import{useState as y}from"react";import{u as ie}from"./ConfirmDialog-DN_NVsrg.js";import{c as de,D as le}from"./DynamicComponents-2Oogxguf.js";import{F as ce}from"./FormAccess-DEsYjDHG.js";import{V as me}from"./ViewHeader-Dr6ZoEJz.js";import{u as ue}from"./useParams-XtwJXIDJ.js";import"react-dom";import"./ClientSelect-Di5Ep3wz.js";import"./FileUpload-DFzHUp8z.js";import"./CodeEditor-BF8OqNGf.js";import"./copy-icon-ePLWnxgr.js";import"./GroupPickerDialog-CJH5Fdnt.js";import"./DataListItemRow-C-0mzg8R.js";import"./KeySelect-CBdQO7FV.js";import"./MultiLineInput-BKovUfcB.js";import"./AddRoleMappingModal-B-7S42YC.js";import"./translationFormatter-aKDacg4X.js";import"./useLocaleSort-Bon3wgU4.js";import"./filter-icon-I49U7vdU.js";function Ke(){const{adminClient:l}=G(),p=H(),[i,O]=y(),[c,P]=y(),{id:f,mapperId:o}=ue(),m=U(),{realm:g}=R(),{t:e}=_(),{addAlert:h,addError:T}=$(),[k,w]=y(!1),[C,x]=y(0),K=()=>x(C+1);z(async()=>{const r=await l.components.listSubComponents({id:f,type:"org.keycloak.storage.ldap.mappers.LDAPStorageMapper"});if(o&&o!=="new"){const t=await l.components.findOne({id:o});return{components:r,fetchedMapper:t}}return{components:r}},({components:r,fetchedMapper:t})=>{if(O(t),P(r),o!=="new"&&!t)throw new Error(e("notFound"));t&&b(t)},[]);const b=r=>{pe(r,p.setValue)},j=async r=>{const t=se(r),n={...t,config:Object.entries(t.config||{}).reduce((u,[N,S])=>(u[N]=Array.isArray(S)?S:[S],u),{})};try{o==="new"?(await l.components.create(n),m(L({realm:g,id:r.parentId,tab:"mappers"}))):await l.components.update({id:o},n),b(n),h(e(o==="new"?"mappingCreatedSuccess":"mappingUpdatedSuccess"),V.success)}catch(u){T(o==="new"?"mappingCreatedError":"mappingUpdatedError",u)}},F=async r=>{try{const t=await l.userStorageProvider.mappersSync({parentId:i?.parentId||"",id:o,direction:r});h(e("syncLDAPGroupsSuccessful",{result:t.status}))}catch(t){T("syncLDAPGroupsError",t)}K()},[E,q]=ie({titleKey:"deleteMappingTitle",messageKey:"deleteMappingConfirm",continueButtonLabel:"delete",continueButtonVariant:J.danger,onConfirm:async()=>{try{await l.components.del({id:i.id}),h(e("mappingDeletedSuccess"),V.success),m(L({id:f,realm:g,tab:"mappers"}))}catch(r){T("mappingDeletedError",r)}}}),A=W({control:p.control,name:"providerId"});if(!c)return a(Q,{});const d=o==="new",s=c.find(r=>r.id===A);return I(B,{children:[a(q,{}),a(me,{titleKey:i?i.name:e("createNewMapper"),dropdownItems:d?void 0:[a(v,{onClick:E,children:e("delete")},"delete"),...s?.metadata.fedToKeycloakSyncSupported?[a(v,{onClick:()=>F("fedToKeycloak"),children:e(s.metadata.fedToKeycloakSyncMessage)},"fedSync")]:[],...s?.metadata.keycloakToFedSyncSupported?[a(v,{onClick:()=>{F("keycloakToFed")},children:e(s.metadata.keycloakToFedSyncMessage)},"ldapSync")]:[]]},C),a(X,{variant:"light",isFilled:!0,children:a(Y,{...p,children:I(ce,{role:"manage-realm",isHorizontal:!0,onSubmit:p.handleSubmit(()=>j(p.getValues())),children:[!d&&a(D,{name:"id",label:e("id"),isDisabled:!0}),a(D,{name:"name",label:e("name"),labelIcon:e("mapperNameHelp"),isDisabled:!d,rules:{required:e("required")}}),a("input",{type:"hidden",defaultValue:d?f:i?i.parentId:"","data-testid":"ldap-mapper-parentId",...p.register("parentId")}),a("input",{type:"hidden",defaultValue:"org.keycloak.storage.ldap.mappers.LDAPStorageMapper","data-testid":"ldap-mapper-provider-type",...p.register("providerType")}),d?a(Z,{label:e("mapperType"),labelIcon:a(ee,{helpText:s?.helpText?s.helpText:e("mapperTypeHelp"),fieldLabelId:"mapperType"}),fieldId:"kc-providerId",isRequired:!0,children:a(ae,{name:"providerId",defaultValue:"",control:p.control,"data-testid":"ldap-mapper-type-select",render:({field:r})=>a(te,{toggleId:"kc-providerId",typeAheadAriaLabel:e("mapperType"),onToggle:()=>w(!k),isOpen:k,onSelect:t=>{b({providerId:t,...Object.fromEntries(c.find(n=>n.id===t)?.properties.filter(n=>n.type==="List").map(n=>[de(n.name),n.options?.[0]])||[])}),w(!1)},selections:r.value,variant:re.typeahead,"aria-label":e("selectMapperType"),children:c.map(t=>a(oe,{value:t.id,children:t.id},t.id))})})}):a(D,{name:"providerId",label:e("mapperType"),labelIcon:s?.helpText?s.helpText:e("mapperTypeHelp"),rules:{required:e("required")},isDisabled:!d}),!!A&&a(le,{properties:s?.properties}),I(ne,{children:[a(M,{isDisabled:!p.formState.isDirty,variant:"primary",type:"submit","data-testid":"ldap-mapper-save",children:e("save")}),a(M,{variant:"link",onClick:()=>m(d?-1:`/${g}/user-federation/ldap/${i.parentId}/mappers`),"data-testid":"ldap-mapper-cancel",children:e("cancel")})]})]})})})]})}export{Ke as default};
//# sourceMappingURL=LdapMapperDetails-DWXfocbH.js.map
