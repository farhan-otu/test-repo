import{jsxs as u,Fragment as M,jsx as o}from"react/jsx-runtime";import{u as R,a as J,b as Q,V as U,e as W,l as X,j as Y,P as Z,N as $,_ as S,O as ee,c7 as te,c8 as oe,aj as re,n as ce,A as ae,f as g,L as k,f4 as h,q as se}from"./main-hjbDDO6j.js";import{useState as l}from"react";import{D as ie}from"./DynamicComponents-2Oogxguf.js";import{F as ne}from"./FormAccess-DEsYjDHG.js";import{V as le}from"./ViewHeader-Dr6ZoEJz.js";import{u as F}from"./useParams-XtwJXIDJ.js";import"react-dom";import"./ClientSelect-Di5Ep3wz.js";import"./FileUpload-DFzHUp8z.js";import"./CodeEditor-BF8OqNGf.js";import"./copy-icon-ePLWnxgr.js";import"./GroupPickerDialog-CJH5Fdnt.js";import"./DataListItemRow-C-0mzg8R.js";import"./KeySelect-CBdQO7FV.js";import"./MultiLineInput-BKovUfcB.js";import"./AddRoleMappingModal-B-7S42YC.js";import"./translationFormatter-aKDacg4X.js";import"./useLocaleSort-Bon3wgU4.js";import"./ConfirmDialog-DN_NVsrg.js";import"./filter-icon-I49U7vdU.js";const I={config:{},executor:""};function Oe(){const{adminClient:P}=R(),{t:a}=J(),C=Q(),{realm:d,profileName:i}=F(),{executorName:n}=F(),{addAlert:A,addError:N}=U(),[O,T]=l(!1),p=W().componentTypes?.["org.keycloak.services.clientpolicy.executor.ClientPolicyExecutorProvider"],[m,H]=l([]),[j,D]=l([]),[v,G]=l([]),[L,B]=l([]),f=X({defaultValues:I}),{control:w,reset:y,handleSubmit:_}=f,c=!!n,E=e=>{const r=e.find(s=>s.name===i)?.executors?.find(s=>s.executor===n);r&&y({config:r.configuration})};Y(()=>P.clientPolicies.listProfiles({includeGlobalProfiles:!0}),e=>{G(e.globalProfiles),B(e.profiles),E(e.profiles),E(e.globalProfiles)},[]);const q=async()=>{const e=f.getValues(),t=L.map(r=>{if(r.name!==i)return r;const s=(r.executors??[]).concat({executor:e.executor,configuration:e.config||{}});if(c){const V=r.executors.find(K=>K.executor===n);V.configuration={...V.configuration,...e.config}}return c?r:{...r,executors:s}});try{await P.clientPolicies.createProfiles({profiles:t,globalProfiles:v}),A(a(c?"updateExecutorSuccess":"addExecutorSuccess"),se.success),C(h({realm:d,profileName:i}))}catch(r){N(c?"updateExecutorError":"addExecutorError",r)}},x=v.find(e=>e.name===i),b=p?.find(e=>e.id===n),z=b?.properties.map(e=>{const t=c?e.defaultValue:"";return{...e,defaultValue:t}});return u(M,{children:[o(le,{titleKey:c?n:a("addExecutor"),divider:!0}),u(Z,{variant:"light",children:[u(ne,{isHorizontal:!0,role:"manage-realm",className:"pf-v5-u-mt-lg",isReadOnly:!!x,children:[o($,{label:a("executorType"),fieldId:"kc-executorType",labelIcon:m.length>0&&m[0].helpText!==""?o(S,{helpText:m[0].helpText,fieldLabelId:"executorTypeHelpText"}):c?o(S,{helpText:b?.helpText,fieldLabelId:"executorTypeHelpText"}):void 0,children:o(ee,{name:"executor",defaultValue:"",control:w,render:({field:e})=>o(te,{toggleId:"kc-executor",placeholderText:"Select an executor",onToggle:t=>T(t),onSelect:t=>{y({...I,executor:t.toString()});const r=p?.filter(s=>s.id===t);H(r??[]),D(r?.[0].properties??[]),T(!1)},selections:c?n:e.value,variant:oe.single,"data-testid":"executorType-select","aria-label":a("executorType"),isOpen:O,maxHeight:580,isDisabled:c,children:p?.map(t=>o(re,{selected:t.id===e.value,value:t.id,description:t.helpText,children:t.id},t.id))})})}),o(ce,{...f,children:o(ie,{properties:c?z:j})}),!x&&u(ae,{children:[o(g,{variant:"primary",onClick:()=>_(q)(),"data-testid":"addExecutor-saveBtn",children:a(c?"save":"add")}),o(g,{variant:"link",component:e=>o(k,{...e,to:h({realm:d,profileName:i})}),"data-testid":"addExecutor-cancelBtn",children:a("cancel")})]})]}),c&&x&&o("div",{className:"kc-backToProfile",children:o(g,{component:e=>o(k,{...e,to:h({realm:d,profileName:i})}),variant:"primary",children:a("back")})})]})]})}export{Oe as default};
//# sourceMappingURL=ExecutorForm-CaS6osp9.js.map
