import{jsx as e,jsxs as c,Fragment as X}from"react/jsx-runtime";import{ar as Na,eS as Va,as as Oa,eT as Ma,eU as Fa,eV as Ka,eW as Ha,eX as Ga,ej as Ua,eA as ra,eB as Ba,dr as _a,ei as za,eY as $a,eD as ja,eZ as qa,dt as Wa,u as ie,e1 as st,j as Be,a as H,V as Te,l as ve,z as qe,K as Ue,P as re,n as Ke,cw as Ce,J as be,e_ as Pt,N as D,O as G,cW as Vt,X as oa,ct as Ja,bt,e$ as Xa,L as Se,cA as Qa,A as Ie,f as R,q as oe,d as le,y as Je,cL as ca,bD as Ht,bE as gt,a5 as Ya,bF as Et,$ as Ae,_ as F,bT as da,bU as Ne,cM as ht,x as At,o as He,S as ge,M as We,m as Ye,B as ne,G as rt,H as Ve,F as ot,bS as Za,bW as it,a8 as _e,c7 as we,w as ze,aj as ue,ap as ft,b as Ze,aw as Gt,ax as Me,ay as ua,R as vt,h as xe,f0 as Wt,T as ke,f1 as en,f2 as Ot,f3 as tn,f4 as an,e as $e,bY as nn,c8 as Fe,a3 as Jt,a1 as St,eG as ln,d2 as sn,d3 as rn,I as Ut,f5 as ct,ak as on,b$ as Bt,C as cn,f6 as Xt,bm as ma,ah as pa,bw as ha,bn as fa,D as nt,by as dt,bx as je,eQ as Mt,eR as _t,a6 as ba,cd as dn,ce as un,cf as Qt,cg as ga,f7 as mn,f8 as Ee,U as et,W as Xe,f9 as Oe,fa as wt,av as pn,c1 as hn,c2 as fn,c3 as Yt,c4 as ut,c5 as bn,c6 as mt,fb as gn,d8 as vn,er as yn,cG as Zt,Q as xt,fc as ea,fd as Tn,a7 as Cn,dB as Sn,fe as kn,ff as ta,fg as aa,dk as Dt,bl as na,dc as In,al as Ln,p as Pn,s as En,cI as An,v as wn}from"./main-hjbDDO6j.js";import xn,{useState as h,useEffect as Le,useMemo as Qe}from"react";import{u as ye}from"./ConfirmDialog-DN_NVsrg.js";import{R as yt,u as Tt}from"./RoutableTabs-ChOqIl6o.js";import{V as Dn}from"./ViewHeader-Dr6ZoEJz.js";import{u as zt}from"./useLocale-BtoaQcMD.js";import{F as te,C as Rn,a as Nn}from"./FormAccess-DEsYjDHG.js";/* empty css                               */import{a as Rt}from"./KeySelect-CBdQO7FV.js";import{U as tt}from"./userProfileMetadata-CFgHgJ2w.js";import{D as lt}from"./SwitchControl-C_wbgFy3.js";import{K as Vn}from"./KeyValueInput-BjiKJH0l.js";import{J as On}from"./JsonFileUpload-D9OTErpO.js";import{d as va,D as ya,a as Ta,b as Ca,c as Ft}from"./DataListItemRow-C-0mzg8R.js";import{t as Sa}from"./translationFormatter-aKDacg4X.js";import{b as Mn}from"./_baseSlice-F8doVSIJ.js";import{b as Fn}from"./_baseFlatten-DK0O-V_R.js";import{C as $t,L as jt}from"./CodeEditor-BF8OqNGf.js";import{T as Z,t as Kn}from"./TimeSelector-C-6T-B4N.js";import{R as Hn}from"./AddRoleMappingModal-B-7S42YC.js";import{G as Gn}from"./GroupPickerDialog-CJH5Fdnt.js";import{T as Ct}from"./Trans-BCvPJnzT.js";import{Q as Un}from"./question-circle-icon-BckMEuvu.js";import{T as kt,a as $,b as j}from"./Tabs-TiG_cKa2.js";import{T as ka}from"./TimeSelectorControl-BNkqjzSp.js";import{i as Ia}from"./isEqual-DwRuOUtl.js";import{u as Bn}from"./useFormatDate-DtCZfuLt.js";import{F as La}from"./filter-icon-I49U7vdU.js";import{D as Pa}from"./DraggableTable-B1QRalkE.js";import{KeyProviderForm as _n}from"./KeyProviderForm-C2YksKGm.js";import{D as zn}from"./DropdownPanel-D_qgc_Fl.js";import{u as $n,m as jn}from"./useLocaleSort-Bon3wgU4.js";import{p as qn}from"./pickBy-DbcNzVCB.js";import{P as Wn}from"./pencil-alt-icon-1xnl9kKm.js";import{u as qt,U as Jn}from"./UserProfileContext-knLEppNh.js";import"react-dom";import"./PageHandler-Dm6Ir_Zl.js";import"./DynamicComponents-2Oogxguf.js";import"./ClientSelect-Di5Ep3wz.js";import"./FileUpload-DFzHUp8z.js";import"./MultiLineInput-BKovUfcB.js";import"./useParams-XtwJXIDJ.js";import"./constants-BclHbWtx.js";import"./copy-icon-ePLWnxgr.js";import"./FileUploadForm-CQxs07NG.js";const Kt=l=>{var{children:n,className:a,label:t}=l,i=Na(l,["children","className","label"]);return xn.createElement(Va,Object.assign({className:Oa(a),label:t},i),n)};Kt.displayName="SelectGroup";function Xn(l){var n=l==null?0:l.length;return n?Fn(l):[]}function Qn(l){return Ma(Fa(l,void 0,Xn),l+"")}var Yn="[object Object]",Zn=Function.prototype,el=Object.prototype,Ea=Zn.toString,tl=el.hasOwnProperty,al=Ea.call(Object);function nl(l){if(!Ka(l)||Ha(l)!=Yn)return!1;var n=Ga(l);if(n===null)return!0;var a=tl.call(n,"constructor")&&n.constructor;return typeof a=="function"&&a instanceof a&&Ea.call(a)==al}function ll(l,n){return n.length<2?l:Ua(l,Mn(n,0,-1))}function il(l,n){return n=ra(n,l),l=ll(l,n),l==null||delete l[Ba(_a(n))]}function sl(l){return nl(l)?void 0:l}var rl=1,ol=2,cl=4,Aa=Qn(function(l,n){var a={};if(l==null)return a;var t=!1;n=za(n,function(s){return s=ra(s,l),t||(t=s.length>1),s}),$a(l,ja(l),a),t&&(a=qa(a,rl|ol|cl,sl));for(var i=n.length;i--;)il(a,n[i]);return a});function dl(l,n){return n=typeof n=="function"?n:void 0,l&&l.length?Wa(l,void 0,n):[]}function ul(){const{adminClient:l}=ie(),{whoAmI:n}=st(),[a,t]=h(),i=n.getUserId();return Be(()=>l.users.findOne({id:i}),t,[i]),{...a,realm:n.getRealm()}}const ml=({realm:l,save:n})=>{const{adminClient:a}=ie(),{t}=H(),{addAlert:i,addError:s}=Te(),u=ul(),d=ve({defaultValues:l}),{control:m,handleSubmit:o,watch:p,reset:A,getValues:C}=d,N=()=>A(l),S=p("smtpServer.from",""),f=p("smtpServer.host",""),[r,w]=qe(),x=Ue({control:m,name:"smtpServer.auth",defaultValue:""}),v=async()=>{const g=I=>Number(I),O=I=>I==="true",k=new Map([["port",g],["ssl",O],["starttls",O],["auth",O]]),E={...C().smtpServer};for(const[I,B]of k.entries())E[I]=B(E[I]);E.port===0&&(E.port=null);try{w(),await a.realms.testSMTPConnection({realm:l.realm},E),i(t("testConnectionSuccess"),oe.success)}catch(I){s("testConnectionError",I)}w()};return e(re,{variant:"light",children:c(Ke,{...d,children:[e(Ce,{title:t("template"),className:"kc-email-template",children:c(te,{isHorizontal:!0,role:"manage-realm",className:"pf-v5-u-mt-lg",onSubmit:o(n),children:[e(be,{name:"smtpServer.from",label:t("from"),type:"email",placeholder:t("smtpFromPlaceholder"),rules:{pattern:{value:Pt,message:t("emailInvalid")},required:t("required")}}),e(be,{name:"smtpServer.fromDisplayName",label:t("fromDisplayName"),labelIcon:t("fromDisplayNameHelp"),placeholder:t("smtpFromDisplayPlaceholder")}),e(be,{name:"smtpServer.replyTo",label:t("replyTo"),type:"email",placeholder:t("replyToEmailPlaceholder"),rules:{pattern:{value:Pt,message:t("emailInvalid")}}}),e(be,{name:"smtpServer.replyToDisplayName",label:t("replyToDisplayName"),labelIcon:t("replyToDisplayNameHelp"),placeholder:t("replyToDisplayPlaceholder")}),e(be,{name:"smtpServer.envelopeFrom",label:t("envelopeFrom"),labelIcon:t("envelopeFromHelp"),placeholder:t("senderEnvelopePlaceholder")})]})}),e(Ce,{className:"kc-email-connection",title:t("connectionAndAuthentication"),children:c(te,{isHorizontal:!0,role:"manage-realm",className:"pf-v5-u-mt-lg",onSubmit:o(n),children:[e(be,{name:"smtpServer.host",label:t("host"),rules:{required:t("required")}}),e(be,{name:"smtpServer.port",label:t("port"),placeholder:t("smtpPortPlaceholder")}),c(D,{label:t("encryption"),fieldId:"kc-html-display-name",children:[e(G,{name:"smtpServer.ssl",control:m,defaultValue:"false",render:({field:g})=>e(Vt,{id:"kc-enable-ssl","data-testid":"enable-ssl",label:t("enableSSL"),isChecked:g.value==="true",onChange:(O,k)=>g.onChange(""+k)})}),e(G,{name:"smtpServer.starttls",control:m,defaultValue:"false",render:({field:g})=>e(Vt,{id:"kc-enable-start-tls","data-testid":"enable-start-tls",label:t("enableStartTLS"),isChecked:g.value==="true",onChange:(O,k)=>g.onChange(""+k)})})]}),e(oa,{name:"smtpServer.auth",label:t("authentication"),defaultValue:"",labelOn:t("enabled"),labelOff:t("disabled"),stringify:!0}),x==="true"&&c(X,{children:[e(be,{name:"smtpServer.user",label:t("username"),placeholder:t("loginUsernamePlaceholder"),rules:{required:t("required")}}),e(Ja,{name:"smtpServer.password",label:t("password"),labelIcon:t("passwordHelp"),rules:{required:t("required")}})]}),u&&e(D,{id:"descriptionTestConnection",children:u.email?e(bt,{variant:"info",component:"h2",isInline:!0,title:t("testConnectionHint.withEmail",{email:u.email})}):e(bt,{variant:"warning",component:"h2",isInline:!0,title:t("testConnectionHint.withoutEmail",{userName:u.username}),actionLinks:e(Xa,{component:g=>e(Se,{...g,to:Qa({realm:u.realm,id:u.id,tab:"settings"})}),children:t("testConnectionHint.withoutEmailAction")})})}),c(Ie,{children:[e(Rt,{children:e(R,{variant:"primary",type:"submit","data-testid":"email-tab-save",children:t("save")})}),e(Rt,{children:e(R,{variant:"secondary",onClick:()=>v(),"data-testid":"test-connection-button",isDisabled:!(Pt.test(S)&&f)||!u?.email,"aria-describedby":"descriptionTestConnection",isLoading:r,spinnerAriaValueText:t("testingConnection"),children:t("testConnection")})}),e(Rt,{children:e(R,{variant:"link",onClick:N,"data-testid":"email-tab-revert",children:t("revert")})})]})]})})]})})},pl=({realm:l,save:n})=>{const{adminClient:a}=ie(),{realm:t}=le(),[i,s]=h();return Be(()=>a.users.getProfile({realm:t}),u=>s(u),[]),i?e(fl,{realm:l,save:n,userProfileConfig:i}):e(Je,{})},hl=["all","external","none"],Nt=[tt.Disabled,tt.Enabled,tt.AdminView,tt.AdminEdit];function fl({realm:l,save:n,userProfileConfig:a}){const{environment:{serverBaseUrl:t}}=ca(),{t:i}=H(),{realm:s}=le(),u=ve(),{control:d,handleSubmit:m,setValue:o,formState:{errors:p}}=u,A=Ht(),C=A(gt.Organizations),N=A(gt.OpenId4VCI),S=()=>{if(He(l,o),o("unmanagedAttributePolicy",a.unmanagedAttributePolicy||Nt[0]),l.attributes?.["acr.loa.map"]){const r=Object.entries(JSON.parse(l.attributes["acr.loa.map"])).flatMap(([w,x])=>({key:w,value:x}));r.concat({key:"",value:""}),o(Et("attributes.acr.loa.map"),r)}};Le(S,[]);const f=m(async({unmanagedAttributePolicy:r,...w})=>{const x={...a};r===tt.Disabled?delete x.unmanagedAttributePolicy:x.unmanagedAttributePolicy=r,await n({...w,upConfig:x})});return e(re,{variant:"light",children:e(Ke,{...u,children:c(te,{isHorizontal:!0,role:"manage-realm",className:"pf-u-mt-lg",onSubmit:f,children:[c(D,{label:i("realmName"),fieldId:"kc-realm-id",isRequired:!0,children:[e(G,{name:"realm",control:d,rules:{required:{value:!0,message:i("required")}},defaultValue:"",render:({field:r})=>e(Rn,{"data-testid":"realmName",onChange:r.onChange,children:r.value})}),p.realm&&e(Ya,{"data-testid":"realm-id-error",message:p.realm.message})]}),e(be,{name:"displayName",label:i("displayName")}),e(be,{name:"displayNameHtml",label:i("htmlDisplayName")}),e(be,{name:Et("attributes.frontendUrl"),type:"url",label:i("frontendUrl"),labelIcon:i("frontendUrlHelp")}),e(Ae,{name:"sslRequired",label:i("requireSsl"),labelIcon:i("requireSslHelp"),controller:{defaultValue:"none"},options:hl.map(r=>({key:r,value:i(`sslType.${r}`)}))}),e(D,{label:i("acrToLoAMapping"),fieldId:"acrToLoAMapping",labelIcon:e(F,{helpText:i("acrToLoAMappingHelp"),fieldLabelId:"acrToLoAMapping"}),children:e(Vn,{label:i("acrToLoAMapping"),name:Et("attributes.acr.loa.map")})}),e(lt,{name:"userManagedAccessAllowed",label:i("userManagedAccess"),labelIcon:i("userManagedAccessHelp")}),C&&e(lt,{name:"organizationsEnabled",label:i("organizationsEnabled"),labelIcon:i("organizationsEnabledHelp")}),N&&e(lt,{name:"verifiableCredentialsEnabled",label:i("verifiableCredentialsEnabled"),labelIcon:i("verifiableCredentialsEnabledHelp")}),e(Ae,{name:"unmanagedAttributePolicy",label:i("unmanagedAttributes"),labelIcon:i("unmanagedAttributesHelpText"),controller:{defaultValue:Nt[0]},options:Nt.map(r=>({key:r,value:i(`unmanagedAttributePolicy.${r}`)}))}),e(D,{label:i("endpoints"),labelIcon:e(F,{helpText:i("endpointsHelp"),fieldLabelId:"endpoints"}),fieldId:"kc-endpoints",children:c(da,{children:[e(Ne,{children:e(ht,{href:`${At(t)}realms/${s}/.well-known/openid-configuration`,title:i("openIDEndpointConfiguration")})}),e(Ne,{children:e(ht,{href:`${At(t)}realms/${s}/protocol/saml/descriptor`,title:i("samlIdentityProviderMetadata")})}),N&&l.verifiableCredentialsEnabled&&e(Ne,{children:e(ht,{href:`${At(t)}realms/${s}/.well-known/openid-credential-issuer`,title:i("oid4vcIssuerMetadata")})})]})}),e(Nn,{name:"realmSettingsGeneralTab",reset:S,isSubmit:!0})]})})})}const bl=({realm:l,refresh:n})=>{const{adminClient:a}=ie(),{t}=H(),{addAlert:i,addError:s}=Te(),{realm:u}=le(),d=async m=>{const o=Array.isArray(m)?Object.keys(m[0])[0]:Object.keys(m)[0];try{await a.realms.update({realm:u},Array.isArray(m)?m.reduce((p,A)=>Object.assign(p,A),l):Object.assign(l,m)),i(t("enableSwitchSuccess",{switch:t(o)})),n()}catch(p){s("enableSwitchError",p)}};return c(re,{variant:"light",children:[e(Ce,{className:"kc-login-screen",title:t("loginScreenCustomization"),children:c(te,{isHorizontal:!0,role:"manage-realm",children:[e(D,{label:t("registrationAllowed"),fieldId:"kc-user-reg",labelIcon:e(F,{helpText:t("userRegistrationHelpText"),fieldLabelId:"registrationAllowed"}),hasNoPaddingTop:!0,children:e(ge,{id:"kc-user-reg-switch","data-testid":"user-reg-switch",value:l.registrationAllowed?"on":"off",label:t("on"),labelOff:t("off"),isChecked:l.registrationAllowed,onChange:(m,o)=>{d({registrationAllowed:o})},"aria-label":t("registrationAllowed")})}),e(D,{label:t("resetPasswordAllowed"),fieldId:"kc-forgot-pw",labelIcon:e(F,{helpText:t("forgotPasswordHelpText"),fieldLabelId:"resetPasswordAllowed"}),hasNoPaddingTop:!0,children:e(ge,{id:"kc-forgot-pw-switch","data-testid":"forgot-pw-switch",name:"resetPasswordAllowed",value:l.resetPasswordAllowed?"on":"off",label:t("on"),labelOff:t("off"),isChecked:l.resetPasswordAllowed,onChange:(m,o)=>{d({resetPasswordAllowed:o})},"aria-label":t("resetPasswordAllowed")})}),e(D,{label:t("rememberMe"),fieldId:"kc-remember-me",labelIcon:e(F,{helpText:t("rememberMeHelpText"),fieldLabelId:"rememberMe"}),hasNoPaddingTop:!0,children:e(ge,{id:"kc-remember-me-switch","data-testid":"remember-me-switch",value:l.rememberMe?"on":"off",label:t("on"),labelOff:t("off"),isChecked:l.rememberMe,onChange:(m,o)=>{d({rememberMe:o})},"aria-label":t("rememberMe")})})]})}),e(Ce,{className:"kc-email-settings",title:t("emailSettings"),children:c(te,{isHorizontal:!0,role:"manage-realm",children:[e(D,{label:t("registrationEmailAsUsername"),fieldId:"kc-email-as-username",labelIcon:e(F,{helpText:t("emailAsUsernameHelpText"),fieldLabelId:"registrationEmailAsUsername"}),hasNoPaddingTop:!0,children:e(ge,{id:"kc-email-as-username-switch","data-testid":"email-as-username-switch",value:l.registrationEmailAsUsername?"on":"off",label:t("on"),labelOff:t("off"),isChecked:l.registrationEmailAsUsername,onChange:(m,o)=>{d([{registrationEmailAsUsername:o},{duplicateEmailsAllowed:!1}])},"aria-label":t("registrationEmailAsUsername")})}),e(D,{label:t("loginWithEmailAllowed"),fieldId:"kc-login-with-email",labelIcon:e(F,{helpText:t("loginWithEmailHelpText"),fieldLabelId:"loginWithEmailAllowed"}),hasNoPaddingTop:!0,children:e(ge,{id:"kc-login-with-email-switch","data-testid":"login-with-email-switch",value:l.loginWithEmailAllowed?"on":"off",label:t("on"),labelOff:t("off"),isChecked:l.loginWithEmailAllowed,onChange:(m,o)=>{d([{loginWithEmailAllowed:o},{duplicateEmailsAllowed:!1}])},"aria-label":t("loginWithEmailAllowed")})}),e(D,{label:t("duplicateEmailsAllowed"),fieldId:"kc-duplicate-emails",labelIcon:e(F,{helpText:t("duplicateEmailsHelpText"),fieldLabelId:"duplicateEmailsAllowed"}),hasNoPaddingTop:!0,children:e(ge,{id:"kc-duplicate-emails-switch","data-testid":"duplicate-emails-switch",label:t("on"),labelOff:t("off"),isChecked:l.duplicateEmailsAllowed,onChange:(m,o)=>{d({duplicateEmailsAllowed:o})},isDisabled:l.loginWithEmailAllowed||l.registrationEmailAsUsername,"aria-label":t("duplicateEmailsAllowed")})}),e(D,{label:t("verifyEmail"),fieldId:"kc-verify-email",labelIcon:e(F,{helpText:t("verifyEmailHelpText"),fieldLabelId:"verifyEmail"}),hasNoPaddingTop:!0,children:e(ge,{id:"kc-verify-email-switch","data-testid":"verify-email-switch",name:"verifyEmail",value:l.verifyEmail?"on":"off",label:t("on"),labelOff:t("off"),isChecked:l.verifyEmail,onChange:(m,o)=>{d({verifyEmail:o})},"aria-label":t("verifyEmail")})})]})}),e(Ce,{className:"kc-user-info-settings",title:t("userInfoSettings"),children:e(te,{isHorizontal:!0,role:"manage-realm",children:e(D,{label:t("editUsernameAllowed"),fieldId:"kc-edit-username",labelIcon:e(F,{helpText:t("editUsernameHelp"),fieldLabelId:"editUsernameAllowed"}),hasNoPaddingTop:!0,children:e(ge,{id:"kc-edit-username-switch","data-testid":"edit-username-switch",value:l.editUsernameAllowed?"on":"off",label:t("on"),labelOff:t("off"),isChecked:l.editUsernameAllowed,onChange:(m,o)=>{d({editUsernameAllowed:o})},"aria-label":t("editUsernameAllowed")})})})})]})},gl=({isOpen:l,onClose:n})=>{const{adminClient:a}=ie(),{t}=H(),{realm:i}=le(),{addAlert:s,addError:u}=Te(),[d,m]=h(!1),[o,p]=h(!1),[A,C]=h(!1),N=d||o;async function S(){C(!0);try{const f=await a.realms.export({realm:i,exportClients:o,exportGroupsAndRoles:d});Za.saveAs(new Blob([it(f)],{type:"application/json"}),"realm-export.json"),s(t("exportSuccess"),oe.success),n()}catch(f){u("exportFail",f)}C(!1)}return c(We,{variant:Ye.small,title:t("partialExport"),isOpen:l,onClose:n,actions:[e(R,{"data-testid":"export-button",isDisabled:A,onClick:S,children:t("export")},"export"),e(R,{"data-testid":"cancel-button",variant:ne.link,onClick:n,children:t("cancel")},"cancel")],children:[e(rt,{children:e(Ve,{children:t("partialExportHeaderText")})}),c(ot,{isHorizontal:!0,className:"keycloak__realm-settings__partial-import_form",children:[e(D,{label:t("includeGroupsAndRoles"),fieldId:"include-groups-and-roles-check",hasNoPaddingTop:!0,children:e(ge,{id:"include-groups-and-roles-check","data-testid":"include-groups-and-roles-check",isChecked:d,onChange:(f,r)=>m(r),label:t("on"),labelOff:t("off"),"aria-label":t("includeGroupsAndRoles")})}),e(D,{label:t("includeClients"),fieldId:"include-clients-check",hasNoPaddingTop:!0,children:e(ge,{id:"include-clients-check","data-testid":"include-clients-check",onChange:(f,r)=>p(r),isChecked:o,label:t("on"),labelOff:t("off"),"aria-label":t("includeClients")})})]}),N&&e(bt,{"data-testid":"warning-message",variant:"warning",component:"p",title:t("exportWarningTitle"),isInline:!0,children:t("exportWarningDescription")})]})},la={users:!1,clients:!1,groups:!1,identityProviders:!1,realmRoles:!1,clientRoles:!1},vl=l=>{const{adminClient:n}=ie(),{t:a}=H(),{realm:t}=le(),[i,s]=h(),u=!!i,[d,m]=h(!1),[o,p]=h(!1),[A,C]=h(!1),[N,S]=h("FAIL"),[f,r]=h({}),[w,x]=h(),{addError:v}=Te(),[g,O]=h(la),k=Object.values(g).some(y=>y),E=()=>{O(la)},I=()=>{s(void 0),r({}),S("FAIL"),E()};Le(()=>{C(!1),x(void 0),I()},[l.open]);const B=y=>{I(),s(y),Array.isArray(y)?y.length>0&&r(y[0]):r(y)},b=y=>{r(y),m(!1),E()},L=(y,ee)=>{const De=ee.currentTarget.name;O({...g,[De]:y})},V=y=>y.map(ee=>e(ue,{value:ee,"data-testid":ee.id+"-select-option",children:ee.realm||ee.id},ee.id)),_=y=>{S(y),p(!1)},J=()=>[e(ue,{value:"FAIL",children:a("FAIL")},"fail"),e(ue,{value:"SKIP",children:a("SKIP")},"skip"),e(ue,{value:"OVERWRITE",children:a("OVERWRITE")},"overwrite")],U=()=>q("users")||q("groups")||q("clients")||q("identityProviders")||se()||ae(),q=y=>{const ee=f[y];return ee!==void 0&&ee.length>0},se=()=>{const y=f.roles?.realm;return y!==void 0&&y.length>0},ae=()=>{const y=f.roles?.client;return y!==void 0&&Object.keys(y).length>0},pe=y=>u?y==="realmRoles"?f.roles?.realm?.length??0:y==="clientRoles"?ae()?he(f.roles.client):0:f[y]?.length??0:0,he=y=>Object.values(y).reduce((ee,De)=>ee+De.length,0),de=(y,ee)=>e(ya,{"aria-labelledby":`${y}-list-item`,children:e(Ta,{children:e(Ca,{dataListCells:[e(Ft,{children:e(Vt,{id:`${y}-checkbox`,label:`${pe(y)} ${ee}`,"aria-labelledby":`${y}-checkbox`,name:y,isChecked:g[y],onChange:(De,It)=>L(It,De),"data-testid":y+"-checkbox"})},y)]})})}),fe=()=>{const y={ifResourceExists:N,id:f.id,realm:f.realm};return g.users&&(y.users=f.users),g.groups&&(y.groups=f.groups),g.identityProviders&&(y.identityProviders=f.identityProviders),g.clients&&(y.clients=f.clients),(g.realmRoles||g.clientRoles)&&(y.roles=f.roles,g.realmRoles||delete y.roles?.realm,g.clientRoles||delete y.roles?.client),y};async function T(){if(!A){C(!0);try{const y=await n.realms.partialImport({realm:t,rep:fe()});x(y)}catch(y){v("importFail",y)}C(!1)}}const P=()=>e(We,{variant:Ye.medium,title:a("partialImport"),isOpen:l.open,onClose:l.toggleDialog,actions:[e(R,{id:"modal-import","data-testid":"import-button",isDisabled:!k,onClick:()=>{T()},children:a("import")},"import"),e(R,{id:"modal-cancel","data-testid":"cancel-button",variant:ne.link,onClick:()=>{l.toggleDialog()},children:a("cancel")},"cancel")],children:c(da,{hasGutter:!0,children:[e(Ne,{children:e(rt,{children:e(Ve,{children:a("partialImportHeaderText")})})}),e(Ne,{children:e(On,{id:"partial-import-file",allowEditingUploadedText:!0,onChange:B})}),u&&U()&&c(X,{children:[e(Ne,{children:e(_e,{})}),Array.isArray(i)&&i.length>1&&c(Ne,{children:[c(Ve,{children:[a("selectRealm"),":"]}),e(we,{toggleId:"realm-selector",isOpen:d,typeAheadAriaLabel:a("realmSelector"),"aria-label":a("realmSelector"),onToggle:()=>m(!d),selections:f.id,onSelect:y=>b(y),placeholderText:f.realm||f.id,children:V(i)})]}),c(Ne,{children:[c(Ve,{children:[a("chooseResources"),":"]}),c(va,{"aria-label":a("resourcesToImport"),isCompact:!0,children:[q("users")&&de("users",a("users")),q("groups")&&de("groups",a("groups")),q("clients")&&de("clients",a("clients")),q("identityProviders")&&de("identityProviders",a("identityProviders")),se()&&de("realmRoles",a("realmRoles")),ae()&&de("clientRoles",a("clientRoles"))]})]}),c(Ne,{children:[c(Ve,{children:[a("selectIfResourceExists"),":"]}),e(we,{isOpen:o,direction:"up",onToggle:()=>{p(!o)},selections:N,onSelect:_,placeholderText:a(N),children:J()})]})]})]})}),K=()=>`${a("importAdded",{count:w?.added})}  ${a("importSkipped",{count:w?.skipped})} ${a("importOverwritten",{count:w?.overwritten})}`,Q=async(y=0,ee=15)=>{if(!w)return[];const De=Math.min(y+ee,w.results.length);return w.results.slice(y,De)},W=y=>{switch(y.action){case"ADDED":return e(ft,{color:"green",children:a("added")},y.id);case"SKIPPED":return e(ft,{color:"orange",children:a("skipped")},y.id);case"OVERWRITTEN":return e(ft,{color:"purple",children:a("overwritten")},y.id);default:return""}},me=y=>{const ee=new Map([["CLIENT",a("clients")],["REALM_ROLE",a("realmRoles")],["USER",a("users")],["CLIENT_ROLE",a("clientRoles")],["IDP",a("identityProviders")],["GROUP",a("groups")]]);return e("span",{children:ee.get(y.resourceType)})},Pe=()=>c(We,{variant:Ye.medium,title:a("partialImport"),isOpen:l.open,onClose:l.toggleDialog,actions:[e(R,{id:"modal-close","data-testid":"close-button",variant:ne.primary,onClick:()=>{l.toggleDialog()},children:a("close")},"close")],children:[e(bt,{variant:"success",component:"p",isInline:!0,title:K()}),e(ze,{loader:Q,isPaginated:!0,ariaLabelKey:"partialImport",columns:[{name:"action",displayKey:"action",cellRenderer:W},{name:"resourceType",displayKey:"type",cellRenderer:me},{name:"resourceName",displayKey:"name"},{name:"id",displayKey:"id"}]})]});return w?Pe():P()},yl=()=>{const{adminClient:l}=ie(),{t:n}=H(),{addAlert:a,addError:t}=Te(),{realm:i}=le(),s=Ze(),[u,d]=h(!1),[m,o]=h(),[p,A]=h(),[C,N]=h(0),[S,f]=h(),[r,w]=h(),x=()=>N(C+1),v=ve({mode:"onChange"});Be(()=>l.clientPolicies.listPolicies({includeGlobalPolicies:!0}),b=>{const L=b.globalPolicies?.map(J=>({...J,global:!0})),V=b.policies?.map(J=>({...J,global:!1})),_=L?.concat(V??[]);o(_),w(_||[]),f(it(_))},[C]);const g=async()=>m??[],O=async()=>{const b=v.getValues(),L=m?.filter(V=>!V.global).map(V=>{const _=b[V.name],J={...V,enabled:_};return delete J.global,J});try{await l.clientPolicies.updatePolicy({policies:L}),s(Ot({realm:i,tab:"policies"})),a(n("updateClientPolicySuccess"),oe.success)}catch(V){t("updateClientPolicyError",V)}},k=b=>Aa(b,"global"),E=async()=>{if(S)try{const b=JSON.parse(S),L=b.filter(_=>!_.global).map(_=>k(_)),V=b.filter(_=>_.global).map(_=>k(_));try{await l.clientPolicies.updatePolicy({policies:L,globalPolicies:V}),a(n("updateClientPoliciesSuccess"),oe.success),x()}catch(_){t("updateClientPoliciesError",_)}}catch(b){console.warn("Invalid json, ignoring value using {}"),t("invalidJsonClientPoliciesError",b)}},[I,B]=ye({titleKey:n("deleteClientPolicyConfirmTitle"),messageKey:n("deleteClientPolicyConfirm",{policyName:p?.name}),continueButtonLabel:n("delete"),continueButtonVariant:ne.danger,onConfirm:async()=>{const b=m?.filter(L=>!L.global&&L.name!==p?.name).map(L=>{const V={...L};return delete V.global,V});try{await l.clientPolicies.updatePolicy({policies:b}),a(n("deleteClientPolicySuccess"),oe.success),x()}catch(L){t("deleteClientPolicyError",L)}}});return m?c(X,{children:[e(B,{}),e(re,{children:c(Gt,{className:"kc-policies-config-section",children:[e(Me,{children:e(ua,{headingLevel:"h1",size:"md",children:n("policiesConfigType")})}),e(Me,{children:e(vt,{isChecked:!u,name:"policiesView",onChange:()=>d(!1),label:n("policiesConfigTypes.formView"),id:"formView-policiesView","data-testid":"formView-policiesView",className:"kc-form-radio-btn pf-v5-u-mr-sm pf-v5-u-ml-sm"})}),e(Me,{children:e(vt,{isChecked:u,name:"policiesView",onChange:()=>d(!0),label:n("policiesConfigTypes.jsonEditor"),id:"jsonEditor-policiesView","data-testid":"jsonEditor-policiesView",className:"kc-editor-radio-btn"})})]})}),e(_e,{}),u?c(X,{children:[e("div",{className:"pf-v5-u-mt-md pf-v5-u-ml-lg",children:e($t,{isLineNumbersVisible:!0,isLanguageLabelVisible:!0,isReadOnly:!1,code:S,language:jt.json,height:"30rem",onChange:f})}),c("div",{className:"pf-v5-u-mt-md",children:[e(R,{variant:ne.primary,className:"pf-v5-u-mr-md pf-v5-u-ml-lg","data-testid":"jsonEditor-policies-saveBtn",onClick:E,children:n("save")}),e(R,{variant:ne.link,"data-testid":"jsonEditor-reloadBtn",onClick:()=>{f(it(r))},children:n("reload")})]})]}):e(ze,{emptyState:e(xe,{message:n("noClientPolicies"),instructions:n("noClientPoliciesInstructions"),primaryActionText:n("createClientPolicy"),onPrimaryAction:()=>s(Wt({realm:i}))}),ariaLabelKey:"clientPolicies",searchPlaceholderKey:"clientPolicySearch",loader:g,toolbarItem:e(ke,{children:e(R,{id:"createPolicy",component:b=>e(Se,{...b,to:Wt({realm:i})}),"data-testid":"createPolicy",children:n("createClientPolicy")})}),isRowDisabled:b=>!!b.global,actions:[{title:n("delete"),onRowClick:b=>{I(),A(b)}}],columns:[{name:"name",cellRenderer:({name:b})=>e(Se,{to:en({realm:i,policyName:b}),children:b})},{name:"enabled",displayKey:"status",cellRenderer:b=>e(Tl,{clientPolicy:b,form:v,saveStatus:O,onConfirm:()=>{v.setValue(b.name,!1),O()}})},{name:"description",cellFormatters:[Sa(n)]}]},m.length)]}):e(Je,{})},Tl=({clientPolicy:l,form:n,saveStatus:a,onConfirm:t})=>{const{t:i}=H(),[s,u]=ye({titleKey:"disablePolicyConfirmTitle",messageKey:"disablePolicyConfirm",continueButtonLabel:"disable",onConfirm:t});return c(X,{children:[e(u,{}),e(G,{name:l.name,"data-testid":`${l.name}-switch`,defaultValue:l.enabled,control:n.control,render:({field:d})=>e(ge,{label:i("enabled"),labelOff:i("disabled"),isChecked:d.value,isDisabled:l.global,onChange:(m,o)=>{o?(d.onChange(o),a()):s()},"aria-label":l.name})})]})};function Cl(){const{adminClient:l}=ie(),{t:n}=H(),{realm:a}=le(),{addAlert:t,addError:i}=Te(),[s,u]=h(),[d,m]=h(),[o,p]=h(),[A,C]=h(!1),[N,S]=h(),[f,r]=h(0);Be(()=>l.clientPolicies.listProfiles({includeGlobalProfiles:!0}),E=>{m(E.globalProfiles);const I=E.globalProfiles?.map(L=>({...L,global:!0})),B=E.profiles?.map(L=>({...L,global:!1})),b=I?.concat(B??[]);u(b||[]),S(JSON.stringify(b,null,2))},[f]);const w=async()=>s??[],x=E=>Aa(E,"global"),[v,g]=ye({titleKey:n("deleteClientProfileConfirmTitle"),messageKey:n("deleteClientProfileConfirm",{profileName:o?.name}),continueButtonLabel:n("delete"),continueButtonVariant:ne.danger,onConfirm:async()=>{const E=s?.filter(I=>I.name!==o?.name&&!I.global).map(I=>x(I));try{await l.clientPolicies.createProfiles({profiles:E,globalProfiles:d}),t(n("deleteClientSuccess"),oe.success),r(f+1)}catch(I){i("deleteClientError",I)}}}),O=E=>c(Se,{to:an({realm:a,profileName:E.name}),children:[E.name," ",E.global&&e(ft,{color:"blue",children:n("global")})]},E.name);if(!s)return e(Je,{});const k=async()=>{if(N)try{const E=JSON.parse(N),I=E.filter(b=>!b.global).map(b=>x(b)),B=E.filter(b=>b.global).map(b=>x(b));try{await l.clientPolicies.createProfiles({profiles:I,globalProfiles:B}),t(n("updateClientProfilesSuccess"),oe.success),r(f+1)}catch(b){i("updateClientProfilesError",b)}}catch(E){i("invalidJsonClientProfilesError",E)}};return c(X,{children:[e(g,{}),e(re,{children:c(Gt,{className:"kc-profiles-config-section",children:[e(Me,{children:e(ua,{headingLevel:"h1",size:"md",children:n("profilesConfigType")})}),e(Me,{children:e(vt,{isChecked:!A,name:"profilesView",onChange:()=>C(!1),label:n("profilesConfigTypes.formView"),id:"formView-profilesView",className:"kc-form-radio-btn pf-v5-u-mr-sm pf-v5-u-ml-sm","data-testid":"formView-profilesView"})}),e(Me,{children:e(vt,{isChecked:A,name:"profilesView",onChange:()=>C(!0),label:n("profilesConfigTypes.jsonEditor"),id:"jsonEditor-profilesView",className:"kc-editor-radio-btn","data-testid":"jsonEditor-profilesView"})})]})}),e(_e,{}),A?c(D,{fieldId:"jsonEditor",children:[e("div",{className:"pf-v5-u-mt-md pf-v5-u-ml-lg",children:e($t,{isLineNumbersVisible:!0,isLanguageLabelVisible:!0,isReadOnly:!1,code:N,language:jt.json,height:"30rem",onChange:E=>{S(E??"")}})}),e(Ie,{children:c("div",{className:"pf-v5-u-mt-md",children:[e(R,{variant:ne.primary,className:"pf-v5-u-mr-md pf-v5-u-ml-lg",onClick:k,"data-testid":"jsonEditor-saveBtn",children:n("save")}),e(R,{variant:ne.link,onClick:()=>{S(it(s))},"data-testid":"jsonEditor-reloadBtn",children:n("reload")})]})})]}):e(ze,{ariaLabelKey:"profiles",searchPlaceholderKey:"clientProfileSearch",loader:w,toolbarItem:e(ke,{children:e(R,{id:"createProfile",component:E=>e(Se,{...E,to:tn({realm:a,tab:"profiles"})}),"data-testid":"createProfile",children:n("createClientProfile")})}),isRowDisabled:E=>E.global,actions:[{title:n("delete"),onRowClick:E=>{p(E),v()}}],columns:[{name:"name",displayKey:n("name"),cellRenderer:O},{name:"description",displayKey:n("clientProfileDescription")}],emptyState:e(xe,{message:n("emptyClientProfiles"),instructions:n("emptyClientProfilesInstructions")})},s.length)]})}const Sl=({realm:l,save:n})=>{const{t:a}=H(),{setValue:t,control:i,handleSubmit:s,formState:u}=ve(),d=Ue({control:i,name:"offlineSessionMaxLifespanEnabled"}),m=()=>{He(l,t)};return Le(m,[]),c(re,{variant:"light",children:[e(Ce,{title:a("SSOSessionSettings"),className:"kc-sso-session-template",children:c(te,{isHorizontal:!0,role:"manage-realm",onSubmit:s(n),children:[e(D,{label:a("SSOSessionIdle"),fieldId:"SSOSessionIdle",labelIcon:e(F,{helpText:a("ssoSessionIdle"),fieldLabelId:"SSOSessionIdle"}),children:e(G,{name:"ssoSessionIdleTimeout",defaultValue:l.ssoSessionIdleTimeout,control:i,render:({field:o})=>e(Z,{className:"kc-sso-session-idle","data-testid":"sso-session-idle-input",value:o.value,onChange:o.onChange,units:["minute","hour","day"]})})}),e(D,{label:a("SSOSessionMax"),fieldId:"SSOSessionMax",labelIcon:e(F,{helpText:a("ssoSessionMax"),fieldLabelId:"SSOSessionMax"}),children:e(G,{name:"ssoSessionMaxLifespan",control:i,render:({field:o})=>e(Z,{className:"kc-sso-session-max","data-testid":"sso-session-max-input",value:o.value,onChange:o.onChange,units:["minute","hour","day"]})})}),e(D,{label:a("SSOSessionIdleRememberMe"),fieldId:"SSOSessionIdleRememberMe",labelIcon:e(F,{helpText:a("ssoSessionIdleRememberMe"),fieldLabelId:"SSOSessionIdleRememberMe"}),children:e(G,{name:"ssoSessionIdleTimeoutRememberMe",control:i,render:({field:o})=>e(Z,{className:"kc-sso-session-idle-remember-me","data-testid":"sso-session-idle-remember-me-input",value:o.value,onChange:o.onChange,units:["minute","hour","day"]})})}),e(D,{label:a("SSOSessionMaxRememberMe"),fieldId:"SSOSessionMaxRememberMe",labelIcon:e(F,{helpText:a("ssoSessionMaxRememberMe"),fieldLabelId:"SSOSessionMaxRememberMe"}),children:e(G,{name:"ssoSessionMaxLifespanRememberMe",control:i,render:({field:o})=>e(Z,{className:"kc-sso-session-max-remember-me","data-testid":"sso-session-max-remember-me-input",value:o.value,onChange:o.onChange,units:["minute","hour","day"]})})})]})}),e(Ce,{title:a("clientSessionSettings"),className:"kc-client-session-template",children:c(te,{isHorizontal:!0,role:"manage-realm",className:"pf-v5-u-mt-lg",onSubmit:s(n),children:[e(D,{label:a("clientSessionIdle"),fieldId:"clientSessionIdle",labelIcon:e(F,{helpText:a("clientSessionIdleHelp"),fieldLabelId:"clientSessionIdle"}),children:e(G,{name:"clientSessionIdleTimeout",control:i,render:({field:o})=>e(Z,{className:"kc-client-session-idle","data-testid":"client-session-idle-input",value:o.value,onChange:o.onChange,units:["minute","hour","day"]})})}),e(D,{label:a("clientSessionMax"),fieldId:"clientSessionMax",labelIcon:e(F,{helpText:a("clientSessionMaxHelp"),fieldLabelId:"clientSessionMax"}),children:e(G,{name:"clientSessionMaxLifespan",control:i,render:({field:o})=>e(Z,{className:"kc-client-session-max","data-testid":"client-session-max-input",value:o.value,onChange:o.onChange,units:["minute","hour","day"]})})})]})}),e(Ce,{title:a("offlineSessionSettings"),className:"kc-offline-session-template",children:c(te,{isHorizontal:!0,role:"manage-realm",className:"pf-v5-u-mt-lg",onSubmit:s(n),children:[e(D,{label:a("offlineSessionIdle"),fieldId:"offlineSessionIdle",labelIcon:e(F,{helpText:a("offlineSessionIdleHelp"),fieldLabelId:"offlineSessionIdle"}),children:e(G,{name:"offlineSessionIdleTimeout",control:i,render:({field:o})=>e(Z,{className:"kc-offline-session-idle","data-testid":"offline-session-idle-input","aria-label":"offline-session-idle-input",value:o.value,onChange:o.onChange,units:["minute","hour","day"]})})}),e(D,{hasNoPaddingTop:!0,label:a("offlineSessionMaxLimited"),fieldId:"kc-offlineSessionMaxLimited",labelIcon:e(F,{helpText:a("offlineSessionMaxLimitedHelp"),fieldLabelId:"offlineSessionMaxLimited"}),children:e(G,{name:"offlineSessionMaxLifespanEnabled",control:i,defaultValue:!1,render:({field:o})=>e(ge,{id:"kc-offline-session-max","data-testid":"offline-session-max-switch","aria-label":a("offlineSessionMaxLimited"),label:a("enabled"),labelOff:a("disabled"),isChecked:o.value,onChange:o.onChange})})}),d&&e(D,{label:a("offlineSessionMax"),fieldId:"offlineSessionMax",id:"offline-session-max-label",labelIcon:e(F,{helpText:a("offlineSessionMaxHelp"),fieldLabelId:"offlineSessionMax"}),children:e(G,{name:"offlineSessionMaxLifespan",control:i,render:({field:o})=>e(Z,{className:"kc-offline-session-max","data-testid":"offline-session-max-input",value:o.value,onChange:o.onChange,units:["minute","hour","day"]})})})]})}),e(Ce,{className:"kc-login-settings-template",title:a("loginSettings"),children:c(te,{isHorizontal:!0,role:"manage-realm",className:"pf-v5-u-mt-lg",onSubmit:s(n),children:[e(D,{label:a("loginTimeout"),id:"kc-login-timeout-label",fieldId:"offlineSessionIdle",labelIcon:e(F,{helpText:a("loginTimeoutHelp"),fieldLabelId:"loginTimeout"}),children:e(G,{name:"accessCodeLifespanLogin",control:i,render:({field:o})=>e(Z,{className:"kc-login-timeout","data-testid":"login-timeout-input","aria-label":"login-timeout-input",value:o.value,onChange:o.onChange,units:["minute","hour","day"]})})}),e(D,{label:a("loginActionTimeout"),fieldId:"loginActionTimeout",id:"login-action-timeout-label",labelIcon:e(F,{helpText:a("loginActionTimeoutHelp"),fieldLabelId:"loginActionTimeout"}),children:e(G,{name:"accessCodeLifespanUserAction",control:i,render:({field:o})=>e(Z,{className:"kc-login-action-timeout","data-testid":"login-action-timeout-input",value:o.value,onChange:o.onChange,units:["minute","hour","day"]})})}),c(Ie,{children:[e(R,{variant:"primary",type:"submit","data-testid":"sessions-tab-save",isDisabled:!u.isDirty,children:a("save")}),e(R,{variant:"link",onClick:m,children:a("revert")})]})]})})]})},kl=({realm:l,save:n})=>{const{t:a}=H(),t=ve(),{handleSubmit:i,setValue:s}=t,u=$e().themes,d=()=>{He(l,s)};Le(d,[]);const m=o=>[{key:"",value:a("choose")},...o];return e(re,{variant:"light",children:c(te,{isHorizontal:!0,role:"manage-realm",className:"pf-v5-u-mt-lg",onSubmit:i(n),children:[c(Ke,{...t,children:[e(lt,{name:"attributes.darkMode",labelIcon:a("darkModeEnabledHelp"),label:a("darkModeEnabled"),defaultValue:"true",stringify:!0}),e(Ae,{id:"kc-login-theme",name:"loginTheme",label:a("loginTheme"),labelIcon:a("loginThemeHelp"),controller:{defaultValue:""},options:m(u.login.map(o=>({key:o.name,value:o.name})))}),e(Ae,{id:"kc-account-theme",name:"accountTheme",label:a("accountTheme"),labelIcon:a("accountThemeHelp"),placeholderText:a("selectATheme"),controller:{defaultValue:""},options:m(u.account.map(o=>({key:o.name,value:o.name})))}),e(Ae,{id:"kc-admin-theme",name:"adminTheme",label:a("adminTheme"),labelIcon:a("adminThemeHelp"),placeholderText:a("selectATheme"),controller:{defaultValue:""},options:m(u.admin.map(o=>({key:o.name,value:o.name})))}),e(Ae,{id:"kc-email-theme",name:"emailTheme",label:a("emailTheme"),labelIcon:a("emailThemeHelp"),placeholderText:a("selectATheme"),controller:{defaultValue:""},options:m(u.email.map(o=>({key:o.name,value:o.name})))})]}),c(Ie,{children:[e(R,{variant:"primary",type:"submit","data-testid":"themes-tab-save",children:a("save")}),e(R,{variant:"link",onClick:d,children:a("revert")})]})]})})},Il=({realm:l,reset:n,save:a})=>{const{t}=H(),i=$e(),s=Ht(),{whoAmI:u}=st(),[d,m]=h(!1),o=nn(i.providers.signature.providers),p=ve(),{setValue:A,control:C}=p,N=Ue({control:C,name:"offlineSessionMaxLifespanEnabled",defaultValue:l.offlineSessionMaxLifespanEnabled}),S=Ue({control:C,name:"ssoSessionIdleTimeout",defaultValue:36e3}),f=Ue({control:C,name:"revokeRefreshToken",defaultValue:!1});return Le(()=>{He(l,A)},[]),c(re,{variant:"light",children:[e(Ce,{title:t("general"),className:"kc-sso-session-template",children:c(te,{isHorizontal:!0,role:"manage-realm",onSubmit:p.handleSubmit(a),children:[e(D,{label:t("defaultSigAlg"),fieldId:"kc-default-signature-algorithm",labelIcon:e(F,{helpText:t("defaultSigAlgHelp"),fieldLabelId:"algorithm"}),children:e(G,{name:"defaultSignatureAlgorithm",defaultValue:"RS256",control:p.control,render:({field:r})=>e(we,{toggleId:"kc-default-sig-alg",onToggle:()=>m(!d),onSelect:w=>{r.onChange(w.toString()),m(!1)},selections:r.value?.toString(),variant:Fe.single,"aria-label":t("defaultSigAlg"),isOpen:d,"data-testid":"select-default-sig-alg",children:o.map((w,x)=>e(ue,{selected:w===r.value,value:w,children:w},`default-sig-alg-${x}`))})})}),s(gt.DeviceFlow)&&c(X,{children:[e(D,{label:t("oAuthDeviceCodeLifespan"),fieldId:"oAuthDeviceCodeLifespan",labelIcon:e(F,{helpText:t("oAuthDeviceCodeLifespanHelp"),fieldLabelId:"oAuthDeviceCodeLifespan"}),children:e(G,{name:"oauth2DeviceCodeLifespan",defaultValue:0,control:p.control,render:({field:r})=>e(Z,{id:"oAuthDeviceCodeLifespan","data-testid":"oAuthDeviceCodeLifespan",value:r.value||0,onChange:r.onChange,units:["minute","hour","day"]})})}),e(D,{label:t("oAuthDevicePollingInterval"),fieldId:"oAuthDevicePollingInterval",labelIcon:e(F,{helpText:t("oAuthDevicePollingIntervalHelp"),fieldLabelId:"oAuthDevicePollingInterval"}),children:e(G,{name:"oauth2DevicePollingInterval",defaultValue:0,control:p.control,render:({field:r})=>e(Jt,{id:"oAuthDevicePollingInterval",value:r.value,min:0,onPlus:()=>r.onChange(Number(r?.value)+1),onMinus:()=>r.onChange(Number(r?.value)>0?Number(r?.value)-1:0),onChange:w=>{const x=Number(w.currentTarget.value);r.onChange(isNaN(x)?0:x)},placeholder:t("oAuthDevicePollingInterval")})})}),e(D,{label:t("shortVerificationUri"),fieldId:"shortVerificationUri",labelIcon:e(F,{helpText:t("shortVerificationUriTooltipHelp"),fieldLabelId:"shortVerificationUri"}),children:e(St,{id:"shortVerificationUri",placeholder:t("shortVerificationUri"),...p.register("attributes.shortVerificationUri")})}),e(D,{label:t("parRequestUriLifespan"),fieldId:"parRequestUriLifespan",labelIcon:e(F,{helpText:t("parRequestUriLifespanHelp"),fieldLabelId:"parRequestUriLifespan"}),children:e(G,{name:"attributes.parRequestUriLifespan",control:p.control,render:({field:r})=>e(Z,{id:"parRequestUriLifespan",className:"par-request-uri-lifespan","data-testid":"par-request-uri-lifespan-input","aria-label":"par-request-uri-lifespan",value:r.value,onChange:r.onChange})})})]})]})}),e(Ce,{title:t("refreshTokens"),className:"kc-client-session-template",children:c(te,{isHorizontal:!0,role:"manage-realm",className:"pf-v5-u-mt-lg",onSubmit:p.handleSubmit(a),children:[e(D,{hasNoPaddingTop:!0,label:t("revokeRefreshToken"),fieldId:"kc-revoke-refresh-token",labelIcon:e(F,{helpText:t("revokeRefreshTokenHelp"),fieldLabelId:"revokeRefreshToken"}),children:e(G,{name:"revokeRefreshToken",control:p.control,defaultValue:!1,render:({field:r})=>e(ge,{id:"kc-revoke-refresh-token","data-testid":"revoke-refresh-token-switch","aria-label":t("revokeRefreshToken"),label:t("enabled"),labelOff:t("disabled"),isChecked:r.value,onChange:r.onChange})})}),f&&e(D,{label:t("refreshTokenMaxReuse"),labelIcon:e(F,{helpText:t("refreshTokenMaxReuseHelp"),fieldLabelId:"refreshTokenMaxReuse"}),fieldId:"refreshTokenMaxReuse",children:e(G,{name:"refreshTokenMaxReuse",defaultValue:0,control:p.control,render:({field:r})=>e(Jt,{type:"text",id:"refreshTokenMaxReuseMs",value:r.value,onPlus:()=>r.onChange(r.value+1),onMinus:()=>r.onChange(r.value-1),onChange:w=>r.onChange(Number(w.target.value))})})})]})}),e(Ce,{title:t("accessTokens"),className:"kc-offline-session-template",children:c(te,{isHorizontal:!0,role:"manage-realm",className:"pf-v5-u-mt-lg",onSubmit:p.handleSubmit(a),children:[c(D,{label:t("accessTokenLifespan"),fieldId:"accessTokenLifespan",labelIcon:e(F,{helpText:t("accessTokenLifespanHelp"),fieldLabelId:"accessTokenLifespan"}),children:[e(G,{name:"accessTokenLifespan",control:p.control,render:({field:r})=>e(Z,{validated:r.value>S?"warning":"default",className:"kc-access-token-lifespan","data-testid":"access-token-lifespan-input","aria-label":"access-token-lifespan",value:r.value,onChange:r.onChange,units:["minute","hour","day"]})}),e(ln,{children:e(sn,{children:e(rn,{children:t("recommendedSsoTimeout",{time:Kn(S,u.getLocale())})})})})]}),e(D,{label:t("accessTokenLifespanImplicitFlow"),fieldId:"accessTokenLifespanImplicitFlow",labelIcon:e(F,{helpText:t("accessTokenLifespanImplicitFlow"),fieldLabelId:"accessTokenLifespanImplicitFlow"}),children:e(G,{name:"accessTokenLifespanForImplicitFlow",control:p.control,render:({field:r})=>e(Z,{className:"kc-access-token-lifespan-implicit","data-testid":"access-token-lifespan-implicit-input",value:r.value,onChange:r.onChange,units:["minute","hour","day"]})})}),e(D,{label:t("clientLoginTimeout"),fieldId:"clientLoginTimeout",labelIcon:e(F,{helpText:t("clientLoginTimeoutHelp"),fieldLabelId:"clientLoginTimeout"}),children:e(G,{name:"accessCodeLifespan",control:p.control,render:({field:r})=>e(Z,{className:"kc-client-login-timeout","data-testid":"client-login-timeout-input","aria-label":"client-login-timeout",value:r.value,onChange:r.onChange,units:["minute","hour","day"]})})}),N&&e(D,{label:t("offlineSessionMax"),fieldId:"offlineSessionMax",id:"offline-session-max-label",labelIcon:e(F,{helpText:t("offlineSessionMaxHelp"),fieldLabelId:"offlineSessionMax"}),children:e(G,{name:"offlineSessionMaxLifespan",control:p.control,render:({field:r})=>e(Z,{className:"kc-offline-session-max","data-testid":"offline-session-max-input",value:r.value,onChange:r.onChange,units:["minute","hour","day"]})})})]})}),e(Ce,{className:"kc-login-settings-template",title:t("actionTokens"),children:c(te,{isHorizontal:!0,role:"manage-realm",className:"pf-v5-u-mt-lg",onSubmit:p.handleSubmit(a),children:[e(D,{label:t("userInitiatedActionLifespan"),id:"kc-user-initiated-action-lifespan",fieldId:"userInitiatedActionLifespan",labelIcon:e(F,{helpText:t("userInitiatedActionLifespanHelp"),fieldLabelId:"userInitiatedActionLifespan"}),children:e(G,{name:"actionTokenGeneratedByUserLifespan",control:p.control,render:({field:r})=>e(Z,{className:"kc-user-initiated-action-lifespan","data-testid":"user-initiated-action-lifespan","aria-label":"user-initiated-action-lifespan",value:r.value,onChange:r.onChange,units:["minute","hour","day"]})})}),e(D,{label:t("defaultAdminInitiated"),fieldId:"defaultAdminInitiated",id:"default-admin-initiated-label",labelIcon:e(F,{helpText:t("defaultAdminInitiatedActionLifespanHelp"),fieldLabelId:"defaultAdminInitiated"}),children:e(G,{name:"actionTokenGeneratedByAdminLifespan",control:p.control,render:({field:r})=>e(Z,{className:"kc-default-admin-initiated","data-testid":"default-admin-initated-input","aria-label":"default-admin-initated-input",value:r.value,onChange:r.onChange,units:["minute","hour","day"]})})}),e(Ve,{className:"kc-override-action-tokens-subtitle",component:Ut.h1,children:t("overrideActionTokens")}),e(D,{label:t("emailVerification"),fieldId:"emailVerification",id:"email-verification",labelIcon:e(F,{helpText:t("emailVerificationHelp"),fieldLabelId:"emailVerification"}),children:e(G,{name:`attributes.${ct("actionTokenGeneratedByUserLifespan.verify-email")}`,defaultValue:"",control:p.control,render:({field:r})=>e(Z,{className:"kc-email-verification","data-testid":"email-verification-input",value:r.value,onChange:w=>r.onChange(w.toString()),units:["minute","hour","day"]})})}),e(D,{label:t("idpAccountEmailVerification"),fieldId:"idpAccountEmailVerification",id:"idp-acct-label",labelIcon:e(F,{helpText:t("idpAccountEmailVerificationHelp"),fieldLabelId:"idpAccountEmailVerification"}),children:e(G,{name:`attributes.${ct("actionTokenGeneratedByUserLifespan.idp-verify-account-via-email")}`,defaultValue:"",control:p.control,render:({field:r})=>e(Z,{className:"kc-idp-email-verification","data-testid":"idp-email-verification-input",value:r.value,onChange:r.onChange,units:["minute","hour","day"]})})}),e(D,{label:t("forgotPassword"),fieldId:"forgotPassword",id:"forgot-password-label",labelIcon:e(F,{helpText:t("forgotPasswordHelp"),fieldLabelId:"forgotPassword"}),children:e(G,{name:`attributes.${ct("actionTokenGeneratedByUserLifespan.reset-credentials")}`,defaultValue:"",control:p.control,render:({field:r})=>e(Z,{className:"kc-forgot-pw","data-testid":"forgot-pw-input",value:r.value,onChange:r.onChange,units:["minute","hour","day"]})})}),e(D,{label:t("executeActions"),fieldId:"executeActions",id:"execute-actions",labelIcon:e(F,{helpText:t("executeActionsHelp"),fieldLabelId:"executeActions"}),children:e(G,{name:`attributes.${ct("actionTokenGeneratedByUserLifespan.execute-actions")}`,defaultValue:"",control:p.control,render:({field:r})=>e(Z,{className:"kc-execute-actions","data-testid":"execute-actions-input",value:r.value,onChange:r.onChange,units:["minute","hour","day"]})})}),c(Ie,{children:[e(R,{variant:"primary",type:"submit","data-testid":"tokens-tab-save",isDisabled:!p.formState.isDirty,children:t("save")}),e(R,{variant:"link",onClick:n,children:t("revert")})]})]})})]})},Ll=()=>{const{adminClient:l}=ie(),{t:n}=H(),[a,t]=qe(),[i,s]=qe(),[u,d]=h(),[m,o]=h([]),[p,A]=h(0),[C,N]=h(0),S=()=>N(C+1),{realm:f}=le(),{addAlert:r,addError:w}=Te(),{enabled:x}=on(),{hasAccess:v}=Bt(),g=v("view-users","manage-realm");Be(()=>l.realms.getDefaultGroups({realm:f}),b=>{d(b),A(p+1)},[C]);const O=()=>Promise.resolve(u),k=async()=>{try{await Promise.all(m.map(b=>l.realms.removeDefaultGroup({realm:f,id:b.id}))),r(n("groupRemove",{count:m.length}),oe.success),o([])}catch(b){w("groupRemoveError",b)}S()},E=async b=>{try{await Promise.all(b.map(L=>l.realms.addDefaultGroup({realm:f,id:L.id}))),r(n("defaultGroupAdded",{count:b.length}),oe.success)}catch(L){w("defaultGroupAddedError",L)}S()},[I,B]=ye({titleKey:n("removeConfirmTitle",{count:m.length}),messageKey:n("removeConfirm",{count:m.length}),continueButtonLabel:"delete",continueButtonVariant:ne.danger,onConfirm:k});return u?c(X,{children:[e(B,{}),i&&e(Gn,{type:"selectMany",text:{title:"addDefaultGroups",ok:"add"},onConfirm:b=>{E(b||[]),s()},onClose:s}),x&&e(cn,{bodyContent:c(Ct,{i18nKey:"defaultGroupsHelp",children:[" ",e(Se,{to:Xt({realm:f})}),"."]}),children:e(rt,{className:"keycloak__section_intro__help",style:{paddingLeft:"var(--pf-v5-c-page__main-section--PaddingLeft)"},children:c(Ve,{children:[e(Un,{})," ",n("whatIsDefaultGroups")]})})}),e(ze,{canSelectAll:!0,onSelect:b=>o([...b]),loader:O,ariaLabelKey:"defaultGroups",searchPlaceholderKey:"searchForGroups",toolbarItem:g&&c(X,{children:[e(ke,{children:e(R,{"data-testid":"openCreateGroupModal",variant:"primary",onClick:s,children:n("addGroups")})}),e(ke,{children:e(ma,{onOpenChange:t,toggle:b=>e(pa,{ref:b,isExpanded:a,variant:"plain",onClick:t,isDisabled:m.length===0,children:e(ha,{})}),isOpen:a,shouldFocusToggleOnSelect:!0,children:e(fa,{children:e(nt,{component:"button",onClick:()=>{I(),t()},children:n("remove")},"action")})})})]}),actions:g?[{title:n("remove"),onRowClick:b=>(o([b]),I(),Promise.resolve(!1))}]:[],columns:[{name:"name",displayKey:"groupName"},{name:"path",displayKey:"path"}],emptyState:e(xe,{hasIcon:!0,message:n("noDefaultGroups"),instructions:c(Ct,{i18nKey:"noDefaultGroupsInstructions",children:[" ",e(Se,{className:"pf-v5-u-font-weight-light",to:Xt({realm:f}),role:"navigation","aria-label":n("identityBrokeringLink")}),"Add groups..."]}),primaryActionText:g?n("addGroups"):"",onPrimaryAction:s})},p)]}):e(Je,{})},Pl=()=>{const{adminClient:l}=ie(),{t:n}=H(),[a,t]=h(10),{realmRepresentation:i}=le(),[s,u]=h(0),{addAlert:d,addError:m}=Te(),{realm:o}=le(),p=async A=>{const C=A;try{await l.roles.createComposite({roleId:i?.defaultRole.id,realm:o},C),u(s+1),d(n("addAssociatedRolesSuccess"),oe.success)}catch(N){m("addAssociatedRolesError",N)}};return c(kt,{activeKey:a,onSelect:(A,C)=>t(C),children:[e($,{id:"roles",eventKey:10,title:e(j,{children:n("defaultRoles")}),"data-testid":"default-roles-tab",children:e(Hn,{name:i?.defaultRole.name,id:i?.defaultRole.id,type:"roles",isManager:!0,save:A=>p(A.map(C=>C.role))})},s),e($,{id:"groups",eventKey:20,title:e(j,{children:n("defaultGroups")}),"data-testid":"default-groups-tab",children:e(Ll,{})})]})};function wa({ariaLabelKey:l="userEventsRegistered",eventTypes:n,addTypes:a,onSelect:t,onDelete:i}){const{t:s}=H(),u=n.map(d=>({id:d,name:s(`eventTypes.${d}.name`),description:s(`eventTypes.${d}.description`)}));return e(ze,{ariaLabelKey:l,searchPlaceholderKey:"searchEventType",loader:u,onSelect:t||void 0,canSelectAll:!!t,toolbarItem:a&&e(ke,{children:e(R,{id:"addTypes",onClick:a,"data-testid":"addTypes",children:s("addSavedTypes")})}),actions:i?[{title:s("remove"),onRowClick:i}]:[],columns:[{name:"name",displayKey:"eventType"},{name:"description",cellFormatters:[Sa(s)]}],emptyState:e(xe,{message:s("emptyEvents"),instructions:s("emptyEventsInstructions")})})}const El=({onConfirm:l,onClose:n,configured:a})=>{const{t}=H(),{enums:i}=$e(),[s,u]=h([]);return e(We,{variant:Ye.medium,title:t("addTypes"),isOpen:!0,onClose:n,actions:[e(R,{"data-testid":"addEventTypeConfirm",variant:"primary",onClick:()=>l(s),children:t("add")},"confirm"),e(R,{"data-testid":"moveCancel",variant:"link",onClick:n,children:t("cancel")},"cancel")],children:e(wa,{ariaLabelKey:"addTypes",onSelect:d=>u(d),eventTypes:i.eventType.filter(d=>!a.includes(d))})})},ia=({type:l,form:n,reset:a,clear:t})=>{const{t:i}=H(),{control:s,watch:u,setValue:d,formState:{isDirty:m}}=n,o=l==="admin"?"adminEventsEnabled":"eventsEnabled",p=u(o),[A,C]=ye({titleKey:"events-disable-title",messageKey:"events-disable-confirm",continueButtonLabel:"confirm",onConfirm:()=>d(o,!1,{shouldDirty:!0})});return c(Ke,{...n,children:[e(C,{}),e(D,{hasNoPaddingTop:!0,label:i("saveEvents"),fieldId:o,labelIcon:e(F,{helpText:i(`save-${l}-eventsHelp`),fieldLabelId:"saveEvents"}),children:e(G,{name:o,defaultValue:!1,control:s,render:({field:N})=>e(ge,{"data-testid":o,id:`${o}-switch`,label:i("on"),labelOff:i("off"),isChecked:N.value,onChange:(S,f)=>{f?N.onChange(f):A()},"aria-label":i("saveEvents")})})}),p&&c(X,{children:[l==="admin"&&e(lt,{name:"adminEventsDetailsEnabled",label:i("includeRepresentation"),labelIcon:i("includeRepresentationHelp")}),e(ka,{name:l==="user"?"eventsExpiration":"adminEventsExpiration",label:i("expiration"),labelIcon:i("expirationHelp"),defaultValue:"",units:["minute","hour","day"],controller:{defaultValue:""}})]}),c(Ie,{children:[e(R,{variant:"primary",type:"submit",id:`save-${l}`,"data-testid":`save-${l}`,isDisabled:!m,children:i("save")}),e(R,{variant:"link",onClick:a,children:i("revert")})]}),e(_e,{}),e(D,{label:i(l==="user"?"clearUserEvents":"clearAdminEvents"),fieldId:`clear-${l}-events`,labelIcon:e(F,{helpText:i(`${l}-clearEventsHelp`),fieldLabelId:`clear-${l}-events`}),children:e(R,{variant:"danger",id:`clear-${l}-events`,"data-testid":`clear-${l}-events`,onClick:()=>t(),children:i(l==="user"?"clearUserEvents":"clearAdminEvents")})})]})},Al=({form:l,reset:n})=>{const{t:a}=H(),i=$e().providers?.eventsListener.providers;return c(Ke,{...l,children:[e(Ae,{name:"eventsListeners",label:a("eventListeners"),labelIcon:a("eventListenersHelpTextHelp"),controller:{defaultValue:""},className:"kc_eventListeners_select",chipGroupProps:{numChips:3,expandedText:a("hide"),collapsedText:a("showRemaining")},variant:Fe.typeaheadMulti,options:Object.keys(i)}),c(Ie,{children:[e(R,{variant:"primary",type:"submit","data-testid":"saveEventListenerBtn",children:a("save")}),e(R,{variant:"link","data-testid":"revertEventListenerBtn",onClick:n,children:a("revert")})]})]})},wl=({realm:l})=>{const{adminClient:n}=ie(),{t:a}=H(),t=ve(),{setValue:i,handleSubmit:s}=t,[u,d]=h(0),m=()=>d(new Date().getTime()),[o,p]=h(0),A=()=>p(new Date().getTime()),[C,N]=h("event"),[S,f]=h(),[r,w]=h(),[x,v]=h(!1),{addAlert:g,addError:O}=Te(),{realm:k,refresh:E}=le(),I=U=>{f(U),He(U||{},i)},B=async U=>{w(U),b()},[b,L]=ye({titleKey:"deleteEvents",messageKey:"deleteEventsConfirm",continueButtonLabel:"clear",continueButtonVariant:ne.danger,onConfirm:async()=>{try{switch(r){case"admin":await n.realms.clearAdminEvents({realm:k});break;case"user":await n.realms.clearEvents({realm:k});break}g(a(`${r}-events-cleared`),oe.success)}catch(U){O(`${r}-events-cleared-error`,U)}}});Be(()=>n.realms.getConfigEvents({realm:k}),U=>{I({...U,adminEventsExpiration:l.attributes?.adminEventsExpiration}),A()},[u]);const V=async U=>{const q=!Ia(S?.eventsListeners,U.eventsListeners),{adminEventsExpiration:se,...ae}=U;l.attributes?.adminEventsExpiration!==se&&await n.realms.update({realm:k},{...l,attributes:{...l.attributes||{},adminEventsExpiration:se}});try{await n.realms.updateConfigEvents({realm:k},ae),I({...S,...ae,adminEventsExpiration:se}),g(a(q?"saveEventListenersSuccess":"eventConfigSuccessfully"),oe.success)}catch(pe){O(a(q?"saveEventListenersError":"eventConfigError"),pe)}E()},_=async U=>{const q=U.map(ae=>ae.id),se=S.enabledEventTypes?.concat(q);await J(se)},J=async(U=[])=>{const q={...t.getValues(),enabledEventTypes:U};await V(q),v(!1),m()};return c(X,{children:[e(L,{}),x&&e(El,{onConfirm:U=>_(U),configured:S?.enabledEventTypes||[],onClose:()=>v(!1)}),c(kt,{activeKey:C,onSelect:(U,q)=>N(q),children:[e($,{eventKey:"event",title:e(j,{children:a("eventListeners")}),"data-testid":"rs-event-listeners-tab",children:e(re,{children:e(te,{role:"manage-events",isHorizontal:!0,onSubmit:s(V),children:e(Al,{form:t,reset:()=>I(S)})})})}),c($,{eventKey:"user",title:e(j,{children:a("userEventsSettings")}),"data-testid":"rs-events-tab",children:[e(re,{children:e(te,{role:"manage-events",isHorizontal:!0,onSubmit:s(V),children:e(ia,{type:"user",form:t,reset:()=>I(S),clear:()=>B("user")})})}),e(re,{children:e(wa,{addTypes:()=>v(!0),eventTypes:S?.enabledEventTypes||[],onDelete:U=>{const q=S?.enabledEventTypes?.filter(se=>se!==U.id);J(q),f({...S,enabledEventTypes:q})}},o)})]}),e($,{eventKey:"admin",title:e(j,{children:a("adminEventsSettings")}),"data-testid":"rs-admin-events-tab",children:e(re,{children:e(te,{role:"manage-events",isHorizontal:!0,onSubmit:s(V),children:e(ia,{type:"admin",form:t,reset:()=>I(S),clear:()=>B("admin")})})})})]})]})},at=["ACTIVE","PASSIVE","DISABLED"],xl=({onFilter:l})=>{const{t:n}=H(),[a,t]=h(at[0]),[i,s]=qe();return e(we,{width:300,"data-testid":"filter-type-select",isOpen:i,className:"kc-filter-type-select",variant:Fe.single,onToggle:s,toggleIcon:e(La,{}),onSelect:u=>{const d=at.find(m=>m===u.toString())||at[0];t(d),l(d),s()},selections:a,"aria-label":n("selectFilterType"),children:at.map(u=>e(ue,{"data-testid":`${u}-option`,value:u,children:n(`keysFilter.${u}`)},u))})},Dl=({realmComponents:l})=>{const{adminClient:n}=ie(),{t:a}=H(),t=Ze(),i=Bn(),[s,u]=h(""),[d,m]=h(""),{realm:o}=le(),[p,A]=h([]),[C,N]=h(at[0]),S=Qe(()=>p?.filter(({status:v})=>v===C),[p,C]);Be(async()=>(await n.realms.getKeys({realm:o})).keys?.map(g=>{const O=l.find(k=>k.id===g.providerId);return{...g,provider:O?.name}}),A,[]);const[f,r]=ye({titleKey:a("publicKey"),messageKey:s,continueButtonLabel:"close",continueButtonVariant:ne.primary,onConfirm:()=>Promise.resolve()}),[w,x]=ye({titleKey:a("certificate"),messageKey:d,continueButtonLabel:"close",continueButtonVariant:ne.primary,onConfirm:()=>Promise.resolve()});return p?c(re,{variant:"light",padding:{default:"noPadding"},children:[e(r,{}),e(x,{}),e(ze,{isNotCompact:!0,className:"kc-keys-list",loader:S,ariaLabelKey:"keysList",searchPlaceholderKey:"searchKey",searchTypeComponent:e(xl,{onFilter:v=>N(v)}),columns:[{name:"algorithm",displayKey:"algorithm",cellFormatters:[dt()],transforms:[je(15)]},{name:"type",displayKey:"type",cellFormatters:[dt()],transforms:[je(10)]},{name:"kid",displayKey:"kid",cellFormatters:[dt()],transforms:[je(10)]},{name:"use",displayKey:"use",cellFormatters:[dt()],transforms:[je(10)]},{name:"provider",displayKey:"provider",cellRenderer:({provider:v})=>v||"-",transforms:[je(10)]},{name:"validTo",displayKey:"validTo",cellRenderer:({validTo:v})=>v?i(new Date(v)):"-",transforms:[je(10)]},{name:"publicKeys",displayKey:"publicKeys",cellRenderer:({publicKey:v,certificate:g})=>g?c("div",{className:"button-wrapper",children:[e(R,{onClick:()=>{f(),u(v)},variant:"secondary",id:v,children:a("publicKey")}),e(R,{onClick:()=>{w(),m(g)},variant:"secondary",id:g,className:"kc-certificate",children:a("certificate")})]}):v?e(R,{onClick:()=>{f(),u(v)},variant:"secondary",id:"kc-public-key",children:a("publicKey")}):"",transforms:[je(20)]}],isSearching:!!S,emptyState:e(xe,{hasIcon:!0,message:a("noKeys"),instructions:a("noKeysDescription"),primaryActionText:a("addProvider"),onPrimaryAction:()=>t(Mt({realm:o,tab:"providers"}))})})]}):e(Je,{})},Rl="_dialog_121se_2",Nl={dialog:Rl},Vl=({providerType:l,onClose:n})=>{const{t:a}=H();return e(We,{className:Nl.dialog,variant:Ye.medium,title:a("addProvider"),isOpen:!0,onClose:n,children:e(_n,{providerType:l,onClose:n})})},Ol=({onConfirm:l,onClose:n})=>{const{t:a}=H(),i=$e().componentTypes?.[_t]??[];return e(We,{variant:"medium",title:a("addProvider"),isOpen:!0,onClose:n,children:e(va,{onSelectDataListItem:(s,u)=>{l(u)},"aria-label":a("addPredefinedMappers"),isCompact:!0,children:i.map(s=>e(ya,{"aria-label":s.id,id:s.id,children:e(Ta,{children:e(Ca,{dataListCells:[e(Ft,{"data-testid":`option-${s.id}`,children:s.id},`name-${s.id}`),e(Ft,{width:2,children:s.helpText},`helpText-${s.helpText}`)]})})},s.id))})})},Ml=({realmComponents:l,refresh:n})=>{const{adminClient:a}=ie(),{t}=H(),{addAlert:i,addError:s}=Te(),{realm:u}=le(),[d,m]=h(""),[o,p]=h([]),[A,C]=qe(),S=$e().componentTypes?.[_t]??[],[f,r]=qe(),[w,x]=h(),[v,g]=h(),O=Qe(()=>l.map(L=>{const V=S.find(_=>L.providerId===_.id);return{...L,providerDescription:V?.helpText}}),[l]),[k,E]=ye({titleKey:"deleteProviderTitle",messageKey:t("deleteProviderConfirm",{provider:v?.name}),continueButtonLabel:"delete",continueButtonVariant:ne.danger,onConfirm:async()=>{try{await a.components.del({id:v.id,realm:u}),n(),i(t("deleteProviderSuccess"),oe.success)}catch(L){s("deleteProviderError",L)}}}),I=()=>{if(d!==""){m(d);const L=O.filter(V=>V.name?.includes(d)||V.providerId?.includes(d));p(L)}else m(""),p(O)},B=L=>{L.key==="Enter"&&I()},b=L=>{m(L)};return c(X,{children:[f&&e(Ol,{onClose:()=>r(),onConfirm:L=>{C(),x(L),r()}}),A&&w&&e(Vl,{providerType:w,onClose:()=>{C(),n()}}),e(E,{}),c(re,{variant:"light",padding:{default:"noPadding"},children:[e(ba,{children:c(dn,{className:"providers-toolbar",children:[e(ke,{children:c(un,{children:[e(Qt,{isFill:!0,children:e(St,{name:"inputGroupName",id:"inputGroupName","data-testid":"provider-search-input",type:"search","aria-label":t("search"),placeholder:t("search"),onChange:(L,V)=>b(V),onKeyDown:B})}),e(Qt,{children:e(R,{variant:ne.control,"aria-label":t("search"),onClick:I,children:e(ga,{})})})]})}),e(ke,{children:e(R,{"data-testid":"addProviderDropdown",className:"add-provider-dropdown",onClick:()=>r(),children:t("addProvider")})})]})}),e(Pa,{variant:"compact",className:"kc-draggable-table",keyField:"id",data:o.length===0?O:o,onDragFinish:async(L,V)=>{const _=O.map(J=>{const U={...J};return delete U.providerDescription,a.components.update({id:J.id},{...U,config:{priority:[(V.length-V.indexOf(J.id)+100).toString()]}})});try{await Promise.all(_),n(),i(t("saveProviderListSuccess"),oe.success)}catch(J){s("saveProviderError",J)}},columns:[{name:"name",displayKey:"name",cellRenderer:L=>e(Se,{"data-testid":"provider-name-link",to:mn({realm:u,id:L.id,providerType:L.providerId}),children:L.name},L.name)},{name:"providerId",displayKey:"provider"},{name:"providerDescription",displayKey:"providerDescription"}],actions:[{title:t("delete"),onClick:(L,V,_)=>{g(_),k()}}]})]})]})},Fl=l=>[...l].sort((a,t)=>{const i=Number(a.config?.priority),s=Number(t.config?.priority);return(isNaN(s)?0:s)-(isNaN(i)?0:i)}),Kl=()=>{const{adminClient:l}=ie(),{t:n}=H(),{realm:a}=le(),[t,i]=h(),[s,u]=h(0),d=()=>{u(s+1)};Be(()=>l.components.find({type:_t,realm:a}),A=>i(Fl(A)),[s]);const m=A=>Tt(Mt({realm:a,tab:A})),o=m("list"),p=m("providers");return t?c(yt,{mountOnEnter:!0,unmountOnExit:!0,defaultLocation:Mt({realm:a,tab:"list"}),children:[e($,{id:"keysList","data-testid":"rs-keys-list-tab","aria-label":"keys-list-subtab",title:e(j,{children:n("keysList")}),...o,children:e(Dl,{realmComponents:t})}),e($,{id:"providers","data-testid":"rs-providers-tab","aria-label":"rs-providers-tab",title:e(j,{children:n("providers")}),...p,children:e(Ml,{realmComponents:t,refresh:d})})]}):e(Je,{})},sa={theme:"",themeType:"",locale:"",hasWords:[]},Hl=({defaultSupportedLocales:l,defaultLocales:n})=>{const{adminClient:a}=ie(),{t}=H(),{realm:i}=le(),s=$e(),{whoAmI:u}=st(),d=$n(),[m,o]=h(!1),[p,A]=h(!1),[C,N]=h(!1),[S,f]=h(!1),[r,w]=h(!1),[x,v]=h({}),[g,O]=h(0),k=s.themes,E=Qe(()=>k?d(Object.keys(k),T=>T):[],[k]),I=Qe(()=>k?d(Object.values(k).flatMap(T=>T.map(P=>P.name)).filter((T,P,K)=>K.indexOf(T)===P),T=>T):[],[k]),B=Qe(()=>Array.from(new Set([...n,...l])),[n,l]),b={theme:t("theme"),themeType:t("themeType"),locale:t("language"),hasWords:t("hasWords")},{getValues:L,reset:V,formState:{isDirty:_,isValid:J},control:U}=ve({mode:"onChange",defaultValues:sa}),q=async()=>{try{const T=L();if(["theme","themeType","locale"].some(Pe=>!T[Pe]))return[];const Q=await a.serverInfo.findEffectiveMessageBundles({realm:i,...T,locale:T.locale||Ee,source:!0}),W=T.hasWords.length>0?Q.filter(Pe=>T.hasWords.some(y=>Pe.value.includes(y)||Pe.key.includes(y))):Q;return d([...W],jn("key"))}catch{return[]}};function se(){o(!1),de()}function ae(){V(),de()}function pe(T){const P={...L()};delete P[T],V({...sa,...P}),de()}function he(T,P){const K=L(),Q=K[T],W=Array.isArray(Q)?Q.filter(me=>me!==P):Q;V({...K,[T]:W}),de()}function de(){const T=qn(L(),P=>P!==""||Array.isArray(P)&&P.length>0);v(T),O(g+1)}const fe=()=>c(Gt,{direction:{default:"column"},spaceItems:{default:"spaceItemsNone"},children:[e(Me,{children:e(rt,{children:e(Ve,{className:"pf-v5-u-mb-md pf-v5-u-mt-0 pf-v5-u-mr-md",component:Ut.p,children:t("effectiveMessageBundlesDescription")})})}),e(Me,{children:e(zn,{buttonText:t("searchForEffectiveMessageBundles"),setSearchDropdownOpen:o,searchDropdownOpen:m,marginRight:"2.5rem",width:"15vw",children:c(ot,{isHorizontal:!0,className:"pf-v5-u-w-25vw","data-testid":"effectiveMessageBundlesSearchForm",onSubmit:T=>T.preventDefault(),children:[e(D,{label:t("theme"),fieldId:"kc-theme",isRequired:!0,children:e(G,{name:"theme",control:U,defaultValue:"",rules:{validate:T=>(T||"").length>0},render:({field:T})=>e(we,{"data-testid":"effective_message_bundles-theme-searchField",chipGroupProps:{numChips:1,expandedText:t("hide"),collapsedText:t("showRemaining")},variant:Fe.single,typeAheadAriaLabel:"Select",onToggle:P=>N(P),selections:T.value,onSelect:P=>{T.onChange(P.toString()),N(!1)},onClear:()=>{T.onChange("")},isOpen:C,"aria-label":t("selectTheme"),chipGroupComponent:e(et,{children:e(Xe,{onClick:P=>{P.stopPropagation(),T.onChange("")},children:T.value},T.value)}),children:[e(ue,{label:t("selectTheme"),isDisabled:!0,children:t("selectTheme")},"theme_placeholder")].concat(I.map(P=>e(ue,{value:P,children:P},P)))})})}),e(D,{label:t("themeType"),fieldId:"kc-themeType",isRequired:!0,children:e(G,{name:"themeType",control:U,defaultValue:"",rules:{validate:T=>(T||"").length>0},render:({field:T})=>e(we,{"data-testid":"effective-message-bundles-feature-searchField",chipGroupProps:{numChips:1,expandedText:t("hide"),collapsedText:t("showRemaining")},variant:Fe.single,typeAheadAriaLabel:"Select",onToggle:P=>f(P),selections:T.value,onSelect:P=>{T.onChange(P.toString()),f(!1)},onClear:()=>{T.onChange("")},isOpen:S,"aria-label":t("selectThemeType"),chipGroupComponent:e(et,{children:e(Xe,{onClick:P=>{P.stopPropagation(),T.onChange("")},children:T.value},T.value)}),children:[e(ue,{label:t("selectThemeType"),isDisabled:!0,children:t("selectThemeType")},"themeType_placeholder")].concat(E.map(P=>e(ue,{value:P,children:P},P)))})})}),e(D,{label:t("language"),fieldId:"kc-language",isRequired:!0,children:e(G,{name:"locale",control:U,defaultValue:"",rules:{validate:T=>(T||"").length>0},render:({field:T})=>e(we,{"data-testid":"effective-message-bundles-language-searchField",chipGroupProps:{numChips:1,expandedText:t("hide"),collapsedText:t("showRemaining")},variant:Fe.single,typeAheadAriaLabel:"Select",onToggle:P=>w(P),selections:T.value,onSelect:P=>{T.onChange(P.toString()),w(!1)},onClear:()=>{T.onChange("")},isOpen:r,"aria-label":t("selectLanguage"),chipGroupComponent:e(et,{children:T.value?e(Xe,{onClick:P=>{P.stopPropagation(),T.onChange("")},children:Oe(T.value,u.getLocale())},T.value):null}),children:[e(ue,{label:t("selectLanguage"),isDisabled:!0,children:t("selectLanguage")},"language_placeholder")].concat(B.map(P=>e(ue,{value:P,children:Oe(P,u.getLocale())},P)))})})}),e(D,{label:t("hasWords"),fieldId:"kc-hasWords",children:e(G,{name:"hasWords",control:U,render:({field:T})=>c("div",{children:[e(St,{id:"kc-hasWords","data-testid":"effective-message-bundles-hasWords-searchField",value:T.value.join(" "),onChange:P=>{const Q=P.target.value;if(Q.trim().length===0)T.onChange([]);else{const W=Q.split(" ").map(me=>me.trim());T.onChange(W)}}}),e(et,{children:T.value.map((P,K)=>e(Xe,{onClick:Q=>{Q.stopPropagation();const W=T.value.filter((me,Pe)=>Pe!==K);T.onChange(W)},children:P},K))})]})})}),c(Ie,{className:"pf-v5-u-mt-sm",children:[e(R,{variant:"primary",onClick:()=>{A(!0),se()},"data-testid":"search-effective-message-bundles-btn",isDisabled:!J,children:t("search")}),e(R,{variant:"secondary",onClick:ae,"data-testid":"reset-search-effective-message-bundles-btn",isDisabled:!_,children:t("reset")})]})]})})}),e(Me,{children:Object.entries(x).length>0&&e(X,{children:Object.entries(x).map(T=>{const[P,K]=T;return e(et,{className:"pf-v5-u-mt-md pf-v5-u-mr-md",categoryName:b[P],isClosable:!0,onClick:()=>pe(P),children:typeof K=="string"?e(Xe,{isReadOnly:!0,children:P==="locale"?Oe(K,u.getLocale())?.toLowerCase():K}):K.map(Q=>e(Xe,{onClick:()=>he(P,Q),children:Q},Q))},P)})})})]});return p?e(ze,{loader:q,ariaLabelKey:"effectiveMessageBundles",toolbarItem:fe(),columns:[{name:"key",displayKey:"key"},{name:"value",displayKey:"value"}],emptyState:e(xe,{message:t("noSearchResults"),instructions:t("noSearchResultsInstructions")}),isSearching:Object.keys(x).length>0},g):c(X,{children:[e("div",{className:"pf-v5-u-py-lg pf-v5-u-pl-md",children:fe()}),e(_e,{}),e(xe,{message:t("emptyEffectiveMessageBundles"),instructions:t("emptyEffectiveMessageBundlesInstructions"),isSearchVariant:!0})]})},Gl=({handleModalToggle:l,save:n,form:a})=>{const{t}=H();return e(We,{variant:Ye.small,title:t("addTranslation"),isOpen:!0,onClose:l,actions:[e(R,{"data-testid":"add-translation-confirm-button",variant:"primary",type:"submit",form:"translation-form",children:t("create")},"confirm"),e(R,{id:"modal-cancel","data-testid":"cancel",variant:ne.link,onClick:()=>{l()},children:t("cancel")},"cancel")],children:e(ot,{id:"translation-form",isHorizontal:!0,onSubmit:a.handleSubmit(n),children:c(Ke,{...a,children:[e(be,{name:"key",label:t("key"),autoFocus:!0,rules:{required:t("required")}}),e(be,{name:"value",label:t("value"),rules:{required:t("required")}})]})})})},Ul=({internationalizationEnabled:l,watchSupportedLocales:n,realm:a,tableData:t})=>{const{adminClient:i}=ie(),{t:s}=H(),[u,d]=h(!1),[m,o]=h(!1),[p,A]=h([]),[C,N]=h(Ee),[S,f]=h(!1),{getValues:r,handleSubmit:w}=ve(),[x,v]=h(!1),[g,O]=h([]),[k,E]=h(0),[I,B]=h(10),[b,L]=h(0),[V,_]=h(""),J=ve({mode:"onChange"}),{addAlert:U,addError:q}=Te(),{realm:se}=le(),{whoAmI:ae}=st(),[pe,he]=h([]),[de,fe]=h(!1),[T,P]=h({}),[K,Q]=h(""),W=()=>{E(k+1)};Le(()=>{(async()=>{try{let z=await i.realms.getRealmLocalizationTexts({first:b,max:I,realm:a.realm,selectedLocale:C||r("defaultLocale")||ae.getLocale()});if(A(Object.entries(z)),V){const ce=Re=>Object.entries(z).filter(Lt=>Lt[Re].includes(V)),Y=dl(ce(0).concat(ce(1)),Ia);z=Object.fromEntries(Y)}return Object.entries(z).slice(b,b+I)}catch{return[]}})().then(z=>{const ce=z.map(Y=>({rowEditBtnAriaLabel:()=>s("rowEditBtnAriaLabel",{translation:Y[1]}),rowSaveBtnAriaLabel:()=>s("rowSaveBtnAriaLabel",{translation:Y[1]}),rowCancelBtnAriaLabel:()=>s("rowCancelBtnAriaLabel",{translation:Y[1]}),cells:[{title:Y[0],props:{value:Y[0]}},{title:Y[1],props:{value:Y[1]}}]}));O(ce)})},[k,t,b,I,V]);const me=()=>{d(!u)},Pe=[e(Kt,{label:s("defaultLocale"),children:e(ue,{value:Ee,children:Oe(Ee,ae.getDisplayName())},Ee)},"group1"),e(_e,{},"divider"),e(Kt,{label:s("supportedLocales"),children:n.map(M=>e(ue,{value:M,children:Oe(M,ae.getLocale())},M))},"group2")],y=async M=>{try{await i.realms.addLocalization({realm:se,selectedLocale:C||r("defaultLocale")||Ee,key:M.key},M.value),i.setConfig({realmName:se}),W(),J.setValue("key",""),J.setValue("value",""),wt.reloadResources(),U(s("addTranslationSuccess"),oe.success)}catch(z){q("addTranslationError",z)}},[ee,De]=ye({titleKey:"deleteConfirmTranslationTitle",messageKey:s("translationDeleteConfirmDialog",{count:pe.length}),continueButtonLabel:"delete",continueButtonVariant:ne.danger,onCancel:()=>{he([]),fe(!1)},onConfirm:async()=>{try{for(const M of pe)delete wt.store.data[ae.getLocale()][se][M],await i.realms.deleteRealmLocalizationTexts({realm:se,selectedLocale:C,key:M});fe(!1),he([]),W(),U(s("deleteAllTranslationsSuccess"),oe.success)}catch(M){q("deleteAllTranslationsError",M)}}}),It=(M,z)=>{const ce=(g[z].cells?.[0]).props.value;M.target.checked?he(Y=>[...Y,ce]):he(Y=>Y.filter(Re=>Re!==ce)),fe(g.length===pe.length+(M.target.checked?1:-1))},xa=()=>{he(de?[]:g.map(M=>(M.cells?.[0]).props.value)),fe(!de)},Da=M=>pe.includes(M),Ra=async(M,z)=>{const ce=Zt(g),Y=Zt(ce[z]);(Y.cells?.[1]).props.value=M,ce[z]=Y;try{const Re=(Y.cells?.[0]).props.value,Lt=(Y.cells?.[1]).props.value;await i.realms.addLocalization({realm:a.realm,selectedLocale:C||r("defaultLocale")||Ee,key:Re},Lt),wt.reloadResources(),U(s("updateTranslationSuccess"),oe.success),O(ce)}catch(Re){q("updateTranslationError",Re)}P(Re=>({...Re,[z]:!1}))};return c(X,{children:[e(De,{}),u&&e(Gl,{handleModalToggle:me,save:M=>{y(M),me()},form:J}),e(rt,{children:e(Ve,{className:"pf-v5-u-mt-lg pf-v5-u-ml-md",component:Ut.p,children:s("realmOverridesDescription")})}),c(pn,{count:p.length,first:b,max:I,onNextClick:L,onPreviousClick:L,onPerPageSelect:(M,z)=>{L(M),B(z)},inputGroupName:"search",inputGroupOnEnter:M=>{_(M),L(0),B(10)},inputGroupPlaceholder:s("searchForTranslation"),toolbarItem:c(X,{children:[e(R,{"data-testid":"add-translationBtn",onClick:()=>{d(!0),fe(!1),he([])},children:s("addTranslation")}),e(ke,{children:e(ma,{onOpenChange:M=>f(M),toggle:M=>e(pa,{ref:M,onClick:()=>f(!S),variant:"plain",isExpanded:S,"data-testid":"toolbar-deleteBtn","aria-label":"kebab",children:e(ha,{})}),isOpen:S,isPlain:!0,children:e(fa,{children:e(nt,{component:"button","data-testid":"delete-selected-TranslationBtn",isDisabled:p.length===0||pe.length===0,onClick:()=>{ee(),f(!1)},children:s("delete")},"action")})})})]}),searchTypeComponent:e(ke,{children:e(we,{width:180,isOpen:m,className:"kc-filter-by-locale-select",variant:Fe.single,isDisabled:!l,onToggle:M=>o(M),onSelect:M=>{N(M.toString()),v(!0),W(),o(!1)},selections:x?Oe(C,ae.getLocale()):a.defaultLocale!==""?Oe(Ee,ae.getLocale()):s("placeholderText"),children:Pe})}),children:[p.length===0&&!V&&e(xe,{hasIcon:!0,message:s("noTranslations"),instructions:s("noTranslationsInstructions"),onPrimaryAction:me}),p.length===0&&V&&e(xe,{hasIcon:!0,icon:ga,isSearchVariant:!0,message:s("noSearchResults"),instructions:s("noRealmOverridesSearchResultsInstructions")}),p.length!==0&&c(hn,{"aria-label":s("editableRowsTable"),"data-testid":"editable-rows-table",children:[e(fn,{children:c(Yt,{children:[e(ut,{className:"pf-v5-u-px-lg",children:e("input",{type:"checkbox","aria-label":s("selectAll"),checked:de,onChange:xa,"data-testid":"selectAll"})}),e(ut,{className:"pf-v5-u-py-lg",children:s("key")}),e(ut,{className:"pf-v5-u-py-lg",children:s("value")}),e(ut,{"aria-hidden":"true"})]})}),e(bn,{children:g.map((M,z)=>c(Yt,{children:[e(mt,{className:"pf-v5-u-px-lg",select:{rowIndex:z,onSelect:ce=>It(ce,z),isSelected:Da((M.cells?.[0]).props.value)}}),e(mt,{className:"pf-m-sm pf-v5-u-px-sm",dataLabel:s("key"),children:(M.cells?.[0]).props.value}),e(mt,{className:"pf-m-sm pf-v5-u-px-sm",dataLabel:s("value"),children:e(ot,{isHorizontal:!0,className:"kc-form-translationValue",onSubmit:w(()=>{Ra(K,z)}),children:e(D,{fieldId:"kc-translationValue",className:"pf-v5-u-display-inline-block",children:T[z]?c(X,{children:[e(St,{"aria-label":s("editTranslationValue"),type:"text",className:"pf-v5-u-w-initial","data-testid":`editTranslationValueInput-${z}`,value:K,onChange:(ce,Y)=>{Q(Y)}},`edit-input-${z}`),e(R,{variant:"link",className:"pf-m-plain","data-testid":`editTranslationAcceptBtn-${z}`,type:"submit","aria-label":s("acceptBtn"),icon:e(gn,{})}),e(R,{variant:"link",className:"pf-m-plain","data-testid":`editTranslationCancelBtn-${z}`,icon:e(vn,{}),"aria-label":s("cancelBtn"),onClick:()=>{P(ce=>({...ce,[z]:!1}))}})]}):c(X,{children:[e("span",{children:(M.cells?.[1]).props.value}),e(R,{onClick:()=>{const ce=(g[z].cells?.[1]).props.value;Q(ce),P(Y=>({...Y,[z]:!0}))},"aria-label":s("editBtn"),variant:"link",className:"pf-m-plain","data-testid":`editTranslationBtn-${z}`,children:e(Wn,{})},`edit-button-${z}`)]})})})},z),e(mt,{isActionCell:!0,children:e(yn,{items:[{title:s("delete"),onClick:()=>{he([(M.cells?.[0]).props.value]),p.length===1&&fe(!0),ee(),f(!1)}}]})})]},(M.cells?.[0]).props.value))})]})]})]})},Bl=({save:l,realm:n,tableData:a})=>{const{t}=H(),{whoAmI:i}=st(),[s,u]=h(0),d=ve(),{setValue:m,control:o,handleSubmit:p,formState:A}=d,C=n.supportedLocales?.length?n.supportedLocales:[Ee],N=$e().themes,S=Qe(()=>{const v=Object.values(N).flatMap(g=>g.flatMap(({locales:O})=>O||[]));return Array.from(new Set(v))},[N]),f=()=>{He(n,m),m("supportedLocales",C)};Le(f,[]);const r=Ue({control:o,name:"supportedLocales",defaultValue:C}),w=Ue({control:o,name:"internationalizationEnabled",defaultValue:n.internationalizationEnabled}),x=Ue({name:"defaultLocale",control:o,defaultValue:n.defaultLocale?[n.defaultLocale]:[]});return c(kt,{activeKey:s,onSelect:(v,g)=>u(g),children:[e($,{id:"locales",eventKey:0,title:e(j,{children:t("locales")}),"data-testid":"rs-localization-locales-tab",children:c(te,{isHorizontal:!0,role:"manage-realm",className:"pf-v5-u-mt-lg pf-v5-u-ml-md",onSubmit:p(l),children:[c(Ke,{...d,children:[e(oa,{name:"internationalizationEnabled",label:t("internationalization"),labelIcon:t("internationalizationHelp"),labelOn:t("enabled"),labelOff:t("disabled"),"aria-label":t("internationalization")}),w&&c(X,{children:[e(Ae,{name:"supportedLocales",isScrollable:!0,label:t("supportedLocales"),controller:{defaultValue:C},variant:"typeaheadMulti",placeholderText:t("selectLocales"),options:S.map(v=>({key:v,value:Oe(v,i.getLocale())||v}))}),e(Ae,{name:"defaultLocale",label:t("defaultLocale"),controller:{defaultValue:Ee},"data-testid":"select-default-locale",options:r.map(v=>({key:v,value:Oe(v,i.getLocale())||v}))})]})]}),c(Ie,{children:[e(R,{variant:"primary",isDisabled:!A.isDirty,type:"submit","data-testid":"localization-tab-save",children:t("save")}),e(R,{variant:"link",onClick:f,children:t("revert")})]})]})}),e($,{id:"realm-overrides",eventKey:1,title:c(j,{children:[t("realmOverrides")," "]}),"data-testid":"rs-localization-realm-overrides-tab",children:e(Ul,{internationalizationEnabled:w,watchSupportedLocales:r,realm:n,tableData:a})}),e($,{id:"effective-message-bundles",eventKey:2,title:e(j,{children:t("effectiveMessageBundles")}),"data-testid":"rs-localization-effective-message-bundles-tab",children:e(Hl,{defaultSupportedLocales:C,defaultLocales:x})})]})},Ge=({fieldName:l,url:n})=>{const{t:a}=H(),t=l.substring(l.indexOf(".")+1);return e(be,{name:l,label:a(t),labelIcon:c(Ct,{i18nKey:`${t}Help`,children:["Default value prevents pages from being included",e(ht,{href:n,title:a("learnMore")})]})})},_l=({realm:l,save:n})=>{const{t:a}=H(),t=ve(),{setValue:i,formState:{isDirty:s},handleSubmit:u}=t,d=()=>He(l,i);return Le(d,[]),e(Ke,{...t,children:c(te,{isHorizontal:!0,role:"manage-realm",className:"keycloak__security-defences__form",onSubmit:u(n),children:[e(Ge,{fieldName:"browserSecurityHeaders.xFrameOptions",url:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options"}),e(Ge,{fieldName:"browserSecurityHeaders.contentSecurityPolicy",url:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy"}),e(Ge,{fieldName:"browserSecurityHeaders.contentSecurityPolicyReportOnly",url:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy-Report-Only"}),e(Ge,{fieldName:"browserSecurityHeaders.xContentTypeOptions",url:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options"}),e(Ge,{fieldName:"browserSecurityHeaders.xRobotsTag",url:"https://developers.google.com/search/docs/advanced/robots/robots_meta_tag"}),e(Ge,{fieldName:"browserSecurityHeaders.xXSSProtection",url:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-XSS-Protection"}),e(Ge,{fieldName:"browserSecurityHeaders.strictTransportSecurity",url:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security"}),e(Ge,{fieldName:"browserSecurityHeaders.referrerPolicy",url:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referrer-Policy"}),c(Ie,{children:[e(R,{variant:"primary",type:"submit","data-testid":"headers-form-tab-save",isDisabled:!s,children:a("save")}),e(R,{variant:"link",onClick:d,children:a("revert")})]})]})})},pt=({name:l,style:n})=>{const{t:a}=H();return e(ka,{name:l,style:n,label:a(l),labelIcon:a(`${l}Help`),controller:{defaultValue:"",rules:{required:a("required")}}})},zl=({realm:l,save:n})=>{const{t:a}=H(),t=ve(),{setValue:i,handleSubmit:s,formState:{isDirty:u}}=t,[d,m]=h(!1),[o,p]=h(!1);let A;(r=>{r.Disabled="Disabled",r.PermanentLockout="PermanentLockout",r.TemporaryLockout="TemporaryLockout",r.PermanentAfterTemporaryLockout="PermanentAfterTemporaryLockout"})(A||(A={}));const C=["Disabled","PermanentLockout","TemporaryLockout","PermanentAfterTemporaryLockout"],N=["MULTIPLE","LINEAR"],S=()=>{He(l,i),p(!1)};Le(S,[]);const f=t.getValues("bruteForceProtected")?t.getValues("permanentLockout")?t.getValues("maxTemporaryLockouts")==0?"PermanentLockout":"PermanentAfterTemporaryLockout":"TemporaryLockout":"Disabled";return e(Ke,{...t,children:c(te,{role:"manage-realm",isHorizontal:!0,onSubmit:s(n),children:[e(D,{label:a("bruteForceMode"),fieldId:"kc-brute-force-mode",labelIcon:e(F,{helpText:a("bruteForceModeHelpText"),fieldLabelId:"bruteForceMode"}),children:e(we,{toggleId:"kc-brute-force-mode",onToggle:()=>m(!d),onSelect:r=>{switch(r){case"Disabled":t.setValue("bruteForceProtected",!1),t.setValue("permanentLockout",!1),t.setValue("maxTemporaryLockouts",0);break;case"TemporaryLockout":t.setValue("bruteForceProtected",!0),t.setValue("permanentLockout",!1),t.setValue("maxTemporaryLockouts",0);break;case"PermanentLockout":t.setValue("bruteForceProtected",!0),t.setValue("permanentLockout",!0),t.setValue("maxTemporaryLockouts",0);break;case"PermanentAfterTemporaryLockout":t.setValue("bruteForceProtected",!0),t.setValue("permanentLockout",!0),t.setValue("maxTemporaryLockouts",1);break}p(!0),m(!1)},selections:f,variant:Fe.single,isOpen:d,"data-testid":"select-brute-force-mode","aria-label":a("selectUnmanagedAttributePolicy"),children:C.map(r=>e(ue,{value:r,children:a(`bruteForceMode.${r}`)},r))})}),f!=="Disabled"&&c(X,{children:[e(xt,{name:"failureFactor",label:a("failureFactor"),labelIcon:a("failureFactorHelp"),controller:{defaultValue:0,rules:{required:a("required")}}}),f==="PermanentAfterTemporaryLockout"&&e(xt,{name:"maxTemporaryLockouts",label:a("maxTemporaryLockouts"),labelIcon:a("maxTemporaryLockoutsHelp"),controller:{defaultValue:0}}),(f==="TemporaryLockout"||f==="PermanentAfterTemporaryLockout")&&c(X,{children:[e(Ae,{name:"bruteForceStrategy",label:a("bruteForceStrategy"),labelIcon:a("bruteForceStrategyHelp"),controller:{defaultValue:""},options:N.map(r=>({key:r,value:a(`bruteForceStrategy.${r}`)}))}),e(pt,{name:"waitIncrementSeconds"}),e(pt,{name:"maxFailureWaitSeconds"}),e(pt,{name:"maxDeltaTimeSeconds"})]}),e(xt,{name:"quickLoginCheckMilliSeconds",label:a("quickLoginCheckMilliSeconds"),labelIcon:a("quickLoginCheckMilliSecondsHelp"),controller:{defaultValue:0}}),e(pt,{name:"minimumQuickLoginWaitSeconds"})]}),c(Ie,{children:[e(R,{variant:"primary",type:"submit","data-testid":"brute-force-tab-save",isDisabled:!u&&!o,children:a("save")}),e(R,{variant:"link",onClick:S,children:a("revert")})]})]})})},$l=({realm:l,save:n})=>{const{t:a}=H(),[t,i]=h(10);return c(kt,{activeKey:t,onSelect:(s,u)=>i(u),children:[e($,{id:"headers",eventKey:10,"data-testid":"security-defenses-headers-tab",title:e(j,{children:a("headers")}),children:e(re,{variant:"light",children:e(_l,{realm:l,save:n})})}),e($,{id:"bruteForce",eventKey:20,"data-testid":"security-defenses-brute-force-tab",title:e(j,{children:a("bruteForceDetection")}),children:e(re,{variant:"light",children:e(zl,{realm:l,save:n})})})]})},jl=({setTableData:l})=>{const{adminClient:n}=ie(),{config:a,save:t}=qt(),{t:i}=H(),s=zt(),u=Ze(),{realm:d}=le(),[m,o]=h(0),[p,A]=h();Le(()=>o(r=>r+1),[a]);async function C(){return a?.groups??[]}const[N,S]=ye({titleKey:"deleteDialogTitle",children:c(Ct,{i18nKey:"deleteDialogDescription",children:[" ",e("strong",{children:{group:p?.name}}),"."]}),continueButtonLabel:"delete",continueButtonVariant:ne.danger,onConfirm:async()=>{const r=(a?.groups??[]).filter(v=>v!==p),w=p?.displayHeader?.substring(2,p?.displayHeader.length-1),x=p?.displayDescription?.substring(2,p?.displayDescription.length-1);try{await Promise.all(s.map(async v=>{try{if(await n.realms.getRealmLocalizationTexts({realm:d,selectedLocale:v})){await n.realms.deleteRealmLocalizationTexts({realm:d,selectedLocale:v,key:w}),await n.realms.deleteRealmLocalizationTexts({realm:d,selectedLocale:v,key:x});const O=await n.realms.getRealmLocalizationTexts({realm:d,selectedLocale:v});l([O])}}catch{console.error(`Error removing translations for ${v}`)}})),t({...a,groups:r},{successMessageKey:"deleteSuccess",errorMessageKey:"deleteAttributeGroupError"})}catch(v){console.error(`Error removing translations or updating attributes group: ${v}`)}}});function f(r){A(r),N()}return c(re,{variant:"light",className:"pf-v5-u-p-0",children:[e(S,{}),e(ze,{loader:C,ariaLabelKey:"tableTitle",toolbarItem:e(ke,{children:e(R,{component:r=>e(Se,{"data-testid":"create-attributes-groups-action",...r,to:ea({realm:d})}),children:i("createGroupText")})}),columns:[{name:"name",displayKey:"columnName",cellRenderer:r=>e(Se,{to:Tn({realm:d,name:r.name}),children:r.name})},{name:"displayHeader",displayKey:"columnDisplayName"},{name:"displayDescription",displayKey:"columnDisplayDescription"}],actions:[{title:i("delete"),onRowClick:f}],emptyState:e(xe,{message:i("emptyStateMessage"),instructions:i("emptyStateInstructions"),primaryActionText:i("createGroupText"),onPrimaryAction:()=>u(ea({realm:d}))})},m)]})},ql=["username","email"],Wl=({setTableData:l})=>{const{adminClient:n}=ie(),{config:a,save:t}=qt(),{realm:i}=le(),{t:s}=H(),u=zt(),d=Ze(),[m,o]=h("allGroups"),[p,A]=qe(),[C,N]=h(a?.attributes),[S,f]=h(""),[r,w]=ye({titleKey:s("deleteAttributeConfirmTitle"),messageKey:s("deleteAttributeConfirm",{attributeName:S}),continueButtonLabel:s("delete"),continueButtonVariant:ne.danger,onConfirm:async()=>{if(!a?.attributes)return;const k=a.attributes.find(I=>I.name===S)?.displayName,E=k?.substring(2,k.length-1);try{await Promise.all(u.map(async B=>{try{if(await n.realms.getRealmLocalizationTexts({realm:i,selectedLocale:B})){await n.realms.deleteRealmLocalizationTexts({realm:i,selectedLocale:B,key:E});const L=await n.realms.getRealmLocalizationTexts({realm:i,selectedLocale:B});l([L])}}catch{console.error(`Error removing translations for ${B}`)}}));const I=a.attributes.filter(B=>B.name!==S);t({...a,attributes:I,groups:a.groups},{successMessageKey:"deleteAttributeSuccess",errorMessageKey:"deleteAttributeError"}),f("")}catch(I){console.error(`Error removing translations or updating attributes: ${I}`)}}});if(!a)return e(Je,{});const x=a.attributes??[],v=a.groups??[],g=async(k,E)=>{const I=x.findIndex(b=>b.name===k.name);let B={};B=x[I],x.splice(I,1),x.splice(E,0,B),t({attributes:x,groups:v},{successMessageKey:"updatedUserProfileSuccess",errorMessageKey:"updatedUserProfileError"})},O=k=>e(Se,{to:ta({realm:i,attributeName:k.name}),children:k.name},k.name);return c(X,{children:[e(ba,{children:c(Cn,{children:[e(ke,{children:e(we,{toggleId:"kc-group-filter",width:200,"data-testid":"filter-select",isOpen:p,variant:Fe.single,onToggle:A,toggleIcon:e(La,{}),onSelect:k=>{const E=k.toString();o(E),N(E==="allGroups"?x:x.filter(I=>I.group===E)),A()},selections:m==="allGroups"?s(m):m,children:[e(ue,{"data-testid":"all-groups",value:"allGroups",children:s("allGroups")},"allGroups"),...Sn(x.filter(k=>!!k.group),"group").map(k=>e(ue,{value:k.group,children:k.group},k.group))]})}),e(ke,{className:"kc-toolbar-attributesTab",children:e(R,{"data-testid":"createAttributeBtn",variant:"primary",component:k=>e(Se,{...k,to:kn({realm:i})}),children:s("createAttribute")})})]})}),e(_e,{}),e(w,{}),e(Pa,{keyField:"name",onDragFinish:async(k,E)=>{const I=x.map(V=>V.name),B=E.indexOf(k),b=I.indexOf(k),L=x[b];L.name&&g(L,B)},actions:[{title:s("edit"),onClick:(k,E,I)=>{d(ta({realm:i,attributeName:I.name}))}},{title:s("delete"),isActionable:({name:k})=>!ql.includes(k),onClick:(k,E,I)=>{f(I.name),r()}}],columns:[{name:"name",displayKey:s("attributeName"),cellRenderer:O},{name:"displayName",displayKey:s("attributeDisplayName")},{name:"group",displayKey:s("attributeGroup")}],data:C??x})]})},Jl=()=>{const{config:l,save:n,isSaving:a}=qt(),{t}=H(),{addError:i}=Te(),[s,u]=h();Le(()=>d(),[l,s]);function d(){s?.setValue(l?it(l):"")}async function m(){const o=s?.getValue();if(o)try{await n(JSON.parse(o))}catch(p){i("invalidJsonError",p);return}}return c(re,{variant:"light",children:[e($t,{language:jt.json,height:"30rem",onEditorDidMount:o=>u(o),isLanguageLabelVisible:!0}),e(ot,{children:c(Ie,{children:[e(R,{"data-testid":"save",variant:"primary",onClick:m,isDisabled:a,children:t("save")}),e(R,{variant:"link",onClick:d,isDisabled:a,children:t("revert")})]})})]})},Xl=({setTableData:l})=>{const{realm:n}=le(),{t:a}=H(),t=d=>Tt(aa({realm:n,tab:d})),i=t("attributes"),s=t("attributes-group"),u=t("json-editor");return e(Jn,{children:c(yt,{defaultLocation:aa({realm:n,tab:"attributes"}),mountOnEnter:!0,children:[e($,{title:e(j,{children:a("attributes")}),"data-testid":"attributesTab",...i,children:e(Wl,{setTableData:l})}),e($,{title:e(j,{children:a("attributesGroup")}),"data-testid":"attributesGroupTab",...s,children:e(jl,{setTableData:l})}),e($,{title:e(j,{children:a("jsonEditor")}),"data-testid":"jsonEditorTab",...u,children:e(Jl,{})})]})})},Ql=({save:l,onChange:n,value:a,realmName:t,refresh:i})=>{const{adminClient:s}=ie(),{environment:u}=ca(),{t:d}=H(),{addAlert:m,addError:o}=Te(),p=Ze(),[A,C]=h(!1),[N,S]=h(!1),{hasAccess:f}=Bt(),r=f("manage-realm"),[w,x]=ye({titleKey:"disableConfirmTitle",messageKey:"disableConfirmRealm",continueButtonLabel:"disable",onConfirm:()=>{n(!a),l()}}),[v,g]=ye({titleKey:"deleteConfirmTitle",messageKey:"deleteConfirmRealmSetting",continueButtonLabel:"delete",continueButtonVariant:ne.danger,onConfirm:async()=>{try{await s.realms.del({realm:t}),m(d("deletedSuccessRealmSetting"),oe.success),p(In({realm:u.masterRealm})),i()}catch(O){o("deleteErrorRealmSetting",O)}}});return c(X,{children:[e(x,{}),e(g,{}),e(vl,{open:A,toggleDialog:()=>C(!A)}),e(gl,{isOpen:N,onClose:()=>S(!1)}),e(Dn,{titleKey:t,subKey:"realmSettingsExplain",helpUrl:Ln.realmSettingsUrl,divider:!1,dropdownItems:[e(nt,{"data-testid":"openPartialImportModal",isDisabled:!r,onClick:()=>{C(!0)},children:d("partialImport")},"import"),e(nt,{"data-testid":"openPartialExportModal",isDisabled:!r,onClick:()=>S(!0),children:d("partialExport")},"export"),e(_e,{},"separator"),e(nt,{isDisabled:!r,onClick:v,children:d("delete")},"delete")],isEnabled:a,isReadOnly:!r,onToggle:O=>{O?(n(O),l()):w()}})]})},Yl=()=>{const{adminClient:l}=ie(),{t:n}=H(),{addAlert:a,addError:t}=Te(),{realm:i,realmRepresentation:s,refresh:u}=le(),d=zt(),m=Ze(),o=Ht(),[p,A]=h(void 0),{control:C,setValue:N,getValues:S}=ve({mode:"onChange"}),[f,r]=h(0),w=()=>{r(f+1)},x=(K=s)=>{He(K,N)};Le(()=>{x(),(async()=>{try{await Promise.all(d.map(async Q=>{try{const W=await l.realms.getRealmLocalizationTexts({realm:i,selectedLocale:Q});W&&A([W])}catch{return[]}}))}catch{return[]}})()},[N,s]);const v=async K=>{K=Pn(K),K.attributes?.["acr.loa.map"]&&typeof K.attributes["acr.loa.map"]!="string"&&(K.attributes["acr.loa.map"]=JSON.stringify(Object.fromEntries(K.attributes["acr.loa.map"].filter(({key:W})=>W!=="").map(({key:W,value:me})=>[W,me]))));try{const W={...s,...K,id:K.realm};W.smtpServer?.port===""&&(W.smtpServer={...W.smtpServer,port:null});const me=await En(An(l.baseUrl,`admin/realms/${i}/ui-ext`),{method:"PUT",body:JSON.stringify(W),headers:{"Content-Type":"application/json",...wn(await l.getAccessToken())}});if(!me.ok)throw new Error(me.statusText);a(n("realmSaveSuccess"),oe.success)}catch(W){t("realmSaveError",W)}i!==(K.realm||s?.realm)&&m(Dt({realm:K.realm,tab:"general"})),u()},g=K=>Tt(Dt({realm:i,tab:K})),O=g("general"),k=g("login"),E=g("email"),I=g("themes"),B=g("keys"),b=g("events"),L=g("localization"),V=g("security-defenses"),_=g("sessions"),J=g("tokens"),U=g("client-policies"),q=g("user-profile"),se=g("user-registration"),{hasAccess:ae,hasSomeAccess:pe}=Bt(),he=ae("view-realm")&&pe("view-events","manage-events"),de=ae("view-realm")&&pe("view-clients","manage-clients"),fe=K=>Tt(Ot({realm:i,tab:K})),T=fe("profiles"),P=fe("policies");return c(X,{children:[e(G,{name:"enabled",defaultValue:!0,control:C,render:({field:K})=>e(Ql,{value:K.value,onChange:K.onChange,realmName:i,refresh:w,save:()=>v(S())})}),e(re,{variant:"light",className:"pf-v5-u-p-0",children:c(yt,{isBox:!0,mountOnEnter:!0,"aria-label":"realm-settings-tabs",defaultLocation:Dt({realm:i,tab:"general"}),children:[e($,{title:e(j,{children:n("general")}),"data-testid":"rs-general-tab",...O,children:e(pl,{realm:s,save:v})}),e($,{title:e(j,{children:n("login")}),"data-testid":"rs-login-tab",...k,children:e(bl,{refresh:u,realm:s})}),e($,{title:e(j,{children:n("email")}),"data-testid":"rs-email-tab",...E,children:e(ml,{realm:s,save:v})}),e($,{title:e(j,{children:n("themes")}),"data-testid":"rs-themes-tab",...I,children:e(kl,{realm:s,save:v})}),e($,{title:e(j,{children:n("keys")}),"data-testid":"rs-keys-tab",...B,children:e(Kl,{})}),he&&e($,{title:e(j,{children:n("events")}),"data-testid":"rs-realm-events-tab",...b,children:e(wl,{realm:s})}),e($,{title:e(j,{children:n("localization")}),"data-testid":"rs-localization-tab",...L,children:e(Bl,{save:v,realm:s,tableData:p},f)}),e($,{title:e(j,{children:n("securityDefences")}),"data-testid":"rs-security-defenses-tab",...V,children:e($l,{realm:s,save:v})}),e($,{title:e(j,{children:n("sessions")}),"data-testid":"rs-sessions-tab",..._,children:e(Sl,{realm:s,save:v},f)}),e($,{title:e(j,{children:n("tokens")}),"data-testid":"rs-tokens-tab",...J,children:e(Il,{save:v,realm:s})}),o(gt.ClientPolicies)&&e($,{title:e(j,{children:n("clientPolicies")}),"data-testid":"rs-clientPolicies-tab",...U,children:c(yt,{mountOnEnter:!0,defaultLocation:Ot({realm:i,tab:"profiles"}),children:[e($,{id:"profiles","data-testid":"rs-policies-clientProfiles-tab","aria-label":n("clientProfilesSubTab"),title:e(j,{children:n("profiles")}),tooltip:e(na,{content:n("clientPoliciesProfilesHelpText")}),...T,children:e(Cl,{})}),e($,{id:"policies","data-testid":"rs-policies-clientPolicies-tab","aria-label":n("clientPoliciesSubTab"),...P,title:e(j,{children:n("policies")}),tooltip:e(na,{content:n("clientPoliciesPoliciesHelpText")}),children:e(yl,{})})]})}),e($,{title:e(j,{children:n("userProfile")}),"data-testid":"rs-user-profile-tab",...q,children:e(Xl,{setTableData:A})}),de&&e($,{title:e(j,{children:n("userRegistration")}),"data-testid":"rs-userRegistration-tab",...se,children:e(Pl,{})})]})})]})};function $i(){return e(Yl,{})}export{$i as default};
//# sourceMappingURL=RealmSettingsSection-B8FIUzu-.js.map
