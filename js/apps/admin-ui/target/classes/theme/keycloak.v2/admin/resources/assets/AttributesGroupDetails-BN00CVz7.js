import{jsxs as y,Fragment as ya,jsx as t}from"react/jsx-runtime";import{u as ma,a as ba,d as fa,b as Da,c as ga,l as ha,V as Ha,z as Ta,j as Ga,K as M,P as Aa,n as va,J as ka,N as w,_ as S,cx as j,cy as E,a1 as R,bt as B,f as x,G as Na,H as Ea,A as xa,L as za,fg as O,fa as Ia}from"./main-hjbDDO6j.js";import{useState as h,useMemo as wa,useEffect as U}from"react";import{F as Pa}from"./FormAccess-DEsYjDHG.js";import{K as Fa}from"./KeyValueInput-BjiKJH0l.js";import{V as $a}from"./ViewHeader-Dr6ZoEJz.js";import{u as La}from"./useLocale-BtoaQcMD.js";/* empty css                               */import{u as Ka,U as Va}from"./UserProfileContext-knLEppNh.js";import{A as Ca,G as q}from"./AddTranslationsDialog-BU7BhuPq.js";import"react-dom";import"./copy-icon-ePLWnxgr.js";import"./KeySelect-CBdQO7FV.js";function Ma(m){return Object.entries(m).reduce((e,[p,s])=>typeof s=="string"?[...e,{key:p,value:s}]:[...e],[])}function Sa(m){return Object.fromEntries(m.filter(e=>e.key.length>0).map(e=>[e.key,e.value]))}const _={annotations:[],displayDescription:"",displayHeader:"",name:""};function ja(){const{adminClient:m}=ma(),{t:e}=ba(),{realm:p,realmRepresentation:s}=fa(),{config:g,save:J}=Ka(),W=Da(),P=La(),z=ga(),r=ha({defaultValues:_}),{addError:Q}=Ha(),c=!!z.name,[b,X]=h(""),[H,Y]=h(""),[T,Z]=h(""),[aa,G]=Ta(),ta=/\$\{([^}]+)\}/,[f,F]=h(),[l,I]=h({displayHeader:{key:"",translations:[]},displayDescription:{key:"",translations:[]}}),o=wa(()=>g?.groups?.find(({name:i})=>i===z.name),[g?.groups,z.name]);U(()=>{if(!o)return;const i=o.annotations?Ma(o.annotations):[];r.reset({..._,...o,annotations:i})},[o,r]),U(()=>{r.setValue("displayHeader",o?.displayHeader||H||""),r.setValue("displayDescription",o?.displayDescription||T||"")},[H,T,o,r]),Ga(async()=>{const i=[],a=[];await Promise.all(P.map(async n=>{try{const u=await m.realms.getRealmLocalizationTexts({realm:p,selectedLocale:n}),k=r.getValues(),N=ua=>{const C=ua?.match(/\$\{(.*?)\}/);return C?C[1]:""},D=N(k.displayHeader)||"",L=N(k.displayDescription)||"",K=u[D]||"",V=u[L]||"";K&&i.push({key:D,translations:[{locale:n,value:K}]}),V&&a.push({key:L,translations:[{locale:n,value:V}]})}catch(u){console.error(`Error fetching translations for ${n}:`,u)}}));const d={displayHeader:{key:i.length>0?i[0].key:"",translations:i.flatMap(n=>n.translations)},displayDescription:{key:a.length>0?a[0].key:"",translations:a.flatMap(n=>n.translations)}};I(d)},()=>{},[P,p,r]);const ea=async()=>{const i=async(a,d,n)=>{try{await m.realms.addLocalization({realm:p,selectedLocale:d,key:a},n)}catch(u){console.error(`Error saving translation for locale ${d}: ${u}`)}};try{if(l&&l.displayHeader.translations.length>0)for(const a of l.displayHeader.translations)a.locale&&a.value&&await i(l.displayHeader.key,a.locale,a.value);if(l&&l.displayDescription.translations.length>0)for(const a of l.displayDescription.translations)a.locale&&a.value&&await i(l.displayDescription.key,a.locale,a.value)}catch(a){console.error(`Error while processing translations: ${a}`)}},ia=async i=>{if(!g)return;const a=[...g.groups??[]],d=o?a.indexOf(o):-1,n={...i,annotations:Sa(i.annotations)};if(d===-1?a.push(n):a[d]=n,s?.internationalizationEnabled){const k=l.displayHeader.translations.some(D=>D.value.trim()!==""),N=l.displayDescription.translations.some(D=>D.value.trim()!=="");if(!k||!N){Q("createAttributeError",e("translationError"));return}}await J({...g,groups:a})&&(await ea(),Ia.reloadResources(),W(O({realm:p,tab:"attributes-group"})))},A=M({control:r.control,name:"displayHeader"}),v=M({control:r.control,name:"displayDescription"}),na=(i,a)=>{const d=a!==""&&s?.internationalizationEnabled?`\${profile.attribute-group.${a}}`:"",n=a!==""&&s?.internationalizationEnabled?`\${profile.attribute-group-description.${a}}`:"";X(a),Y(d),Z(n)},$=ta.test(A||v),sa=A?.substring(2,A.length-1),ra=v?.substring(2,v.length-1),oa=i=>{I(a=>({...a,displayHeader:i}))},la=i=>{I(a=>({...a,displayDescription:i}))},da=()=>{G()},pa=f==="displayHeader"?sa:`profile.attribute-group.${b}`,ca=f==="displayDescription"?ra:`profile.attribute-group-description.${b}`;return y(ya,{children:[aa&&t(Ca,{translationKey:f==="displayHeader"?pa:ca,type:f==="displayHeader"?"displayHeader":"displayDescription",translations:f==="displayHeader"?l.displayHeader:l.displayDescription,onTranslationsAdded:f==="displayHeader"?oa:la,toggleDialog:da,onCancel:()=>{G()}}),t($a,{titleKey:o?"editGroupText":"createGroupText",divider:!0}),t(Aa,{variant:"light",onSubmit:r.handleSubmit(ia),children:t(Pa,{isHorizontal:!0,role:"manage-realm",children:y(va,{...r,children:[t(ka,{name:"name",label:e("nameField"),labelIcon:e("nameHintHelp"),isDisabled:!!o||c,rules:{required:e("required"),onChange:i=>{na(i,i.target.value)}}}),!!o&&t("input",{type:"hidden",...r.register("name")}),t(w,{label:e("displayHeaderField"),labelIcon:t(S,{helpText:e("displayHeaderHintHelp"),fieldLabelId:"displayHeaderField"}),fieldId:"kc-attributes-group-display-header",children:y(j,{hasGutter:!0,children:[y(E,{span:s?.internationalizationEnabled?11:12,children:[t(R,{id:"kc-attributes-group-display-header","data-testid":"attributes-group-display-header",isDisabled:s?.internationalizationEnabled&&b!==""||c&&$,value:c?A:s?.internationalizationEnabled?H:void 0,...r.register("displayHeader")}),H&&t(B,{className:"pf-v5-u-mt-sm",variant:"info",isInline:!0,isPlain:!0,title:e("addAttributesGroupTranslationInfo")})]}),s?.internationalizationEnabled&&t(E,{span:1,children:t(x,{variant:"link",className:"pf-m-plain","data-testid":"addAttributeDisplayNameTranslationBtn","aria-label":e("addAttributeDisplayNameTranslation"),isDisabled:!b&&!c,onClick:()=>{F("displayHeader"),G()},icon:t(q,{})})})]})}),t(w,{label:e("displayDescriptionField"),labelIcon:t(S,{helpText:e("displayDescriptionHintHelp"),fieldLabelId:"displayDescriptionField"}),fieldId:"kc-attributes-group-display-description",children:y(j,{hasGutter:!0,children:[y(E,{span:s?.internationalizationEnabled?11:12,children:[t(R,{id:"kc-attributes-group-display-description","data-testid":"attributes-group-display-description",isDisabled:s?.internationalizationEnabled&&b!==""||c&&$,value:c?v:s?.internationalizationEnabled?T:void 0,...r.register("displayDescription")}),T&&t(B,{className:"pf-v5-u-mt-sm",variant:"info",isInline:!0,isPlain:!0,title:e("addAttributesGroupTranslationInfo")})]}),s?.internationalizationEnabled&&t(E,{span:1,children:t(x,{variant:"link",className:"pf-m-plain","data-testid":"addAttributeDisplayDescriptionTranslationBtn","aria-label":e("addAttributeDisplayDescriptionTranslation"),isDisabled:!b&&!c,onClick:()=>{F("displayDescription"),G()},icon:t(q,{})})})]})}),t(Na,{children:t(Ea,{component:"h2",children:e("annotationsText")})}),t(w,{label:e("annotationsText"),fieldId:"kc-annotations",children:t(Fa,{label:e("annotationsText"),name:"annotations"})}),y(xa,{children:[t(x,{variant:"primary",type:"submit","data-testid":"saveGroupBtn",children:e("save")}),t(x,{variant:"link",component:i=>t(za,{...i,to:O({realm:p,tab:"attributes-group"})}),children:e("cancel")})]})]})})})]})}const tt=()=>t(Va,{children:t(ja,{})});export{tt as default};
//# sourceMappingURL=AttributesGroupDetails-BN00CVz7.js.map
